var me=Object.defineProperty,$t=Object.defineProperties,zt=Object.getOwnPropertyDescriptor,Nt=Object.getOwnPropertyDescriptors;var re=Object.getOwnPropertySymbols;var Ke=Object.prototype.hasOwnProperty,Je=Object.prototype.propertyIsEnumerable;var je=(r,t,e)=>t in r?me(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,G=(r,t)=>{for(var e in t||(t={}))Ke.call(t,e)&&je(r,e,t[e]);if(re)for(var e of re(t))Je.call(t,e)&&je(r,e,t[e]);return r},A=(r,t)=>$t(r,Nt(t)),u=(r,t)=>me(r,"name",{value:t,configurable:!0});var se=(r,t)=>{var e={};for(var i in r)Ke.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&re)for(var i of re(r))t.indexOf(i)<0&&Je.call(r,i)&&(e[i]=r[i]);return e};var D=(r,t,e,i)=>{for(var s=i>1?void 0:i?zt(t,e):t,n=r.length-1,a;n>=0;n--)(a=r[n])&&(s=(i?a(t,e,s):a(s))||s);return i&&s&&me(t,e,s),s};var F=(r,t,e)=>new Promise((i,s)=>{var n=l=>{try{o(e.next(l))}catch(p){s(p)}},a=l=>{try{o(e.throw(l))}catch(p){s(p)}},o=l=>l.done?i(l.value):Promise.resolve(l.value).then(n,a);o((e=e.apply(r,t)).next())});import{EditorTypeRegistry as Kt}from"@serenity-is/corelib";import{deepClone as Ye,extend as ve,getHighlightTarget as Jt,isBS3 as Qt,notifyError as Xt,notifyWarning as Yt,serviceRequest as Zt,tryFirst as Ze,tryGetText as et}from"@serenity-is/corelib";import{Widget as Ht,EditorTypeRegistry as _t,EditorUtils as fe,Select2Editor as Ut,EnumEditor as Wt}from"@serenity-is/corelib";import{extend as Qe,isInstanceOfType as Xe,localText as qt,toId as jt}from"@serenity-is/corelib";var U=class{constructor(t){var p,d,c,h,g,b,f,v,y,x,C,w,V,qe;this.args=t;var e=t.grid.getOptions().editorFactory,i=(p=t.column.editableProperty)!=null?p:t.column.sourceItem,s=Qe({},i.editorParams),n=(d=e==null?void 0:e.options)==null?void 0:d.editorParams;n!=null&&(typeof n=="function"&&(n=n({column:t.column,item:t.item,slickArgs:t})),s=Qe(s,n));var a=(b=(h=(c=e==null?void 0:e.options)==null?void 0:c.editorType)==null?void 0:h.call(c,{column:t.column,item:t.item,slickArgs:t}))!=null?b:_t.get((g=i.editorType)!=null?g:"String"),o={container:$(t.container),element:Vt=>Vt.addClass("s-cell-editor"),type:a,options:s};this.editor=Ht.create(o);var l=(v=(f=s.maxLength)!=null?f:s.maxlength)!=null?v:i==null?void 0:i.maxLength;l!=null&&this.editor.element.is(":input")&&(l>0?(y=this.editor.element)==null||y.attr("maxlength",l):(x=this.editor.element)==null||x.removeAttr("maxlength")),this.editor.element.focus(),(w=(C=this.editor.element[0]).select)==null||w.call(C),(qe=(V=e==null?void 0:e.options)==null?void 0:V.editorInit)==null||qe.call(V,{column:t.column,editor:this.editor,item:t.item,slickArgs:t})}focus(){this.editor.element.focus()}isValueChanged(){return JSON.stringify(this.serializeValue())!=JSON.stringify(this.defaultValue)}loadValue(t){var i;let e=(i=this.args.column.editableProperty)!=null?i:this.args.column.sourceItem;fe.loadValue(this.editor,e,t),this.defaultValue=this.serializeValue()}serializeValue(){var s;let t=(s=this.args.column.editableProperty)!=null?s:this.args.column.sourceItem,e=Object.create(null);if(fe.saveValue(this.editor,t,e),Xe(this.editor,Wt)){var i=e[t.name];typeof i=="string"&&!isNaN(i)&&(e[t.name]=jt(i))}return t.name!==this.args.column.field&&Xe(this.editor,Ut)&&(e[this.args.column.field]=this.editor.text),e}applyValue(t,e){for(var i of Object.keys(e))t[i]=e[i]}position(t){}preClick(){var t;((t=this.args.column.sourceItem)==null?void 0:t.editorType)=="Boolean"&&(this.editor.value=!this.editor.value)}hide(){}show(){}validate(){var a,o;let t=(a=this.args.column.editableProperty)!=null?a:this.args.column.sourceItem,e=fe.getValue(this.editor);if(t.required&&(e==null||typeof e=="string"&&!e.trim().length))return{valid:!1,msg:qt("Validation.Required")};if(this.args.column.validator!=null){var i=this.args.column.validator(e,this.args);if(!i.valid)return i}var s=this.args.grid.getOptions().editorFactory;if(s&&((o=s.options)!=null&&o.validator)){var n=s.options.validator(e,this.args);if(n!=null)return{valid:!1,msg:n}}return{valid:!0,msg:null}}destroy(){var t;(t=this.editor)==null||t.destroy()}};u(U,"GridEditWrapper");var ei={autoSave:!1,refreshAfterSave:!0,resetOnLoad:!0,showValidationError:!0,undoRowDblEsc:!0},ye=class{constructor(t){this.dirtyStyles={};var i;this._options=t=ve(ve({},ei),t),t.grid.slickGrid.setOptions({editable:!0,editorFactory:this,enableCellNavigation:!0,editorCellNavOnLRKeys:!1,autoEdit:!0,editCommandHandler:(s,n,a)=>{var d,c;var o=s.__orig;o==null&&(s.__orig=ve({},s));var l=s[n.field];a.execute();var p=s[n.field];(c=(d=this.options).afterCommitEdit)==null||c.call(d,{column:n,item:s,oldValue:l,value:p,row:a.row}),this.updateModifiedClassesForRow(a.row),t.grid.updateInterface(),t.autoSave&&this.saveChanges()}});var e;t.undoRowDblEsc&&t.grid.slickGrid.onKeyDown.subscribe(s=>{if(s.key==="Escape"&&!t.grid.slickGrid.getCellEditor()){var n=t.grid.slickGrid.getActiveCell();n!=null&&n.row>=0&&n.cell>=0&&e!=null&&n.row==e.row&&n.cell==e.cell?(e=null,this.undoRowChanges(n.row),t.grid.slickGrid.updateRow(n.row)):e=n}else e=null}),t.showValidationError&&t.grid.slickGrid.onValidationError.subscribe((s,n)=>{ti(n.cellNode,n.validationResults.msg)}),t.resetOnLoad&&((i=t.grid.view)==null||i.onDataLoaded.subscribe(()=>{this.undoChanges()}))}updateModifiedClassesForRow(t){var d,c;var e=this._options.grid.slickGrid,i=e.getDataItem(t),s=i.__orig;if(s==null)delete this.dirtyStyles[t];else{var n=this.dirtyStyles[t];n==null&&(this.dirtyStyles[t]=n={});for(var a=e.getColumns(),o=0;o<a.length;o++){var l=a[o],p=(c=(d=l.editableProperty)==null?void 0:d.name)!=null?c:l.field;p==null||!this.isFieldDirty(i,p)?delete n[l.id]:n[l.id]="slick-cell-dirty"}}e.setCellCssStyles("dirtycells",Ye(this.dirtyStyles))}get options(){return this._options}getEditor(t,e){var l,p,d,c;if(t.editableProperty==null&&t.sourceItem&&t.sourceItem.filteringIdField!=null){var i=this._options.grid.propertyItemsData;if(i!=null){var s=t.sourceItem.filteringIdField;t.editableProperty=(p=(l=Ze(i.items||[],h=>h.name==s))!=null?l:Ze(i.additionalItems||[],h=>h.name==s))!=null?p:null}}var n=(d=t.editableProperty)!=null?d:t.sourceItem;if(n==null||n.readOnly||n.updatable===!1||Kt.get((c=t.sourceItem.editorType)!=null?c:"String")==null)return null;if(this._options.editable!=null){var a=this._options.grid.slickGrid.getDataItem(e),o=this._options.editable({column:t,item:a,row:e});if(o!==void 0&&!o)return null}return U}isDirty(){var n;var t=(n=this._options.grid)==null?void 0:n.slickGrid;if(!t)return!1;for(var e=t.getDataLength(),i=0;i<e;i++){var s=t.getDataItem(i);if(this.isItemDirty(s))return!0}return!1}isItemDirty(t){return t&&t.__orig&&Object.keys(t).some(e=>e!=="__orig"&&t.__orig[e]!=t[e])}isFieldDirty(t,e){return t.__orig&&t.__orig[e]!=t[e]}undoRowChanges(t){var e=this._options.grid.slickGrid.getDataItem(t);if(e&&e.__orig){var i=e.__orig;for(var s in e)delete e[s];for(var s in i)e[s]=i[s]}this.updateModifiedClassesForRow(t)}undoChanges(){var a;var t=(a=this._options.grid)==null?void 0:a.slickGrid;if(t){for(var e=t.getDataLength(),i=0;i<e;i++){var s=t.getDataItem(i);s.__orig&&this.undoRowChanges(i)}for(var n in this.dirtyStyles)delete this.dirtyStyles[n];t.setCellCssStyles("dirtycells",Ye(this.dirtyStyles)),t.invalidate()}}saveChanges(){var c;var t=(c=this._options.grid)==null?void 0:c.slickGrid;if(t){for(var e=t.getDataLength(),i={},s=0;s<e;s++){var n=t.getDataItem(s);if(this.isItemDirty(n)){var a={EntityId:n.__orig[this._options.grid.getIdProperty()],Entity:Object.create(null)};for(var o of Object.keys(n))o!=="__orig"&&this.isFieldDirty(n,o)&&(a.Entity[o]=n[o]);Object.keys(a.Entity).length&&(i[s]=a)}}var l=Object.keys(i),p=-1,d=this;u(function h(){if(++p>=l.length){d.undoChanges(),d._options.refreshAfterSave&&d._options.grid.refresh(),d._options.grid.updateInterface();return}var g=parseInt(l[p],10),b=i[g],f=d._options.grid.slickGrid.getDataItem(g);let v=u(()=>{delete f.__orig,delete b[g],d.updateModifiedClassesForRow(g),h()},"then"),y=u(()=>{d._options.autoSave&&d.undoRowChanges(g),d._options.grid.updateInterface()},"fail");if(d._options.saveHandler)d._options.saveHandler(b).then(v).catch(y);else{var x=d._options.saveServiceMethod;if(x==null){var C=d._options.grid.getService;C&&(x=C()+"/Update")}x?Zt(x,b,v).fail(y):Yt("Save handler for edit controller is not defined!")}},"saveNext")()}}static saveChangesButton(t){var e;return{title:(e=et("Controls.EntityGrid.SaveChangesButton"))!=null?e:"Save Changes",cssClass:"apply-changes-button",disabled:()=>{var i;return!((i=t())!=null&&i.isDirty())},onClick:()=>{var i;return(i=t())==null?void 0:i.saveChanges()},separator:!0}}static undoButton(t){var e;return{hint:(e=et("Controls.EntityGrid.UndoChangesButton"))!=null?e:"Undo Changes",cssClass:"undo-changes-button",icon:"fa-undo",disabled:()=>{var i;return!((i=t())!=null&&i.isDirty())},onClick:i=>{var s;return(s=t())==null?void 0:s.undoChanges()}}}};u(ye,"GridEditController");function ti(r,t){if($.fn.tooltip){var e,i=Jt(r);i?e=$(i):e=$(r),$.fn.tooltip&&e.tooltip({title:t,trigger:"manual"}).tooltip("show"),window.setTimeout(function(){e.tooltip(Qt()?"destroy":"dispose")},1500)}else Xt(t)}u(ti,"showValidationError");import{Decorators as ii,LazyLoadHelper as ri,Widget as si}from"@serenity-is/corelib";import{htmlEncode as be}from"@serenity-is/corelib";var W=class extends si{constructor(e){var s;super(e.grid.element,e);this.autoSizing=0;this.columnResizeHandler=u(()=>{var e;!this.autoSizing&&((e=this.options.disableIfUserResize)==null||e)&&(this.disabled=!0)},"columnResizeHandler");this.queueAutoSize=0;e.disabled!=null&&(this.disabled=!!e.disabled),this.slickGrid=e.grid.slickGrid,this.$container=$(this.slickGrid.getContainerNode()),this.$container.on("dblclick."+this.uniqueName,".slick-resizable-handle",n=>this.resizeHandleClick(n)),this.slickGrid.onColumnsResized.subscribe(this.columnResizeHandler);var i=this;this.oldMarkupReady=e.grid.markupReady,e.grid.markupReady=function(){i.oldMarkupReady&&i.oldMarkupReady.call(this),!i.disabled&&(!i.markupReadyOnce||!i.options.autoSizeAllJustOnce)&&i.autoSizeAll(i.disabled!=null?!1:null),i.markupReadyOnce=!0},this.oldPersistSettings=e.grid.persistSettings,e.grid.persistSettings=function(n){if(!i.autoSizing)return i.oldPersistSettings.call(this,n)},this.oldGetCurrentSettings=e.grid.getCurrentSettings,e.grid.getCurrentSettings=function(n){var a;return n=n||this.gridPersistanceFlags(),n.columnWidths=(a=n.columnWidths)!=null?a:!!i.disabled,i.oldGetCurrentSettings.call(this,n)},this.oldRestoreSettingsFrom=e.grid.restoreSettingsFrom,e.grid.restoreSettingsFrom=function(n,a){var o=a||this.gridPersistanceFlags();n!=null&&n.columns&&(o.columnWidths||n.columns.some(l=>l.width!=null))&&(i.disabled=!0),i.oldRestoreSettingsFrom.call(this,n,a)},this.inputDelta=(s=e.inputDelta)!=null?s:8,this.disabled||this.autoSizeAll()}destroy(){this.options&&this.options.grid&&(this.options.grid.element.off("."+this.uniqueName),this.options.grid.markupReady=this.oldMarkupReady),this.slickGrid&&this.slickGrid.onColumnsResized.unsubscribe(this.columnResizeHandler),this.options=null,this.slickGrid=null,this.$container=null,super.destroy()}resizeHandleClick(e){if(e.ctrlKey){e.preventDefault(),e.stopPropagation(),this.options.beforeUserAutoSizeAll&&this.options.beforeUserAutoSizeAll(),this.autoSizeAll(!1),this.options.afterUserAutoSizeAll&&this.options.afterUserAutoSizeAll(),this.disabled=!1;return}var i=$(e.currentTarget).closest(".slick-header-column"),s=i.data("column");!s||!s.resizable||(e.preventDefault(),e.stopPropagation(),this.autoSizeColumn(i,s))}createCellNodes(e){let i=document.createElement("div");if(i.classList.add("slick-row","s-offscreen"),i.style.visibility="hidden",i.innerHTML=e.join(""),i.childNodes.length>0&&this.slickGrid.getCanvasNode().appendChild(i),Array.from)return Array.from(i.childNodes);for(var s=i.childNodes,n=i.childNodes.length,a=[],o=0;o<n;o++)a.push(s[o]);return a}calcMaxWidthFromCellNodes(e,i,s){var p,d;var n=i.maxWidth>0?i.maxWidth:this.options.maxWidth,a=0;for(let c=0;c<e.length;c++){let h=e[c];var o=h.offsetWidth+(((p=h.dataset)==null?void 0:p.isInputNode)==="1"&&(d=this.inputDelta)!=null?d:0);if(o>a&&(a=o),n>0&&o>=n)break}var l=a||0;return typeof this.options.ignoreHeaders=="number"?l=Math.max(Math.min(this.options.ignoreHeaders,s.offsetWidth,l)):this.options.ignoreHeaders||(l=Math.max(s.offsetWidth,l)),l=(l||0)+1,i.maxWidth>0?l=Math.min(l,i.maxWidth):l=Math.min(l,this.options.maxWidth||400),i.minWidth>0?l=Math.max(l,i.minWidth):l=Math.max(l,this.options.minWidth||30),l}getAutoColumnWidth(e,i){var l,p;var s=this.slickGrid.getColumnIndex(i.id),n=[];this.renderColumnCells(n,i,s,this.getMaxCalcLength());let a=this.createCellNodes(n);try{let d;this.options.ignoreHeaders||(d=tt(e[0]));try{return this.calcMaxWidthFromCellNodes(a,i,d)}finally{(l=d==null?void 0:d.parentElement)==null||l.removeChild(d)}}finally{var o=(p=a[0])==null?void 0:p.parentElement;o&&o.parentElement.removeChild(o)}}autoSizeColumn(e,i){let s=this.getAutoColumnWidth(e,i);if(s!==i.width){this.autoSizing++;try{i.width=s,this.slickGrid.setColumns(this.slickGrid.getColumns()),this.slickGrid.onColumnsResized.notify()}finally{this.autoSizing--}}}autoSizeAll(e){var a,o;if(!this.$container.is(":visible")){this.queueAutoSize<=0&&(this.queueAutoSize++,ri.executeOnceWhenShown(this.$container,()=>this.autoSizeAll(e)));return}this.queueAutoSize>0&&this.queueAutoSize--,this.autoSizing++;try{var i=this.$container.find(".slick-header-column");e=e!=null?e:this.options.useExplicitWidths&&this.options.useExplicitWidths();var s=this.getMaxCalcLength();let l=[],p=[];try{i.each((c,h)=>{var g=$(h).data("column");if(g&&this.getPreSetWidth(g)==null){var b=this.slickGrid.getColumnIndex(g.id);this.renderColumnCells(l,g,b,s)}else for(var f=0;f<s;f++)l.push("<div></div>");this.options.ignoreHeaders||p.push(tt(h))});let d=this.createCellNodes(l);try{i.each((c,h)=>{var g=$(h).data("column");if(g){var b=d.slice(c*s,(c+1)*s),f=this.getPreSetWidth(g);f==null&&(f=this.calcMaxWidthFromCellNodes(b,g,p[c])),g.width=f}})}finally{var n=(a=d[0])==null?void 0:a.parentElement;n&&((o=n.parentElement)==null||o.removeChild(n))}}finally{p.forEach(d=>{var c;return(c=d==null?void 0:d.parentElement)==null?void 0:c.removeChild(d)})}this.slickGrid.setColumns(this.slickGrid.getColumns()),this.slickGrid.onColumnsResized.notify()}finally{this.autoSizing--}}getMaxCalcLength(){var i,s;var e=this.slickGrid.getDataLength();return((i=this.options.maxRows)!=null?i:40)<e&&(e=(s=this.options.maxRows)!=null?s:40),e}renderColumnCells(e,i,s,n){var d;for(var a=0;a<n;a++){e.push('<div class="slick-cell" style="text-overflow: initial !important; white-space: nowrap !important;"');var o=this.slickGrid.getDataItem(a);if(!o){e.push("></div>");continue}var l=this.slickGrid.getFormatter(a,i),p=this.slickGrid.getFormatterContext(a,s);let c,h;if(l)try{h=l(p)}catch(g){h=be((d=o[i.field])!=null?d:"")}else h=be(o[i.field]);if((h==null?void 0:h.length)>5&&h.substring(0,6)=="<input"){let g=document.createElement("template");if(g.innerHTML=h,c=g.content.firstChild,c.type!="checkbox"){e.push(' data-isInputNode="1">',be(c.value),"</div>");continue}}e.push(">",h,"</div>")}}getPreSetWidth(e){if(this.options.useExplicitWidths&&e.sourceItem&&e.sourceItem.width>0&&e.sourceItem.widthSet)return e.sourceItem.width}};u(W,"AutoColumnWidthMixin"),W=D([ii.registerClass("Serenity.AutoColumnWidthMixin")],W);function tt(r){let t=r.cloneNode(!0);return t.style.cssText="position: absolute; visibility: hidden; right: auto; text-overflow: initial; white-space: nowrap;",r.parentNode.insertBefore(t,r),t}u(tt,"createHeaderClone");import{getGlobalThis as yi,localText as ot}from"@serenity-is/corelib";var Se=Object.keys;function ni(r){return typeof r=="boolean"}u(ni,"isBoolean");function ai(r){return r&&typeof r.nodeType=="number"}u(ai,"isElement");function xe(r){return typeof r=="string"}u(xe,"isString");function oi(r){return typeof r=="number"}u(oi,"isNumber");function M(r){return typeof r=="object"?r!==null:q(r)}u(M,"isObject");function q(r){return typeof r=="function"}u(q,"isFunction");function li(r){let{prototype:t}=r;return!!(t&&t.isReactComponent)}u(li,"isComponentClass");function di(r){return M(r)&&typeof r.length=="number"&&typeof r.nodeType!="number"}u(di,"isArrayLike");function Te(r,t){if(r)for(let e of Se(r))t(r[e],e)}u(Te,"forEach");function ui(r){return M(r)&&"current"in r}u(ui,"isRef");var pi=Symbol.for("jsx-dom:type"),it=function(r){return r.ShadowRoot="ShadowRoot",r}(it||{});function ci(r){return r!=null&&r[pi]===it.ShadowRoot}u(ci,"isShadowRoot");function rt(r){return!ni(r)&&r!=null}u(rt,"isVisibleChild");var hi=typeof DOMTokenList!="undefined"?DOMTokenList:function(){};function st(r){return Array.isArray(r)?r.map(st).filter(Boolean).join(" "):r instanceof hi?""+r:M(r)?Se(r).filter(t=>r[t]).join(" "):rt(r)?""+r:""}u(st,"className");var ae=class{constructor(t){this.props=t}render(){return null}};u(ae,"Component");ae.prototype;function gi(r,t,e){return t=A(G({},t),{children:e}),new r(t).render()}u(gi,"initComponentClass");function I(r,t){let n=t,{children:e}=n,i=se(n,["children"]),s;if(xe(r)){if(s=i.namespaceURI?document.createElementNS(i.namespaceURI,r):document.createElement(r),vi(i,s),we(e,s),s instanceof window.HTMLSelectElement&&i.value!=null)if(i.multiple===!0&&Array.isArray(i.value)){let a=i.value.map(o=>String(o));s.querySelectorAll("option").forEach(o=>o.selected=a.includes(o.value))}else s.value=i.value;nt(i.ref,s)}else if(q(r))M(r.defaultProps)&&(i=G(G({},r.defaultProps),i)),s=li(r)?gi(r,i,e):r(A(G({},i),{children:e}));else throw new TypeError(`Invalid JSX element type: ${r}`);return s}u(I,"jsx");function nt(r,t){ui(r)?r.current=t:q(r)&&r(t)}u(nt,"attachRef");function we(r,t){if(di(r))mi(r,t);else if(xe(r)||oi(r))Ce(document.createTextNode(r),t);else if(r===null)Ce(document.createComment(""),t);else if(ai(r))Ce(r,t);else if(ci(r)){let e=t.attachShadow(r.attr);we(r.children,e),nt(r.ref,e)}}u(we,"appendChild");function mi(r,t){for(let e of[...r])we(e,t);return t}u(mi,"appendChildren");function Ce(r,t){t instanceof window.HTMLTemplateElement?t.content.appendChild(r):t.appendChild(r)}u(Ce,"appendChildToNode");function at(r,t){t==null||t===!1||(Array.isArray(t)?t.forEach(e=>at(r,e)):xe(t)?r.setAttribute("style",t):M(t)&&Te(t,(e,i)=>{i.indexOf("-")===0?r.style.setProperty(i,e):r.style[i]=e}))}u(at,"style");function fi(r,t,e){switch(r){case"htmlFor":ne(e,"for",t);return;case"dataset":Te(t,(i,s)=>{i!=null&&(e.dataset[s]=i)});return;case"innerHTML":case"innerText":case"textContent":rt(t)&&(e[r]=t);return;case"dangerouslySetInnerHTML":M(t)&&(e.innerHTML=t.__html);return;case"value":if(t==null||e instanceof window.HTMLSelectElement)return;if(e instanceof window.HTMLTextAreaElement){e.value=t;return}break;case"spellCheck":e.spellcheck=t;return;case"class":case"className":q(t)?t(e):ne(e,"class",st(t));return;case"ref":case"namespaceURI":return;case"style":at(e,t);return;case"on":case"onCapture":Te(t,(i,s)=>{e.addEventListener(s,i,r==="onCapture")});return}if(q(t)){if(r[0]==="o"&&r[1]==="n"){let i=r.toLowerCase(),s=i.endsWith("capture");if(i==="ondoubleclick"?i="ondblclick":s&&i==="ondoubleclickcapture"&&(i="ondblclickcapture"),!s&&e[i]===null)e[i]=t;else if(s)e.addEventListener(i.substring(2,i.length-7),t,!0);else{let n;i in window?n=i.substring(2):n=i[2]+r.slice(3),e.addEventListener(n,t)}}}else M(t)?e[r]=t:t===!0?ne(e,r,""):t!==!1&&t!=null&&ne(e,r,t)}u(fi,"attribute");function ne(r,t,e){r.setAttribute(t,e)}u(ne,"attr");function vi(r,t){for(let e of Se(r))fi(e,r[e],t);return t}u(vi,"attributes");var Ie=class{constructor(t){this.options=t;var e=this.dataGrid=t.grid,i=$(I("div",{class:"btn-group view-switch",role:"group",style:"float: right",children:[I("a",{href:"javascript:;",title:ot("Site.CardViewMixin.ListView"),class:"btn btn-primary active","data-view":"list",children:I("i",{class:"fa fa-list"})}),I("a",{href:"javascript:;",title:ot("Site.CardViewMixin.CardView"),class:"btn btn-primary","data-view":"card",children:I("i",{class:"fa fa-grip-horizontal"})})]})).prependTo(e.element.find(".grid-title"));this.cardContainer=$('<div class="view-container card-container" style="display: none;"></div>').insertAfter(e.element.children(".grid-container")),i.find("[data-view]").click(o=>{this.switchView($(o.target).closest("[data-view]").attr("data-view"))}),t.viewType&&this.switchView(this.options.viewType,!1),this.resizeCardView(),e.element.bind("layout",()=>this.resizeCardView()),e.view.onDataChanged.subscribe(()=>{this.updateCardItems()});var s=e.getCurrentSettings;e.getCurrentSettings=function(o){var l=s.apply(e,[o]);return l.viewType=i.find("[data-view].active").val(),l};var n=this,a=e.restoreSettingsFrom;e.restoreSettingsFrom=function(o,l){a.apply(e,[o,l]);var p=o==null?void 0:o.viewType;(p=="card"||p=="list")&&n.switchView(p,!1)}}switchView(t,e=!0){var i=this.dataGrid.element.find('.btn[data-view="'+t+'"]');i.addClass("active").siblings(".active").not(i).removeClass("active");var s=t=="card";this.dataGrid.element.children(".card-container").toggle(s),this.dataGrid.element.children(".grid-container").toggle(!s),s&&this.updateCardItems(),e&&this.dataGrid.persistSettings(),this.dataGrid.element.trigger("layout")}updateCardItems(){var e;let t=(e=this.options.cardClass)!=null?e:"col-12 col-md-6 col-lg-6 col-xxl-4";$(this.cardContainer[0]).html("").append(I("div",{className:"row card-items",children:this.dataGrid.getItems().map((i,s)=>I("div",{className:t,children:I("div",{className:"card",ref:n=>{var o;var a=this.options.renderItem(i,s);a instanceof HTMLElement?n.appendChild(a):(o=yi())==null||o.ReactDOM.render(a,n)}})},s))}))}resizeCardView(){var t=this.dataGrid.element.children(".grid-container");if(t.is(":visible")){var e=t.height();e&&this.dataGrid.element.children(".card-container").css({height:e+"px"})}}};u(Ie,"CardViewMixin");import{SummaryType as R}from"@serenity-is/corelib";import{tryFirst as lt,toId as bi}from"@serenity-is/corelib";import{Aggregators as oe}from"@serenity-is/corelib";function dt(r){switch(r){case R.Sum:return oe.Sum;case R.Avg:return oe.Avg;case R.Max:return oe.Max;case R.Min:return oe.Min}return null}u(dt,"toAggregator");var ke=class{constructor(t){var o;var e=t.grid;e.slickGrid&&!((o=e.slickGrid.getOptions())!=null&&o.showFooterRow)&&e.slickGrid.setFooterRowVisibility(!0);var i=u(()=>{var l=e.allColumns,p=[];for(var d of l)if(d.sourceItem!=null&&d.sourceItem.summaryType!=null&&d.sourceItem.summaryType!=R.Disabled){var c=dt(d.sourceItem.summaryType);if(c==null)continue;d.summaryType=d.sourceItem.summaryType,p.push(new c(d.field))}return p},"getDefaultAggregators");e.view.setSummaryOptions({aggregators:i()});var s=$(`<ul class="s-AggregatesPopup" 
                style="display:none;position:absolute;z-index:100000;">
                <li data-agg="1">Sum</li>
                <li data-agg="2">Average</li>
                <li data-agg="3">Min</li>
                <li data-agg="4">Max</li>
            </ul>`).appendTo(document.body).click(l=>{if($(l.target).is("li")){var p=s.data("column");if(!(p==null||!p.id)){var d=lt(e.allColumns,f=>f.id==p.id);if(d&&!(d.sourceItem==null||d.sourceItem.summaryType==null||d.sourceItem.summaryType==R.Disabled)){var c=bi($(l.target).data("agg"));if(c!==d.summaryType){d.summaryType=c;var h=e.allColumns.filter(f=>f.summaryType).map(f=>{var v=dt(f.summaryType);return v==null?null:new v(f.field)}).filter(f=>f!=null);e.view.setSummaryOptions({aggregators:h});for(var g=e.view.getGrouping(),b=0;b<g.length;b++)g[b].aggregators=h;e.view.setGrouping(g),e.slickGrid.invalidate()}}}}});e.element.on("click",".slick-footerrow-column",l=>{l.preventDefault();var p=$(l.currentTarget).data("column");if(!(!p||!p.id)){var d=lt(e.allColumns,c=>c.id==p.id);d&&(!d||!d.sourceItem||d.sourceItem.summaryType==null||d.sourceItem.summaryType==R.Disabled||(s.data("column",d).show().css("top",l.pageY-s.height()+"px").css("left",l.pageX+"px").children("li").removeClass("active").end().children("li[data-agg="+d.summaryType+"]").addClass("active"),$(document.body).off("click.aggregatesMenu"+e.uniqueName),window.setTimeout(()=>$(document.body).on("click.aggregatesMenu"+e.uniqueName,()=>{s.hide(),$(document.body).off("click.aggregatesMenu"+e.uniqueName)}),1)))}});var n=e.getCurrentSettings;e.getCurrentSettings=function(l){var p=n.apply(e,[l]);return p};var a=e.restoreSettingsFrom;e.restoreSettingsFrom=function(l,p){a.apply(e,[l,p])}}};u(ke,"CustomSummaryMixin");import{tryFirst as xi}from"@serenity-is/corelib";import{GroupItemMetadataProvider as wi}from"@serenity-is/sleekgrid";import{htmlEncode as L,indexOf as Ci,tryGetText as Ge}from"@serenity-is/corelib";import{EventEmitter as Ti,NonDataRow as Si}from"@serenity-is/sleekgrid";var z=class{constructor(t){this.onGroupChanged=new Ti;var e={deleteIconCssClass:"fa fa-cross"};this.options=$.extend(!0,{},e,t)}init(t){this.grid=t,this.gridUid=t.getUID(),this.dropbox=$(t.getGroupingPanel());var e=this.options.dropPlaceHolderText||Ge("Site.DraggableGroupingMixin.DropPlaceholder")||"Drag a column header here to group by that column";this.dropbox.html("<div class='slick-dropped-placeholder'>"+L(e)+`</div><div class="slick-group-expand-all" title="${L(Ge("Site.DraggableGrupingMixin.ExpandAllButton")||"Expand All")}" style="display:none"></div><div class="slick-group-collapse-all" title="${L(Ge("Site.DraggableGrupingMixin.CollapseAllButton")||"Collapse All")}" style="display:none"></div>`),this.dropboxPlaceholder=this.dropbox.find(".slick-dropped-placeholder"),this.expandAll=this.dropbox.find(".slick-group-expand-all"),this.collapseAll=this.dropbox.find(".slick-group-collapse-all"),this.setupColumnDropbox();for(var i=this.getColumns(),s=0;s<i.length;s++){var n=i[s];t.updateColumnHeader(n.id)}this.columnsGroupBy=[]}getColumns(){return this.options.getAllColumns&&this.options.getAllColumns()||this.grid.getColumns()}destroy(){this.onGroupChanged.clear()}setupColumnDropbox(){var t=this;this.dropbox.droppable({activeClass:"ui-state-default",hoverClass:"ui-state-hover",accept:":not(.ui-sortable-helper)",deactivate:(e,i)=>{this.dropbox.removeClass("slick-header-column-denied")},drop:(e,i)=>{this.addGroupColumn(i.draggable.attr("id").replace(t.gridUid,""))&&this.groupChanged(!0)},over:(e,i)=>{var s=i.draggable.attr("id").replace(this.gridUid,"");this.getColumns().forEach((n,a,o)=>{n.id==s&&n.grouping!==!1&&this.dropbox.addClass("slick-header-column-denied")})}}),this.dropbox.sortable({items:"div.slick-dropped-grouping",cursor:"default",tolerance:"pointer",helper:"clone",update:(e,i)=>{for(var s=$(e.target).sortable("toArray",{attribute:"data-id"}),n=[],a=0,o=s.length;a<o;a++)for(var l=0,p=this.columnsGroupBy.length;l<p;l++)if(this.columnsGroupBy[l].id==s[a]){n.push(this.columnsGroupBy[l]);break}this.columnsGroupBy=n,this.groupChanged(!0)}}),this.expandAll.on("click",e=>{this.grid.getData().expandAllGroups()}),this.collapseAll.on("click",e=>{this.grid.getData().collapseAllGroups()})}getGroupingFor(t){var e=null;if(this.options.getGroupingFor&&(e=this.options.getGroupingFor(t)),e===!1)return e;var i=t.field||t.id,s=1,n=this.grid.getSortColumns();if(n!=null&&n.length>0){for(var a of n)if(a.columnId==t.id){s=a.sortAsc?1:-1;break}}return $.extend({getter:i,displayTotalsRow:this.options.displayTotalsRow,comparer:function(o,l){return o.value===l.value?0:o.value!=null&&l.value==null||o.value>l.value?s:-s},formatter:o=>{var l;if(t.format||t.formatter){var p=this.grid.getFormatter(-1,t);if(p){var d=new Si,c=this.grid.getFormatterContext(-1,-1);d.__grp=o,d[t.field]=o.value,c.item=d,c.value=o.value;try{l=p(c)}catch(g){l=L(o.value)}}else l=L(o.value)}else l=L(o.value);var h=this.options.getCount?this.options.getCount(o):o.count;return'<span class="s-group-name">'+(t.name||t.field||t.id)+": </span>"+l+' <span class="s-group-count">('+(h||0).toString()+")</span>"},collapsed:!0},e)}addGroupColumn(t){var e=!0;this.columnsGroupBy.forEach(function(n,a,o){n.id==t&&(e=!1)});var i=this.getColumns();if(e){var s=!1;if(i.forEach((n,a,o)=>{if(!(n.id!==t||n.grouping===!1)&&!((n.grouping==null||$.isEmptyObject(n.grouping))&&(n.grouping=this.getGroupingFor(n),n.grouping===!1))){var l=$("<div id='"+this.gridUid+n.id+"_entry' data-id='"+n.id+"' class='slick-dropped-grouping'>"),p=$("<div style='display: inline-flex'>"+L(n.name)+"</div>");p.appendTo(l);var d=$("<div class='slick-groupby-remove'></div>");this.options.deleteIconCssClass&&d.addClass(this.options.deleteIconCssClass),this.options.deleteIconImage&&d.css("background","url("+this.options.deleteIconImage+") no-repeat center right"),!this.options.deleteIconCssClass&&!this.options.deleteIconImage&&d.addClass("slick-groupby-remove-image"),d.appendTo(l),$("</div>").appendTo(l),l.appendTo(this.dropbox),this.columnsGroupBy.push(n),d.one("click",()=>this.removeIconClick(n.id,l)),s=!0}}),s)return this.grid.invalidate(),!0}}setDroppedGroups(t){if(this.columnsGroupBy=[],this.dropbox.find(".slick-dropped-grouping").remove(),!(!t||!t.length)){for(var e=0;e<t.length;e++)this.addGroupColumn(t[e]);this.groupChanged(!1)}}removeIconClick(t,e){e.remove();for(var i=!1,s;(s=Ci(this.columnsGroupBy,n=>n.id==t))>=0;)this.columnsGroupBy.splice(s,1),i=!0;i&&this.groupChanged(!0)}updateInterface(){var t=!!(this.columnsGroupBy&&this.columnsGroupBy.length);this.collapseAll.toggle(t),this.expandAll.toggle(t),this.dropboxPlaceholder.toggle(!t)}groupChanged(t){if(this.updateInterface(),this.columnsGroupBy.length==0){this.grid.getData().setGrouping([]),this.onGroupChanged.notify({groupColumns:[],userChange:t}),this.grid.invalidate();return}var e=[];this.columnsGroupBy.forEach(function(i){e.push(i.grouping)}),this.grid.getData().setGrouping(e),this.grid.invalidate(),this.onGroupChanged.notify({groupColumns:e,userChange:t})}static setupColumnReorder(t,e,i,s){e.filter(":ui-sortable").sortable("destroy");var n=$(t.getGroupingPanel()),a=t.getColumns(),o=t.getUID();e.sortable({distance:3,cursor:"default",tolerance:"intersection",helper:"clone",placeholder:"slick-sortable-placeholder ui-state-default slick-header-column",forcePlaceholderSize:!0,appendTo:"body",start:function(l,p){$(p.helper).addClass("slick-header-column-active")},beforeStop:function(l,p){$(p.helper).removeClass("slick-header-column-active");var d=n.find(".slick-dropped-grouping").length;d>0&&(n.find(".slick-dropped-placeholder").hide(),n.find(".slick-dropped-grouping").show())},stop:function(l){if(!t.getEditorLock().commitCurrentEdit()){$(this).sortable("cancel");return}for(var p=e.sortable("toArray"),d=[],c=0;c<p.length;c++)d.push(a[t.getColumnIndex(p[c].replace(o,""))]);t.setColumns(d),s(t.onColumnsReordered,{}),l.stopPropagation(),i()}})}};u(z,"DraggableGroupingPlugin");typeof globalThis!="undefined"&&globalThis.Slick&&globalThis.Slick.Plugins&&(globalThis.Slick.Plugins.DraggableGrouping=z);function Ii(r,t,e){var i=u(function(s){return e?e(s[r]):s[r]},"key");return function(s,n){var a=i(s),o=i(n);return(a<o?-1:a>o?1:0)*[1,-1][+!!t]}}u(Ii,"sortBy");var Ee=class{constructor(t){var p,d,c,h,g,b,f;var e=t.grid,i=(g=(d=t.groupItemMetadataProvider)!=null?d:(p=e.slickGrid)==null?void 0:p.getPluginByName("GroupItemMetadataProvider"))!=null?g:(h=(c=e.view)==null?void 0:c.getGroupItemMetadataProvider)==null?void 0:h.call(c);i==null&&(i=new wi,e.slickGrid&&e.slickGrid.registerPlugin(i)),e.slickGrid&&!((b=e.slickGrid.getOptions())!=null&&b.groupingPanel)&&e.slickGrid.setOptions({groupingPanel:!0}),(f=e.view)!=null&&f.setGroupItemMetadataProvider&&e.view.setGroupItemMetadataProvider(i);var s=this.plugin=new z({getAllColumns:()=>e.allColumns,getCount:t.getCount,displayTotalsRow:t.displayTotalsRow,collapsed:t.collapsed});e.slickGrid.registerPlugin(s),s.onGroupChanged.subscribe((v,y)=>{y.userChange&&!e.restoringSettings&&Promise.resolve(e.persistSettings(null)).then(()=>{t.onGroupChanged&&t.onGroupChanged(y)})});var n=e.getCurrentSettings;e.getCurrentSettings=function(v){var y=n.apply(e,[v]);if(v==null||v.groupColumns==null||v.groupColumns){var x=e.view.getGrouping()||[];y.groupColumns=x.map(C=>C.getter).filter(C=>C!=null&&typeof C=="string")}return y};function a(v){if(v!=null){var y=e.allColumns,x=v.map(w=>xi(y,V=>V.id==w)).filter(w=>w!=null),C=x.map(w=>(w.grouping==null&&(w.grouping=s.getGroupingFor(w)),w.grouping));e.view.setGrouping(C),s.setDroppedGroups(x.map(w=>w.id)),e.slickGrid.invalidate()}}u(a,"loadGroupCols");function o(){var v=e.allColumns.filter(y=>y.sourceItem!=null&&y.sourceItem.groupOrder!=null);return v.length?v.sort(Ii("groupOrder")).map(y=>y.id):null}u(o,"getDefaultGroupCols");var l=e.restoreSettingsFrom;e.restoreSettingsFrom=function(v,y){var C;e.restoringSettings++;try{if(l.apply(e,[v,y]),!v||!(y==null||y.groupColumns==null||y.groupColumns))return;var x=(C=v.groupColumns)!=null?C:o();a(x)}finally{e.restoringSettings--}}}};u(Ee,"DraggableGroupingMixin");import{Decorators as ki,EditorUtils as ut,EntityDialog as m,EntityGrid as Gi,FormKeyAttribute as Ei,IEditDialog as Fi,ItemNameAttribute as Di,PropertyGrid as Pi,PropertyGridMode as Fe,SubDialogHelper as pt,TabsExtensions as Oi,TemplatedDialog as De,ValidationHelper as Ai,Widget as Mi}from"@serenity-is/corelib";import{confirmDialog as le,endsWith as Ri,format as ct,getAttributes as Li,getForm as Bi,getInstanceType as ht,isEmptyOrNull as gt,isMobileView as Vi,localText as T,LT as $i,notifySuccess as zi,Router as mt,serviceCall as ft,tryGetText as Ni,validateOptions as Hi,validatorAbortHandler as _i}from"@serenity-is/corelib";var Ui=(i=>(i[i.Never=0]="Never",i[i.Auto=1]="Auto",i[i.Confirm=2]="Confirm",i))(Ui||{}),j=class extends Gi{constructor(e,i){super(e,i);this.element.on("ondatachange."+this.uniqueName,()=>{this.subDialogDataChange()}),this.element.on("handleroute."+this.uniqueName,(s,n)=>{n.handled||!n.route&&this.isDialogOpen&&this.dialogClose()}),$(window).on("resize."+this.uniqueName,()=>{this.arrange()})}createSlickGrid(){var e=super.createSlickGrid();this.idPrefix=this.uniqueName+"_DLG_",this.element.addClass("s-GridWithDialog"),this.dialogPane=$(`<div id="${this.uniqueName}_DLG" class="s-GridDialogPane flex-layout"></div>`).appendTo(this.slickContainer);var i=this.getTemplate().replace(new RegExp("~_","g"),this.idPrefix);return this.dialogPane.html(i),this.initValidator(),this.initTabs(),this.initPropertyGrid(),this.initLocalizationGrid(),e}destroy(){$(window).off("resize."+this.uniqueName),this.propertyGrid&&(this.propertyGrid.destroy(),this.propertyGrid=null),this.localizationGrid&&(this.localizationGrid.destroy(),this.localizationGrid=null),this.undeleteButton=null,this.applyChangesButton=null,this.deleteButton=null,this.saveAndCloseButton=null,this.tabs&&this.tabs.tabs("destroy"),this.tabs=null,this.validator&&this.byId("Form").remove(),this.validator=null,super.destroy()}getItemCssClass(e,i){var s=super.getItemCssClass(e,i);return this.isDialogOpen&&this.entityId==e[this.getIdProperty()]?(s||"")+" editing-item":s}getSaveState(){try{return $.toJSON(this.getSaveEntity())}catch(e){return null}}hasPendingChanges(){return this.getSaveState()!=this.loadedState}autoSaveOnSwitch(){return 0}autoSaveOnClose(){return 0}checkPendingChangesOnSwitch(e,i){if(this.isDialogOpen&&(typeof e=="number"||typeof e=="string")){if(e==this.entityId)return;if(this.autoSaveOnSwitch()&&this.hasPendingChanges()){this.autoSaveOnSwitch()==2||this.triedAutoSaveForCurrentEntity?le(T("Site.Dialogs.PendingChangesConfirmation"),()=>{this.save(s=>{i()})},{onNo:()=>{this.loadResponse({}),i()}}):(this.triedAutoSaveForCurrentEntity=!0,this.save(s=>{i()}));return}}i()}editItem(e){this.checkPendingChangesOnSwitch(e,()=>{super.editItem(e)})}createEntityDialog(e,i){return e==this.getItemType()?(i&&i(this),this):super.createEntityDialog(e,i)}layout(){super.layout()}byId(e){return $("#"+this.idPrefix+e)}getDefaultTemplateName(){return De.prototype.getDefaultTemplateName.call(this)}getTemplateName(){return De.prototype.getTemplateName.call(this)}getFallbackTemplate(){return`<div class="s-DialogContent">
<div class="s-Form">
    <form id="~_Form" action="">
        <div class="fieldset ui-widget ui-widget-content ui-corner-all">
            <div id="~_PropertyGrid"></div>
            <div class="clear"></div>
        </div>
    </form> 
</div>
</div>`}getTemplate(){return De.prototype.getTemplate.call(this)}getValidatorOptions(){return{}}initValidator(){var e=this.byId("Form");if(e.length>0){var i=this.getValidatorOptions();this.validator=e.validate(Hi(i))}}resetValidation(){this.validator&&this.validator.resetAll()}validateForm(){return this.validator==null||!!this.validator.form()}dialogOpen(){this.isDialogOpen||(this.element.toggleClass("dialog-open",!0),this.isDialogOpen=!0,this.updateInterface(),this.layout(),this.onDialogOpen(),mt.dialog(this.element,this.dialogPane,()=>this.getEditHash()),this.dialogPane.triggerHandler("panelopen"))}getEditHash(){return this.entityId?"edit/"+this.entityId.toString():"new"}onDialogOpen(){Vi()||$(":input",this.dialogPane).not("button").eq(0).focus(),this.arrange(),this.tabs&&this.tabs.tabs("option","active",0)}arrange(){window.innerWidth<768?this.dialogPane.children(".panel-titlebar").prependTo(this.element):this.element.children(".panel-titlebar").prependTo(this.dialogPane),this.dialogPane.find(".require-layout").filter(":visible").each(function(e,i){$(i).triggerHandler("layout")})}onDialogClose(){$(document).trigger("click"),$.qtip&&$(document.body).children(".qtip").each(function(e,i){$(i).qtip("hide")})}getDialogTitle(){return""}dialogClose(){this.isDialogOpen&&(this.triedAutoSaveForCurrentEntity=!1,this.element.toggleClass("dialog-open",!1),this.isDialogOpen=!1,this.updateInterface(),this.layout(),this.onDialogClose(),this.dialogPane.triggerHandler("panelclose"))}get dialogTitle(){return this.element.data("dialogtitle")}set dialogTitle(e){var i=this.dialogTitle;this.element.data("dialogtitle",e),i!=this.dialogTitle&&(this.setupDialogTitle(),this.arrange())}setupDialogTitle(){var s;var e=(s=this.dialogTitle)!=null?s:this.getDialogTitle(),i=this.dialogPane.children(".panel-titlebar").add(this.element.children(".panel-titlebar"));gt(e)?i.remove():(i.length||(i=$("<div class='panel-titlebar'><div class='panel-titlebar-text'></div></div>").prependTo(this.dialogPane)),i.children(".panel-titlebar-text").text(e),i.children(".panel-titlebar-close").length||$('<button class="panel-titlebar-close">&nbsp;</button>').prependTo(i).click(n=>{this.autoSaveOnClose()&&this.hasPendingChanges()?(n.preventDefault(),this.autoSaveOnClose()==2||this.triedAutoSaveForCurrentEntity?le(T("Site.Dialogs.PendingChangesConfirmation"),()=>this.saveAndCloseButton.click(),{onNo:()=>{this.dialogClose()}}):(this.triedAutoSaveForCurrentEntity=!0,this.saveAndCloseButton.click())):this.dialogClose()}))}initTabs(){var e=this.byId("Tabs");e.length!==0&&(this.tabs=e.tabs({}),this.tabs.bind("tabsactivate",()=>this.arrange()))}get_entity(){return this.entity}set_entity(e){this.entity=e||new Object}get_entityId(){return this.entityId}set_entityId(e){this.entityId=e}getEntityNameFieldValue(){var e;return((e=this.get_entity()[this.getNameProperty()])!=null?e:"").toString()}getEntityTitle(){var i;if(this.isEditMode()){var e=(i=this.getEntityNameFieldValue())!=null?i:"";return ct(T("Controls.EntityDialog.EditRecordTitle"),this.getEntitySingular(),gt(e)?"":" ("+e+")")}else return ct(T("Controls.EntityDialog.NewRecordTitle"),this.getEntitySingular())}updateTitle(){this.dialogTitle=this.getEntityTitle()}isCloneMode(){return!1}isEditMode(){return this.get_entityId()!=null&&!this.isCloneMode()}isDeleted(){return m.prototype.isDeleted.apply(this,arguments)}isNew(){return this.get_entityId()==null}isNewOrDeleted(){return this.isNew()||this.isDeleted()}getDeleteOptions(e){return{}}deleteHandler(e,i){ft(e)}doDelete(e){return m.prototype.doDelete.apply(this,arguments)}onDeleteSuccess(e){return m.prototype.onDeleteSuccess.apply(this,arguments)}attrs(e){return Li(ht(this),e,!0)}getEntityType(){var e=super.getEntityType();return Ri(e,"Grid")&&(this.entityType=e=e.substring(0,e.length-4)),e}getFormKey(){if(this.formKey!=null)return this.formKey;var e=this.attrs(Ei);return e.length>=1?this.formKey=e[0].value:this.formKey=this.getEntityType()}getEntitySingular(){if(this.entitySingular!=null)return this.entitySingular;var e=this.attrs(Di);if(e.length>=1)this.entitySingular=e[0].value,this.entitySingular=$i.getDefault(this.entitySingular,this.entitySingular);else{var i=Ni(this.getLocalTextDbPrefix()+"EntitySingular");i==null&&(i=this.getEntityType()),this.entitySingular=i}return this.entitySingular}getNameProperty(){return m.prototype.getNameProperty.apply(this,arguments)}getIsDeletedProperty(){return m.prototype.getIsDeletedProperty.apply(this,arguments)}load(e,i,s){return m.prototype.load.call(this,e,i,s)}loadNewAndOpenDialog(){this.loadResponse({}),this.dialogOpen()}loadEntityAndOpenDialog(e,i){this.loadResponse({Entity:e}),this.dialogOpen()}loadResponse(e){var i=this.entityId;e=e||{},this.onLoadingData(e);var s=e.Entity||new Object;this.beforeLoadEntity(s),this.loadEntity(s),this.set_entity(s),this.afterLoadEntity(),this.isDialogOpen&&i!=this.entityId&&mt.replaceLast(this.getEditHash(),!0),(this.autoSaveOnClose()||this.autoSaveOnSwitch())&&(this.triedAutoSaveForCurrentEntity=!1,this.loadedState=this.getSaveState())}loadEntity(e){var i=this.getIdProperty();i!=null&&this.set_entityId(e[i]),this.set_entity(e),this.propertyGrid!=null&&(this.propertyGrid.set_mode(this.isEditMode()?Fe.update:Fe.insert),this.propertyGrid.load(e))}beforeLoadEntity(e){this.localizationPendingValue=null,this.localizationLastValue=null}afterLoadEntity(){this.updateInterface(),this.updateTitle(),this.slickGrid.invalidate()}loadByIdAndOpenDialog(e){this.loadById(e,i=>window.setTimeout(()=>this.dialogOpen(),0),()=>{this.element.is(":visible")||this.element.remove()})}onLoadingData(e){}getLoadByIdOptions(e,i){return{}}getLoadByIdRequest(e){var i={};return i.EntityId=e,i}reloadById(){this.loadById(this.get_entityId())}loadById(e,i,s){return m.prototype.loadById.apply(this,arguments)}loadByIdHandler(e,i,s){return m.prototype.loadByIdHandler.apply(this,arguments)}initLocalizationGrid(){return m.prototype.initLocalizationGrid.apply(this,arguments)}initLocalizationGridCommon(e){return m.prototype.initLocalizationGridCommon.apply(this,arguments)}isLocalizationMode(){return this.localizationButton!=null&&this.localizationButton.hasClass("pressed")}isLocalizationModeAndChanged(){return m.prototype.isLocalizationModeAndChanged.apply(this,arguments)}localizationButtonClick(){return m.prototype.localizationButtonClick.apply(this,arguments)}getLanguages(){return m.prototype.getLanguages.apply(this,arguments)}loadLocalization(){m.prototype.loadLocalization.apply(this,arguments)}setLocalizationGridCurrentValues(){m.prototype.setLocalizationGridCurrentValues.apply(this,arguments)}getLocalizationGridValue(){return m.prototype.getLocalizationGridValue.apply(this,arguments)}getPendingLocalizations(){return m.prototype.getPendingLocalizations.apply(this,arguments)}initPropertyGrid(){var e=this.byId("PropertyGrid");if(!(e.length<=0)){var i=this.getPropertyGridOptions();this.propertyGrid=new Pi(e,i).init(null),this.element.closest(".ui-dialog").hasClass("s-Flexify")&&this.propertyGrid.element.children(".categories").flexHeightOnly(1)}}getFormPropertyItems(){var e=this.getFormKey();return Bi(e)}getPropertyGridOptions(){return{idPrefix:this.idPrefix,items:this.getFormPropertyItems(),mode:Fe.insert,localTextPrefix:"Forms."+this.getFormKey()+".",useCategories:!0}}validateBeforeSave(){return!0}getSaveOptions(e){var i={};return i.service=this.getService()+"/"+(this.isEditMode()?"Update":"Create"),i.onSuccess=s=>{this.triedAutoSaveForCurrentEntity=!1,this.onSaveSuccess(s),e&&e(s);var n=this.isEditMode()?"update":"create",a=i.request==null?null:i.request.Entity,o=this.isEditMode()?this.get_entityId():s==null?null:s.EntityId,l={type:n,entity:a,entityId:o};this.element.triggerHandler("ondatachange",[l])},i.onCleanup=()=>{this.validator&&_i(this.validator)},i.request=this.getSaveRequest(),i}getSaveEntity(){var e=new Object;if(this.propertyGrid!=null&&this.propertyGrid.save(e),this.isEditMode()){var i=this.getIdProperty();i!=null&&e[i]==null&&(e[i]=this.get_entityId())}return e}getSaveRequest(){var e=this.getSaveEntity(),i={};if(i.Entity=e,this.isEditMode()){var s=this.getIdProperty();s!=null&&(i.EntityId=this.get_entityId())}return this.localizationPendingValue!=null&&(i.Localizations=this.getPendingLocalizations()),i}onSaveSuccess(e){}save_submitHandler(e){var i=this.getSaveOptions(e);this.saveHandler(i,e)}save(e){return Ai.submit(this.byId("Form"),()=>this.validateBeforeSave(),()=>this.save_submitHandler(e))}saveHandler(e,i){ft(e)}createToolbar(e){super.createToolbar(e),this.toolbar&&(this.saveAndCloseButton=this.toolbar.findButton("save-and-close-button").hide(),this.saveAndCloseButton.prev(".separator").addClass("dialog-button-separator"),this.applyChangesButton=this.toolbar.findButton("apply-changes-button").hide(),this.deleteButton=this.toolbar.findButton("delete-button").hide(),this.undeleteButton=this.toolbar.findButton("undo-delete-button").hide(),this.cloneButton=this.toolbar.findButton("clone-button").hide(),this.localizationButton=this.toolbar.findButton("localization-button").hide())}showSaveSuccessMessage(e){zi(T("Controls.EntityDialog.SaveSuccessMessage"),"",null)}getButtons(){var e=super.getButtons();return e.push({title:T("Controls.EntityDialog.SaveButton"),cssClass:"save-and-close-button dialog-button",icon:"fa-check-circle text-purple",hotkey:"alt+s",separator:!0,onClick:()=>{this.save(i=>{this.dialogClose()})},visible:()=>!!this.isDialogOpen&&!this.isDeleted()&&!this.isViewMode(),disabled:()=>!this.hasSavePermission()||this.readOnly}),e.push({title:"",hint:T("Controls.EntityDialog.ApplyChangesButton"),cssClass:"apply-changes-button dialog-button",hotkey:"alt+a",icon:"fa-clipboard-check text-purple",onClick:()=>{this.save(i=>{if(this.isEditMode()){var s=i.EntityId;s==null&&(s=this.get_entityId()),this.loadById(s)}else this.loadById(i.EntityId);this.showSaveSuccessMessage(i)})},visible:()=>!!this.isDialogOpen&&!this.isDeleted()&&!this.isViewMode(),disabled:()=>!this.hasSavePermission()||this.readOnly}),e.push({title:T("Controls.EntityDialog.DeleteButton"),cssClass:"delete-button dialog-button",icon:"fa-trash-o text-red",hotkey:"alt+x",onClick:()=>{le(T("Controls.EntityDialog.DeleteConfirmation"),()=>{this.doDelete(()=>this.dialogClose())})},visible:()=>!!this.isDialogOpen&&this.isEditMode()&&!this.isDeleted()&&!this.isViewMode(),disabled:()=>!this.hasDeletePermission()||this.readOnly}),e.push({title:T("Controls.EntityDialog.UndeleteButton"),cssClass:"undo-delete-button dialog-button",onClick:()=>{this.isDeleted()&&le(T("Controls.EntityDialog.UndeleteConfirmation"),()=>{this.undelete(()=>this.loadById(this.get_entityId()))})},visible:()=>!!this.isDialogOpen&&this.isEditMode()&&this.isDeleted()&&!this.isViewMode(),disabled:()=>!this.hasDeletePermission()||this.readOnly}),e.push({title:T("Controls.EntityDialog.LocalizationButton"),cssClass:"localization-button dialog-button",onClick:()=>this.localizationButtonClick()}),e.push({title:T("Controls.EntityDialog.CloneButton"),cssClass:"clone-button dialog-button",icon:"fa-clone",onClick:()=>{if(this.isEditMode()){var i=this.getCloningEntity();Mi.create({type:ht(this),init:s=>pt.bubbleDataChange(pt.cascade(s,this.element),this,!0).loadEntityAndOpenDialog(i,null)})}},visible:()=>!1,disabled:()=>!this.hasInsertPermission()||this.readOnly}),e}getCloningEntity(){return m.prototype.getCloningEntity.apply(this,arguments)}updateInterface(){var o;ut.setContainerReadOnly(this.dialogPane,!1);var e=!!this.isDialogOpen,i=this.isLocalizationMode(),s=this.hasSavePermission(),n=this.isViewMode(),a=this.readOnly;if((o=this.toolbar)==null||o.updateInterface(),this.tabs!=null&&Oi.setDisabled(this.tabs,"Log",!e||this.isNewOrDeleted()),this.propertyGrid!=null&&this.propertyGrid.element.toggle(e&&!i),this.localizationGrid!=null&&this.localizationGrid.element.toggle(e&&i),this.localizationButton!=null&&(this.localizationButton.toggle(this.localizationGrid!=null),this.localizationButton.find(".button-inner").text(this.isLocalizationMode()?T("Controls.EntityDialog.LocalizationBack"):T("Controls.EntityDialog.LocalizationButton"))),i&&e){this.toolbar!=null&&this.toolbar.findButton("tool-button").not(".localization-hidden").addClass(".localization-hidden").hide(),this.localizationButton&&this.localizationButton.show();return}this.toolbar.findButton("localization-hidden").removeClass("localization-hidden").show(),(!s||n||a)&&ut.setContainerReadOnly(this.byId("Form"),!0)}getUndeleteOptions(e){return m.prototype.getUndeleteOptions.apply(this,arguments)}undeleteHandler(e,i){return m.prototype.undeleteHandler.apply(this,arguments)}undelete(e){return m.prototype.undelete.apply(this,arguments)}getInsertPermission(){return m.prototype.getInsertPermission.apply(this,arguments)}getUpdatePermission(){return m.prototype.getUpdatePermission.apply(this,arguments)}getDeletePermission(){return m.prototype.getDeletePermission.apply(this,arguments)}hasDeletePermission(){return m.prototype.hasDeletePermission.apply(this,arguments)}hasInsertPermission(){return m.prototype.hasInsertPermission.apply(this,arguments)}hasUpdatePermission(){return m.prototype.hasUpdatePermission.apply(this,arguments)}hasSavePermission(){return m.prototype.hasSavePermission.apply(this,arguments)}isViewMode(){return m.prototype.isViewMode.apply(this,arguments)}useViewMode(){return m.prototype.useViewMode.apply(this,arguments)}};u(j,"EntityGridDialog"),j=D([ki.registerClass("Serenity.EntityGridDialog",[Fi])],j);import{htmlEncode as Pe,format as Oe,notifySuccess as vt,notifyWarning as yt,localText as P,trimToNull as Wi}from"@serenity-is/corelib";var Ae=class{constructor(t){this.options=t;var e=this.dataGrid=t.grid,i=$(`
<div class="dropdown favorite-views" style="float: right">
  <button class="btn btn-primary dropdown-toggle" type="button" id="${e.element.attr("id")}_Favorites" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
    <i class="fa fa-star"></i> ${Pe(P("Site.FavoriteViewsMixin.FavoriteViews"))}
    <span class="caret"></span>
  </button>
  <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
    <li class="save">
        <div>${Pe(P("Site.FavoriteViewsMixin.SaveView"))}</div>
        <div><input type="text"></div>
        <div><button class="btn btn-primary save-button"><i class="fa fa-floppy-o"></i> ${Pe(P("Site.FavoriteViewsMixin.SaveButton"))}</button></div>
    </li>
  </ul>
</div>
`).prependTo(e.element.find(".grid-title"));i.on("shown.bs.dropdown",n=>{i.find("input[type=text]").focus()});var s=i.find("li.save input[type=text]");i.find("button.save-button").click(()=>F(this,null,function*(){var n=Wi(s.val());if(!n){yt(P("Site.FavoriteViewsMixin.EmptyNameError"));return}let a=yield this.getFavorites();a[n]=e.getCurrentSettings(),yield this.saveFavorites(a),vt(Oe(P("Site.FavoriteViewsMixin.SaveSuccessMessage"),n)),s.val(""),this.populateFavorites()})),this.ul=i.children("ul"),this.ul.on("click","i.fa-trash-o",n=>F(this,null,function*(){var a=$(n.target).closest("li").children("a").text();let o=yield this.getFavorites();delete o[a],yield this.saveFavorites(o),yield this.populateFavorites(),yt(Oe(P("Site.FavoriteViewsMixin.DeleteSuccessMessage"),a))})),this.ul.on("click","a",n=>F(this,null,function*(){var a=$(n.target).text(),l=(yield this.getFavorites())[a];l&&(e.restoreSettingsFrom(l),e.refresh(),vt(Oe(P("Site.FavoriteViewsMixin.LoadedViewMessage"),a)))})),this.populateFavorites()}populateFavorites(){return F(this,null,function*(){var t=yield this.getFavorites(),e=this.ul.children(".save");this.ul.children().not(e).remove();var i=Object.keys(t).sort();if(i.length){for(var s of i){var n=$('<li class="fav"><a href="javascript:;"></a></li>').insertBefore(e).children("a").text(s).end();$('<i class="fa fa-trash-o pull-right"></i>').attr("title",P("Site.FavoriteViewsMixin.DeleteButtonHint")).appendTo(n)}$('<li role="separator" class="divider"></li>').insertBefore(e)}})}saveFavorites(t){return F(this,null,function*(){var e=this.dataGrid.getPersistanceStorage(),i="Views:"+this.dataGrid.getPersistanceKey();return Promise.resolve(e.setItem(i,JSON.stringify(t)))})}getFavorites(){return F(this,null,function*(){var t=this.dataGrid.getPersistanceStorage(),e="Views:"+this.dataGrid.getPersistanceKey(),i=(yield t.getItem(e))||"{}";return JSON.parse(i)||{}})}};u(Ae,"FavoriteViewsMixin");import{Criteria as K,deepClone as ji,serviceCall as Ki}from"@serenity-is/corelib";import{htmlEncode as E,tryGetText as O}from"@serenity-is/corelib";import{EventEmitter as bt,EventSubscriber as qi}from"@serenity-is/sleekgrid";var Ct=(i=>(i[i.disabled=0]="disabled",i[i.value=1]="value",i[i.text=2]="text",i))(Ct||{}),N=class{constructor(t){this.checkedValues=new window.Set;this.onFilterApplied=new bt;this.onCommand=new bt;this.handler=new qi;var e={buttonClass:"headerfilterbutton",useColumnFormatter:!0,getFilterValues:null};this.options=$.extend(!0,{},e,t),this.handleMenuItemClick=this.handleMenuItemClick.bind(this)}init(t){this.grid=t,this.handler.subscribe(t.onHeaderCellRendered,this.handleHeaderCellRendered.bind(this)).subscribe(t.onBeforeHeaderCellDestroy,this.handleBeforeHeaderCellDestroy.bind(this)).subscribe(t.onClick,this.handleBodyMouseDown.bind(this)).subscribe(t.onColumnsResized,this.columnsResized.bind(this)),t.setColumns(t.getColumns()),$(document.body).bind("mousedown",this.handleBodyMouseDown=this.handleBodyMouseDown.bind(this))}destroy(){this.handler.unsubscribeAll(),$(document.body).unbind("mousedown",this.handleBodyMouseDown)}getFilterType(t){return t.headerFilterType!=null||this.options.getFilterType!=null&&(t.headerFilterType=this.options.getFilterType(t),t.headerFilterType!=null)||t.headerFilterType==null&&(t.headerFilterType=1),t.headerFilterType}handleBodyMouseDown(t){this.menu&&this.menu[0]!=t.target&&!$.contains(this.menu[0],t.target)&&this.hideMenu()}hideMenu(){this.menu&&(this.menu.remove(),this.menu=null)}handleHeaderCellRendered(t,e){var i=e.column,s=this.getFilterType(i);if(s===0)return!1;var n=$("<span></span>").addClass("slick-header-menubutton s-header-filter-button").data("column",i);this.options.buttonImage&&n.css("background-image","url("+this.options.buttonImage+")"),this.setButtonIsFiltered(n,i.headerFilterValues!=null&&i.headerFilterValues.length>0),$(e.node).addClass("has-header-menubutton"),n.on("click",a=>{a.stopPropagation(),this.showFilter(a)}).appendTo(e.node)}handleBeforeHeaderCellDestroy(t,e){$(e.node).find(".s-header-filter-button").remove()}addMenuItem(t,e,i,s,n){var a=$("<div class='slick-header-menuitem s-header-filter-item'>").data("command",s).data("column",e).bind("click",this.handleMenuItemClick).appendTo(t),o=$("<div class='slick-header-menuicon s-header-filter-icon'>").appendTo(a);n&&o.css("background-image","url("+n+")"),$("<span class='slick-header-menucontent s-header-filter-content'>").text(i).appendTo(a)}addSearchInput(t,e){return $('<input class="input" placeholder="'+E(O("Site.HeaderFiltersMixin.Search")||"Search")+'">').data("column",e).bind("keyup",i=>{this.updateFilterValues(e,()=>{})}).appendTo(t)}updateFilterItems(t){var e="<label><input type='checkbox' value='-1' />"+E(O("Site.HeaderFiltersMixin.SelectAll")||"(Select All)")+"</label>";this.checkedValues=new window.Set(t.headerFilterValues||[]);for(var i=0;i<this.filterValues.length;i++){var s=this.checkedValues.has(this.filterValues[i]);e+="<label><input type='checkbox' value='"+i+"'"+(s?" checked='checked'":"")+"/>"+this.filterTexts[i]+"</label>"}var n=this.menu.find(".filter");n.empty().append($(e)),$(":checkbox",n).bind("click",a=>{this.onCheckboxClick($(a.target))})}getFilterText(t,e){var i=t[e.field];if(this.options.useColumnFormatter)try{var s=this.grid.getFormatter(-1,e);if(s){var n=this.grid.getFormatterContext(-1,-1);n.item=t,n.value=i;var a=s(n);return i==null&&a===""?E(O("Site.HeaderFiltersMixin.Null")||"(null)"):a}}catch(o){}return i==null?E(O("Site.HeaderFiltersMixin.Null")||"(null)"):E(i)}showFilter(t){var e=$(t.target),i=e.data("column");this.checkedValues=new window.Set(i.headerFilterValues||[]),this.menu?this.menu.empty():this.menu=$("<div class='slick-header-menu s-header-filter-menu cke_dialog'>").appendTo(document.body).hide(),this.searchInput=this.addSearchInput(this.menu,i);var s="<label><input type='checkbox' value='-1' />"+E(O("Site.HeaderFiltersMixin.SelectAll")||"(Select All)")+"</label>",n=$("<div class='filter'>").appendTo(this.menu),a=$('<div class="buttons"></buttons>').appendTo(this.menu);$('<button class="btn btn-success">'+E(O("Site.HeaderFiltersMixin.OkButton")||"OK")+"</button>").appendTo(a).bind("click",o=>{Array.from?i.headerFilterValues=Array.from(this.checkedValues):(i.headerFilterValues=[],this.checkedValues&&this.checkedValues.forEach(l=>i.headerFilterValues.push(l))),this.setButtonIsFiltered(e,i.headerFilterValues.length>0),this.handleApply(o,i)}),$('<button class="btn btn-danger">'+E(O("Site.HeaderFiltersMixin.ClearButton")||"Clear")+"</button>").appendTo(a).bind("click",o=>{i.headerFilterValues&&(i.headerFilterValues.length=0),this.setButtonIsFiltered(e,!1),this.handleApply(o,i)}),$('<button class="btn btn-secondary">'+E(O("Site.HeaderFiltersMixin.CancelButton")||"Cancel")+"</button>").appendTo(a).bind("click",o=>this.hideMenu()),$(":checkbox",n).bind("click",o=>{this.onCheckboxClick($(o.target))}),this.updateFilterValues(i,()=>{this.menu.show(),n.css("height",null);var o=this.menu.height(),l=$(t.target).height(),p=$(t.target).offset(),d=p.left-this.menu.width()+$(t.target).width()-8,c=p.top+l,h=$(window).scrollTop(),g=$(window).height()+h,b=parseInt($("div.content-wrapper").css("padding-top"),10)||0;c+o>g&&g-c+b<c-h&&(c-=o+l+8,c<h&&(c=h));var f=c+o-g;f>0&&n.css("height",n.height()-f),this.menu.css("top",c).css("left",d>0?d:0)})}columnsResized(){this.hideMenu()}onCheckboxClick(t){var e=t.val(),i=t.parent().parent();if(t.val()<0)t.prop("checked")?($(":checkbox",i).prop("checked",!0),this.checkedValues=new window.Set(this.filterValues||[])):($(":checkbox",i).prop("checked",!1),this.checkedValues.clear());else{var s=this.filterValues[e],n=this.checkedValues.has(s);t.prop("checked")&&!n?this.checkedValues.add(s):n&&this.checkedValues.delete(s)}}setButtonIsFiltered(t,e){t.toggleClass("is-filtered",e)}handleApply(t,e){this.hideMenu(),this.onFilterApplied.notify({grid:this.grid,column:e},t,this),t.preventDefault(),t.stopPropagation()}containsFilter(t){if(t==null&&t.length==0)return i=>!0;var e=E(t).toLowerCase();return i=>(i=(i!=null?i:"").toString().replace(/<[^>]+>/g,"").toLowerCase(),i.indexOf(e)>=0)}getFilterValue(t,e){var i=t[e.field];return this.options.useColumnFormatter&&e.formatter!=null&&e.headerFilterType==2?this.getFilterText(t,e).replace(/<[^>]+>/g,""):i}sortFilterValues(){for(var t=[],e=0;e<this.filterValues.length;e++)t[e]=e;t.sort((n,a)=>{var o=this.filterValues[n],l=this.filterValues[a];return o<l?-1:o>l?1:0});for(var i=[],s=[],e=0;e<t.length;e++)i.push(this.filterValues[e]),s.push(this.filterTexts[e]);this.filterValues=i,this.filterTexts=s}updateFilterValues(t,e){this.options.getFilterValues!=null?this.options.getFilterValues(t,(i,s)=>{if(i==null)this.updateFilterValuesFromData(t),this.updateFilterItems(t),e();else{this.filterValues=[],this.filterTexts=[],s=s||i.map(a=>{var o={};return o[t.field]=a,this.getFilterText(o,t)});var n=this.containsFilter(this.searchInput.val());this.filterValues=i.filter((a,o)=>n(s[o])?(this.filterTexts.push(s[o]),!0):!1),this.sortFilterValues(),this.updateFilterItems(t),e()}}):(this.updateFilterValuesFromData(t),this.updateFilterItems(t),e())}updateFilterValuesFromData(t){this.filterValues=[],this.filterTexts=[];var e=this.grid.getData(),i;if(this.checkedValues&&this.checkedValues.size)i=e.getItems();else{i=[];for(var s=0;s<e.getLength();s++)i.push(e.getItem(s))}var n=new window.Set,a=this.searchInput.val(),o=this.containsFilter(a);for(var l of i){var p=this.getFilterValue(l,t);if(!n.has(p)){var d=this.getFilterText(l,t);o(d)&&(n.add(p),this.filterValues.push(p),this.filterTexts.push(d))}}this.sortFilterValues()}handleMenuItemClick(t){var e=$(this).data("command"),i=$(this).data("column");this.hideMenu(),this.onCommand.notify({grid:this,column:i,command:e},t,this),t.preventDefault(),t.stopPropagation()}};u(N,"HeaderFiltersPlugin");typeof globalThis!="undefined"&&globalThis.Slick&&globalThis.Slick.Plugins&&(globalThis.Slick.Plugins.HeaderFilters=N);var Me=class{constructor(t){var e=null,i={};t.filterByText==null?this.filterByText=!t.grid.view.url||!t.grid.view.getPagingInfo().rowsPerPage:this.filterByText=!!t.filterByText;var s=new N({getFilterType:l=>this.filterByText?2:l.sortable!=null&&!l.sortable?0:l.sourceItem!=null&&l.sourceItem.notFilterable!=null&&l.sourceItem.notFilterable?0:1,getFilterValues:(l,p)=>{if(l.headerFilterType==2)return p(null);e=l;try{if(!t.grid.onViewSubmit()){p([]);return}}finally{e=null}var d=ji(t.grid.view.params);d.DistinctFields=[l.field],d.Skip=0,d.Take=0;var c=$.toJSON(d),h=i[c];h&&h.expires>new Date().getTime()?p(h.value):Ki({request:d,url:t.grid.view.url,onSuccess:g=>{i[c]={value:g.Values,expires:new Date().getTime()+1e3*30},p(g.Values)}})}});s.onFilterApplied.subscribe((l,p)=>{var d=p.column;d&&d.headerFilterType==2?t.grid.view.setItems(t.grid.view.getItems(),!0):t.grid.refresh()}),t.grid.slickGrid.registerPlugin(s);var n=this,a=t.grid.onViewSubmit;t.grid.onViewSubmit=function(){if(!a.call(this))return!1;var l=this.slickGrid.getColumns(),p=this.view.params;for(var d of l)if(!(d===e||d.headerFilterType==2)){var c=d.headerFilterValues;if(c&&c.length){var h=c.filter(b=>b!=null),g=K(d.field).in(h);h.length!==c.length&&(h.length>0?g=K.or(K(d.field).isNull(),g):g=K(d.field).isNull()),p.Criteria=K.and(p.Criteria,g)}}return!0};var o=t.grid.onViewFilter;t.grid.onViewFilter=function(l){if(!o.apply(this,arguments))return!1;var p=this.slickGrid.getColumns();for(var d of p)if(d.headerFilterType==2){var c=d.headerFilterValues;if(c&&c.length){var h=s.getFilterValue(l,d);if(c.indexOf(h)<0)return!1}}return!0}}};u(Me,"HeaderFiltersMixin");import{htmlEncode as J,resolveUrl as Tt,localText as Q,format as Ji}from"@serenity-is/corelib";var Re=class{constructor(t){this.options=$.extend({},Re.defaults,t),localStorage.setItem("IdleTimeout:LastActivity",$.now().toString()),localStorage.removeItem("IdleTimeout:Signout");var e,i;$("body").on(this.options.activityEvents,s=>{if(s.type=="mousemove"){if(s.clientX==e&&s.clientY==i)return;e=s.clientX,i=s.clientY}this.isWarningActive()||this.resetIdleTimer()}),this.options.keepAliveTimer&&this.startKeepAliveTimer(),this.resetIdleTimer()}startKeepAliveTimer(){clearTimeout(this.keepAliveTimer);var t=u(()=>{$.get(Tt(this.options.keepAliveUrl)+"?"+new Date().getTime()),this.startKeepAliveTimer()},"keepSessionAlive");this.keepAliveTimer=setTimeout(t,this.options.keepAliveTimer*1e3)}isWarningActive(){return $("#idle-timeout-warning").is(":visible")}startWarningTimer(){this.warningTimer=setInterval(()=>this.warningTimeout(),this.options.checkInterval*1e3)}stopWarningTimer(){clearInterval(this.warningTimer),clearInterval(this.remainingTimer)}warningTimeout(){this.getRemainingSeconds()<0&&this.signout()}resetIdleTimer(){clearTimeout(this.idleTimer),localStorage.setItem("IdleTimeout:LastActivity",$.now().toString()),this.idleTimeout()}idleTimeout(){this.checkActivityTimeout(),this.idleTimer=setTimeout(()=>this.idleTimeout(),this.options.checkInterval*1e3)}checkActivityTimeout(){var t=parseInt(localStorage.getItem("IdleTimeout:LastActivity")||$.now().toString())+(this.options.activityTimeout-(this.options.warningDuration||0))*1e3;$.now()>t?this.options.warningDuration?(this.showWarning(),this.startWarningTimer()):this.signout():localStorage.getItem("IdleTimeout:Signout")?this.signout():this.isWarningActive()&&(this.closeWarning(),this.stopWarningTimer())}signout(){localStorage.setItem("IdleTimeout:Signout","1"),clearTimeout(this.keepAliveTimer),this.stopWarningTimer(),this.closeWarning(),this.options.beforeSignout&&this.options.beforeSignout(),this.options.signoutUrl&&(window.location.href=Tt(this.options.signoutUrl))}showWarning(){var t=$("#idle-timeout-warning");t.length||(t=$(`<div class="modal fade" id="idle-timeout-warning">
<div class="modal-dialog">
    <div class="modal-content">
        <div class="modal-header">
            <h4 class="modal-title">${J(Q("Controls.IdleTimeout.WarningTitle"))} </h4>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-hidden="true"></button>
        </div>
        <div class="modal-body">
        <p>${J(Q("Controls.IdleTimeout.WarningMessage"))}</p>
        <p>${Ji(J(Q("Controls.IdleTimeout.CountdownMessage")),"<span id='idle-timeout-seconds'></span>&nbsp;")}</p>
        <div class="progress">
            <div id="idle-timeout-progress" class="progress-bar progress-bar-striped active" role="progressbar" 
                style="min-width: 15px; width: 100%;">
            </div>
        </div>
        <div class="modal-footer">
            <button id="idle-timeout-warning-signout" type="button" class="btn btn-danger">
                ${J(Q("Controls.IdleTimeout.SignoutButton"))}
            </button>
            <button id="idle-timeout-warning-keepalive" type="button" class="btn btn-primary" data-bs-dismiss="modal">
                ${J(Q("Controls.IdleTimeout.KeepAliveButton"))}
            </button>
        </div>
    </div>
</div>
</div>`).appendTo(document.body),$("#idle-timeout-warning-signout").on("click",()=>this.signout()),t.on("hide.bs.modal",()=>{clearTimeout(this.warningTimer),clearTimeout(this.remainingTimer),this.resetIdleTimer()})),t.modal("show"),this.countdownDisplay()}closeWarning(){var t=$("#idle-timeout-warning").off("hide.bs.modal");t.length&&t.data()&&t.data()["bs.modal"]&&t.data()["bs.modal"].isShown&&(t.removeClass("fade"),t.modal("hide"),t.remove())}getRemainingSeconds(){var t=parseInt(localStorage.getItem("IdleTimeout:LastActivity")||$.now().toString())+this.options.activityTimeout*1e3;return Math.ceil((t-$.now())/1e3)}countdownDisplay(){clearTimeout(this.remainingTimer);var t=u(()=>{var e=Math.max(this.getRemainingSeconds(),1),i=100*Math.max(1,e)/(this.options.warningDuration||1);$("#idle-timeout-progress").css("width",i+"%"),$("#idle-timeout-seconds").text(e)},"update");this.remainingTimer=setInterval(t,500),t()}},de=Re;u(de,"IdleTimeout"),de.defaults={activityEvents:"click keyup mouseup mousemove scroll touchend touchmove wheel mousewheel",activityTimeout:900,checkInterval:5,keepAliveTimer:300,keepAliveUrl:"~/Account/KeepAlive",signoutUrl:"~/Account/Signout",warningDuration:60};function Tn(){}u(Tn,"setupUIOverrides");import{Decorators as Qi,EntityGrid as Xi,GridUtils as Yi,LookupEditor as St,QuickFilterBar as xt,SelectEditor as X,Widget as wt}from"@serenity-is/corelib";import{confirmDialog as It,format as Zi,isEmptyOrNull as er,isTrimmedEmpty as kt,localText as S,notifyError as Gt,notifySuccess as Le,outerHtml as Be,serviceCall as tr,trimToEmpty as pe,trimToNull as ir}from"@serenity-is/corelib";function ue(r){return F(this,null,function*(){try{yield navigator.clipboard.writeText(r)}catch(i){var t=document.createElement("textarea");t.setAttribute("style",`position: absolute, left: -9999px, top: ${window.pageYOffset||document.documentElement.scrollTop}px`),t.setAttribute("readonly",""),t.value=r;var e=$(".ui-dialog-content:visible").last();e.length?e.append(t):document.body.append(t),t.select(),document.execCommand("copy"),t.remove()}})}u(ue,"copyToClipboard");var Y=class extends Xi{constructor(e){super(e);this.element.on("keyup."+this.uniqueName+" change."+this.uniqueName,"input.custom-text",i=>{var s=ir($(i.target).val());s===""&&(s=null),this.view.getItemById($(i.target).data("key")).CustomText=s,this.hasChanges=!0})}getIdProperty(){return"Key"}getLocalTextDbPrefix(){return"Site.Translation."}getService(){return"Administration/Translation"}onClick(e,i,s){if(super.onClick(e,i,s),e.isDefaultPrevented())return;let n=this.itemAt(i),a;if($(e.target).hasClass("source-text")){if(e.preventDefault(),a=u(()=>{n.CustomText=n.SourceText,this.view.updateItem(n.Key,n),this.hasChanges=!0},"done"),kt(n.CustomText)||pe(n.CustomText)===pe(n.SourceText)){a();return}It(S("Site.Translation.OverrideConfirmation"),a);return}if($(e.target).hasClass("target-text")){if(e.preventDefault(),a=u(()=>{n.CustomText=n.TargetText,this.view.updateItem(n.Key,n),this.hasChanges=!0},"done"),kt(n.CustomText)||pe(n.CustomText)===pe(n.TargetText)){a();return}It(S("Site.Translation.OverrideConfirmation"),a);return}}getColumns(){var e=[];return e.push({field:"Key",width:300,sortable:!1}),e.push({field:"SourceText",width:300,sortable:!1,format:i=>Be($("<a/>").addClass("source-text").text(i.value||""))}),e.push({field:"CustomText",width:300,sortable:!1,format:i=>Be($("<input/>").addClass("custom-text").attr("value",i.value).attr("type","text").attr("data-key",i.item.Key))}),e.push({field:"TargetText",width:300,sortable:!1,format:i=>Be($("<a/>").addClass("target-text").text(i.value||""))}),e}createToolbarExtensions(){super.createToolbarExtensions();let e={lookupKey:"Administration.Language"};this.sourceLanguage=wt.create({type:St,element:i=>i.appendTo(this.toolbar.element).attr("placeholder","--- "+S("Site.Translation.SourceLanguage")+" ---"),options:e}),this.sourceLanguage.changeSelect2(i=>{this.hasChanges?this.saveChanges(this.targetLanguageKey).then(()=>this.refresh()):this.refresh()}),this.targetLanguage=wt.create({type:St,element:i=>i.appendTo(this.toolbar.element).attr("placeholder","--- "+S("Site.Translation.TargetLanguage")+" ---"),options:e}),this.targetLanguage.changeSelect2(i=>{this.hasChanges?this.saveChanges(this.targetLanguageKey).then(()=>this.refresh()):this.refresh()})}getQuickFilters(){var e=super.getQuickFilters(),i=xt.boolean("UserTranslated",S("Site.Translation.UserTranslated"));i.init=n=>n.changeSelect2(()=>this.hasChanges&&this.saveChanges(this.targetLanguageKey)),e.push(i);var s=xt.boolean("HasTranslation",S("Site.Translation.HasTranslation"));return s.init=n=>n.changeSelect2(()=>this.hasChanges&&this.saveChanges(this.targetLanguageKey)),e.push(s),e.push({field:"Assembly",cssClass:"Assembly",title:S("Site.Translation.Assembly"),type:X}),e}onViewProcessData(e){e=super.onViewProcessData(e),this.keysByAssembly={};var i=this.tryFindQuickFilter(X,"Assembly");if(i){var s=i.value;i.clearItems();var n=Object.keys(e.KeysByAssembly);n.sort();for(var a of n){var o=e.KeysByAssembly[a];if(o!=null&&o.length){i.addOption(a,a);var l=this.keysByAssembly[a]={};for(var p of o)l[p]=!0}}i.element.select2("val",s)}return e}saveChanges(e){var i={};for(let s of this.getItems())i[s.Key]=s.CustomText;return tr({service:this.getService()+"/Update",request:{TargetLanguageID:e,Translations:i}}).then(s=>{this.hasChanges=!1,Le(Zi(S("Site.Translation.SaveSuccessMessage"),s.SavedPath))})}onViewSubmit(){var e=this.view.params;return e.SourceLanguageID=this.sourceLanguage.value,this.targetLanguageKey=this.targetLanguage.value||"",e.TargetLanguageID=this.targetLanguageKey,this.hasChanges=!1,super.onViewSubmit()}getButtons(){return[{title:S("Site.Translation.SaveChangesButton"),onClick:e=>this.saveChanges(this.targetLanguageKey).then(()=>this.refresh()),cssClass:"apply-changes-button"},{hint:S("Site.Translation.CopySourceTranslations"),cssClass:"copy-source-to-clipboard",icon:"fa fa-clone",onClick:()=>{for(var e=this.slickGrid.getDataLength(),i={},s=0;s<e;s++){var n=this.slickGrid.getDataItem(s);i[n.Key]=n.SourceText}ue(JSON.stringify(i,null,"  ")).then(()=>Le(S("Site.Translation.CopySuccessMessage"))).catch(()=>Gt(S("Site.Translation.CopyFailMessage")))}},{hint:S("Site.Translation.CopyTargetTranslations"),cssClass:"copy-target-to-clipboard",icon:"fa fa-copy",onClick:()=>{var a;for(var e=this.slickGrid.getDataLength(),i={},s=0;s<e;s++){var n=this.slickGrid.getDataItem(s);i[n.Key]=(a=n.CustomText)!=null&&a.length?n.CustomText:n.HasTranslation?n.TargetText:null}ue(JSON.stringify(i,null,"  ")).then(()=>Le(S("Site.Translation.CopySuccessMessage"))).catch(()=>Gt(S("Site.Translation.CopyFailMessage")))}}]}createQuickSearchInput(){Yi.addQuickSearchInputCustom(this.toolbar.element,(e,i,s)=>{this.searchText=i,this.view.setItems(this.view.getItems(),!0),s(this.slickGrid.getDataLength()>0)})}onViewFilter(e){var d,c,h;if(!super.onViewFilter(e))return!1;var i=this.tryFindQuickFilter(X,"UserTranslated");if((d=i==null?void 0:i.value)!=null&&d.length&&(i.value=="1"&&!e.UserTranslated||i.value=="0"&&e.UserTranslated))return!1;var s=this.tryFindQuickFilter(X,"HasTranslation");if((c=s==null?void 0:s.value)!=null&&c.length&&(s.value=="1"&&!e.HasTranslation||s.value=="0"&&e.HasTranslation))return!1;var n=this.tryFindQuickFilter(X,"Assembly");if((h=n==null?void 0:n.value)!=null&&h.length){var a=(this.keysByAssembly||{})[n.value];if(!a||!a[e.Key])return!1}if(!this.searchText)return!0;var o=Select2.util.stripDiacritics,l=o(this.searchText).toLowerCase();function p(g){return g?g.toLowerCase().indexOf(l)>=0:!1}return u(p,"match"),er(l)||p(e.Key)||p(e.SourceText)||p(e.TargetText)||p(e.CustomText)}usePager(){return!1}};u(Y,"TranslationGrid"),Y=D([Qi.registerClass("Serenity.Extensions.TranslationGrid")],Y);import{Decorators as rr,PropertyGrid as sr,PropertyGridMode as nr,TemplatedDialog as ar,WX as or}from"@serenity-is/corelib";import{confirmDialog as lr,getForm as dr,htmlEncode as Et,localText as Z}from"@serenity-is/corelib";var ee=class extends ar{constructor(e){super(e);this._step=1;this.element.children().addClass("wizard-horz"),this.wizardGrid=new sr(this.byId("WizardGrid"),this.getPropertyGridOptions()),this.wizardGrid.element.children(".property-tabs").children("li").each((i,s)=>{var n=$(s),a=n.children("a").html();n.html("").attr("data-step",i+1),$('<span class="badge"/>').text(i+1).appendTo(n),$('<span class="text"/>').html(a).appendTo(n),$('<span class="chevron"/>').appendTo(n)}),this.byId("CancelButton").click(i=>this.confirmCancel(i)),this.byId("BackButton").click(()=>{this.moveToStep(this.step-1)}),this.byId("NextButton").click(()=>{if(!this.validateForm())return!1;this.moveToStep(this.step+1)}),this.wizardGrid.element.children(".property-tabs").on("click","li",i=>{var s=$(i.currentTarget).data("step");s>this.step||this.moveToStep(s)}),this.wizardGrid.load(this.getInitialEntity()),this.getStepLink(this._step).addClass("in show active"),this.getStepPanel(this._step).addClass("in show active"),this.element.on("dialogbeforeclose panelbeforeclose",i=>{or.hasOriginalEvent(i)&&this.confirmCancel(i)})}getPropertyGridOptions(){return{idPrefix:this.idPrefix,mode:nr.insert,items:this.getPropertyItems(),localTextPrefix:"Forms."+this.getFormKey()+".",useCategories:!0}}getFormKey(){return null}getPropertyItems(){var e=this.getFormKey();return e?dr(e):[]}getInitialEntity(){return{}}get maxSteps(){return this.wizardGrid.element.children(".property-tabs").children("li").length}moveToStep(e){if(!(e==this.step||e<1||e>this.maxSteps+1)){if(e>=this.maxSteps+1){this.finish();return}(e<this.step?this.back:this.next).call(this,e)}}get step(){return this._step}set step(e){this.getStepLink(this._step).removeClass("in active"),this.getStepPanel(this._step).removeClass("in show active"),this.getStepLink(e).addClass("in active"),this.getStepPanel(e).addClass("in show active").find(".require-layout").triggerHandler("layout");var i;for(i=e;i<=this._step;i++)this.getStepLink(i).removeClass("complete").find("span.badge").removeClass("badge-success");for(i=this._step;i<e;i++)this.getStepLink(i).addClass("complete").find("span.badge").addClass("badge-success");this._step=e,this.byId("BackButton").toggleClass("disabled",this._step<=1),this.byId("NextButton").children(".txt").text(Z("Site.WizardDialog."+(this._step==this.maxSteps?"Finish":"Next")+"Button"))}reset(){this.step=1,this.wizardGrid.load(this.getInitialEntity())}finish(){this.dialogClose()}next(e){this.step=e}back(e){this.step=e}getStepLink(e){return this.wizardGrid.element.children(".property-tabs").children("li").eq(e-1)}getStepPanel(e){return this.wizardGrid.element.children(".property-panes").children().eq(e-1)}getFallbackTemplate(){return`
<div class="s-Form">
<form id="~_Form" action="">
    <div id="~_WizardGrid" class="wizard-grid">
    </div>

    <div class="buttons" style="text-align: right;">
        <button id="~_CancelButton" class="btn btn-danger" formnovalidate><i class="fa fa-ban"></i> ${Z("Site.WizardDialog.CancelButton")}</button>
        <button id="~_BackButton" class="btn btn-primary disabled" formnovalidate><i class="fa fa-chevron-left"></i> ${Et(Z("Site.WizardDialog.BackButton"))}</button>
        <button id="~_NextButton" class="btn btn-primary" formnovalidate><span class="txt">${Et(Z("Site.WizardDialog.NextButton"))}</span> <i class="fa fa-chevron-right"></i></button>
    </div>
</form>
</div>`}getCancelMessage(){return Z("Site.WizardDialog.CancelMessage")}confirmCancel(e){var i=this.getCancelMessage();if(!i){e.preventDefault(),this.dialogClose();return}e.preventDefault(),lr(i,()=>{this.dialogClose()})}getSaveEntity(e){var i={};if(this.wizardGrid.save(i),e!=null){for(var s=this.maxSteps,n=1;n<=s;n++)if(!(e.indexOf(n)>=0)){var a=this.getStepPanel(n);a.find(".field").each((o,l)=>{var p=$(l).attr("class").split(" ")[1];p&&delete i[p]})}}return i}get compactSteps(){return this.element.children().hasClass("compact-steps")}set compactSteps(e){this.element.children().toggleClass("compact-steps",e)}};u(ee,"WizardDialog"),ee=D([rr.registerClass("Serenity.WizardDialog")],ee);import{PasswordEditor as ur,PrefixedContext as pr,initFormType as cr}from"@serenity-is/corelib";var te=class extends pr{constructor(t){if(super(t),!te.init){te.init=!0;var e=ur;cr(te,["Password",e])}}},H=te;u(H,"ElevateForm"),H.formKey="Membership.Elevate";import{proxyTexts as hr}from"@serenity-is/corelib";var Ve;(t=>{let r;(i=>{let e;(n=>{let s;(a=>t.Pro.Extensions.Texts=hr(a,"",{Controls:{IdleTimeout:{}},Forms:{Membership:{Elevation:{}}},Site:{CardViewMixin:{},DraggableGroupingMixin:{},FavoriteViewsMixin:{},HeaderFiltersMixin:{},WizardDialog:{}}}))(s=n.Texts||(n.Texts={}))})(e=i.Extensions||(i.Extensions={}))})(r=t.Pro||(t.Pro={}))})(Ve||(Ve={}));var Ft=Ve.Pro.Extensions.Texts;import{PropertyPanel as Ar}from"@serenity-is/corelib";import{parseQueryString as Mr,resolveUrl as Bt,serviceCall as Rr}from"@serenity-is/corelib";var ge=Object.keys;function gr(r){return typeof r=="boolean"}u(gr,"isBoolean");function mr(r){return r&&typeof r.nodeType=="number"}u(mr,"isElement");function He(r){return typeof r=="string"}u(He,"isString");function Pt(r){return typeof r=="number"}u(Pt,"isNumber");function B(r){return typeof r=="object"?r!==null:ie(r)}u(B,"isObject");function ie(r){return typeof r=="function"}u(ie,"isFunction");function fr(r){let{prototype:t}=r;return!!(t&&t.isReactComponent)}u(fr,"isComponentClass");function vr(r){return B(r)&&typeof r.length=="number"&&typeof r.nodeType!="number"}u(vr,"isArrayLike");function ze(r,t){if(r)for(let e of ge(r))t(r[e],e)}u(ze,"forEach");function yr(r){return B(r)&&"current"in r}u(yr,"isRef");var Ne={animationIterationCount:0,borderImageOutset:0,borderImageSlice:0,borderImageWidth:0,boxFlex:0,boxFlexGroup:0,boxOrdinalGroup:0,columnCount:0,columns:0,flex:0,flexGrow:0,flexPositive:0,flexShrink:0,flexNegative:0,flexOrder:0,gridArea:0,gridRow:0,gridRowEnd:0,gridRowSpan:0,gridRowStart:0,gridColumn:0,gridColumnEnd:0,gridColumnSpan:0,gridColumnStart:0,fontWeight:0,lineClamp:0,lineHeight:0,opacity:0,order:0,orphans:0,tabSize:0,widows:0,zIndex:0,zoom:0,fillOpacity:0,floodOpacity:0,stopOpacity:0,strokeDasharray:0,strokeDashoffset:0,strokeMiterlimit:0,strokeOpacity:0,strokeWidth:0};function br(r,t){return r+t.charAt(0).toUpperCase()+t.substring(1)}u(br,"prefixKey");var Cr=["Webkit","ms","Moz","O"];ge(Ne).forEach(r=>{Cr.forEach(t=>{Ne[br(t,r)]=0})});var Tr=Symbol.for("jsx-dom:type"),Ot=function(r){return r.ShadowRoot="ShadowRoot",r}(Ot||{});function Sr(r){return r!=null&&r[Tr]===Ot.ShadowRoot}u(Sr,"isShadowRoot");var xr="http://www.w3.org/2000/svg",wr="http://www.w3.org/1999/xlink",Ir="http://www.w3.org/XML/1998/namespace";function At(r){return!gr(r)&&r!=null}u(At,"isVisibleChild");var kr=typeof DOMTokenList!="undefined"?DOMTokenList:function(){};function Mt(r){return Array.isArray(r)?r.map(Mt).filter(Boolean).join(" "):r instanceof kr?""+r:B(r)?ge(r).filter(t=>r[t]).join(" "):At(r)?""+r:""}u(Mt,"className");var Gr={animate:0,circle:0,clipPath:0,defs:0,desc:0,ellipse:0,feBlend:0,feColorMatrix:0,feComponentTransfer:0,feComposite:0,feConvolveMatrix:0,feDiffuseLighting:0,feDisplacementMap:0,feDistantLight:0,feFlood:0,feFuncA:0,feFuncB:0,feFuncG:0,feFuncR:0,feGaussianBlur:0,feImage:0,feMerge:0,feMergeNode:0,feMorphology:0,feOffset:0,fePointLight:0,feSpecularLighting:0,feSpotLight:0,feTile:0,feTurbulence:0,filter:0,foreignObject:0,g:0,image:0,line:0,linearGradient:0,marker:0,mask:0,metadata:0,path:0,pattern:0,polygon:0,polyline:0,radialGradient:0,rect:0,stop:0,svg:0,switch:0,symbol:0,text:0,textPath:0,tspan:0,use:0,view:0},Er=/^(a(ll|t|u)|base[FP]|c(al|lipPathU|on)|di|ed|ex|filter[RU]|g(lyphR|r)|ke|l(en|im)|ma(rker[HUW]|s)|n|pat|pr|point[^e]|re[^n]|s[puy]|st[^or]|ta|textL|vi|xC|y|z)/;var he=class{constructor(t){this.props=t}render(){return null}};u(he,"Component");he.prototype;function Fr(r,t,e){return t=A(G({},t),{children:e}),new r(t).render()}u(Fr,"initComponentClass");function k(r,t){let n=t,{children:e}=n,i=se(n,["children"]);!i.namespaceURI&&Gr[r]===0&&(i=A(G({},i),{namespaceURI:xr}));let s;if(He(r)){if(s=i.namespaceURI?document.createElementNS(i.namespaceURI,r):document.createElement(r),Or(i,s),_e(e,s),s instanceof window.HTMLSelectElement&&i.value!=null)if(i.multiple===!0&&Array.isArray(i.value)){let a=i.value.map(o=>String(o));s.querySelectorAll("option").forEach(o=>o.selected=a.includes(o.value))}else s.value=i.value;Rt(i.ref,s)}else if(ie(r))B(r.defaultProps)&&(i=G(G({},r.defaultProps),i)),s=fr(r)?Fr(r,i,e):r(A(G({},i),{children:e}));else throw new TypeError(`Invalid JSX element type: ${r}`);return s}u(k,"jsx");function Rt(r,t){yr(r)?r.current=t:ie(r)&&r(t)}u(Rt,"attachRef");function _e(r,t){if(vr(r))Dr(r,t);else if(He(r)||Pt(r))$e(document.createTextNode(r),t);else if(r===null)$e(document.createComment(""),t);else if(mr(r))$e(r,t);else if(Sr(r)){let e=t.attachShadow(r.attr);_e(r.children,e),Rt(r.ref,e)}}u(_e,"appendChild");function Dr(r,t){for(let e of[...r])_e(e,t);return t}u(Dr,"appendChildren");function $e(r,t){t instanceof window.HTMLTemplateElement?t.content.appendChild(r):t.appendChild(r)}u($e,"appendChildToNode");function ce(r,t){return r.replace(/[A-Z]/g,e=>t+e.toLowerCase())}u(ce,"normalizeAttribute");function Lt(r,t){t==null||t===!1||(Array.isArray(t)?t.forEach(e=>Lt(r,e)):He(t)?r.setAttribute("style",t):B(t)&&ze(t,(e,i)=>{i.indexOf("-")===0?r.style.setProperty(i,e):Pt(e)&&Ne[i]!==0?r.style[i]=e+"px":r.style[i]=e}))}u(Lt,"style");function Pr(r,t,e){switch(r){case"xlinkActuate":case"xlinkArcrole":case"xlinkHref":case"xlinkRole":case"xlinkShow":case"xlinkTitle":case"xlinkType":Dt(e,wr,ce(r,":"),t);return;case"xmlnsXlink":_(e,ce(r,":"),t);return;case"xmlBase":case"xmlLang":case"xmlSpace":Dt(e,Ir,ce(r,":"),t);return}switch(r){case"htmlFor":_(e,"for",t);return;case"dataset":ze(t,(i,s)=>{i!=null&&(e.dataset[s]=i)});return;case"innerHTML":case"innerText":case"textContent":At(t)&&(e[r]=t);return;case"dangerouslySetInnerHTML":B(t)&&(e.innerHTML=t.__html);return;case"value":if(t==null||e instanceof window.HTMLSelectElement)return;if(e instanceof window.HTMLTextAreaElement){e.value=t;return}break;case"spellCheck":e.spellcheck=t;return;case"class":case"className":ie(t)?t(e):_(e,"class",Mt(t));return;case"ref":case"namespaceURI":return;case"style":Lt(e,t);return;case"on":case"onCapture":ze(t,(i,s)=>{e.addEventListener(s,i,r==="onCapture")});return}if(ie(t)){if(r[0]==="o"&&r[1]==="n"){let i=r.toLowerCase(),s=i.endsWith("capture");if(i==="ondoubleclick"?i="ondblclick":s&&i==="ondoubleclickcapture"&&(i="ondblclickcapture"),!s&&e[i]===null)e[i]=t;else if(s)e.addEventListener(i.substring(2,i.length-7),t,!0);else{let n;i in window?n=i.substring(2):n=i[2]+r.slice(3),e.addEventListener(n,t)}}}else B(t)?e[r]=t:t===!0?_(e,r,""):t!==!1&&t!=null&&(e instanceof SVGElement&&!Er.test(r)?_(e,ce(r,"-"),t):_(e,r,t))}u(Pr,"attribute");function _(r,t,e){r.setAttribute(t,e)}u(_,"attr");function Dt(r,t,e,i){r.setAttributeNS(t,e,i)}u(Dt,"attrNS");function Or(r,t){for(let e of ge(r))Pr(e,r[e],t);return t}u(Or,"attributes");var Ue=Ft.Forms.Membership.Elevation;var We=class extends Ar{getFormKey(){return H.formKey}getReturnUrl(){var t=Mr();return t.returnUrl||t.ReturnUrl}redirectToReturnUrl(){var t=this.getReturnUrl();if(t&&/^\//.test(t)){var e=window.location.hash;e!=null&&e!="#"&&(t+=e),window.location.href=t}else window.location.href=Bt("~/")}submitClick(){if(this.validateForm()){var t=this.propertyGrid.save();Rr({url:Bt("~/Account/Elevate"),request:t,onSuccess:()=>{this.redirectToReturnUrl()}})}}renderContents(){let t=this.useIdPrefix();this.element.empty().append(k("div",{class:"s-container-tight",children:k("div",{class:"s-Panel p-4",children:[k("h5",{class:"text-center mb-4",children:Ue.ConfirmAccess}),k("p",{class:"text-center",children:Ue.ActionRequiresElevation}),k("form",{id:t.Form,action:"",children:[k("div",{id:t.PropertyGrid}),k("button",{id:t.SubmitButton,type:"submit",class:"btn btn-primary my-3 mx-8 w-100",onClick:e=>{e.preventDefault(),this.submitClick()},children:Ue.ElevateButton})]})]})}))}};u(We,"ElevationPanel");export{W as AutoColumnWidthMixin,Ui as AutoSaveOption,Ie as CardViewMixin,ke as CustomSummaryMixin,Ee as DraggableGroupingMixin,z as DraggableGroupingPlugin,We as ElevationPanel,j as EntityGridDialog,Ae as FavoriteViewsMixin,ye as GridEditController,U as GridEditWrapper,Ct as HeaderFilterType,Me as HeaderFiltersMixin,N as HeaderFiltersPlugin,de as IdleTimeout,Y as TranslationGrid,ee as WizardDialog,Tn as setupUIOverrides};
//# sourceMappingURL=index.js.map
