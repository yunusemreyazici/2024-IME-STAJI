var Cl=Object.defineProperty;var Il=Object.getOwnPropertyDescriptor;var g=(n,r,e,t)=>{for(var i=t>1?void 0:t?Il(r,e):r,a=n.length-1,o;a>=0;a--)(o=n[a])&&(i=(t?o(r,e,i):o(i))||i);return t&&i&&Cl(r,e,i),i};var me=(n,r,e)=>new Promise((t,i)=>{var a=u=>{try{l(e.next(u))}catch(d){i(d)}},o=u=>{try{l(e.throw(u))}catch(d){i(d)}},l=u=>u.done?t(u.value):Promise.resolve(u.value).then(a,o);l((e=e.apply(n,r)).next())});function Nt(n,r){return n.some(r)}function Su(n,r){let e=0;for(let t of n)r(t)&&e++;return e}function wu(n,r){for(let e of n)if(r(e))return e;throw new Error("first:No element satisfies the condition.!")}function Ou(n,r){var o;let e={byKey:Object.create(null),inOrder:[]};for(var t=0;t<n.length;t++){var i=n[t];let l=(o=r(i))!=null?o:"";var a=e.byKey[l];a===void 0?(a={order:e.inOrder.length,key:l,items:[i],start:t},e.byKey[l]=a,e.inOrder.push(a)):a.items.push(i)}return e}function Os(n,r){for(var e=0;e<n.length;e++)if(r(n[e]))return e;return-1}function ku(n,r,e){if(n.insert)n.insert(r,e);else if(Array.isArray(n))n.splice(r,0,e);else throw new Error("Object does not support insert!")}var _u=Array.isArray;function Eu(n,r){let e,t=!1;for(let i of n)if(r(i)){if(t)throw new Error("single:sequence contains more than one element.");t=!0,e=i}if(!t)throw new Error("single:No element satisfies the condition.");return e}function Sa(n,r){var t;let e={};for(let i of n){let a=(t=r(i))!=null?t:"",o=e[a];o||(o=e[a]=[]),o.push(i)}return e}function ks(n,r){for(let e of n)if(r(e))return e}function Fu(n,r){return n!=null?n:r}function tn(n){return n!=null}var Ur=()=>{var n=new Date;return new Date(n.getFullYear(),n.getMonth(),n.getDate())};function Q(n,r){for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&(n[e]=r[e]);return n}function Ve(n,r,e){if(r!=null||e!=null)return Q(Q(Ve(n||{}),Ve(r||{})),Ve(e||{}));var t=n,i={}.toString.call(n).slice(8,-1);if(i=="Set")return new Set([...n].map(o=>Ve(o)));if(i=="Map")return new Map([...n].map(o=>[Ve(o[0]),Ve(o[1])]));if(i=="Date")return new Date(n.getTime());if(i=="RegExp")return RegExp(n.source,Sl(n));if(i=="Array"||i=="Object"){t=Array.isArray(n)?[]:{};for(var a in n)t[a]=Ve(n[a])}return t}function Sl(n){if(typeof n.source.flags=="string")return n.source.flags;var r=[];return n.global&&r.push("g"),n.ignoreCase&&r.push("i"),n.multiline&&r.push("m"),n.sticky&&r.push("y"),n.unicode&&r.push("u"),r.join("")}function _i(){return er("__types")}function Oa(n,r){for(var e=r.split("."),t=0;t<e.length;t++)if(n=n[e[t]],n==null)return null;return n}var Kt=typeof globalThis!="undefined"&&globalThis||typeof window!="undefined"&&window||typeof self!="undefined"&&self||typeof global!="undefined"&&global||function(){return this}()||Function("return this")();function _s(){return Kt}function ka(n,r){var e;let t=_i();if(r==null){if(e=t[n],e!=null||Kt==null||n==="Object")return e;r=Kt}return e=Oa(r,n),typeof e!="function"?null:e}function br(n){return Object.prototype.hasOwnProperty.call(n,"__typeName")&&n.__typeName||void 0}function Es(n,r){Object.defineProperty(n,"__typeName",{value:r,configurable:!0})}function se(n){return br(n)||n.name||(n.toString().match(/^\s*function\s*([^\s(]+)/)||[])[1]||"Object"}function Xt(n){var r=se(n),e=r.indexOf("["),t=r.lastIndexOf(".",e>=0?e:r.length);return t>0?r.substr(t+1):r}function U(n){if(n==null)throw new Le("instance","Can't get instance type of null or undefined!");try{return n.constructor}catch(r){return Object}}function Ue(n,r){return n===r||r.prototype instanceof n?!0:typeof n.__isAssignableFrom=="function"?n.__isAssignableFrom(r):!1}function Ae(n,r){return n==null?!1:typeof r.__isInstanceOfType=="function"?r.__isInstanceOfType(n):Ue(r,U(n))}function Ce(n,r){return Ae(n,r)?n:null}function Zt(n,r){if(n==null)return n;if(Ae(n,r))return n;throw new wa("Cannot cast object to type "+se(r))}function rn(n){if(n===Object||!n.prototype||n.__interface===!0)return null;if(Object.getPrototypeOf)return Object.getPrototypeOf(n.prototype).constructor;var r=n.prototype;if(Object.prototype.hasOwnProperty.call(r,"constructor"))try{var e=r.constructor;return delete r.constructor,r.constructor}finally{r.constructor=e}return r.constructor}function ce(n,r,e){var c;var t=[];if(e){var i=rn(n);if(i)for(var a=ce(i,r,!0),o=0;o<a.length;o++){var l=U(a[o]);t.push(a[o])}}var u=(c=n.__metadata)==null?void 0:c.attr;if(u!=null)for(var o=0;o<u.length;o++){var a=u[o];if(r==null||Ae(a,r)){for(var l=U(a),d=t.length-1;d>=0;d--)Ae(t[d],l)&&t.splice(d,1);t.push(a)}}return t}var _a=(e=>(e[e.field=4]="field",e[e.property=16]="property",e))(_a||{});function nn(n,r){var o;var e=[],t=rn(n);t&&(e=nn(t,r&-2));var i=(o=n.__metadata)==null?void 0:o.members;if(i!=null)for(var a of i)r&a.type&&e.push(a);return e}function Ds(n,r){var e=r.name,t=Rs(n);t.members=t.members||[];let i;for(var a of t.members)if(a.name==e){i=a;break}return i?(r.type!=null&&(i.type=r.type),r.attr!=null&&(i.attr=Ns(i.attr,r.attr)),r.getter!=null&&(i.getter=r.getter),r.setter!=null&&(i.setter=r.setter),i):(t.members.push(r),r)}function an(n){let r=_i();var e=[];if(n){var i=function(a,o){for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&i(a[l],l);typeof a=="function"&&o.charAt(0).toUpperCase()===o.charAt(0)&&o.charAt(0).toLowerCase()!==o.charAt(0)&&e.push(a)};i(n,"")}else for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&e.push(r[t]);return e}function jr(n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&delete n[r]}function sn(n,r){if(!n)return r._targets,r;if(!r)return n._targets,n;var e=n._targets?n._targets:[null,n],t=r._targets?r._targets:[null,r];return Fs(e.concat(t))}var wl={};function er(n){let r;if(Kt?(Kt.Q||(Kt.Q={}),r=Kt.Q.__stateStore,r||(Kt.Q.__stateStore=r=Object.create(null))):r=wl,n==null)return r;var e=r[n];return e==null&&(r[n]=e=Object.create(null)),e}var gt;(e=>(e.toString=(t,i)=>{var u;var a=t;if(i===0||!((u=t.__metadata)!=null&&u.enumFlags)){for(var o in a)if(a[o]===i)return o;return i==null?"":i.toString()}else{var l=[];for(var o in a)a[o]&i?l.push(o):l.push(i==null?"":i.toString());return l.join(" | ")}},e.getValues=t=>{var i=[],a=t;for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&typeof a[o]=="number"&&i.push(a[o]);return i}))(gt||(gt={}));function Ol(n,r,e){for(var t=0;t<n.length;t+=2)if(n[t]===r&&n[t+1]===e)return!0;return!1}var Fs=n=>{var r=function(){if(n.length===2)return n[1].apply(n[0],arguments);for(var e=n.slice(),t=0;t<e.length;t+=2)Ol(n,e[t],e[t+1])&&e[t+1].apply(e[t],arguments);return null};return r._targets=n,r},on=(n,r)=>{if(!n||n===r)return null;if(!r)return n;var e=n._targets,t=null,i;r._targets?(t=r._targets[0],i=r._targets[1]):i=r;for(var a=0;a<e.length;a+=2)if(e[a]===t&&e[a+1]===i){if(e.length===2)return null;var o=e.slice();return o.splice(a,2),Fs(o)}return n},Ps=n=>typeof n!="function"&&n.__interface===null;function Pu(n,r){for(var e=0;e<r.length-1;e+=2)(function(t,i){Object.defineProperty(n.prototype,t,{get:function(){return this.w(t,i)},enumerable:!0,configurable:!0})})(r[e],r[e+1])}function Ru(n,r,e,t){e=e||"get_"+r,t=t||"set_"+r,Object.defineProperty(n.prototype,r,{get:function(){return this[e]()},set:function(i){return this[t](i)},configurable:!0,enumerable:!0})}function Rs(n){return(!Object.prototype.hasOwnProperty.call(n,"__metadata")||!n.__metadata)&&(n.__metadata=Object.create(null)),n.__metadata}function kl(n){return n.filter((r,e)=>n.indexOf(r)===e)}var _l=new Proxy({},{get:(n,r)=>r});function Nu(){return _l}function Au(n){return n}function Ns(n,r){return!n||!r?(n||r||[]).slice():kl(n.concat(r))}function El(n){return n!=null&&Array.isArray(n.__interfaces)&&n.__interfaces.some(r=>{var e;return r===this||((e=br(this))==null?void 0:e.length)&&r.__interface&&br(r)===this.__typeName})}function Ea(n,r,e){var i;let t=_i();r&&r.length?(Es(n,r),t[r]=n):(i=br(n))!=null&&i.length&&(t[n.__typeName]=n),e!=null&&e.length&&Object.defineProperty(n,"__interfaces",{value:Ns(n.__interfaces,e),configurable:!0})}function xr(n,r,e){Ea(n,r,e),Object.defineProperty(n,"__interface",{value:!1,configurable:!0})}function Da(n,r,e){xr(n,r,e),Qe(n,new Yt)}function Kr(n,r,e){if(Ea(n,r,void 0),e&&e!=r){let t=_i();t[e]||(t[e]=n)}Object.defineProperty(n,"__interface",{value:null,configurable:!0})}function ln(n,r,e){Ea(n,r,e),Object.defineProperty(n,"__interface",{value:!0,configurable:!0}),Object.defineProperty(n,"__isAssignableFrom",{value:El,configurable:!0})}function Qe(n,r){var e=Rs(n);e.attr=e.attr||[],e.attr.push(r)}var et=class{};ln(et,"Serenity.ISlickFormatter");var Yt=class{};xr(Yt,"Serenity.EditorAttribute");function Fa(n,r,e){var o;if(!n)return;let t=_i();for(var i of Object.keys(n))if(!(i.charAt(0)<"A"||i.charAt(0)>"Z"||i.indexOf("$")>=0||!Object.prototype.hasOwnProperty.call(n,i))){var a=n[i];a==null||Array.isArray(a)||a instanceof Date||typeof a!="function"&&typeof a!="object"||(!br(a)&&(typeof a=="function"&&typeof a.nodeType!="number"||Object.prototype.hasOwnProperty.call(a,"__interface")&&a.__interface!==void 0)&&(typeof a=="function"&&!a.__interfaces&&((o=a.prototype)!=null&&o.format)&&i.substr(-9)==="Formatter"&&(a.__interface===void 0&&Object.defineProperty(a,"__interface",{value:!1,configurable:!0}),a.__interfaces=[et]),a.__interface!==void 0&&(Es(a,r+i),t[r+i]=a)),e>0&&Fa(a,r+i+".",e-1))}}var ye=class extends Error{constructor(r){super(r),this.name="Exception"}},Le=class extends ye{constructor(r,e){super((e||"Value cannot be null.")+`
Parameter name: `+r),this.name="ArgumentNullException"}},wa=class extends ye{constructor(r){super(r),this.name="InvalidCastException"}};function te(n,r){return n.endsWith(r)}function w(n){return n==null||n.length===0}function mt(n){return Y(n)==null}function Ge(n,r,e=" "){if(n=n==null?"":n.toString(),n.padStart)return n.padStart(r,e);for(;n.length<r;)n=e+n;return n}function G(n,r){return n.startsWith(r)}function Mu(n){return Ie(Ie(Yr(n),`\r
`," "),`
`," ").trim()}var As=function(n){var r,e,t;return(t=(e=(r=n!=null?n:"").trimEnd)==null?void 0:e.call(r))!=null?t:n.replace(/\s*$/,"")},Bu=function(n){var r,e,t;return(t=(e=(r=n!=null?n:"").trimStart)==null?void 0:e.call(r))!=null?t:n.replace(/^\s*/,"")};function Je(n){var r;return(r=n==null?void 0:n.trim())!=null?r:""}function Yr(n){return(n!=null?n:"").trim()}function Y(n){return n==null?null:(n=Je(n),n.length===0?null:n)}function Ie(n,r,e){var t,i;return n=n||"",(i=(t=n.replaceAll)==null?void 0:t.call(n,r,e))!=null?i:n.split(r).join(e)}function Pa(n,r){if(n==null)return"";let e=n.toString();for(;e.length<r;)e="0"+e;return e}function O(n){let r=Tr()[n];return r==null&&(r=n!=null?n:""),r}var $u=O;function qu(n){return function(r){return O("Db."+n+"."+r)}}function Tr(){return er("__localText")}function Hu(n){return function(r,e){if(r!=null&&!G(r,"`")){var t=V(r);if(t!=null)return t}if(r!=null&&G(r,"`")&&(r=r.substr(1)),!w(n)){var i=typeof e=="function"?e(n):n+e,a=V(i);if(a!=null)return a}return r}}function V(n){var r=Tr()[n];return r}function Wu(n){return function(r){return O("Db."+n+"."+r)}}function Ls(n,r,e){if(typeof window!="undefined"&&window.Proxy)return new window.Proxy(n,{get:(i,a)=>{var o=e[a];if(o==null)return O(r+a);var l=n[a];return l!=null||(n[a]=l=Ls({},r+a+".",o)),l},ownKeys:i=>Object.keys(e)});for(var t of Object.keys(e))typeof e[t]=="number"?Object.defineProperty(n,t,{get:()=>O(r+t)}):n[t]=Ls({},r+t+".",e[t]);return n}var Xr=class{constructor(r){this.key=r}static add(r,e){if(!r)return;let t=Tr();if(typeof r=="string"){t[r]=e;return}e=e||"";for(let i of Object.keys(r)){let a=e+i,o=r[i];typeof o=="object"?Xr.add(o,a+"."):t[a]=o}}get(){var r=Tr()[this.key];return r==null&&(r=this.key||""),r}toString(){var r=Tr()[this.key];return r==null&&(r=this.key||""),r}},yt=Xr;yt.empty=new Xr(""),yt.initializeTextClass=function(r,e){for(var t=Object.keys(r).slice(),i=Tr(),a=0;a<t.length;a++){var o=t[a],l=r[o];if(l instanceof Xr){var u=l,d=e+o;i[d]=u.key,r[o]=new Xr(d)}}},yt.getDefault=function(r,e){var t=Tr()[r];return t==null&&(t=e,t==null&&(t=r||"")),t};if(typeof globalThis!="undefined"){let n=globalThis.Q||(globalThis.Q={});n.LT==null&&(n.LT=yt)}var Ms,Dl=typeof jQuery=="function"?jQuery:typeof globalThis.$=="function"?globalThis.$:typeof window!="undefined"?(Ms=window.jQuery)!=null?Ms:window.$:void 0,k=Dl;function Ku(n){Cr(n,"",O("Controls.SelectEditor.EmptyItemText"))}function Cr(n,r,e){k("<option/>").attr("value",r!=null?r:"").text(e!=null?e:"").appendTo(n)}var Yu=L;function Xu(n){n.html("")}function Ra(n,r,e){var d;let t=n instanceof k&&n!=null,i=t?n.get(0):n,a=typeof document=="undefined"?null:document;if(i==null)return null;var o=!1;e===void 0&&(e=i.getRootNode(),o=!0);let l=(d=i.id)!=null?d:"";for(;;){var u=e==null?void 0:e.querySelector("#"+l+r);if(!u&&o&&(u=a==null?void 0:a.getElementById(l+r)),!u&&l.length&&(u=e==null?void 0:e.querySelector("#"+l+"_"+r),!u&&o&&(u=a==null?void 0:a.getElementById(l+"_"+r))),u||!l.length)return t?k(u!=null?u:null):u!=null?u:null;let c=l.lastIndexOf("_");c<=0?l="":l=l.substring(0,c)}}var Fl={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","&":"&amp;"};function Pl(n){return Fl[n]}function L(n){return n==null?"":(typeof n!="string"&&(n=""+n),n.replace(/[<>"'&]/g,Pl))}function Bs(){return k("<div/>").appendTo(document.body)}function Zu(n){return k("<i/>").append(n.eq(0).clone()).html()}function Tt(n,r,e){if(!(r==null||!r.length)){if(r.indexOf(" ")<0){n.classList.toggle(r,e);return}var t=r.split(" ").map(a=>a.trim()).filter(a=>a.length);for(var i of t)n.classList.toggle(i,e)}}var Rl={tapToDismiss:!0,toastClass:"toast",containerId:"toast-container",showDuration:300,onShown:()=>{},hideDuration:1e3,onHidden:()=>{},closeMethod:!1,closeDuration:!1,closeEasing:!1,closeOnHover:!0,extendedTimeOut:1e3,iconClass:"toast-info",positionClass:"toast-top-right",timeOut:5e3,titleClass:"toast-title",messageClass:"toast-message",escapeHtml:!0,target:"body",closeHtml:'<button type="button">&times;</button>',closeClass:"toast-close-button",newestOnTop:!0,preventDuplicates:!1,rtl:!1,onCloseClick:()=>{},closeButton:!1,onclick:()=>{}},Ei=null,Na=class{constructor(r){this.toastId=0;this.previousToast=null;var e;this.options=Object.assign(Object.assign({},(e=Ei==null?void 0:Ei.options)!=null?e:Rl),r),this.createContainer(r)}createContainer(r=this.options){var e=document.createElement("div");e.setAttribute("id",r.containerId),r.positionClass&&Tt(e,r.positionClass,!0);let t=document.getElementsByTagName(r.target);return t&&t[0]&&t[0].appendChild(e),e}getContainer(r,e=!1){var i;let t=document.getElementById((i=r==null?void 0:r.containerId)!=null?i:this.options.containerId);return t||(e?this.createContainer(r!=null?r:this.options):null)}error(r,e,t){return this.notify({type:"error",iconClass:"toast-error",message:r,title:e},t)}warning(r,e,t){return this.notify({type:"warning",iconClass:"toast-warning",message:r,title:e},t)}success(r,e,t){return this.notify({type:"success",iconClass:"toast-success",message:r,title:e},t)}info(r,e,t){return this.notify({type:"info",iconClass:"toast-info",message:r,title:e},t)}subscribe(r){this.listener=r}publish(r){this.listener&&this.listener(r)}clear(r,e={}){this.clearToast(r,this.options,e)||this.clearContainer(this.options)}remove(r){var e=this.getContainer(this.options);if(e){if(r&&r!==document.activeElement){this.removeToast(r);return}if(!e.hasChildNodes()){let t=e.parentElement;t&&t.removeChild(e)}}}removeToast(r,e=this.options){var t=this.getContainer(e);!t||!r.parentNode||(r.parentNode.removeChild(r),!(r.offsetWidth>0&&r.offsetHeight>0)&&(t.hasChildNodes()||(t.parentNode&&t.parentNode.removeChild(t),this.previousToast=null)))}clearContainer(r=this.options){var e=this.getContainer(r);if(!e)return;let t=Array.from(e.childNodes);for(let i=t.length-1;i>=0;i-=1)this.clearToast(t[i])}clearToast(r,e,t={}){if(!r)return!1;let i=t.force||!1;return r&&(i||r!==document.activeElement)?(this.removeToast(r,e),!0):!1}notify(r,e){if(e=Object.assign(Object.assign(Object.assign({},this.options),r),e),((R,z)=>{if(R.preventDuplicates){if(z.message===this.previousToast)return!0;this.previousToast=z.message||""}return!1})(e,r))return null;this.toastId+=1;var i=this.getContainer(e,!0);let a=null,o=document.createElement("div"),l=document.createElement("div"),u=document.createElement("div"),d=document.createElement("div");d.innerHTML=e.closeHtml.trim();let c=d.firstChild,p={toastId:this.toastId,state:"visible",startTime:new Date,endTime:void 0,opt:e,map:r},f=(R=null)=>{o===document.activeElement&&!R||(this.removeToast(o),a&&clearTimeout(a),e.onHidden&&p.state!=="hidden"&&e.onHidden(),p.state="hidden",p.endTime=new Date,this.publish(p))},b=()=>{let R="";switch(e.iconClass){case"toast-success":case"toast-info":R="polite";break;default:R="assertive"}o.setAttribute("aria-live",R)},x=()=>{(e.timeOut>0||e.extendedTimeOut>0)&&(a=setTimeout(f,e.extendedTimeOut))},v=()=>{a&&clearTimeout(a)},I=()=>{e.closeOnHover&&(o.addEventListener("mouseover",()=>v()),o.addEventListener("mouseout",()=>x())),!e.onclick&&e.tapToDismiss&&o.addEventListener("click",f),e.closeButton&&c&&c.addEventListener("click",R=>{R.stopPropagation(),e.onCloseClick&&e.onCloseClick(R),f(!0)}),e.onclick&&o.addEventListener("click",R=>{e.onclick&&e.onclick(R),f()})},S=()=>{if(r.title){let R=r.title;e.escapeHtml&&(R=L(r.title)),l.innerHTML=R,Tt(l,e.titleClass,!0),o.appendChild(l)}},T=()=>{if(r.message){let R=r.message;e.escapeHtml&&(R=L(r.message)),u.innerHTML=R,Tt(u,e.messageClass,!0),o.appendChild(u)}},_=()=>{e.closeButton&&c&&(Tt(c,e.closeClass,!0),c.setAttribute("role","button"),o.insertBefore(c,o.firstChild))},N=()=>{e.newestOnTop?i.insertBefore(o,i.firstChild):i.appendChild(o)},E=()=>{e.onShown&&e.onShown(),e.timeOut>0&&(a=setTimeout(f,e.timeOut))};return(()=>{o.classList.add("show"),e.rtl&&o.classList.add("rtl"),e.toastClass&&Tt(o,e.toastClass,!0),e.iconClass&&Tt(o,e.iconClass,!0),S(),T(),_(),N(),b()})(),E(),I(),this.publish(p),o}};Ei=new Na;var At=Ei;typeof At!="undefined"&&At.options&&(At.options.escapeHtml=!0);var Nl={timeOut:3e3,showDuration:250,hideDuration:500,escapeHtml:!0,extendedTimeOut:500,positionClass:"position-toast toast-top-full-width"};function Di(n){return n=Q(Q({},Nl),n),Aa(!0,n),n}function un(n,r,e,t){if(typeof At!="undefined"&&typeof At[n]=="function"){At[n](r,e,Di(t));return}if(typeof document=="undefined"||!document.body){console.error(`no document found! can't show toast: ${n} - ${e}: ${r}`);return}var i=document.getElementById("toast-container");if(!i){i=document.createElement("div"),i.id="toast-container",i.className="toast-container top-0 end-0 p-3",document.body.append(i);var a=document.createElement("div");a.className="toast",a.role="alert",a.ariaLive="assertive",a.ariaAtomic="true",a.innerHTML=`<div class="toast-header bg-${L(n)} text-${L(n)}">
          <strong class="me-auto">${L(e)}</strong>
          <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="${L(O("Dialogs.CloseButton"))}"></button>
        </div>
        <div class="toast-body">
        ${L(r)}
        </div>
      </div>`,i.appendChild(a),typeof bootstrap=="undefined"&&(a.querySelector(".btn-close").addEventListener("click",function(){this.remove()}),setTimeout(function(){this.remove()},1e4))}}function Fi(n,r,e){un("warning",n,r,Di(e))}function Vs(n,r,e){un("success",n,r,Di(e))}function ld(n,r,e){un("info",n,r,Di(e))}function re(n,r,e){un("error",n,r,Di(e))}function Aa(n,r){if(typeof At!="undefined"){var e=At.getContainer(r,n);if(!(!e||!e.classList.contains("position-toast"))){var t=typeof $!="undefined"?$(window.document.body).children(".ui-dialog:visible, .modal.in, .modal.show").last():[];if(t.length>0){var i=t.position();e.classList.add("positioned-toast"),e.style.position="absolute",e.style.top=i.top+28+"px",e.style.left=i.left+6+"px",e.style.width=t.width()-12+"px"}else e.classList.contains("positioned-toast")&&(e.classList.remove("positioned-toast"),e.style.position="",e.style.top="",e.style.left="",e.style.width="")}}}var Se={applicationPath:"/",emailAllowOnlyAscii:!0,responsiveDialogs:!0,bootstrapMessages:!1,rootNamespaces:["Serenity"],notLoggedInHandler:null};typeof document!="undefined"&&(La=document.querySelector("link#ApplicationPath"),La!=null&&(Se.applicationPath=La.getAttribute("href")));var La;var Al=typeof bootstrap!="undefined"?bootstrap:void 0,Ir=Al;var Qs,Gs,$s;typeof k!="undefined"&&((Gs=(Qs=k.fn)==null?void 0:Qs.button)!=null&&Gs.noConflict)&&(($s=k.ui)!=null&&$s.button)&&(k.fn.btn=k.fn.button.noConflict());function qs(n){return n?G(n,"fa-")?"fa "+n:G(n,"glyphicon-")?"glyphicon "+n:n:null}function Hs(n,r,e){var t=Q({modal:!0,width:"40%",maxWidth:450,minWidth:180,resizable:!1,open:function(){n.onOpen&&n.onOpen.call(this)},close:function(){var i,a;(a=(i=k(this)).dialog)==null||a.call(i,"destroy"),n.onClose&&n.onClose.call(this,n.result)}},n);return t.dialogClass="s-MessageDialog"+(e?" "+e:""),n.buttons&&(t.buttons=n.buttons.map(i=>{var a=$a(i);return a.click=function(o){n.result=i.result,k(this).dialog("close"),i.click&&i.click.call(this,o)},a})),k("<div>"+r+"</div>").dialog(t)}var Ma,Ba;function Ct(){var n,r,e,t;return Ma!=null?Ma:Ma=!!(typeof k!="undefined"&&((t=(e=(r=(n=k)==null?void 0:n.fn)==null?void 0:r.modal)==null?void 0:e.Constructor)!=null&&t.VERSION)&&(k.fn.modal.Constructor.VERSION+"").charAt(0)=="3")}function vt(){return Ba!=null?Ba:Ba=typeof Ir!="undefined"&&(!Ir.Modal||!Ir.Modal.VERSION||(!Ir.Modal.VERSION+"").charAt(0)!="4")}var Ll={AlertTitle:"Alert",InformationTitle:"Information",WarningTitle:"Warning",ConfirmationTitle:"Confirm",OkButton:"OK",YesButton:"Yes",NoButton:"No",CancelButton:"Cancel",CloseButton:"Close"};function Me(n){var r;return L((r=V("Dialogs."+n))!=null?r:Ll[n])}function Qa(n,r,e,t=!0){var i=`<button type="button" class="${vt()?"btn-":""}close" data-${vt()?"bs-":""}dismiss="modal" aria-label="${Me("CloseButton")}">${vt()?"":'<span aria-hidden="true">&times;</span>'}</button>`,a=document.createElement("div");return a.classList.add("modal"),e!=null&&e.length&&Tt(a,e,!0),a.setAttribute("tabindex","-1"),a.setAttribute("role","dialog"),a.innerHTML=`<div class="modal-dialog" role="document">
    <div class="modal-content">
        <div class="modal-header">
            ${Ct()?i:""}<h5 class="modal-title">${L(n)}</h5>${Ct()?"":i}
        </div>
        <div class="modal-body">${t?L(r):r}</div>
        <div class="modal-footer"></div>
    </div>
</div>`,a}function Ga(n){var i,a;var r=n.htmlEncode==null||n.htmlEncode?L(n.text):n.text,e=qs(n.icon);e!=null&&e.length&&(r='<i class="'+L(e)+'"><i>'+(r?" "+r:""));var t=document.createElement("button");return t.classList.add("btn"),(i=n.cssClass)!=null&&i.length&&Tt(t,n.cssClass,!0),(a=n.hint)!=null&&a.length&&t.setAttribute("title",n.hint),t.innerHTML=r,t}function $a(n){var i;var r=n.htmlEncode==null||n.htmlEncode?L(n.text):n.text,e=qs(n.icon);e!=null&&e.length&&(r='<i class="'+L(e)+'"></i>'+(r?" "+r:""));var t={text:r,click:n.click};return(i=n.cssClass)!=null&&i.length&&(t.cssClass=n.cssClass),t}function qa(n,r,e){var t=Qa(n.title,r,"s-MessageModal"+(e?" "+e:""),!1),i=t.querySelector(".modal-footer"),a=typeof k=="undefined"&&vt();function o(d){if(i){var c=Ga(d);i.append(c),c.addEventListener("click",p=>{var f;n.result=d.result,a?(f=Ir.Modal.getInstance(t))==null||f.hide():k(t).modal("hide"),d.click&&d.click.call(this,p)})}}if(n.buttons)for(var l of n.buttons)o(l);if(a)document.body.appendChild(t),n.onOpen&&t.addEventListener("shown.bs.modal",n.onOpen),t.addEventListener("hidden.bs.modal",d=>{try{n.onClose&&n.onClose(n.result)}finally{t.remove()}}),document.body.appendChild(t),new Ir.Modal(t,{backdrop:!1}).show();else{var u=k(t).appendTo(document.body);n.onOpen&&u.one("shown.bs.modal",n.onOpen),u.one("hidden.bs.modal",d=>{try{n.onClose&&n.onClose(n.result)}finally{u.remove()}}),vt()?(u.modal({backdrop:!1}),u.modal("show")):u.modal({backdrop:!1,show:!0}),vt()&&u.modal("show")}}var Va;function Pi(){var n;return Va==null&&(Va=!vt()&&(typeof k=="undefined"||(!k.ui||!((n=k.ui)!=null&&n.dialog))&&(!k.fn||!k.fn.modal))),Va}function Ha(n){var r,e;return Se.bootstrapMessages||n.bootstrap||!((e=(r=k)==null?void 0:r.ui)!=null&&e.dialog)}function Ws(n,r){var e=r==null||r.htmlEncode==null||r.htmlEncode;e&&(n=L(n));var t=r==null||r.preWrap==null&&e||r.preWrap;return'<div class="message"'+(t?' style="white-space: pre-wrap">':">")+n+"</div>"}function _e(n,r){var i,a,o;if(Pi()){window.alert(n);return}r!=null||(r={});let e=Ha(r);r.htmlEncode==null&&(r.htmlEncode=!0),r.okButton==null&&(r.okButton=Me("OkButton")),r.title==null&&(r.title=Me("AlertTitle")),r.buttons==null&&(r.buttons=[],(r.okButton==null||r.okButton)&&r.buttons.push({text:typeof r.okButton=="boolean"?Me("OkButton"):r.okButton,cssClass:(i=r.okButtonClass)!=null?i:e?"btn-danger":void 0,result:"ok"}));var t=Ws(n,r);e?qa(r,t,(a=r.modalClass)!=null?a:"s-AlertModal"):Hs(r,t,(o=r.dialogClass)!=null?o:"s-AlertDialog")}var bd=_e;function Zr(n,r,e){var i,a,o;if(Pi()){window.confirm(n)&&r&&r();return}e!=null||(e={});let t=Ha(e);e.htmlEncode==null&&(e.htmlEncode=!0),e.yesButton==null&&(e.yesButton=Me("YesButton")),e.noButton==null&&(e.noButton=Me("NoButton")),typeof e.title=="undefined"&&(e.title=Me("ConfirmationTitle")),e.buttons==null&&(e.buttons=[],(e.yesButton==null||e.yesButton)&&e.buttons.push({text:typeof e.yesButton=="boolean"?Me("YesButton"):e.yesButton,cssClass:(i=e.yesButtonClass)!=null?i:t?"btn-primary":void 0,result:"yes",click:r}),(e.noButton==null||e.noButton)&&e.buttons.push({text:typeof e.noButton=="boolean"?Me("NoButton"):e.noButton,cssClass:t?vt()?"btn-danger":"btn-default":void 0,result:"no",click:e.onNo}),e.cancelButton&&e.buttons.push({text:typeof e.cancelButton=="boolean"?Me("CancelButton"):e.cancelButton,cssClass:t?vt()?"btn-secondary":"btn-default":void 0,result:"cancel",click:e.onCancel})),n=Ws(n,e),t?qa(e,n,(a=e.modalClass)!=null?a:"s-ConfirmModal"):Hs(e,n,(o=e.dialogClass)!=null?o:"s-ConfirmDialog")}var xd=Zr;function ei(n){var a,o;if(Pi()){window.alert(n.html);return}var r;function e(l){if(l){var u=l.appendChild(document.createElement("iframe"));u.setAttribute("style","border: none; width: 100%; height: 100%;"),r=u.contentDocument,r&&(r.open(),r.write(n.html),r.close())}}if(Ha(n)){qa({title:Me("AlertTitle"),modalClass:"modal-lg",onOpen:function(){e(this.querySelector(".modal-body>div"))}},'<div style="overflow: hidden"></div>',"s-IFrameModal");return}var t=document.createElement("div");t.style.overflow="hidden",document.body.appendChild(t);let i=Q({autoOpen:!0,modal:!0,width:"60%",height:"400",title:Me("AlertTitle"),open:function(){e(t)},close:function(){var l,u,d,c;(c=(d=(u=(l=k(t)).dialog)==null?void 0:u.call(l,"destroy").html(""))==null?void 0:d.remove)==null||c.call(d)}},n);(o=(a=k(t)).dialog)==null||o.call(a,i)}function Ml(n,r,e){if(Pi()){window.alert(n),r&&r();return}Zr(n,r,Q({title:Me("InformationTitle"),dialogClass:"s-InformationDialog",modalClass:"s-InformationModal",yesButton:Me("OkButton"),yesButtonClass:"btn-info",noButton:!1},e))}var Td=Ml;function Bl(n,r,e){if(Pi()){window.alert(n),r&&r();return}Zr(n,r,Q({title:Me("SuccessTitle"),dialogClass:"s-SuccessDialog",modalClass:"s-SuccessModal",yesButton:Me("OkButton"),yesButtonClass:"btn-success",noButton:!1},e))}var Cd=Bl;function Vl(n,r){_e(n,Q({title:Me("WarningTitle"),dialogClass:"s-WarningDialog",modalClass:"s-WarningModal",okButtonClass:"btn-warning"},r))}var Id=Vl;function dn(n,r){var e=k&&n instanceof k?n.get(0):n;if(!(!e||!e.classList.contains("s-Panel")||e.classList.contains("hidden"))){var t;if(k){if(t=k.Event(r),t.type="panelbeforeclose",t.target=e,k(n).trigger(t),t.isDefaultPrevented())return;t=k.Event("panelclosing",{panel:e}),k(window).trigger(t)}else{if(t=new Event("panelbeforeclose",{cancelable:!0}),e.dispatchEvent(t),t.defaultPrevented)return;t=new Event("panelclosing"),t.panel=e,window.dispatchEvent(t)}e.classList.add("hidden");var i=e.dataset.paneluniquename;if(i!=null&&i.length&&document.querySelectorAll(`[data-panelhiddenby="${i}"]`).forEach(o=>{o.classList.remove("panel-hidden"),o.removeAttribute("data-panelhiddenby")}),k)k(window).triggerHandler("resize"),k(".require-layout:visible").triggerHandler("layout"),t=k.Event(r),t.type="panelclose",t.target=e,k(e).trigger(t),t=k.Event("panelclosed",{panel:e}),k(window).trigger(t);else{window.dispatchEvent(new Event("resize"));var a=new Event("layout");document.querySelectorAll(".require-layout").forEach(o=>{(o.offsetWidth>0||o.offsetHeight>0)&&o.dispatchEvent(a)}),e.dispatchEvent(new Event("panelclose")),t=new Event("panelclosed"),t.panel=e,window.dispatchEvent(t)}}}function Js(n,r){var u,d;var e=k&&n instanceof k?n.get(0):n;if(!e)return;var t;k?(t=k.Event("panelopening",{panel:e}),k(window).trigger(t)):(t=new Event("panelopening"),t.panel=e,window.dispatchEvent(t));var i=(u=document.querySelector(".panels-container"))!=null?u:document.querySelector("section.content");e.dataset.paneluniquename=(d=r!=null?r:e.id)!=null?d:new Date().getTime().toString();function a(c){c===e||c.tagName==="LINK"||c.tagName==="SCRIPT"||c.classList.contains("panel-hidden")||(c.classList.contains("ui-dialog")||c.classList.contains("ui-widget-overlay"))&&c.offsetWidth<=0&&c.offsetHeight<=0||(c.classList.add("panel-hidden"),c.setAttribute("data-panelhiddenby",e.dataset.paneluniquename))}if(i){var o=i.children;let c=o.length;for(var l=0;l<c;l++)a(o[l]);e.parentElement!==i&&i.appendChild(e)}document.querySelectorAll(".ui-dialog, .ui-widget-overlay, .modal.show, .modal.in").forEach(a),e.classList.remove("hidden"),e.classList.remove("panel-hidden"),e.classList.add("s-Panel"),k?(k(e).trigger("panelopen"),t=k.Event("panelopened",{panel:e}),k(window).trigger(t)):(e.dispatchEvent(new Event("panelopen")),t=new Event("panelopened"),t.panel=e,window.dispatchEvent(t))}var cn;(t=>{function n(i){var a,o;_e((o=(a=i==null?void 0:i.Message)!=null?a:i==null?void 0:i.Code)!=null?o:"??ERROR??")}t.showServiceError=n;function r(i,a,o,l,u){var c;try{if(!t.isDevelopmentMode())return;var d=(c=u==null?void 0:u.stack)!=null?c:u==null?void 0:u.toString();i="<p></p><p>Message: "+L(i)+"</p><p>File: "+L(a)+", Line: "+o+", Column: "+l+(d?"</p><p>"+L(d):"")+"</p>",window.setTimeout(function(){try{re(i,"SCRIPT ERROR! See browser console (F12) for details.",{escapeHtml:!1,timeOut:15e3})}catch(p){}},0)}catch(p){}}t.runtimeErrorHandler=r;function e(){var a;var i=((a=window.location.hostname)!=null?a:"").toLowerCase();return i==="localhost"||i==="127.0.0.1"||i==="[::1]"||i.endsWith(".local")||i.endsWith(".localhost")}t.isDevelopmentMode=e})(cn||(cn={}));var ti=0;function zs(n){var e;if(ti>0){ti++;return}if((e=k)!=null&&e.blockUI)k.blockUI(n);else if(typeof document!="undefined"){var r=document.createElement("div");r.className="blockUI blockOverlay",r.setAttribute("style","z-index: 2000; border: none; margin: 0px; padding: 0px; width: 100%; height: 100%; top: 0px; left: 0px; opacity: 0; cursor: wait; position: fixed;"),document.body.appendChild(r)}ti++}function ri(n){n=Object.assign({baseZ:2e3,message:"",overlayCSS:{opacity:"0.0",zIndex:2e3,cursor:"wait"},fadeOut:0},n),n.useTimeout?window.setTimeout(function(){zs(n)},0):zs(n)}function Sr(){var n,r;if(ti>1){ti--;return}ti--,(n=k)!=null&&n.unblockUI?k.unblockUI({fadeOut:0}):typeof document!="undefined"&&((r=document.body.querySelector(":scope > .blockUI.blockOverlay"))==null||r.remove())}function Wa(n){if($.cookie)return $.cookie(n);n+="=";for(var r=document.cookie.split(/;\s*/),e=r.length-1;e>=0;e--)if(!r[e].indexOf(n))return r[e].replace(n,"")}typeof $!="undefined"&&$.ajaxSetup&&$.ajaxSetup({beforeSend:function(n,r){if(!r||!r.crossDomain){var e=Wa("CSRF-TOKEN");e&&n.setRequestHeader("X-CSRF-TOKEN",e)}}});function $e(n){let r=function(t){if(!(Se.notLoggedInHandler!=null&&t&&t.Error&&t.Error.Code=="NotLoggedIn"&&Se.notLoggedInHandler(n,t))){if(n.onError!=null){n.onError(t);return}cn.showServiceError(t.Error)}};var e=n.service;return e&&e.length&&e.charAt(0)!="~"&&e.charAt(0)!="/"&&e.indexOf("://")<0&&(e=Ee("~/Services/")+e),n=Q({dataType:"json",contentType:"application/json",type:"POST",cache:!1,blockUI:!0,url:e,data:JSON.stringify(n.request),success:function(t,i,a){try{!t.Error&&n.onSuccess&&n.onSuccess(t)}finally{n.blockUI&&Sr(),n.onCleanup&&n.onCleanup()}},error:function(t,i,a){try{if(t.status===403){var o=null;try{o=t.getResponseHeader("Location")}catch(d){o=null}if(o){window.top.location.href=o;return}}if((t.getResponseHeader("content-type")||"").toLowerCase().indexOf("application/json")>=0){var l=$.parseJSON(t.responseText);if(l&&l.Error){r(l);return}}var u=t.responseText;u?ei({html:u}):t.status?t.status==500?_e("HTTP 500: Connection refused! Check browser console for details."):_e("HTTP "+t.status+" error! Check browser console for details."):t.statusText!="abort"&&_e("An unknown AJAX connection error occurred! Check browser console for details.")}finally{n.blockUI&&Sr(),n.onCleanup&&n.onCleanup()}}},n),n.blockUI&&ri(null),$.ajax(n)}function Ld(n,r,e,t){return $e(Q({service:n,request:r,onSuccess:e},t))}function Us(n,r,e){n.EqualityFilter==null&&(n.EqualityFilter={}),n.EqualityFilter[r]=e}function Md(n){let r;n===void 0?r=location.search.substring(1,location.search.length):r=n||"";let e={},t=r.split("&");for(let i=0;i<t.length;i++){let a=t[i].split("="),o=decodeURIComponent(a[0]);e[o]=a.length>=2?decodeURIComponent(a[1]):o}return e}function js(n){let r=$("<form/>").attr("method","POST").attr("action",n.url?Ee(n.url):Ee("~/Services/"+n.service)).appendTo(document.body);n.target&&r.attr("target",n.target);let e=$("<div/>").appendTo(r);$("<input/>").attr("type","hidden").attr("name","request").val($.toJSON(n.request)).appendTo(e);var t=Wa("CSRF-TOKEN");t&&$("<input/>").attr("type","hidden").attr("name","__RequestVerificationToken").appendTo(e).val(t),$("<input/>").attr("type","submit").appendTo(e),r.submit(),window.setTimeout(function(){r.remove()},0)}function Bd(n){let r=$("<form/>").attr("method","POST").attr("action",Ee(n.url)).appendTo(document.body);n.target&&r.attr("target",n.target);let e=$("<div/>").appendTo(r);if(n.params!=null)for(let i in n.params)$("<input/>").attr("type","hidden").attr("name",i).val(n.params[i]).appendTo(e);var t=Wa("CSRF-TOKEN");t&&$("<input/>").attr("type","hidden").attr("name","__RequestVerificationToken").appendTo(e).val(t),$("<input/>").attr("type","submit").appendTo(e),r.submit(),window.setTimeout(function(){r.remove()},0)}function Ee(n){return n&&n.substr(0,2)==="~/"?Se.applicationPath+n.substr(2):n}var Lt={decimalSeparator:".",groupSeparator:",",decimalDigits:2,negativeSign:"-",positiveSign:"+",percentSymbol:"%",currencySymbol:"$",dateSeparator:"/",dateOrder:"mdy",dateFormat:"MM/dd/yyyy",dateTimeFormat:"MM/dd/yyyy HH:mm:ss",amDesignator:"AM",pmDesignator:"PM",timeSeparator:":",firstDayOfWeek:0,dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],minimizedDayNames:["Su","Mo","Tu","We","Th","Fr","Sa"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December",""],shortMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec",""],stringCompare:(n,r)=>n<r?-1:n>r?1:0};function Ql(n){var r={};for(let e=0;e<n.length;e++)r[n.charAt(e)]=e+1;return function(e,t){if(e=e||"",t=t||"",e==t)return 0;let i;for(let a=0,o=Math.min(e.length,t.length);a<o;a++){let l=e.charAt(a),u=t.charAt(a);if(l===u)continue;let d=r[l],c=r[u];if(d!=null&&c!=null)return d<c?-1:1;if(i=l.localeCompare(u),i!=0)return i}return i!=null?i:e.localeCompare(t)}}var F={decimalSeparator:".",groupSeparator:",",dateSeparator:"/",dateOrder:"dmy",dateFormat:"dd/MM/yyyy",dateTimeFormat:"dd/MM/yyyy HH:mm:ss",stringCompare:Ql("AaBbCc\xC7\xE7FfGg\u011E\u011FHhI\u0131\u0130iJjKkLlMmNnOo\xD6\xF6PpRrSs\u015E\u015FTtUu\xDC\xFCVvYyZz")};(function(){var e;let n;for(n in Lt)F[n]===void 0&&Object.prototype.hasOwnProperty.call(Lt,n)&&(F[n]=Lt[n]);if(typeof document!="undefined"&&(n=Y((e=document.querySelector("script#ScriptCulture"))==null?void 0:e.textContent))!=null){var r=JSON.parse(n);r.DecimalSeparator!=null&&(F.decimalSeparator=r.DecimalSeparator),r.GroupSeparator!=null&&r.GroupSeparator!=F.decimalSeparator?F.groupSeparator=r.GroupSeparator:F.groupSeparator==F.decimalSeparator&&(F.groupSeparator=F.decimalSeparator=="."?",":"."),delete r.GroupSeparator,delete r.DecimalSeparator;for(n in r)F[n]===void 0&&Object.prototype.hasOwnProperty.call(r,n)&&(F[n.charAt(0).toLowerCase()+n.substr(1)]=r[n])}})();function Gd(n){return n&&n.replace(/i/g,"\u0130").replace(/ı/g,"I").toLowerCase()}function $d(n){return n&&n.replace(/i/g,"\u0130").replace(/ı/g,"I").toUpperCase()}var qd=F.stringCompare;function Ks(n,r,e,t){var i=null,a=n.indexOf(r);a>0&&(i=n.substring(a),n=n.substr(0,a));var o=G(n,t);o&&(n=n.substring(1));var l=3;if(n.length<l)return(o?t:"")+(i?n+i:n);for(var u=n.length,d="",c=!1;!c;){var p=l,f=u-p;if(f<0&&(l+=f,p+=f,f=0,c=!0),!p)break;var b=n.substring(f,f+p);d.length?d=b+e+d:d=b,u-=p}return o&&(d="-"+d),i?d+i:d}var Gl=/\{\{|\}\}|\{[^\}\{]+\}/g;function Ys(n,r,e,t){return n.replace(Gl,function(i){if(i==="{{"||i==="}}")return i.charAt(0);var a=parseInt(i.substr(1),10),o=e[a+t];if(o==null)return"";var l=null,u=i.indexOf(":");return u>0&&(l=i.substring(u+1,i.length-1)),$l(o,l,r)})}function j(n,...r){return Ys(n,F,arguments,1)}function Hd(n,r,...e){return Ys(r,n,arguments,2)}function $l(n,r,e){return typeof n=="number"?It(n,r,e):Object.prototype.toString.call(n)==="[object Date]"?ie(n,r,e):n.format?n.format(r,e!=null?e:F):String(n)}var Ri=(n,r,e)=>{var t=Math.pow(10,r||0);n*=t;var i=n>0|-(n<0);if(n%1===.5*i){var a=Math.floor(n);return(a+(e?i>0:a%2*i))/t}return Math.round(n)/t},Xs=n=>n!=null?n>0?Math.floor(n):Math.ceil(n):null;function It(n,r,e,t){var _,N,E,D,R,z,Te,le;if(n==null)return"";var i=typeof e!="string"?e!=null?e:F:{decimalSeparator:e,groupSeparator:t!=null?t:e==","?".":","};if(isNaN(n))return(_=i.nanSymbol)!=null?_:F.nanSymbol;if(r==="i")return n.toString();(r==null||r=="")&&(r="g");var a=(N=i.decimalSeparator)!=null?N:F.decimalSeparator;t=(E=t!=null?t:i.groupSeparator)!=null?E:F.groupSeparator;var o=(D=i.negativeSign)!=null?D:F.negativeSign,l="",u=-1;r.length>1&&(u=parseInt(r.substring(1),10));var d=r.charAt(0);switch(d){case"g":case"G":u!=-1?l=n.toFixed(u):l=n.toString(),a!="."&&(l=l.replace(".",a));break;case"d":case"D":l=parseInt(Math.abs(n)).toString(),u!=-1&&(l=Ge(l,u,"0")),n<0&&(l=o+l);break;case"x":case"X":l=parseInt(Math.abs(n)).toString(16),d=="X"&&(l=l.toUpperCase()),u!=-1&&(l=Ge(l,u,"0"));break;case"e":case"E":u==-1?l=n.toExponential(6):l=n.toExponential(u),d=="E"&&(l=l.toUpperCase());break;case"f":case"F":case"n":case"N":if(u==-1&&(u=(R=i.decimalDigits)!=null?R:F.decimalDigits),l=n.toFixed(u).toString(),u&&a!="."){var c=l.indexOf(".");l=l.substring(0,c)+a+l.substring(c+1)}(d=="n"||d=="N")&&(l=Ks(l,a,t,o));break;case"c":case"C":case"p":case"P":u==-1&&(u=(z=i.decimalDigits)!=null?z:F.decimalDigits);var p;if(d==="p"||d=="P"?(n*=100,p=(Te=i.percentSymbol)!=null?Te:F.percentSymbol):p=(le=i.currencySymbol)!=null?le:F.currencySymbol,l=n.toFixed(u).toString(),u&&a!="."){var c=l.indexOf(".");l=l.substring(0,c)+a+l.substring(c+1)}l=Ks(l,a,t,o)+p;break;default:for(var f="",b="",x="",v=!1,I=!1,S=0;S<r.length;S++){var T=r.charAt(S);if(T=="'"){I=!I;continue}else if(!I){if(T=="\\"){var T=r.charAt(S+1)||"";S++}else if(T=="#"||T==","||T=="."||T=="0"){v=!0,b+=T;continue}}v?x+=T:f+=T}r=b;let K="";if(r.indexOf(".")>-1){let ge=a,ke=r.substring(r.lastIndexOf(".")+1);n=ql(n,ke.length);let Xe=n%1,ve=new String(Xe.toFixed(ke.length));ve=ve.substring(ve.lastIndexOf(".")+1);for(let Ne=0;Ne<ke.length;Ne++)if(ke.charAt(Ne)=="#"&&ve.charAt(Ne)!="0"){ge+=ve.charAt(Ne);continue}else if(ke.charAt(Ne)=="#"&&ve.charAt(Ne)=="0")if(ve.substring(Ne).match("[1-9]")){ge+=ve.charAt(Ne);continue}else break;else ke.charAt(Ne)=="0"?ge+=ve.charAt(Ne):ge+=ke.charAt(Ne);K+=ge}else n=Math.round(n);let Oe=Math.floor(n);n<0&&(Oe=Math.ceil(n));let fe="";r.indexOf(".")==-1?fe=r:fe=r.substring(0,r.indexOf("."));let ue="";if(!(Oe==0&&fe.substr(fe.length-1)=="#")){let ge=new String(Math.abs(Oe)),ke=9999;fe.lastIndexOf(",")!=-1&&(ke=fe.length-fe.lastIndexOf(",")-1);let Xe=0;for(let ve=ge.length-1;ve>-1;ve--)ue=ge.charAt(ve)+ue,Xe++,Xe==ke&&ve!=0&&(ue=t+ue,Xe=0);if(fe.length>ue.length){let ve=fe.indexOf("0");if(ve!=-1){let Ne=fe.length-ve,Hr=fe.length-ue.length-1;for(;ue.length<Ne;){let Ut=fe.charAt(Hr);Ut==","&&(Ut=t),ue=Ut+ue,Hr--}}}}return!ue&&fe.indexOf("0",fe.length-1)!==-1&&(ue="0"),K=ue+K,n<0&&(K=o+K),K.lastIndexOf(a)==K.length-1&&(K=K.substring(0,K.length-1)),f+K+x}return l}function st(n){if(n==null||(n=Je(n.toString()),!n.length))return null;let r=F.groupSeparator;return n&&n.length&&n.indexOf(r)>0&&(n=n.replace(new RegExp("(\\b\\d{1,3})\\"+r+"(?=\\d{3}(\\D|$))","g"),"$1")),/^[-\+]?\d+$/.test(n)?parseInt(n,10):NaN}function tr(n){if(n==null||(n=Je(n.toString()),n.length==0))return null;let r=F.groupSeparator;return n&&n.length&&n.indexOf(r)>0&&(n=n.replace(new RegExp("(\\b\\d{1,3})\\"+r+"(?=\\d{3}(\\D|$))","g"),"$1")),new RegExp("^\\s*([-\\+])?(\\d*)\\"+F.decimalSeparator+"?(\\d*)\\s*$").test(n)?parseFloat(n.toString().replace(F.decimalSeparator,".")):NaN}function ql(n,r){let e=Math.pow(10,r||0),t=(Math.round(n*e)/e).toString();if(r>0){let i=t.indexOf(".");for(i==-1?(t+=".",i=0):i=t.length-(i+1);i<r;)t+="0",i++}return parseFloat(t)}function Ni(n){return n==null?null:typeof n=="number"?n:(typeof n=="string"&&(n=Je(n)),n.length?n.length>=15||!/^-?\d+$/.test(n)?n:parseInt(n,10):null)}var Hl=/'.*?[^\\]'|dddd|ddd|dd|d|MMMM|MMM|MM|M|yyyy|yy|y|hh|h|HH|H|mm|m|ss|s|tt|t|fff|ff|f|zzz|zz|z|\//g;function ie(n,r,e){var c,p,f,b,x,v,I,S,T,_,N,E;if(!n)return"";let t;if(typeof n=="string"){if(t=je(n,e==null?void 0:e.dateOrder),!t)return"";if(isNaN(t.valueOf()))return n}else t=n;if(r=="i")return t.toString();if(r=="id")return t.toDateString();if(r=="it")return t.toTimeString();if(e==null&&(e=F),r==null||r=="d")r=(c=e.dateFormat)!=null?c:F.dateFormat;else if(r.length==1)switch(r){case"g":r=((p=e.dateTimeFormat)!=null?p:F.dateTimeFormat).replace(":ss","");break;case"G":r=(f=e.dateTimeFormat)!=null?f:F.dateTimeFormat;break;case"s":r="yyyy-MM-ddTHH:mm:ss";break;case"t":r=e.dateTimeFormat&&e.dateFormat?e.dateTimeFormat.replace(e.dateFormat+" ",""):"HH:mm";break;case"u":case"U":r=r=="u"?"yyyy-MM-ddTHH:mm:ss.fffZ":(b=e.dateTimeFormat)!=null?b:F.dateTimeFormat,t=new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds());break}r.charAt(0)=="%"&&(r=r.substr(1));var i=Hl,a=[];for(i.lastIndex=0;;){var o=i.lastIndex,l=i.exec(r);if(a.push(r.slice(o,l?l.index:r.length)),!l)break;var u=l[0],d=u;switch(u){case"/":d=(x=e.dateSeparator)!=null?x:F.dateSeparator;break;case"dddd":d=((v=e.dayNames)!=null?v:F.dayNames)[t.getDay()];break;case"ddd":d=((I=e.shortDayNames)!=null?I:F.shortDayNames)[t.getDay()];break;case"dd":d=Ge(t.getDate().toString(),2,"0");break;case"d":d=t.getDate();break;case"MMMM":d=((S=e.monthNames)!=null?S:F.monthNames)[t.getMonth()];break;case"MMM":d=((T=e.shortMonthNames)!=null?T:F.shortMonthNames)[t.getMonth()];break;case"MM":d=Ge(t.getMonth()+1,2,"0");break;case"M":d=t.getMonth()+1;break;case"yyyy":d=Ge(t.getFullYear(),4,"0");break;case"yy":d=Ge(t.getFullYear()%100,2,"0");break;case"y":d=t.getFullYear()%100;break;case"h":case"hh":d=t.getHours()%12,d?u=="hh"&&(d=Ge(d,2,"0")):d="12";break;case"HH":d=Ge(t.getHours(),2,"0");break;case"H":d=t.getHours();break;case"mm":d=Ge(t.getMinutes(),2,"0");break;case"m":d=t.getMinutes();break;case"ss":d=Ge(t.getSeconds().toString(),2,"0");break;case"s":d=t.getSeconds();break;case"t":case"tt":d=t.getHours()<12?(_=e.amDesignator)!=null?_:F.amDesignator:(N=e.pmDesignator)!=null?N:F.pmDesignator,u=="t"&&(d=d.charAt(0));break;case"fff":d=Ge(t.getMilliseconds(),3,"0");break;case"ff":d=Ge(t.getMilliseconds(),3,"0").substr(0,2);break;case"f":d=Ge(t.getMilliseconds(),3,"0").charAt(0);break;case"z":d=t.getTimezoneOffset()/60,d=(d>=0?"-":"+")+Math.floor(Math.abs(d));break;case"zz":case"zzz":d=t.getTimezoneOffset()/60,d=(d>=0?"-":"+")+Ge(Math.floor(Math.abs(d)),2,"0"),u=="zzz"&&(d+=((E=e.timeSeparator)!=null?E:F.timeSeparator)+Ge(Math.abs(t.getTimezoneOffset()%60),2,"0"));break;default:d.charAt(0)=="'"&&(d=d.substr(1,d.length-2).replace(/\\'/g,"'"));break}a.push(d)}return a.join("")}function Wd(n){if(n==null)return"";if(n===0)return"0";let r=Math.floor(n/24/60),e="";r>0&&(e+=r.toString());let t=Pa(Math.floor(n%(24*60)/60),2)+":"+Pa(n%60,2);return t!="00:00"&&(r>0&&(e+="."),e+=t),e}function Zs(n){if(n==null)return"";let r=function(i){return(i<10?"0":"")+i},e=n.getUTCFullYear()+"-"+r(n.getUTCMonth()+1)+"-"+r(n.getUTCDate())+"T"+r(n.getUTCHours())+":"+r(n.getUTCMinutes()),t=Number(n.getUTCSeconds()+"."+(n.getUTCMilliseconds()<100?"0":"")+r(n.getUTCMilliseconds()));return e+=":"+r(t)+"Z",e}var Wl=/(\d{4,})(?:-(\d{1,2})(?:-(\d{1,2})(?:[T ](\d{1,2}):(\d{1,2})(?::(\d{1,2})(?:\.(\d+))?)?(?:(Z)|([+-])(\d{1,2})(?::(\d{1,2}))?)?)?)?)?/;function qe(n){return n==null||(typeof n!="string"&&(n=n+""),!n.length)?null:Wl.test(n)?new Date(n+(n.length==10?"T00:00:00":"")):new Date(NaN)}function pn(n){let r=Je(n);if(!r.length)return null;if(r.length<4||r.length>5)return NaN;let e,t;if(r.charAt(1)==":")e=st(r.substr(0,1)),t=st(r.substr(2,2));else{if(r.charAt(2)!=":")return NaN;e=st(r.substr(0,2)),t=st(r.substr(3,2))}return isNaN(e)||isNaN(t)||e<0||e>23||t<0||t>59?NaN:e*60+t}function eo(n){let r,e=Je(n);if(!e.length)return null;let t=e.split(".");if(t.length==1)return r=st(t[0]),isNaN(r)?pn(t[0]):r*24*60;if(t.length==2){r=st(t[0]);let i=pn(t[1]);return isNaN(r)||!i||isNaN(i)?NaN:r*24*60+i}else return NaN}function je(n,r){if(!n||!n.length||(n=Je(n),!n.length))return null;if(n.length>=10&&n.charAt(4)==="-"&&n.charAt(7)==="-"&&(n.length===10||n.length>10&&n.charAt(10)==="T"))return qe(n);if(n.indexOf(" ")>0&&n.indexOf(":")>n.indexOf(" ")+1){var e=je(n.substring(0,n.indexOf(" ")));return!e||isNaN(e.valueOf())?new Date(NaN):qe(ie(e,"yyyy-MM-dd")+"T"+Je(n.substring(n.indexOf(" ")+1)))}let t,i,a,o=Jl(n);if(o.length==3){if(o.some(l=>!/^[0-9]+$/.test(l)))return new Date(NaN);switch(r=r||F.dateOrder,r){case"dmy":t=parseInt(o[0],10),i=parseInt(o[1],10)-1,a=parseInt(o[2],10);break;case"ymd":t=parseInt(o[2],10),i=parseInt(o[1],10)-1,a=parseInt(o[0],10);break;case"mdy":default:t=parseInt(o[1],10),i=parseInt(o[0],10)-1,a=parseInt(o[2],10);break}if(isNaN(t)||isNaN(i)||isNaN(a)||t<1||t>31||i<0||i>11||a>9999||a<0)return new Date(NaN);if(a<100){let l=new Date().getFullYear(),u=l%100+10;a+=l-l%100+(a<=u?0:-100)}return new Date(a,i,t)}else if(o.length==1)try{return new Date(o[0])}catch(l){return new Date(NaN)}return new Date(NaN)}function Jl(n){return n=Je(n),n.length?n.indexOf("/")>=0?n.split("/"):n.indexOf(".")>=0?n.split("."):n.indexOf("-")>=0?n.split("-"):n.indexOf("\\")>=0?n.split("\\"):[n]:null}function Ai(n,r){let e,t=er();if(t.__scriptHash==null&&typeof document!="undefined"&&(e=Y((document.querySelector("script#RegisteredScripts")||{}).innerHTML))!=null&&e.charAt(0)=="{"){var i=JSON.parse(e);he.setRegisteredScripts(i)}if(t.__scriptHash==null)if(r)t.__scriptHash={};else return null;return r?t.__scriptHash[n]=new Date().getTime().toString():t.__scriptHash[n]}function zl(n,r){er("__scriptHash")[n]=r}function wr(n){return er("__scriptData")[n]}function Ul(n,r){er("__scriptData")[n]=r}var he;(I=>{function n(S,T,_){typeof $!="undefined"&&typeof document!="undefined"&&$(document.body).bind("scriptdatachange."+T,function(N,E){E==S&&_()})}I.bindToChange=n;function r(S){typeof $!="undefined"&&typeof document!="undefined"&&$(document.body).triggerHandler("scriptdatachange",[S])}I.triggerChange=r;function e(S){typeof $!="undefined"&&typeof document!="undefined"&&$(document.body).unbind("scriptdatachange."+S)}I.unbindFromChange=e;function t(S,T){var _;return{async:T,cache:!0,type:"GET",url:Ee("~/DynJS.axd/")+S+".js?v="+((_=Ai(S))!=null?_:new Date().getTime()),data:null,dataType:"text",converters:{"text script":function(N){return N}},success:function(N,E,D){$.globalEval(N)},error:function(N,E,D){var R=G(S,"Lookup.");if(N.status==403&&R){re('<p>Access denied while trying to load the lookup: "<b>'+S.substr(7)+'</b>". Please check if current user has required permissions for this lookup.</p> <p><em>Lookups use the ReadPermission of their row by default. You may override that for the lookup like [LookupScript("Some.Lookup", Permission = "?")] to grant all authenticated users to read it (or use "*" for public).</em></p><p><em>Note that this might be a security risk if the lookup contains sensitive data, so it could be better to set a separate permission for lookups, like "MyModule:Lookups".</em></p>',null,{timeOut:1e4,escapeHtml:!1});return}re("An error occurred while trying to load "+(R?' the lookup: "'+S.substr(7):' dynamic script: "'+S)+'"!. Please check the error message displayed in the dialog below for more info.');var z=N.responseText;z?ei({html:z}):N.status?N.status==500?_e("HTTP 500: Connection refused! Check browser console for details."):_e("HTTP "+N.status+" error! Check browser console for details."):_e("An unknown connection error occurred! Check browser console for details.")}}}let i={};function a(S){var E;let T=S+"?"+((E=Ai(S))!=null?E:"");var _=i[T];if(_)return _;let N=t(S,!0);return ri(null),i[T]=_=Promise.resolve($.ajax(N).always(function(){delete i[T],Sr()})),_}function o(S){$.ajax(t(S,!1))}function l(S){return me(this,null,function*(){return yield a(S)})}function u(S){var T;throw S!=null&&S.startsWith("Lookup.")?T='No lookup with key "'+S.substring(7)+'" is registered. Please make sure you have a [LookupScript("'+S.substring(7)+'")] attribute in server side code on top of a row / custom lookup and  its key is exactly the same.':T=j("Can't load script data: {0}!",S),re(T),new Error(T)}function d(S){var T=wr(S);return T==null&&o(S),T=wr(S),T==null&&u(S),T}I.ensure=d;function c(S){return me(this,null,function*(){var T=wr(S);return T!=null||(yield l(S),T=wr(S),T==null&&u(S)),T})}I.ensureAsync=c;function p(S){Ai(S,!0),o(S);var T=wr(S);return T}I.reload=p;function f(S){return me(this,null,function*(){return Ai(S,!0),yield l(S),wr(S)})}I.reloadAsync=f;function b(S){return wr(S)!=null||Ai(S)!=null}I.canLoad=b;function x(S){var T=new Date().getTime().toString();for(var _ in S)zl(_,S[_]||T)}I.setRegisteredScripts=x;function v(S,T){Ul(S,T),r(S)}I.set=v})(he||(he={}));function Ja(n){return he.ensure("RemoteData."+n)}function za(n){return me(this,null,function*(){return yield he.ensureAsync("RemoteData."+n)})}function Or(n){return he.ensure("Lookup."+n)}function Ua(n){return me(this,null,function*(){return yield he.ensureAsync("Lookup."+n)})}function ja(n){return he.reload("Lookup."+n)}function jl(n){return me(this,null,function*(){return yield he.reloadAsync("Lookup."+n)})}function Kl(n){return Ka(n).items}function Ka(n){return he.ensure("Columns."+n)}function Yl(n){return me(this,null,function*(){return(yield Ya(n)).items})}function Ya(n){return me(this,null,function*(){return he.ensureAsync("Columns."+n)})}function Xa(n){return Li(n).items}function Li(n){return he.ensure("Form."+n)}function Xl(n){return me(this,null,function*(){return(yield Mi(n)).items})}function Mi(n){return me(this,null,function*(){return yield he.ensureAsync("Form."+n)})}function Za(n){return he.ensure("Template."+n)}function Zl(n){return me(this,null,function*(){return yield he.ensureAsync("Template."+n)})}function ii(n){return he.canLoad(n)}var to={canLoadScriptData:ii,getColumns:Kl,getColumnsAsync:Yl,getForm:Xa,getFormAsync:Xl,getLookup:Or,getLookupAsync:Ua,getRemoteData:Ja,getRemoteDataAsync:za,getTemplate:Za,getTemplateAsync:Zl,reloadLookup:ja,reloadLookupAsync:jl,ScriptData:he};if(typeof globalThis!="undefined"){let n=globalThis.Q||(globalThis.Q={});for(fn in to)n[fn]==null&&(n[fn]=to[fn])}var fn;var eu=/[|&]/,ae;(a=>{function n(o){if(o==null)return!1;if(o=="*")return!0;if(o==""||o=="?")return!!a.isLoggedIn;var l=a.userDefinition;return l?l.IsAdmin?!0:e(l.Permissions,o):!1}a.hasPermission=n;function r(o){return me(this,null,function*(){if(o==null)return!1;if(o=="*")return!0;if(o==""||o=="?")return yield a.isLoggedInAsync;var l=yield a.userDefinitionAsync;return l?l.IsAdmin?!0:e(l.Permissions,o):!1})}a.hasPermissionAsync=r;function e(o,l){if(!o||l==null)return!1;if(o[l])return!0;if(!eu.test(l))return!1;var u=l.split("|");for(var d of u){if(!d.length)continue;var c=d.split("&");let f=!1;for(var p of c)if(!p||!o[p]){f=!0;break}if(!f)return!0}return!1}a.isPermissionInSet=e;function t(o){if(!n(o))throw re(O("Authorization.AccessDenied")),new Error(O("Authorization.AccessDenied"))}a.validatePermission=t;function i(o){return me(this,null,function*(){if(!(yield r(o)))throw re(O("Authorization.AccessDenied")),new Error(O("Authorization.AccessDenied"))})}a.validatePermissionAsync=i})(ae||(ae={}));Object.defineProperty(ae,"isLoggedIn",{get:function(){var n,r;return!!((r=(n=ae.userDefinition)==null?void 0:n.Username)!=null&&r.length)},configurable:!0});Object.defineProperty(ae,"isLoggedInAsync",{get:function(){return me(this,null,function*(){var n,r;return!!((r=(n=yield ae.userDefinitionAsync)==null?void 0:n.Username)!=null&&r.length)})},configurable:!0});Object.defineProperty(ae,"userDefinition",{get:function(){return Ja("UserData")},configurable:!0});Object.defineProperty(ae,"userDefinitionAsync",{get:function(){return me(this,null,function*(){return yield za("UserData")})},configurable:!0});Object.defineProperty(ae,"username",{get:function(){var n;return(n=ae.userDefinition)==null?void 0:n.Username},configurable:!0});Object.defineProperty(ae,"usernameAsync",{get:function(){return me(this,null,function*(){var n;return(n=yield ae.userDefinitionAsync)==null?void 0:n.Username})},configurable:!0});function ro(n,r,e){var t,i,a,o,l;r==null&&(r=100);var u=function(){var c=Date.now()-o;c<r&&c>=0?t=setTimeout(u,r-c):(t=null,e||(l=n.apply(a,i)),t||(a=i=null))},d=function(){return a=this,i=arguments,o=Date.now(),t||(t=setTimeout(u,r),e&&(l=n.apply(a,i))),l};return d.clear=function(){t&&(clearTimeout(t),t=null)},d.flush=function(){t&&(l=n.apply(a,i),a=i=null,clearTimeout(t),t=null)},d}var Mt;(x=>{var n,r=0,e=0,t={};function i(){n==null&&e>0&&(n=window.setTimeout(o,100))}function a(){n!=null&&(window.clearTimeout(n),n=null)}function o(){for(var v in t){var I=t[v];try{var S=I.element();if(!S)continue;var T=S.offsetWidth,_=S.offsetHeight;try{if((I.width&&I.storedWidth!==T||I.height&&I.storedHeight!==_||!I.width&&!I.height&&(!T!=!I.storedWidth||!_!=!I.storedHeight))&&T>0&&_>0)try{I.handler()}finally{T=S.offsetWidth,_=S.offsetHeight}}finally{I.storedWidth=T,I.storedHeight=_}}catch(N){console.log(N)}}a(),i()}function l(v){var I=t[v];if(I){var S=I.element();S&&(I.storedWidth=S.offsetWidth,I.storedHeight=S.offsetHeight)}}x.store=l;function u(v){var I=t[v];I&&(l(v),I.storedWidth>=0&&I.storedHeight>=0&&I.handler(),l(v))}x.trigger=u;function d(v,I,S,T){if(I==null)throw"Layout handler can't be null!";return t[++r]={element:v,handler:I,width:S!==!1,height:T!==!1},e++,l(r),i(),r}x.onSizeChange=d;function c(v,I){return d(v,I,!0,!1)}x.onWidthChange=c;function p(v,I){return d(v,I,!1,!0)}x.onHeightChange=p;function f(v,I){return d(v,I,!1,!1)}x.onShown=f;function b(v){var I=t[v];return I&&(delete t[v],e--,e<=0&&a()),0}x.off=b})(Mt||(Mt={}));function io(n,r){var e=n&&n[0];if(e){if(e.offsetWidth>0&&e.offsetHeight>0){r();return}var t=Mt.onShown(()=>e,()=>{Mt.off(t),r()})}}function hn(n,r,e){var t=n&&n[0];t&&(e&&t.offsetWidth>0&&t.offsetHeight>0&&r(),Mt.onShown(()=>t,()=>{r()}))}var Ke;(S=>{let n,r=0,e=0,t=0,i=0;S.enabled=!0;function o(T,_){return T==_||T==_+"#"||_==T+"#"}function l(T,_,N){if(!(!S.enabled||r>0)){T=T||"",T=T.replace(/^#/,""),T=T?"#"+T:"";var E=window.location.href.replace(/#$/,"").replace(/#.*$/,"")+T;if(E!=window.location.href){if(_&&n!=null&&o(n,E)){N&&v();var D=window.location.href;n=null,window.history.back();return}N&&v(),n=window.location.href,window.location.hash=T}}}S.navigate=l;function u(T,_){l(T,_,!0)}S.replace=u;function d(T,_){if(S.enabled){var N=window.location.hash||"";N.charAt(0)=="#"&&(N=N.substr(1,N.length-1));var E=N.split("/+/");E.length>1&&(T&&T.length?(E[E.length-1]=T,T=E.join("/+/")):(E.splice(E.length-1,1),T=E.join("/+/"))),u(T,_)}}S.replaceLast=d;function c(){return k(".ui-dialog-content:visible, .ui-dialog.panel-hidden>.ui-dialog-content, .s-Panel").toArray().sort((T,_)=>(k(T).data("qrouterorder")||0)-(k(_).data("qrouterorder")||0))}function p(T,_,N){var E=[],D=T.hasClass(".ui-dialog-content")||T.hasClass(".s-Panel"),R=D?T:T.closest(".ui-dialog-content, .s-Panel"),z=N(),Te;if(R.length){for(var le=c(),K=le.indexOf(R[0]),Oe=0;Oe<=K;Oe++){var fe=k(le[Oe]).data("qroute");fe&&fe.length&&E.push(fe)}if(!D&&(Te=R.attr("id"),Te)){Te+="_";var ue=T.attr("id");ue&&G(ue,Te)&&(z=ue.substr(Te.length)+"@"+z)}}else{var ue=T.attr("id");ue&&(!T.hasClass("route-handler")||k(".route-handler").first().attr("id")!=ue)&&(z=ue+"@"+z)}E.push(z),_.data("qroute",z),u(E.join("/+/")),_.bind("dialogclose.qrouter panelclose.qrouter",ge=>{_.data("qroute",null),_.unbind(".qrouter");var ke=_.data("qprhash"),Xe=k(ge.target).closest(".s-MessageDialog").length>0||ge&&ge.originalEvent&&(ge.originalEvent.type=="keydown"&&ge.originalEvent.keyCode==27||k(ge.originalEvent.target).hasClass("ui-dialog-titlebar-close")||k(ge.originalEvent.target).hasClass("panel-titlebar-close"));ke!=null?u(ke,Xe):d("",Xe)})}function f(T,_,N){S.enabled&&_.on("dialogopen.qrouter panelopen.qrouter",E=>{p(T,_,N)})}S.dialog=f;function b(T){var ue,ge;if(S.enabled){r++;try{T=(ue=T!=null?T:window.location.hash)!=null?ue:"",T.charAt(0)=="#"&&(T=T.substr(1,T.length-1));for(var _=c(),N=T.split("/+/"),E=_.map(ke=>k(ke).data("qroute")),D=0;D<_.length&&D<N.length&&E[D]==N[D];)D++;for(var R=D;R<_.length;R++){var z=k(_[R]);z.hasClass("ui-dialog-content")?(ge=z.dialog)==null||ge.call(z,"close"):z.hasClass("s-Panel")&&dn(z)}for(var R=D;R<N.length;R++){var Te=N[R],le=Te.split("@"),K;if(le.length==2){var Oe=R>0?k(_[R-1]):k([]);if(Oe.length){var fe=Oe.attr("id");fe&&(K=k("#"+fe+"_"+le[0]),K.length&&(Te=le[1]))}(!K||!K.length)&&(K=k("#"+le[0]),K.length&&(Te=le[1]))}(!K||!K.length)&&(K=R>0?k(_[R-1]):k(".route-handler").first()),K.triggerHandler("handleroute",{handled:!1,route:Te,parts:N,index:R})}}finally{r--}}}S.resolve=b;function x(T,_){if(t>0)if(new Date().getTime()-i>1e3)t=0;else{t--;return}b()}function v(){t++,i=new Date().getTime()}window.addEventListener("hashchange",x,!1);let I=1;typeof document!="undefined"&&typeof k!="undefined"&&k.fn&&k(document).on("dialogopen panelopen",".ui-dialog-content, .s-Panel",function(T,_){if(S.enabled){var N=k(T.target);if(N.data("qrouterorder",I++),!N.data("qroute")){N.data("qprhash",window.location.hash);var E=k(c).not(N).last();E.length||(E=k("html")),p(E,N,()=>"!"+(++e).toString(36))}}})})(Ke||(Ke={}));function vc(n,r){var a,o,l,u;var e=k&&n instanceof k?n.get(0):n;document.documentElement.classList.add("full-height-page"),e.classList.add("responsive-height");let t=(a=r==null?void 0:r.setHeight)!=null?a:k&&!e.classList.contains("s-DataGrid")&&!e.classList.contains("s-Panel"),i=function(){t&&ts(k(e)),k?k(e).triggerHandler("layout"):e.dispatchEvent(new Event("layout"))};document.body.classList.contains("has-layout-event")?k?k(document.body).on("layout",i):e.addEventListener("layout",i):(o=window.Metronic)!=null&&o.addResizeHandler?window.Metronic.addResizeHandler(i):k?k(window).resize(i):window.addEventListener("resize",i),i(),k&&k(e).one("remove",()=>{k(window).off("resize",i),k("body").off("layout",i)}),!(r!=null&&r.noRoute)&&typeof document!="undefined"&&!k(document.body).attr("data-fhrouteinit")&&(k(document.body).attr("data-fhrouteinit","true"),typeof Ke!="undefined"&&((u=(l=Ke).resolve)==null||u.call(l)))}function tu(n){let r=0;return n.parent().children().not(n).each(function(e,t){let i=k(t);i.is(":visible")&&(r+=i.outerHeight(!0))}),r=n.parent().height()-r,n.css("box-sizing")!=="border-box"&&(r=r-(n.outerHeight(!0)-n.height())),r}function ts(n){let r=tu(n),e=Math.round(r)+"px";n.css("height")!=e&&n.css("height",e)}function Bi(){var n,r,e;return typeof window!="undefined"&&((e=(r=(n=window.matchMedia)==null?void 0:n.call(window,"(max-width: 767px)"))==null?void 0:r.matches)!=null?e:window.innerWidth<768)}function es(){var n=_s();if(n&&Se.rootNamespaces)for(var r of Se.rootNamespaces){var e=Oa(n,r);e!=null&&Fa(e,r+".",3)}}typeof k!="undefined"?k(es):typeof document!="undefined"&&document.readyState==="loading"?document.addEventListener("DOMContentLoaded",es):es();function bc(n){hn(n,function(){n.triggerHandler("layout")},!0)}function no(n){var e;n=n.closest(".ui-dialog"),(e=n.position)==null||e.call(n,{at:"center center",of:window});let r=n.position();r.left<0&&n.css("left","0px"),r.top<0&&n.css("top","0px")}var ao=class{constructor(r,e){this.items=[];this.itemById={};r=r||{},this.textFormatter=r.textFormatter,this.idField=r.idField,this.parentIdField=r.parentIdField,this.textField=r.textField,this.textFormatter=r.textFormatter,e!=null&&this.update(e)}update(r){if(this.items=[],this.itemById={},r)for(var e of r)this.items.push(e);var t=this.idField;if(t)for(var i of this.items){var a=i[t];a!=null&&(this.itemById[a]=i)}}};var so=(o=>(o[o.Disabled=-1]="Disabled",o[o.None=0]="None",o[o.Sum=1]="Sum",o[o.Avg=2]="Avg",o[o.Min=3]="Min",o[o.Max=4]="Max",o))(so||{});Kr(so,"Serenity.SummaryType");var oo=(o=>(o[o.List=0]="List",o[o.KeyOnly=1]="KeyOnly",o[o.Details=2]="Details",o[o.None=3]="None",o[o.IdOnly=4]="IdOnly",o[o.Lookup=5]="Lookup",o))(oo||{}),ru=(o=>(o[o.details=0]="details",o[o.keyOnly=1]="keyOnly",o[o.list=2]="list",o[o.none=3]="none",o[o.idOnly=4]="idOnly",o[o.lookup=5]="lookup",o))(ru||{});var lo,we=(lo=k)==null?void 0:lo.validator;if(we&&we.methods&&we.addMethod){we.prototype.showLabel&&(uo=we.prototype.showLabel,we.prototype.showLabel=function(e,t){t!=null&&(t=L(t)),uo.call(this,e,t)}),we.addMethod("customValidate",function(e,t){var i=this.optional(t);if(t==null||i)return i;var a=$._data(t,"events");if(!a)return!0;var o=a.customValidate;if(o==null||o.length===0)return!0;for(var l=$(t),u=0;u<o.length;u++)if($.isFunction(o[u].handler)){var d=o[u].handler(l);if(d!=null)return l.data("customValidationMessage",d),!1}return!0},function(e,t){return $(t).data("customValidationMessage")}),we.addMethod("dateQ",function(e,t){var i=this.optional(t);if(i)return i;var a=je(e);if(!a||isNaN(a.valueOf()))return!1;var o=new Date(a);return o.setHours(0,0,0,0),o.getTime()===a.getTime()}),we.addMethod("dateTimeQ",function(e,t){var i=this.optional(t);if(i)return i;var a=je(e);return!(!a||isNaN(a.valueOf()))}),we.addMethod("hourAndMin",function(e,t){return this.optional(t)||!isNaN(pn(e))}),we.addMethod("dayHourAndMin",function(e,t){return this.optional(t)||!isNaN(eo(e))}),we.addMethod("decimalQ",function(e,t){return this.optional(t)||!isNaN(tr(e))}),we.addMethod("integerQ",function(e,t){return this.optional(t)||!isNaN(st(e))});let n=we.methods.email,r=null;we.addMethod("email",function(e,t){return Se.emailAllowOnlyAscii?n.call(this,e,t):(r==null&&(r=new RegExp("^((([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+(\\.([a-z]|\\d|[!#\\$%&'\\*\\+\\-\\/=\\?\\^_`{\\|}~]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])+)*)|((\\x22)((((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(([\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x7f]|\\x21|[\\x23-\\x5b]|[\\x5d-\\x7e]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(\\\\([\\x01-\\x09\\x0b\\x0c\\x0d-\\x7f]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]))))*(((\\x20|\\x09)*(\\x0d\\x0a))?(\\x20|\\x09)+)?(\\x22)))@((([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|\\d|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))\\.)+(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])|(([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])([a-z]|\\d|-|\\.|_|~|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])*([a-z]|[\\u00A0-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF])))$","i")),r.test(e))}),$(iu)}var uo;function iu(){let n=(r,e)=>{var t=V("Validation."+e);t?we.messages[r]=t:we.messages[r]||(we.messages[r]=e+"?")};n("required","Required"),n("email","Email"),n("minlength","MinLength"),n("maxlength","MaxLength"),n("digits","Digits"),n("range","Range"),n("xss","Xss"),n("dateQ","DateInvalid"),n("decimalQ","Decimal"),n("integerQ","Integer"),n("url","Url")}function rs(n,r,e){var t,i,a,o,l;return Ct()?(i=(t=n.attr("data-original-title",r||""))==null?void 0:t.tooltip)==null||i.call(t,"fixTitle"):(o=(a=n.attr("title",r||""))==null?void 0:a.tooltip)==null||o.call(a,"_fixTitle"),e!=null&&((l=n.tooltip)==null||l.call(n,e?"show":"hide")),n}function ni(n){var r=n.dataset.vxHighlight;if(r)return document.getElementById(r);if(n.classList.contains("select2-offscreen")&&n.id)return document.getElementById("s2id_"+n.id)}function is(){return{errorClass:"error",ignore:":hidden, .no-validate",ignoreTitle:!0,normalizer:function(n){return $.trim(n)},highlight:function(n,r,e){if(n.type==="radio")this.findByName(n.name).addClass(r).removeClass(e);else{r!=null&&r.length&&n.classList.add(r),e!=null&&e.length&&n.classList.remove(e);var t=ni(n);t&&t.classList&&(r!=null&&r.length&&t.classList.add(r),e!=null&&e.length&&t.classList.remove(e))}},unhighlight:function(n,r,e){if(n.type==="radio")this.findByName(n.name).removeClass(r).addClass(e);else{r!=null&&r.length&&n.classList.remove(r),e!=null&&e.length&&n.classList.add(e);var t=ni(n);t&&t.classList&&(r!=null&&r.length&&t.classList.remove(r),e!=null&&e.length&&t.classList.add(e))}},showErrors:function(){var a;if((a=$==null?void 0:$.fn)!=null&&a.tooltip){var n,r,e,t,i;for(n=0;this.errorList[n];n++)e=this.errorList[n],i=ni(e.element),i!=null?t=$(i):t=$(e.element),n!=0?rs(t,"",!1):rs(t,e.message,!0);for(n=0,r=this.validElements();r[n];n++)i=ni(e.element),i!=null?t=$(i):t=$(e.element),rs(t,"",!1)}we.prototype.defaultShowErrors.call(this)}}}function Ac(n,r){return n.validate(Q(is(),r))}function rr(n,r,e){if(!n.length)return n;if(e==null)throw new ye("rule is null!");return n.addClass("customValidate").bind("customValidate."+r,e),n}function Lc(n,r){return n.unbind("customValidate."+r),n}var co;function nu(n,r){co.call(this,n,r),this.errorsFor(n).each(function(e,t){var i=$(t);i.parent(".vx").length&&(i.attr("title",i.text()),r&&i.hasClass("error")&&i.removeClass("checked"))})}function gn(){if(typeof $=="undefined"||!$.validator)return;let n=$.validator;n=n.prototype,co=n.showLabel,n.showLabel=nu,n.oldfocusInvalid=n.focusInvalid,n.focusInvalid=function(){this.settings.abortHandler&&this.settings.abortHandler(this),this.oldfocusInvalid.call(this)},n.oldstopRequest=n.focusInvalid,n.stopRequest=function(r,e){let t=this.formSubmitted;this.oldfocusInvalid.call(this,[r,e]),!e&&this.pendingRequest==0&&t&&this.settings.abortHandler&&this.settings.abortHandler(this)},n.resetAll=function(){this.submitted={},this.prepareForm(),this.hideErrors(),this.elements().removeClass(this.settings.errorClass)}}function Vi(n){n.settings.abortHandler=null,n.settings.submitHandler=function(){return!1}}function mn(n){var r=is();return delete r.showErrors,Q(Q(r,{meta:"v",errorPlacement:function(e,t){let i=null,a=t.attr("data-vx-id");if(a&&(i=$("#"+a),i.length?i=i[0]:i=null),i==null)if(i=t.parents("div.field"),i.length){let o=$("div.vx",i[0]);o.length&&(i=o[0])}else i=t.parent();e.appendTo(i)},submitHandler:function(){return!1},invalidHandler:function(e,t){if(re(O("Validation.InvalidFormMessage")),$(t.errorList.map(d=>d.element)).closest(".category.collapsed").children(".category-title").each((d,c)=>($(c).click(),!0)),t.errorList.length){var i=t.errorList[0].element;if(i){var a=$(i).closest(".tab-pane");if(!a.hasClass("active")&&a.parent().hasClass("tab-content")){var o=a.attr("id");o&&$('a[href="#'+o+'"]').click()}if($.fn.tooltip){var l,u=ni(i);u?l=$(u):l=$(i),$.fn.tooltip&&l.tooltip({title:t.errorList[0].message,trigger:"manual"}).tooltip("show"),window.setTimeout(function(){l.tooltip(Ct()?"destroy":"dispose")},1500)}}}},success:function(e){e.addClass("checked")}}),n)}typeof $!="undefined"?$.validator?gn():$(gn):typeof document!="undefined"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",gn):setTimeout(gn,100));var vn=class extends Array{bw(r,e){return[[this,">=",r],"and",[this,"<=",e]]}contains(r){return[this,"like","%"+r+"%"]}endsWith(r){return[this,"like","%"+r]}eq(r){return[this,"=",r]}gt(r){return[this,">",r]}ge(r){return[this,">=",r]}in(r){return[this,"in",[r]]}isNull(){return["is null",this]}isNotNull(){return["is not null",this]}le(r){return[this,"<=",r]}lt(r){return[this,"<",r]}ne(r){return[this,"!=",r]}like(r){return[this,"like",r]}startsWith(r){return[this,"like",r+"%"]}notIn(r){return[this,"not in",[r]]}notLike(r){return[this,"not like",r]}},fo=1,Fe=2,Qi=3,yn=4,ot=function(n,r,e){this.expression=n,this.error=r,this.position=e,this.toString=function(){return'Error parsing expression: "'+n+'", "'+r+", position: "+e}};function au(n){var r,e,t=[],i=n.length,a=n.length-1,o=0,l,u;function d(){for(;l<i;){if(u=n.charAt(l),u===" "||u==="	"){l++;continue}break}}function c(){r=l;for(var I=!1;r++<a;)if(u=n.charAt(r),u==="'")if(r<a&&n.charAt(r+1)==="'"){r++,I=!0;continue}else break;if(r===l||n.charAt(r)!=="'")throw new ot(n,"unterminated string",l);e=n.substr(l+1,r-l-1),I&&(e=e.replace(/''/g,"'"))}function p(){r=l;for(var I=!1;r<a&&(u=n.charAt(r+1),u>="0"&&u<="9"||!I&&u===".");)u==="."&&(I=!0),r++;e=parseFloat(n.substring(l,r+1))}function f(){for(r=l;r<a&&(u=n.charAt(r+1),u=="_"||u>="A"&&u<="Z"||u>="a"&&u<="z"||u>="0"&&u<="9");)r++;e=n.substr(l,r-l+1)}function b(){if(l++,f(),!e.length)throw new ot(n,"expected parameter name",l)}function x(){if(d(),l>=i||n.charAt(l)!="("){if(l<i&&n.charAt(l)=="@"){b(),l=r;return}throw new ot(n,"expected parenthesis",l)}l++;let I=[];for(;;){if(d(),l>=i)throw new ot(n,"expected parenthesis",l);if(u=n.charAt(l),u==","){if(I.length==0)throw new ot(n,"unexpected comma",l);l++,d(),u=n.charAt(l)}else{if(u==")")break;if(I.length>0)throw new ot(n,"expected comma",l)}if(u==="'"){c(),I.push(e),l=r+1;continue}if(u>="0"&&u<="9"){p(),I.push(e),l=r+1;continue}if(u=="n"&&(f(),e==="null")){I.push(null),l=r+1;continue}throw new ot(n,"unexpected token",l)}e=I}for(l=0;l<i;l++)if(u=n.charAt(l),!(u===" "||u==="	")){if(u=="_"||u>="A"&&u<="Z"||u>="a"&&u<="z"){f();var v=e.toLowerCase();if(v=="is")if(l=r+1,d(),f(),v=e.toLowerCase(),v==="not")if(l=r+1,d(),f(),e.toLowerCase()==="null")t.push({t:Fe,v:"is not null"});else throw new ot(n,'expected "null"',l);else if(v==="null")t.push({t:Fe,v:"is null"});else throw new ot(n,'expected "null" or "not" keyword',l);else if(v==="and"||v==="or"||v==="xor")t.push({t:Fe,v});else if(v==="not"){let I=r;l=r+1,d(),f(),v=e.toLowerCase(),v==="in"?(l=r+1,t.push({t:Fe,v:"not in"}),x(),typeof e=="string"?t.push({t:yn,v:e}):t.push({t:Qi,v:e})):v==="like"?(t.push({t:Fe,v:"not like"}),l=r):(t.push({t:Fe,v:"not"}),l=I);continue}else if(v==="in"){t.push({t:Fe,v:"in"}),l=r+1,x(),typeof e=="string"?t.push({t:yn,v:e}):t.push({t:Qi,v:e});continue}else v==="like"?t.push({t:Fe,v:"like"}):t.push({t:fo,v:e});l=r;continue}if(u==="@"){b(),t.push({t:yn,v:e}),l=r;continue}if((u==="-"||u==="+")&&l<a&&n.charAt(l+1)>="0"&&n.charAt(l+1)<="9"||u>="0"&&u<="9"){r=l,p(),t.push({t:Qi,v:e}),l=r;continue}if(u==="'"){r=l,c(),t.push({t:Qi,v:e}),l=r;continue}if(u==="="){t.push({t:Fe,v:u});continue}if(u==="("){o++,t.push({t:Fe,v:u});continue}if(u==")"){if(o<=0)throw new ot(n,"unexpected parenthesis",l);o--,t.push({t:Fe,v:u});continue}if(u===">"||u==="<"){l<a&&n.charAt(l+1)==="="?(t.push({t:Fe,v:u+"="}),l++):t.push({t:Fe,v:u});continue}throw new ot(n,"unknown token",l)}if(o>0)throw new ot(n,"missing parenthesis",l);return t}var po={"=":4,">":4,"<":4,">=":4,"<=":4,"<>":4,"!=":4,like:5,"not like":5,in:5,"not in":5,"is null":5,"is not null":5,not:6,and:7,xor:8,or:9};function su(n){var r=[],e=[];for(var t of n)if(t.t===Fe){var i=po[t.v];if(i!=null){for(;e.length;){var a=e[e.length-1];if(a.t!==Fe||a.v=="(")break;var o=po[a.v];if(o==null||o>i)break;r.push(e.pop())}e.push(t)}else if(t.v==="(")e.push(t);else if(t.v===")"){for(;e.length&&(e[e.length-1].t!==Fe||e[e.length-1].v!=="(");)r.push(e.pop());e.pop()}else r.push(t)}else r.push(t);for(;e.length;){var l=e.pop();if(l.t==Fe&&(l.v==="("||l.v===")"))throw"Mismatched parentheses in criteria expression!";r.push(l)}return r}function ou(n,r){var e=[];for(var t of n)switch(t.t){case fo:{e.push([t.v]);break}case Qi:{e.push(Array.isArray(t.v)?[t.v]:t.v);break}case yn:{if(!r)throw new Error("getParam must be passed for parameterized expressions!");var i=r(t.v);e.push(Array.isArray(i)?[i]:i);break}case Fe:{switch(t.v){case"not":case"is null":case"is not null":if(!e.length)throw new Error("Unary operator "+t.v+" requires a value!");e.push([t.v,e.pop()]);break;default:if(e.length<2)throw new Error("Binary operator "+t.v+" requires two values!");var a=e.pop(),o=e.pop();e.push([o,t.v,a]);break}break}default:throw new Error("Invalid operator type: "+t.t+"!")}if(e.length!=1)throw new Error("Error evaluating expression!");return e.pop()}function ns(n,r){var e=au(n),t=su(e);return ou(t,r)}function lu(n,...r){if(!(n!=null&&n.length))return[];if(typeof n=="string")return ns(n,r==null||r[0]==null?null:t=>r[0][t]);if(!r.length)return ns(n.join(""));var e=String.raw({raw:n},...r.map((t,i)=>"@__"+i));return ns(e,t=>t.startsWith("__")?r[parseInt(t.substring(2),10)]:void 0)}var ho=(T=>(T.paren="()",T.not="not",T.isNull="is null",T.isNotNull="is not null",T.exists="exists",T.and="and",T.or="or",T.xor="xor",T.eq="=",T.ne="!=",T.gt=">",T.ge=">=",T.lt="<",T.le="<=",T.in="in",T.notIn="not in",T.like="like",T.notLike="not like",T))(ho||{});function W(n){var r=vn.of(n);return!r.eq&&(r.__proto__=vn.prototype),r}W.and=function(r,e,...t){var i=W.join(r,"and",e);if(t)for(let a of t)i=W.join(i,"and",a);return i};W.Operator=ho;W.isEmpty=function(r){return r==null||r.length===0||r.length===1&&typeof r[0]=="string"&&r[0].length===0};W.join=function(r,e,t){return W.isEmpty(r)?t:W.isEmpty(t)?r:[r,e,t]};W.not=function(r){return["not",r]};W.or=function(r,e,...t){var i=W.join(r,"or",e);if(t)for(let a of t)i=W.join(i,"or",a);return i};W.paren=function(r){return W.isEmpty(r)?r:["()",r]};W.parse=lu;import{escape as uu,NonDataRow as du,convertCompatFormatter as cu}from"@serenity-is/sleekgrid";var go;(a=>{function n(o){this.field_=o,this.type_="Avg",this.init=function(){this.count_=0,this.nonNullCount_=0,this.sum_=0},this.accumulate=function(l){var u=l[this.field_];this.count_++,u!=null&&u!==""&&!isNaN(u)&&(this.nonNullCount_++,this.sum_+=parseFloat(u))},this.storeResult=function(l){l.avg||(l.avg={}),this.nonNullCount_!=0&&(l.avg[this.field_]=this.sum_/this.nonNullCount_)}}a.Avg=n;function r(o,l){this.field_=o,this.type_="WeightedAvg",this.weightedField_=l,this.init=function(){this.sum_=0,this.weightedSum_=0},this.accumulate=function(u){var d=u[this.field_],c=u[this.weightedField_];this.isValid(d)&&this.isValid(c)&&(this.weightedSum_+=parseFloat(c),this.sum_+=parseFloat(d)*parseFloat(c))},this.storeResult=function(u){u.avg||(u.avg={}),this.sum_&&this.weightedSum_&&(u.avg[this.field_]=this.sum_/this.weightedSum_)},this.isValid=function(u){return u!==null&&u!==""&&!isNaN(u)}}a.WeightedAvg=r;function e(o){this.field_=o,this.type_="Min",this.init=function(){this.min_=null},this.accumulate=function(l){var u=l[this.field_];u!=null&&u!==""&&!isNaN(u)&&(this.min_==null||u<this.min_)&&(this.min_=u)},this.storeResult=function(l){l.min||(l.min={}),l.min[this.field_]=this.min_}}a.Min=e;function t(o){this.field_=o,this.type_="Max",this.init=function(){this.max_=null},this.accumulate=function(l){var u=l[this.field_];u!=null&&u!==""&&!isNaN(u)&&(this.max_==null||u>this.max_)&&(this.max_=u)},this.storeResult=function(l){l.max||(l.max={}),l.max[this.field_]=this.max_}}a.Max=t;function i(o){this.field_=o,this.type_="Sum",this.init=function(){this.sum_=null},this.accumulate=function(l){var u=l[this.field_];u!=null&&u!==""&&!isNaN(u)&&(this.sum_+=parseFloat(u))},this.storeResult=function(l){l.sum||(l.sum={}),l.sum[this.field_]=this.sum_}}a.Sum=i})(go||(go={}));var bn;(t=>{function n(i,a,o){var p;var l=o.substring(0,1).toUpperCase()+o.substring(1),u=(p=V("Enums.Serenity.SummaryType."+l))!=null?p:l,d=i[o][a.field],c=r(a,d);return"<span class='aggregate agg-"+o+"'  title='"+L(u)+"'>"+c+"</span>"}t.formatMarkup=n;function r(i,a){var d,c,p;var o=(d=i.format)!=null?d:i.formatter?cu(i.formatter):null;if(o!=null){var l=new du;l[i.field]=a;try{return o({column:i,escape:uu,item:l,value:a})}catch(f){}}if(typeof a=="number"){var u=(p=(c=i.sourceItem)==null?void 0:c.displayFormat)!=null?p:"#,##0.##";return L(It(a,u))}else return L(a)}t.formatValue=r;function e(i,a){if(!i||!a)return"";var o=null;return["sum","avg","min","max","cnt"].forEach(function(l){if(o==null&&i[l]&&i[l][a.field]!=null)return o=n(i,a,l),!1}),o||""}t.groupTotalsFormatter=e})(bn||(bn={}));import{EventEmitter as St,EventData as pu,gridDefaults as as,Group as fu,GroupItemMetadataProvider as hu,GroupTotals as gu}from"@serenity-is/sleekgrid";var xn=class{constructor(r){var ws;var e=this;as!=null&&as.groupTotalsFormatter===void 0&&(as.groupTotalsFormatter=bn.groupTotalsFormatter);var t,i=[],a=[],o={},l=null,u=null,d=null,c=0,p=!0,f,b,x={},v={},I,S=[],T,_,N=[],E={getter:null,formatter:null,comparer:function(h,y){return h.value===y.value?0:h.value>y.value?1:-1},predefinedValues:[],aggregateEmpty:!1,aggregateCollapsed:!1,aggregateChildGroups:!1,collapsed:!1,displayTotalsRow:!0,lazyTotalsCalculation:!1},D={},R=[],z=[],Te=[],le=":|:",K=1,Oe=0,fe=new St,ue=new St,ge=new St,ke=new St,Xe=new St,ve=new St,Ne=new St,Hr=new St,Ut=new St,ht=!1,zi=null,Wr=0,Ui=0,ss,os,ji=null,Jr=r.groupItemMetadataProvider,Ki=(ws=r.localSort)!=null?ws:!1,X;function So(){c++}function wo(){c--,c<=0&&Ze()}function Oo(h){x=h}function ko(h){I=h}function zr(h){h=h||0;for(var y,C=h,A=i.length;C<A;C++){if(y=i[C][t],y===void 0){var M="Each data element must implement a unique '"+t+"' property. Object at index '"+C+"' has no identity value: ";throw M+=$.toJSON(i[C]),M}o[y]=C}}function _o(){for(var h,y=0,C=i.length;y<C;y++)if(h=i[y][t],h===void 0||o[h]!==y){var A="Each data element must implement a unique '"+t+"' property. Object at index '"+y+"' ";throw h==null?A+="has no identity value: ":A+="has repeated identity value '"+h+"': ",A+=$.toJSON(i[y]),A}}function Eo(){return i}function Do(){return t}function ls(h,y){y!=null&&typeof y=="string"&&(t=y),i=S=h,Ki&&i.sort(Yi()),o={},l=null,D.totals={},zr(),_o(),c?Is(i):Ze(),fe.notify({dataView:e},null,e)}function Fo(h){var y=!1;if(h.rowsPerPage!=null&&X.rowsPerPage!=h.rowsPerPage&&(X.rowsPerPage=h.rowsPerPage,y=!0),h.page!=null){var C;X.rowsPerPage?ji==null?C=h.page:C=Math.min(h.page,Math.ceil(ji/X.rowsPerPage)+1):C=1,C<1&&(C=1),C!=K&&(X.seekToPage=C,y=!0)}y&&Zi()}function jt(){return{rowsPerPage:X.rowsPerPage,page:K,totalCount:ji,loading:ht,error:zi,dataView:X}}function Yi(){if(b!=null)return b;var h=[],y=[],C=X.sortBy||[];for(var A of C)A!=null&&(A.length>5&&A.toLowerCase().substr(A.length-5).toLowerCase()==" desc"?(y.push(!1),h.push(A.substr(0,A.length-5))):(y.push(!0),h.push(A)));return function(M,H){for(var B=0,de=h.length;B<de;B++){var ne=h[B],Z=y[B]?1:-1,Rt=M[ne],ki=H[ne],en=(Rt==ki?0:Rt>ki?1:-1)*Z;if(en!=0)return en}return 0}}function Ca(h,y){p=y,f=null,y===!1&&i.reverse(),b=h,i.sort(Yi()),y===!1&&i.reverse(),o={},zr(),Ze()}function Po(){return Ki}function Ro(h){Ki!=h&&(Ki=h,Ca())}function us(h,y){p=y,f=h,b=null;var C=Object.prototype.toString;Object.prototype.toString=typeof h=="function"?h:function(){return this[h]},y===!1&&i.reverse(),i.sort(),Object.prototype.toString=C,y===!1&&i.reverse(),o={},zr(),Ze()}function No(){f?us(f,p):Ca(b,p)}function Ao(){return S}function Lo(){return u}function Mo(h){u=h,r.inlineFilters&&(T=ll(),_=ul()),Ze()}function Bo(){return R}function Vo(h){h=h||{},D.aggregators=h.aggregators||[],D.compiledAccumulators=[],D.totals={};for(var y=D.aggregators.length;y--;)D.compiledAccumulators[y]=Cs(D.aggregators[y]);ds(R||[])}function Qo(){if(D.totals=D.totals||{},!D.totals.initialized){D.aggregators=D.aggregators||[],D.compiledAccumulators=D.compiledAccumulators||[];for(var h,y=D.aggregators.length;y--;)h=D.aggregators[y],h.init(),D.compiledAccumulators[y].call(h,i),h.storeResult(D.totals);D.totals.initialized=!0}return D.totals}function ds(h){Jr||(Jr=new hu),z=[],Te=[],h=h||[],R=h instanceof Array?h:[h];for(var y=0;y<R.length;y++){var C=R[y]=Q(Q({},E),Ve(R[y]));C.aggregators=C.aggregators||D.aggregators||[],C.getterIsAFn=typeof C.getter=="function",C.compiledAccumulators=[];for(var A=C.aggregators.length;A--;)C.compiledAccumulators[A]=Cs(C.aggregators[A]);Te[y]={}}Ze()}function Go(h){return i[h]}function $o(h){return o[h]}function Oi(){if(!l){l={};for(var h=0,y=a.length;h<y;h++)l[a[h][t]]=h}}function qo(h){return Oi(),l[h[t]]}function Ho(h){return Oi(),l[h]}function cs(h){return i[o[h]]}function Wo(h){var y=[];Oi();for(var C=0,A=h.length;C<A;C++){var M=l[h[C][t]];M!=null&&(y[y.length]=M)}return y}function Jo(h){var y=[];Oi();for(var C=0,A=h.length;C<A;C++){var M=l[h[C]];M!=null&&(y[y.length]=M)}return y}function zo(h){for(var y=[],C=0,A=h.length;C<A;C++)h[C]<a.length&&(y[y.length]=a[h[C]][t]);return y}function ps(h,y){if(o[h]===void 0)throw new Error("Invalid id");if(h!==y[t]){var C=y[t];if(C==null)throw new Error("Cannot update item to associate with a null id");if(o[C]!==void 0)throw new Error("Cannot update item to associate with a non-unique id");o[C]=o[h],delete o[h],d&&d[h]&&delete d[h],h=C}i[o[h]]=y,d||(d={}),d[h]=!0,Ze()}function fs(h,y){i.splice(h,0,y),zr(h),Ze()}function Uo(h){i.push(h),zr(i.length-1),Ze()}function hs(h){var y=o[h];if(y===void 0)throw"Invalid id";delete o[h],i.splice(y,1),zr(y),Ze()}function gs(h){fs(Ko(h),h)}function jo(h,y){if(o[h]===void 0||h!==y[t])throw new Error("Invalid or non-matching id "+o[h]);var C=Yi(),A=cs(h);C(A,y)!==0?(hs(h),gs(y)):ps(h,y)}function Ko(h){for(var y=0,C=i.length,A=Yi();y<C;){var M=y+C>>>1;A(i[M],h)===-1?y=M+1:C=M}return y}function Yo(){return a}function Xo(){return a.length}function Zo(h){var y=a[h];if(y&&y.__group&&y.totals&&!y.totals.initialized){var C=R[y.level];C.displayTotalsRow||(Xi(y.totals),y.title=C.formatter?C.formatter(y):L(y.value))}else y&&y.__groupTotals&&!y.initialized&&Xi(y);return y}function el(h){var y=a[h];return y===void 0?null:y.__group?Jr.getGroupRowMetadata(y):y.__groupTotals?Jr.getTotalsRowMetadata(y):r.getItemMetadata&&r.getItemMetadata(y,h)||null}function ms(h,y){if(h==null)for(var C=0;C<R.length;C++)Te[C]={},R[C].collapsed=y,y===!0?Xe.notify({level:C,groupingKey:null}):ke.notify({level:C,groupingKey:null});else Te[h]={},R[h].collapsed=y,y===!0?Xe.notify({level:h,groupingKey:null}):ke.notify({level:h,groupingKey:null});Ze()}function tl(h){ms(h,!0)}function rl(h){ms(h,!1)}function il(h){var y=h[0];return h.length===1&&y.indexOf(le)!==-1?{level:y.split(le).length-1,groupingKey:y}:{level:h.length-1,groupingKey:h.join(le)}}function ys(h,y){var C=il(h);Te[C.level][C.groupingKey]=R[C.level].collapsed^y,y?Xe.notify({level:C.level,groupingKey:C.groupingKey}):ke.notify({level:C.level,groupingKey:C.groupingKey}),Ze()}function nl(h){var y=Array.prototype.slice.call(arguments);ys(y,!0)}function al(h){var y=Array.prototype.slice.call(arguments);ys(y,!1)}function sl(){return z}function vs(h,y,C,A,M){var H=h[y];return H||(H=new fu,H.value=y,H.level=C,H.groupingKey=(A?A.groupingKey+le:"")+y,M[M.length]=H,h[y]=H),H}function bs(h,y){for(var C,A,M=[],H={},B,de=y?y.level+1:0,ne=R[de],Z=0,Rt=ne.predefinedValues.length;Z<Rt;Z++)A=ne.predefinedValues[Z],C=vs(H,A,de,y,M);for(var Z=0,Rt=h.length;Z<Rt;Z++)B=h[Z],A=ne.getterIsAFn?ne.getter(B):B[ne.getter],C=vs(H,A,de,y,M),C.rows[C.count++]=B;if(de<R.length-1)for(var Z=0;Z<M.length;Z++)C=M[Z],C.groups=bs(C.rows,C);return M.length&&xs(M,de),M.sort(R[de].comparer),M}function Xi(h){var y=h.group,C=R[y.level],A=y.level==R.length,M,H=C.aggregators.length;if(!A&&C.aggregateChildGroups)for(var B=y.groups.length;B--;)y.groups[B].totals.initialized||Xi(y.groups[B].totals);for(;H--;)M=C.aggregators[H],M.init(),!A&&C.aggregateChildGroups?C.compiledAccumulators[H].call(M,y.groups):C.compiledAccumulators[H].call(M,y.rows),M.storeResult(h);h.initialized=!0}function ol(h){var y=R[h.level],C=new gu;C.group=h,h.totals=C,y.lazyTotalsCalculation||Xi(C)}function xs(h,y){y=y||0;for(var C=R[y],A=C.collapsed,M=Te[y],H=h.length,B;H--;)B=h[H],!(B.collapsed&&!C.aggregateCollapsed)&&(B.groups&&xs(B.groups,y+1),C.aggregators.length&&(C.aggregateEmpty||B.rows.length||B.groups&&B.groups.length)&&ol(B),B.collapsed=A^M[B.groupingKey],B.title=C.formatter?C.formatter(B):L(B.value))}function Ts(h,y){y=y||0;for(var C=R[y],A=[],M,H=0,B,de=0,ne=h.length;de<ne;de++){if(B=h[de],A[H++]=B,!B.collapsed){M=B.groups?Ts(B.groups,y+1):B.rows;for(var Z=0,Rt=M.length;Z<Rt;Z++)A[H++]=M[Z]}B.totals&&C.displayTotalsRow&&(!B.collapsed||C.aggregateCollapsed)&&(A[H++]=B.totals)}return A}function Ia(h){var y=/^function[^(]*\(([^)]*)\)\s*{([\s\S]*)}$/,C=h.toString().match(y);return{params:C[1].split(","),body:C[2]}}function Cs(h){var y=Ia(h.accumulate),C=new Function("_items","for (var "+y.params[0]+", _i=0, _il=_items.length; _i<_il; _i++) {"+y.params[0]+" = _items[_i]; "+y.body+"}");return C}function ll(){var h=Ia(u),y=h.body.replace(/return false\s*([;}]|$)/gi,"{ continue _coreloop; }$1").replace(/return true\s*([;}]|$)/gi,"{ _retval[_idx++] = $item$; continue _coreloop; }$1").replace(/return ([^;}]+?)\s*([;}]|$)/gi,"{ if ($1) { _retval[_idx++] = $item$; }; continue _coreloop; }$2"),C=["var _retval = [], _idx = 0; ","var $item$, $args$ = _args; ","_coreloop: ","for (var _i = 0, _il = _items.length; _i < _il; _i++) { ","$item$ = _items[_i]; ","$filter$; ","} ","return _retval; "].join("");C=C.replace(/\$filter\$/gi,y),C=C.replace(/\$item\$/gi,h.params[0]),C=C.replace(/\$args\$/gi,h.params[1]);var A=new Function("_items,_args",C);return A.displayName=A.name="compiledFilter",A}function ul(){var h=Ia(u),y=h.body.replace(/return false\s*([;}]|$)/gi,"{ continue _coreloop; }$1").replace(/return true\s*([;}]|$)/gi,"{ _cache[_i] = true;_retval[_idx++] = $item$; continue _coreloop; }$1").replace(/return ([^;}]+?)\s*([;}]|$)/gi,"{ if ((_cache[_i] = $1)) { _retval[_idx++] = $item$; }; continue _coreloop; }$2"),C=["var _retval = [], _idx = 0; ","var $item$, $args$ = _args; ","_coreloop: ","for (var _i = 0, _il = _items.length; _i < _il; _i++) { ","$item$ = _items[_i]; ","if (_cache[_i]) { ","_retval[_idx++] = $item$; ","continue _coreloop; ","} ","$filter$; ","} ","return _retval; "].join("");C=C.replace(/\$filter\$/gi,y),C=C.replace(/\$item\$/gi,h.params[0]),C=C.replace(/\$args\$/gi,h.params[1]);var A=new Function("_items,_args,_cache",C),M="compiledFilterWithCaching";return A.displayName=M,A.name=dl(A,M),A}function dl(h,y){try{Object.defineProperty(h,"name",{writable:!0,value:y})}catch(C){h.name=y}}function cl(h,y){for(var C=[],A=0,M=0,H=h.length;M<H;M++)u(h[M],y)&&(C[A++]=h[M]);return C}function pl(h,y,C){for(var A=[],M=0,H,B=0,de=h.length;B<de;B++)H=h[B],C[B]?A[M++]=H:u(H,y)&&(A[M++]=H,C[B]=!0);return A}function fl(h){if(u){var y=r.inlineFilters?T:cl,C=r.inlineFilters?_:pl;x.isFilterNarrowing?S=y(S,I):x.isFilterExpanding?S=C(h,I,N):x.isFilterUnchanged||(S=y(h,I))}else S=h.concat();return{totalRows:S.length,rows:S}}function hl(h,y){var C,A,M,H=[],B=0,de=y.length;x&&x.ignoreDiffsBefore&&(B=Math.max(0,Math.min(y.length,x.ignoreDiffsBefore))),x&&x.ignoreDiffsAfter&&(de=Math.min(y.length,Math.max(0,x.ignoreDiffsAfter)));for(var ne=B,Z=h.length;ne<de;ne++)ne>=Z?H[H.length]=ne:(C=y[ne],A=h[ne],(R.length&&(M=C.__nonDataRow||A.__nonDataRow)&&C.__group!==A.__group||C.__group&&!C.equals(A)||M&&(C.__groupTotals||A.__groupTotals)||C[t]!=A[t]||d&&d[C[t]])&&(H[H.length]=ne));return H}function Is(h){l=null,(x.isFilterNarrowing!=v.isFilterNarrowing||x.isFilterExpanding!=v.isFilterExpanding)&&(N=[]);var y=fl(h);Oe=y.totalRows;var C=y.rows;D.totals={},z=[],R.length&&(z=bs(C),z.length&&(C=Ts(z)));var A=hl(a,C);return a=C,A}function Ze(){if(!c){var h=a.length,y=Oe,C=Is(i);d=null,v=x,x={},y!==Oe&&ve.notify(jt(),null,e),h!==a.length&&Ne.notify({previous:h,current:a.length,dataView:e},null,e),C.length>0&&Hr.notify({rows:C,dataView:e},null,e),(h!==a.length||C.length>0)&&Ut.notify({rowsDiff:C,previousRowCount:h,currentRowCount:a.length,rowCountChanged:h!==a.length,rowsChanged:C.length>0,dataView:e},null,e)}}function gl(h,y,C){var A=this,M,H=A.mapRowsToIds(h.getSelectedRows()),B=new St;function de(Z){H.join(",")!=Z.join(",")&&(H=Z,B.notify({grid:h,ids:H,dataView:A},new pu,A))}function ne(){if(H.length>0){M=!0;var Z=A.mapIdsToRows(H);y||de(A.mapRowsToIds(Z)),h.setSelectedRows(Z),M=!1}}return h.onSelectedRowsChanged.subscribe(function(Z,Rt){if(!M){var ki=A.mapRowsToIds(h.getSelectedRows());if(!C||!h.getOptions().multiSelect)de(ki);else{var en=$.grep(H,function(Tl){return A.getRowById(Tl)===void 0});de(en.concat(ki))}}}),this.onRowsChanged.subscribe(ne),this.onRowCountChanged.subscribe(ne),B}function ml(h,y){var C,A;M(h.getCellCssStyles(y));function M(de){C={};for(var ne in de){var Z=a[ne][t];C[Z]=de[ne]}}function H(){if(C){A=!0,Oi();var de={};for(var ne in C){var Z=l[ne];Z!=null&&(de[Z]=C[ne])}h.setCellCssStyles(y,de),A=!1}}var B=function(de,ne){A||y==ne.key&&(ne.hash?M(ne.hash):(h.onCellCssStylesChanged.unsubscribe(B),Ut.unsubscribe(H)))};h.onCellCssStylesChanged.subscribe(B),Ut.subscribe(H)}function Ss(h){if(X.onProcessData&&h&&(h=X.onProcessData(h,X)||h),zi=null,ht&&ht.abort(),ht=!1,!h)return zi=X.errormsg,ve.notify(jt()),!1;h.TotalCount=h.TotalCount||0,h.Entities=h.Entities||[],!h.Skip||!X.rowsPerPage&&!h.Take?h.Page=1:h.Page=Math.ceil(h.Skip/(h.Take||X.rowsPerPage))+1,K=h.Page,ji=h.TotalCount,ls(h.Entities),ve.notify(jt())}function Zi(){if(Wr>0){Ui++;return}if(Ui=0,ht&&ht.abort(),X.onSubmit){var h=X.onSubmit(X);if(h===!1)return!1}if(ue.notify(this),!X.url)return!1;X.seekToPage||(X.seekToPage=1);var y={},C=(X.seekToPage-1)*X.rowsPerPage;C&&(y.Skip=C),X.rowsPerPage&&(y.Take=X.rowsPerPage),X.sortBy&&X.sortBy.length&&(typeof X.sortBy!="string"?y.Sort=X.sortBy:y.Sort=[X.sortBy]),X.params&&(y=Q(y,X.params));var A=os,M={cache:!1,type:X.method,contentType:ss,url:X.url,data:y,dataType:A,success:function(B){ht=!1,B.Error?re(B.Error.Message||B.Error.Code):Ss(B),ge.notify(this)},error:function(B,de,ne){if(ht=!1,(B.getResponseHeader("content-type")||"").toLowerCase().indexOf("application/json")>=0){var Z=$.parseJSON(B.responseText);if(Z!=null&&Z.Error!=null){re(Z.Error.Message||Z.Error.Code),ve.notify(jt()),ge.notify(this);return}}zi=B.errormsg,ve.notify(jt()),ge.notify(this)},complete:function(){ht=!1}};if(X.onAjaxCall){var H=X.onAjaxCall(this,M);if(H===!1)return ht=!1,ve.notify(jt()),!1}M.data=$.toJSON(M.data),ve.notify(jt()),ht=$.ajax(M)}function yl(){Wr==0&&(Ui=0),Wr++}function vl(){Wr>0&&(Wr--,Wr==0&&Ui>0&&Zi())}function bl(){return Jr}function xl(h){Jr=h}return t=r.idField||"id",ss=r.contentType||"application/json",os=r.dataType||"json",u=r.filter||null,X={beginUpdate:So,endUpdate:wo,setPagingOptions:Fo,getPagingInfo:jt,getIdPropertyName:Do,getRows:Yo,getItems:Eo,setItems:ls,getFilter:Lo,getFilteredItems:Ao,setFilter:Mo,sort:Ca,fastSort:us,reSort:No,getLocalSort:Po,setLocalSort:Ro,setSummaryOptions:Vo,getGrandTotals:Qo,setGrouping:ds,getGrouping:Bo,collapseAllGroups:tl,expandAllGroups:rl,collapseGroup:nl,expandGroup:al,getGroups:sl,getIdxById:$o,getRowByItem:qo,getRowById:Ho,getItemById:cs,getItemByIdx:Go,mapItemsToRows:Wo,mapRowsToIds:zo,mapIdsToRows:Jo,setRefreshHints:Oo,setFilterArgs:ko,refresh:Ze,updateItem:ps,insertItem:fs,addItem:Uo,deleteItem:hs,sortedAddItem:gs,sortedUpdateItem:jo,syncGridSelection:gl,syncGridCellCssStyles:ml,getLength:Xo,getItem:Zo,getItemMetadata:el,getGroupItemMetadataProvider:bl,setGroupItemMetadataProvider:xl,onRowCountChanged:Ne,onRowsChanged:Hr,onRowsOrCountChanged:Ut,onPagingInfoChanged:ve,onGroupExpanded:ke,onGroupCollapsed:Xe,addData:Ss,populate:Zi,populateLock:yl,populateUnlock:vl,onDataChanged:fe,onDataLoaded:ge,onDataLoading:ue,params:r.params||{},onSubmit:r.onSubmit||null,url:r.url||null,rowsPerPage:r.rowsPerPage||0,seekToPage:r.seekToPage||1,onAjaxCall:r.onAjaxCall||null,onProcessData:r.onProcessData||null,method:r.method||"POST",errormsg:O("Controls.Pager.DefaultLoadError"),sortBy:typeof r.sortBy=="string"?[r.sortBy]:r.sortBy||[],idField:t},r.url&&r.autoLoad&&Zi(),X}};function ee(n){return function(r){return xr(r,"Serenity."+n+"Attribute")}}var Ye=class{constructor(r){this.value=r}};Ye=g([ee("EnumKey")],Ye);var Bt=class{constructor(r){this.displayName=r}};Bt=g([ee("DisplayName")],Bt);var Tn=class{constructor(r){this.category=r}};Tn=g([ee("Category")],Tn);var ai=class{constructor(r){this.value=r}};ai=g([ee("ColumnsKey")],ai);var Cn=class{constructor(r){this.cssClass=r}};Cn=g([ee("CssClass")],Cn);var In=class{constructor(r){this.value=r}};In=g([ee("DefaultValue")],In);var kr=class{constructor(r){this.value=r}};kr=g([ee("DialogType")],kr);var Sn=class{constructor(r,e){this.key=r;this.value=e}};Sn=g([ee("EditorOption")],Sn);var Ln=class{constructor(r){this.editorType=r}setParams(r){}};xr(Ln,"Serenity.EditorTypeAttributeBase");var wn=class extends Ln{constructor(r){super(r)}};wn=g([ee("EditorType")],wn);var _r=class{constructor(r){this.value=r}};_r=g([ee("Element")],_r);var ir=class{constructor(r){this.value=r}};ir=g([ee("EntityType")],ir);var Er=class{constructor(r=!0){this.value=r}};Er=g([ee("Filterable")],Er);var Dr=class{constructor(r=!0){this.value=r}};Dr=g([ee("Flexify")],Dr);var wt=class{constructor(r){this.value=r}};wt=g([ee("FormKey")],wt);var On=class{constructor(r){this.origin=r}};On=g([ee("GeneratedCode")],On);var kn=class{constructor(){}};kn=g([ee("Hidden")],kn);var _n=class{constructor(r){this.hint=r}};_n=g([ee("Hint")],_n);var nr=class{constructor(r){this.value=r}};nr=g([ee("IdProperty")],nr);var En=class{constructor(r=!0){this.value=r}};En=g([ee("Insertable")],En);var ar=class{constructor(r){this.value=r}};ar=g([ee("IsActiveProperty")],ar);var Vt=class{constructor(r){this.value=r}};Vt=g([ee("ItemName")],Vt);var sr=class{constructor(r){this.value=r}};sr=g([ee("LocalTextPrefix")],sr);var Fr=class{constructor(r=!0){this.value=r}};Fr=g([ee("Maximizable")],Fr);var Dn=class{constructor(r){this.maxLength=r}};Dn=g([ee("MaxLength")],Dn);var si=class{constructor(r){this.value=r}};si=g([ee("NameProperty")],si);var Fn=class{};Fn=g([ee("OneWay")],Fn);var or=class{};or=g([ee("Option")],or);var Pr=class{constructor(r){this.value=r}};Pr=g([ee("OptionsType")],Pr);var Rr=class{constructor(r=!0){this.value=r}};Rr=g([ee("Panel")],Rr);var Pn=class{constructor(r){this.value=r}};Pn=g([ee("Placeholder")],Pn);var Rn=class{constructor(r=!0){this.value=r}};Rn=g([ee("ReadOnly")],Rn);var Nn=class{constructor(r=!0){this.isRequired=r}};Nn=g([ee("Required")],Nn);var Nr=class{constructor(r=!0){this.value=r}};Nr=g([ee("Resizable")],Nr);var Ar=class{constructor(r=!0){this.value=r}};Ar=g([ee("Responsive")],Ar);var Qt=class{constructor(r){this.value=r}};Qt=g([ee("Service")],Qt);var An=class{constructor(r=!0){this.value=r}};An=g([ee("Updatable")],An);var m;(N=>{function n(E,D){return function(R){typeof E=="string"?xr(R,E,D):xr(R,null,E)}}N.registerClass=n;function r(E,D){return function(R){typeof E=="string"?ln(R,E,D):ln(R,null,E)}}N.registerInterface=r;function e(E,D){return function(R){typeof E=="string"?Da(R,E,D):Da(R,null,E)}}N.registerEditor=e;function t(E,D,R){Kr(E,R,D),D&&Qe(E,new Ye(D))}N.registerEnum=t;function i(E,D,R){t(E,R!=null?R:D,D)}N.registerEnumType=i;function a(E=[et],D=[et]){return n(E,D)}N.registerFormatter=a;function o(E){return function(D){Qe(D,new Ye(E))}}N.enumKey=o;function l(){return function(E,D){var R=G(D,"get_")||G(D,"set_"),z=R?D.substr(4):D;Ds(E.constructor,{name:z,attr:[new or],type:R?16:4,getter:R?"get_"+z:null,setter:R?"set_"+z:null})}}N.option=l;function u(E){return function(D){Qe(D,new kr(E))}}N.dialogType=u;function d(){return function(E){var D=new Yt;Qe(E,D)}}N.editor=d;function c(E){return function(D){Qe(D,new _r(E))}}N.element=c;function p(E=!0){return function(D){Qe(D,new Er(E))}}N.filterable=p;function f(E=!0){return function(D){Qe(D,new Dr(E))}}N.flexify=f;function b(E){return function(D){Qe(D,new Vt(E))}}N.itemName=b;function x(E=!0){return function(D){Qe(D,new Fr(E))}}N.maximizable=x;function v(E){return function(D){Qe(D,new Pr(E))}}N.optionsType=v;function I(E=!0){return function(D){Qe(D,new Rr(E))}}N.panel=I;function S(E=!0){return function(D){Qe(D,new Nr(E))}}N.resizable=S;function T(E=!0){return function(D){Qe(D,new Ar(E))}}N.responsive=T;function _(E){return function(D){Qe(D,new Qt(E))}}N.service=_})(m||(m={}));var Gt=class{};Gt=g([m.registerInterface("Serenity.IBooleanValue")],Gt);var tt=class{};tt=g([m.registerInterface("Serenity.IDoubleValue")],tt);var Ot=class{};Ot=g([m.registerInterface("Serenity.IDialog")],Ot);var $t=class{};$t=g([m.registerInterface("Serenity.IEditDialog")],$t);var rt=class{};rt=g([m.registerInterface("Serenity.IGetEditValue")],rt);var pe=class{};pe=g([m.registerInterface("Serenity.IReadOnly")],pe);var it=class{};it=g([m.registerInterface("Serenity.ISetEditValue")],it);var oe=class{};oe=g([m.registerInterface("Serenity.IStringValue")],oe);var qt=class{};qt=g([m.registerInterface("Serenity.IValidateRequired")],qt);var mo=(i=>(i[i.Before=0]="Before",i[i.Delete=1]="Delete",i[i.Insert=2]="Insert",i[i.Update=3]="Update",i))(mo||{});Kr(mo,"Serenity.CaptureOperationType");var lt;(t=>{function n(i,a){var o=i,l=o["get_"+a];if(typeof l!="undefined")return l.apply(i);var u=e(a);return l=o["get_"+u],typeof l!="undefined"?l.apply(i):o[u]}t.getPropertyValue=n;function r(i,a,o){var l=i,u=l["set_"+a];if(typeof u!="undefined"){u.apply(i,[o]);return}var d=e(a);if(u=l["set_"+d],typeof u!="undefined"){u.apply(i,[o]);return}l[d]=o}t.setPropertyValue=r;function e(i){if(w(i))return i;if(i==="ID")return"id";for(var a=!1,o=0,l=0;l<i.length;l++)if(i.charCodeAt(l)>=65&&i.charCodeAt(l)<=90)o++;else{a=!0;break}return!a&&i.length!==1||o===0?i:o>1?i.substr(0,o-1).toLowerCase()+i.substr(o-1):i.length===1?i.toLowerCase():i.substr(0,1).toLowerCase()+i.substr(1)}t.makeCamelCase=e})(lt||(lt={}));function lr(n,r,e){let t;function i(){t=null}function a(u){var d=ka(u);if(d!=null&&n(d))return d;for(var c of Se.rootNamespaces){var p=c+"."+u;if(d=t[p],d||(d=ka(c+"."+u),d!=null&&n(d)))return d}}function o(){t={};for(var u of an())if(n(u)){var d=br(u);t[d]=u;var c=r&&r(u);c&&c!==d&&(t[c]=u)}if(e){for(var p of Object.keys(t))if(p.endsWith(e)){var f=p.substring(0,p.length-e.length);f&&!t[f]&&(t[f]=t[p])}}}function l(u){var f;if(!u)return null;var d;t==null&&o();var d=t[u];if(d)return d;if(d=a(u),d==null&&e&&!te(u,e)&&(d=(f=t[u+e])!=null?f:a(u+e)),d){t[u]=d;var c=r&&r(d);if(c&&u!=c&&(t[c]=d),e&&u.endsWith(e)){var p=u.substring(0,u.length-e.length);p&&!t[p]&&(t[p]=t[u])}return d}return d}return{reset:i,tryGet:l}}var Lr;(i=>{let n=lr(a=>Ue(Ot,a),null,"Dialog");function r(a){if(w(a))throw new Le("key");var o=n.tryGet(a);if(o)return o;var l=`"${L(a)}" dialog class not found! 
Make sure there is such a dialog type under the project root namespace, 
and its namespace parts start with capital letters like MyProject.MyModule.MyDialog.

If using ES modules, make sure the dialog type has a decorator like 
@Decorators.registerClass('MyProject.MyModule.MyDialog') with the full name
and "side-effect-import" this dialog class from the current 
"page.ts/grid.ts/dialog.ts file (import "./path/to/MyDialog.ts").

If you had this error from an editor with the InplaceAdd option, verify that the lookup key
and dialog type name match case-sensitively, excluding the Dialog suffix.
Specify the DialogType property in the LookupEditor attribute if it is not.

After applying fixes, build and run "node ./tsbuild.js" (or "tsc" if using namespaces) 
from the project folder.`;throw re(l.replace(/\r?\n\r?\n/g,"<br/><br/>"),"",{escapeHtml:!1,timeOut:5e3}),new ye(l)}i.get=r;function e(){n.reset()}i.reset=e;function t(a){return n.tryGet(a)}i.tryGet=t})(Lr||(Lr={}));function yo(n){function r(){if(typeof n=="undefined"||!n.ui||!n.ui.dialog||!n.ui.dialog.prototype)return!1;n.ui.dialog.prototype._allowInteraction=function(e){return n(e.target).closest(".ui-dialog").length?!0:!!n(e.target).closest(".ui-datepicker, .select2-drop, .cke, .cke_dialog, .modal, #support-modal").length},function(e){n.ui.dialog.prototype._focusTabbable=function(){if(Bi){this.uiDialog&&this.uiDialog.focus();return}e.call(this)}}(n.ui.dialog.prototype._focusTabbable),function(e){n.ui.dialog.prototype._createTitlebar=function(){e.call(this),this.uiDialogTitlebar.find(".ui-dialog-titlebar-close").html('<i class="fa fa-times" />')}}(n.ui.dialog.prototype._createTitlebar)}!r()&&typeof n!="undefined"&&n.fn&&n(r),typeof n!="undefined"&&n.fn&&(n.toJSON||(n.toJSON=JSON.stringify),n.parseJSON||(n.parseJSON=JSON.parse),n.cleanData=function(e){return function(t){var i,a,o,l,u=t;for(o=0;(a=u[o])!=null;o++)try{i=n._data(a,"events"),i&&i.remove&&(u===t&&(u=Array.prototype.slice.call(t)),n(a).triggerHandler("remove"),delete i.remove)}catch(d){}e(t)}}(n.cleanData))}function mu(){var r,e;let n=typeof global!="undefined"?global:typeof window!="undefined"?window:typeof self!="undefined"?self:null;typeof React=="undefined"&&typeof n!="undefined"&&(n.preact!=null?(n.React=n.ReactDOM=n.preact,React.Fragment=(r=React.Fragment)!=null?r:"x-fragment"):n.Nerv!=null?(n.React=n.ReactDOM=n.Nerv,React.Fragment=(e=React.Fragment)!=null?e:"x-fragment"):(n.React={Component:function(){},Fragment:"x-fragment",createElement:function(){return{_reactNotLoaded:!0}}},n.ReactDOM={render:function(){throw Error("To use React, it should be included before Serenity.CoreLib.js")}}))}mu();var P=class{constructor(r,e){if(this.element=r,this.options=e||{},this.widgetName=P.getWidgetName(U(this)),this.uniqueName=this.widgetName+(P.nextWidgetNumber++).toString(),r.data(this.widgetName))throw new ye(j("The element already has widget '{0}'!",this.widgetName));r.on("remove."+this.widgetName,t=>{t.bubbles||t.cancelable||this.destroy()}).data(this.widgetName,this),this.addCssClass(),this.idPrefix=this.uniqueName+"_",this.renderContents()}destroy(){this.element&&(this.element.removeClass(this.getCssClass()),this.element.off("."+this.widgetName).off("."+this.uniqueName).removeData(this.widgetName),this.element=null)}addCssClass(){this.element.addClass(this.getCssClass())}getCssClass(){var r=U(this),e=[],t=Ie(se(r),".","-");e.push(t);for(let i of Se.rootNamespaces)if(G(t,i+"-")){e.push(t.substr(i.length+1));break}return e.push(Xt(r)),e.filter((i,a,o)=>o.indexOf(i)===a).map(i=>"s-"+i).join(" ")}static getWidgetName(r){return Ie(se(r),".","_")}static elementFor(r){var e=ce(r,_r,!0),t=e.length>0?e[0].value:"<input/>";return k(t)}addValidationRule(r,e){return rr(this.element,r,e)}getGridField(){return this.element.closest(".field")}change(r){this.element.on("change."+this.uniqueName,r)}changeSelect2(r){this.element.on("change."+this.uniqueName,function(e,t){t!==!0&&r(e)})}static create(r){let e;if(Ue(Ot,r.type))e=new r.type(r.options),r.container&&e.element.appendTo(r.container),r.element&&r.element(e.element);else{var t=P.elementFor(r.type);r.container&&t.appendTo(r.container),r.element&&r.element(t),e=new r.type(t,r.options)}return e.init(null),r.init&&r.init(e),e}initialize(){}init(r){return r&&r(this),this}renderContents(){}};P.nextWidgetNumber=0,P.__isWidgetType=!0,P=g([m.registerClass("Serenity.Widget")],P);typeof k!="undefined"&&k.fn&&(k.fn.tryGetWidget=function(n){var r=this,e;if(Ue(P,n)){var t=P.getWidgetName(n);if(e=r.data(t),e!=null&&!Ue(n,U(e))&&(e=null),e!=null)return e}var i=r.data();if(i==null)return null;for(var a of Object.keys(i))if(e=i[a],e!=null&&Ue(n,U(e)))return e;return null},k.fn.getWidget=function(n){if(this==null)throw new Le("element");if(this.length===0)throw new ye(j("Searching for widget of type '{0}' on a non-existent element! ({1})",se(n),this.selector));var r=this.tryGetWidget(n);if(r==null){var e=j("Element has no widget of type '{0}'! If you have recently changed editor type of a property in a form class, or changed data type in row (which also changes editor type) your script side Form definition might be out of date. Make sure your project builds successfully and transform T4 templates",se(n));throw re(e,"",null),new ye(e)}return r});typeof k=="function"&&yo(k);var Mr;(i=>{let n=lr(a=>!!ce(a,Yt).length||Ue(P,a),null,"Editor");function r(a){if(w(a))throw new Le("key");var o=n.tryGet(a);if(o)return o;var l=`"${L(a)}" editor class not found! 
Make sure there is such a editor type under the project root namespace,
and its namespace parts start with capital letters like MyProject.MyModule.MyEditor.

If using ES modules, make sure the editor type has a decorator like 
@Decorators.registerEditor('MyProject.MyModule.MyFormatter') with the full name 
and "side-effect-import" this editor class from the current 
"page.ts/grid.ts/dialog.ts file (import "./path/to/MyEditor.ts").

After applying fixes, build and run "node ./tsbuild.js" (or "tsc" if using namespaces) 
from the project folder.`;throw re(l.replace(/\r?\n\r?\n/g,"<br/><br/>"),"",{escapeHtml:!1,timeOut:5e3}),new ye(l)}i.get=r;function e(){n.reset()}i.reset=e;function t(a){return n.tryGet(a)}i.tryGet=t})(Mr||(Mr={}));var ur;(i=>{let n=lr(Ps,a=>{var o;return(o=ce(a,Ye)[0])==null?void 0:o.value},null);function r(a){var o=n.tryGet(a);if(o)return o;var l=`Can't find "${L(a)}" enum type! 
If you have recently defined this enum type in server side code, make sure 
your project builds successfully and run "dotnet sergen t". 

Also verify there is such an enum type under the project root namespace, 
and its namespace parts start with capital letters like MyProject.MyModule.MyEnum.

If using ES modules, make sure the enum type is registered with 
Q.registerEnum('MyProject.MyModule.MyDialog') with the full name of 
your enum type and "side-effect-import" this enum from the current 
"page.ts/grid.ts/dialog.ts file (import "./path/to/MyEnum.ts").

After applying fixes, build and run "node ./tsbuild.js" (or "tsc" if using namespaces) 
from the project folder.`;throw re(l.replace(/\r?\n\r?\n/g,"<br/><br/>"),"",{escapeHtml:!1,timeOut:5e3}),new ye(l)}i.get=r;function e(){n.reset()}i.reset=e;function t(a){return n.tryGet(a)}i.tryGet=t})(ur||(ur={}));var kt;(e=>(e.executeOnceWhenShown=io,e.executeEverytimeWhenShown=hn))(kt||(kt={}));var vo=class{constructor(r){this.idPrefix=r}byId(r){return $("#"+this.idPrefix+r)}w(r,e){return $("#"+this.idPrefix+r).getWidget(e)}};var Br=class extends P{constructor(r,e){var t,i;super(r,e),r.addClass("s-PopupMenuButton"),r.click(a=>{var u,d,c,p;a.preventDefault(),a.stopPropagation(),this.options.onPopup!=null&&this.options.onPopup();var o=this.options.menu;(p=(c=o.show()).position)==null||p.call(c,{my:(u=this.options.positionMy)!=null?u:"left top",at:(d=this.options.positionAt)!=null?d:"left bottom",of:this.element});var l=this.uniqueName;$(document).one("click."+l,function(f){o.hide()})}),(i=(t=this.options.menu.hide().appendTo(document.body).addClass("s-PopupMenu")).menu)==null||i.call(t)}destroy(){this.options.menu!=null&&(this.options.menu.remove(),this.options.menu=null),super.destroy()}};Br=g([m.registerEditor("Serenity.PopupMenuButton")],Br);var Mn=class extends Br{constructor(r,e){super(r,e),r.addClass("s-PopupToolButton"),$("<b/>").appendTo(r.children(".button-outer").children("span"))}};Mn=g([m.registerEditor("Serenity.PopupToolButton")],Mn);var He=class extends P{constructor(e,t){super(e,t);this.element.addClass("s-Toolbar clearfix").html('<div class="tool-buttons"><div class="buttons-outer"><div class="buttons-inner"></div></div></div>'),this.createButtons()}destroy(){this.element.find("div.tool-button").unbind("click"),this.mouseTrap&&(this.mouseTrap.destroy?this.mouseTrap.destroy():this.mouseTrap.reset(),this.mouseTrap=null),super.destroy()}createButtons(){for(var e=$("div.buttons-inner",this.element).last(),t=this.options.buttons,i=0,a=0;a<t.length;a++){var o=t[a];o.separator&&i>0&&(e=$('<div class="buttons-inner"></div>').appendTo(e.parent()),i=0),this.createButton(e,o),i++}}createButton(e,t){var u;var i=(u=t.cssClass)!=null?u:"",a=$('<div class="tool-button"><div class="button-outer"><span class="button-inner"></span></div></div>').appendTo(e);t.action!=null&&a.attr("data-action",t.action),(t.separator==="right"||t.separator==="both")&&$('<div class="separator"></div>').appendTo(e),i.length>0&&a.addClass(i),w(t.hint)||a.attr("title",t.hint),a.click(function(d){a.hasClass("disabled")||t.onClick(d)});var o=t.title;if(t.htmlEncode!==!1&&(o=L(t.title)),!w(t.icon)){a.addClass("icon-tool-button");var l=t.icon;G(l,"fa-")?l="fa "+l:G(l,"glyphicon-")&&(l="glyphicon "+l),o="<i class='"+L(l)+"'></i> "+o}o==null||o.length===0?a.addClass("no-text"):a.find("span").html(o),t.visible===!1&&a.hide(),t.disabled!=null&&typeof t.disabled!="function"&&a.toggleClass("disabled",!!t.disabled),(typeof t.visible=="function"||typeof t.disabled=="function")&&a.on("updateInterface",()=>{typeof t.visible=="function"&&a.toggle(!!t.visible()),typeof t.disabled=="function"&&a.toggleClass("disabled",!!t.disabled())}),!w(t.hotkey)&&window.Mousetrap!=null&&(this.mouseTrap=this.mouseTrap||window.Mousetrap(t.hotkeyContext||this.options.hotkeyContext||window.document.documentElement),this.mouseTrap.bind(t.hotkey,function(d,c){return a.is(":visible")&&a.triggerHandler("click"),t.hotkeyAllowDefault}))}findButton(e){return e!=null&&G(e,".")&&(e=e.substr(1)),$("div.tool-button."+e,this.element)}updateInterface(){this.element.find(".tool-button").each(function(e,t){$(t).triggerHandler("updateInterface")})}};He=g([m.registerClass("Serenity.Toolbar")],He);var Pe=class extends P{byId(r){return $("#"+this.idPrefix+r,this.element)}byID(r,e){return this.byId(r).getWidget(e)}static noGeneric(r){var e=r.indexOf("$");return e>=0?r.substr(0,e):r}getDefaultTemplateName(){return Pe.noGeneric(Xt(U(this)))}getTemplateName(){var r=U(this),e=se(r),t=Pe.templateNames,i=Pe.templateNames[e];if(i!=null)return i;for(;r&&r!==P;){var a=Pe.noGeneric(se(r));for(let o of Se.rootNamespaces)if(G(a,o+".")){a=a.substr(o.length+1);break}if(ii("Template."+a)||(a=Ie(a,".","_"),ii("Template."+a)||$("script#Template_"+a).length>0))return t[e]=a,a;if(a=Pe.noGeneric(Xt(r)),ii("Template."+a)||$("script#Template_"+a).length>0)return Pe.templateNames[e]=a,a;r=rn(r)}return t[e]=i=this.getDefaultTemplateName(),i}getFallbackTemplate(){return null}getTemplate(){var r=this.getTemplateName(),e=$("script#Template_"+r);if(e.length>0)return e.html();let t;if(!ii("Template."+r)&&this.getDefaultTemplateName()==r&&(t=this.getFallbackTemplate(),t!=null))return t;if(t=Za(r),t==null)throw new Error(j("Can't locate template for widget '{0}' with name '{1}'!",se(U(this)),r));return t}renderContents(){for(var r=this.getTemplate().replace(new RegExp("~_","g"),this.idPrefix),e=0;;){var t=r.indexOf('{{text:"',e);if(t<0)break;var e=r.indexOf('"}}',t);if(e<0)break;var i=r.substr(t+8,e-t-8),a=O(i);r=r.substr(0,t)+a+r.substr(e+3),e=t+a.length}this.element.html(r)}useIdPrefix(){return yu(this.idPrefix)}};Pe.templateNames={},Pe=g([m.registerClass("Serenity.TemplatedWidget")],Pe);function yu(n){return new Proxy({_:n!=null?n:""},vu)}var vu={get(n,r){return r.startsWith("#")?"#"+n._+r.substring(1):n._+r}};typeof $!="undefined"&&$.fn&&($.fn.flexHeightOnly=function(n=1){return this.flexWidthHeight(0,n)},$.fn.flexWidthOnly=function(n=1){return this.flexWidthHeight(n,0)},$.fn.flexWidthHeight=function(n=1,r=1){return this.addClass("flexify").data("flex-x",n).data("flex-y",r)},$.fn.flexX=function(n){return this.data("flex-x",n)},$.fn.flexY=function(n){return this.data("flex-y",n)});var Bn=class extends P{constructor(e,t){super(e,t);this.xDifference=0;this.yDifference=0;kt.executeOnceWhenShown(e,()=>{this.storeInitialSize()})}storeInitialSize(){if(!this.element.data("flexify-init")){var e=this.options.designWidth;e==null&&(e=this.element.width()),this.element.data("flexify-width",e);var t=this.options.designHeight;t==null&&(t=this.element.height()),this.element.data("flexify-height",t),this.element.data("flexify-init",!0),this.element.on("resize."+this.uniqueName,()=>this.resizeElements()),this.element.on("resizestop."+this.uniqueName,()=>this.resizeElements());var i=this.element.find(".ui-tabs");i.length>0&&i.on("tabsactivate."+this.uniqueName,()=>this.resizeElements()),(this.options.designWidth!=null||this.options.designHeight!=null)&&this.resizeElements()}}getXFactor(e){var t=null;return this.options.getXFactor!=null&&(t=this.options.getXFactor(e)),t==null&&(t=e.data("flex-x")),t!=null?t:1}getYFactor(e){var t=null;return this.options.getYFactor!=null&&(t=this.options.getYFactor(e)),t==null&&(t=e.data("flex-y")),t!=null?t:0}resizeElements(){var e=this.element.width(),t=this.element.data("flexify-width");t==null&&(this.element.data("flexify-width",e),t=e);var i=this.element.height(),a=this.element.data("flexify-height");a==null&&(this.element.data("flexify-height",i),a=i),this.xDifference=e-t,this.yDifference=i-a;var o=this.element,l=this.element.find(".ui-tabs-panel");l.length>0&&(o=l.filter(":visible")),o.find(".flexify").add(l.filter(".flexify:visible")).each((u,d)=>{this.resizeElement($(d))})}resizeElement(e){var t=this.getXFactor(e);if(t!==0){var i=e.data("flexify-width");if(i==null){var a=e.width();e.data("flexify-width",a),i=a}e.width(i+t*this.xDifference|0)}var o=this.getYFactor(e);if(o!==0){var l=e.data("flexify-height");if(l==null){var u=e.height();e.data("flexify-height",u),l=u}e.height(l+o*this.yDifference|0)}e.hasClass("require-layout")&&e.triggerHandler("layout")}};var dr;(t=>{function n(i,a,o,l,u){var c;var d=(c=i==null?void 0:i.dialog)==null?void 0:c.call(i);return d.dialog("option","resizable",!0),l!=null&&d.dialog("option","minWidth",l),a!=null&&d.dialog("option","width",a),u!=null&&d.dialog("option","minHeight",u),o!=null&&d.dialog("option","height",o),i}t.dialogResizable=n;function r(i){return i.dialogExtend({closable:!0,maximizable:!0,dblclick:"maximize",icons:{maximize:"ui-icon-maximize-window"}}),i}t.dialogMaximizable=r;function e(i){return new Bn(i.closest(".ui-dialog"),{}),i}t.dialogFlexify=e})(dr||(dr={}));var xe=class extends Pe{constructor(e){super(Bs().addClass("s-TemplatedDialog hidden"),e);this.element.attr("id",this.uniqueName),this.initValidator(),this.initTabs(),this.initToolbar()}get isMarkedAsPanel(){var e=ce(U(this),Rr,!0);return e.length>0&&e[e.length-1].value!==!1}get isResponsive(){return Se.responsiveDialogs||ce(U(this),Ar,!0).length>0}static getCssSize(e,t){var i=e.css(t);if(i==null||!te(i,"px"))return null;i=i.substr(0,i.length-2);let a=st(i);return a==null||isNaN(a)||a==0?null:a}static applyCssSizes(e,t){let i,a=$("<div/>").hide().addClass(t).appendTo(document.body);try{var o=$("<div/>").addClass("size").appendTo(a);i=xe.getCssSize(o,"minWidth"),i!=null&&(e.minWidth=i),i=xe.getCssSize(o,"width"),i!=null&&(e.width=i),i=xe.getCssSize(o,"height"),i!=null&&(e.height=i),i=xe.getCssSize(o,"minHeight"),i!=null&&(e.minHeight=i)}finally{a.remove()}}destroy(){var t,i,a,o,l,u,d;if((i=(t=this.tabs)==null?void 0:t.tabs)==null||i.call(t,"destroy"),this.tabs=null,(l=(o=(a=this.toolbar)==null?void 0:a.toolbar)==null?void 0:o.destroy)==null||l.call(o),this.toolbar=null,this.validator&&this.byId("Form").remove(),this.validator=null,this.element!=null&&this.element.hasClass("ui-dialog-content"))(d=(u=this.element)==null?void 0:u.dialog)==null||d.call(u,"destroy"),this.element.removeClass("ui-dialog-content");else if(this.element!=null&&this.element.hasClass("modal-body")){var e=this.element.closest(".modal").data("bs.modal",null);this.element&&this.element.removeClass("modal-body"),window.setTimeout(()=>e.remove(),0)}$(window).unbind("."+this.uniqueName),super.destroy()}initDialog(){var i,a;if(this.element.hasClass("ui-dialog-content"))return;this.element.removeClass("hidden"),(a=(i=this.element)==null?void 0:i.dialog)==null||a.call(i,this.getDialogOptions()),this.element.closest(".ui-dialog").on("resize",o=>this.arrange());let e=U(this);this.isResponsive?(dr.dialogResizable(this.element),$(window).bind("resize."+this.uniqueName,o=>{this.element&&this.element.is(":visible")&&this.handleResponsive()}),this.element.closest(".ui-dialog").addClass("flex-layout")):dr.dialogFlexify&&ce(e,Dr,!0).length>0&&(dr.dialogFlexify(this.element),dr.dialogResizable(this.element)),ce(e,Fr,!0).length>0&&dr.dialogMaximizable(this.element);var t=this;this.element.bind("dialogopen."+this.uniqueName,()=>{$(document.body).addClass("modal-dialog-open"),this.isResponsive&&this.handleResponsive(),t.onDialogOpen()}),this.element.bind("dialogclose."+this.uniqueName,()=>{$(document.body).toggleClass("modal-dialog-open",$(".ui-dialog:visible").length>0),t.onDialogClose()})}getModalOptions(){return{backdrop:!1,keyboard:!1,size:"lg",modalClass:this.getCssClass()}}initModal(){var c,p;if(!this.element.hasClass("modal-body")){var e=(p=(c=this.element.data("dialogtitle"))!=null?c:this.getDialogTitle())!=null?p:"",t=this.getModalOptions();t.show=!1;var i="s-Modal";t.modalClass&&(i+=" "+t.modalClass);var a=Qa(e,"",i),o=$(a).appendTo(document.body).addClass("flex-layout");o.one("shown.bs.modal."+this.uniqueName,()=>{this.element.triggerHandler("shown.bs.modal"),this.onDialogOpen()}),o.one("hidden.bs.modal."+this.uniqueName,()=>{$(document.body).toggleClass("modal-open",$(".modal.show").length+$(".modal.in").length>0),this.onDialogClose()}),t.size&&o.find(".modal-dialog").addClass("modal-"+t.size);var l=o.find(".modal-footer"),u=this.getDialogButtons();if(u!=null)for(var d of u)$(Ga(d)).appendTo(l).click(d.click);else l.hide();o.modal(t),o.find(".modal-body").replaceWith(this.element.removeClass("hidden").addClass("modal-body")),$(window).on("resize."+this.uniqueName,this.arrange.bind(this))}}initToolbar(){var e=this.byId("Toolbar");if(e.length!==0){var t=this.element.closest(".ui-dialog");t.length===0&&(t=this.element.closest(".modal"),t.length==0&&(t=this.element));var i={buttons:this.getToolbarButtons(),hotkeyContext:t[0]};this.toolbar=new He(e,i)}}getToolbarButtons(){return[]}getValidatorOptions(){return{}}initValidator(){var e=this.byId("Form");if(e.length>0){var t=this.getValidatorOptions();this.validator=(we||e.validate)&&e.validate(mn(t))}}resetValidation(){this.validator&&this.validator.resetAll()}validateForm(){return this.validator==null||!!this.validator.form()}dialogOpen(e){var t,i;e=e!=null?e:this.isMarkedAsPanel,e?(this.element.hasClass("s-Panel")||(this.element.on("panelopen."+this.uniqueName,()=>{this.onDialogOpen()}),this.element.on("panelclose."+this.uniqueName,()=>{this.onDialogClose()})),xe.openPanel(this.element,this.uniqueName),this.setupPanelTitle()):this.useBSModal()?(this.initModal(),this.element.closest(".modal").modal("show")):(this.initDialog(),(i=(t=this.element).dialog)==null||i.call(t,"open"))}useBSModal(){var e;return!!(!$.ui||!((e=$.ui)!=null&&e.dialog)||xe.bootstrapModal)}static openPanel(e,t){return Js(e,t)}static closePanel(e,t){return dn(e,t)}onDialogOpen(){var e,t;Bi()||$(":input",this.element).not("button").eq(0).focus(),this.arrange(),this.tabs&&((t=(e=this.tabs).tabs)==null||t.call(e,"option","active",0))}arrange(){this.element.find(".require-layout").filter(":visible").each(function(e,t){$(t).triggerHandler("layout")})}onDialogClose(){$(document).trigger("click"),$.qtip&&$(document.body).children(".qtip").each(function(e,t){$(t).qtip("hide")}),window.setTimeout(()=>{var e=this.element;this.destroy(),e.remove(),Aa(!1,null)},0)}addCssClass(){this.isMarkedAsPanel&&(super.addCssClass(),this.isResponsive&&this.element.addClass("flex-layout"))}getDialogButtons(){}getDialogOptions(){var o,l;var e={},t="s-Dialog "+this.getCssClass();e.dialogClass=t;var i=this.getDialogButtons();i!=null&&(e.buttons=i.map($a)),e.width=920,xe.applyCssSizes(e,t),e.autoOpen=!1;let a=U(this);return e.resizable=ce(a,Nr,!0).length>0,e.modal=!0,e.position={my:"center",at:"center",of:$(window.window)},e.title=(l=(o=this.element.data("dialogtitle"))!=null?o:this.getDialogTitle())!=null?l:"",e}getDialogTitle(){return""}dialogClose(){var e,t,i,a;this.element.hasClass("ui-dialog-content")?(a=(t=(e=this.element).dialog)==null?void 0:(i=t.call(e)).dialog)==null||a.call(i,"close"):this.element.hasClass("modal-body")?this.element.closest(".modal").modal("hide"):this.element.hasClass("s-Panel")&&!this.element.hasClass("hidden")&&xe.closePanel(this.element)}get dialogTitle(){var e,t;return this.element.hasClass("ui-dialog-content")?(t=(e=this.element).dialog)==null?void 0:t.call(e,"option","title"):this.element.hasClass("modal-body")?this.element.closest(".modal").find(".modal-header").children("h5").text():this.element.data("dialogtitle")}setupPanelTitle(){var i;var e=(i=this.dialogTitle)!=null?i:this.getDialogTitle(),t=this.element.children(".panel-titlebar");w(e)?t.remove():(this.element.children(".panel-titlebar").length||(t=$("<div class='panel-titlebar'><div class='panel-titlebar-text'></div></div>").prependTo(this.element)),t.children(".panel-titlebar-text").text(e),this.element.hasClass("s-Panel")&&(t.children(".panel-titlebar-close").length||$('<button class="panel-titlebar-close">&nbsp;</button>').prependTo(t).click(a=>{xe.closePanel(this.element,a)})))}set dialogTitle(e){var i,a;var t=this.dialogTitle;this.element.data("dialogtitle",e),this.element.hasClass("ui-dialog-content")?(a=(i=this.element).dialog)==null||a.call(i,"option","title",e):this.element.hasClass("modal-body")?this.element.closest(".modal").find(".modal-header").children("h5").text(e!=null?e:""):this.element.hasClass("s-Panel")&&t!=this.dialogTitle&&(this.setupPanelTitle(),this.arrange())}set_dialogTitle(e){this.dialogTitle=e}initTabs(){var t;var e=this.byId("Tabs");e.length!==0&&(this.tabs=(t=e.tabs)==null?void 0:t.call(e,{}),this.tabs.bind("tabsactivate",()=>this.arrange()))}handleResponsive(){var l;var e=(l=this.element)==null?void 0:l.dialog(),t=this.element.closest(".ui-dialog");if(Bi()){var i=this.element.data("responsiveData");if(!i){i={},i.draggable=e.dialog("option","draggable"),i.resizable=e.dialog("option","resizable"),i.position=e.css("position");var a=t.position();i.left=a.left,i.top=a.top,i.width=t.width(),i.height=t.height(),i.contentHeight=this.element.height(),this.element.data("responsiveData",i),e.dialog("option","draggable",!1),e.dialog("option","resizable",!1)}t.addClass("mobile-layout"),t.css({left:"0px",top:"0px",width:$(window).width()+"px",height:$(window).height()+"px",position:"fixed"}),$(document.body).scrollTop(0),ts(this.element)}else{var o=this.element.data("responsiveData");o&&(e.dialog("option","draggable",o.draggable),e.dialog("option","resizable",o.resizable),this.element.closest(".ui-dialog").css({left:"0px",top:"0px",width:o.width+"px",height:o.height+"px",position:o.position}),this.element.height(o.contentHeight),t.removeClass("mobile-layout"),this.element.removeData("responsiveData"))}}};xe=g([m.registerClass("Serenity.TemplatedDialog",[Ot])],xe);var oi=class extends Pe{constructor(e,t){super(e,t);this.initValidator(),this.initTabs(),this.initToolbar()}destroy(){var e,t;this.tabs&&((t=(e=this.tabs).tabs)==null||t.call(e,"destroy"),this.tabs=null),this.toolbar&&(this.toolbar.destroy(),this.toolbar=null),this.validator&&(this.byId("Form").remove(),this.validator=null),super.destroy()}arrange(){this.element.find(".require-layout").filter(":visible").each(function(e,t){$(t).triggerHandler("layout")})}getToolbarButtons(){return[]}getValidatorOptions(){return{}}initTabs(){var t;var e=this.byId("Tabs");e.length!==0&&(this.tabs=(t=e.tabs)==null?void 0:t.call(e,{}))}initToolbar(){var e=this.byId("Toolbar");if(e.length!==0){var t={buttons:this.getToolbarButtons()};this.toolbar=new He(e,t)}}initValidator(){var e=this.byId("Form");if(e.length>0){var t=this.getValidatorOptions();this.validator=e.validate(mn(t))}}resetValidation(){this.validator&&this.validator.resetAll()}validateForm(){return this.validator==null||!!this.validator.form()}};oi=g([m.registerClass("Serenity.TemplatedPanel")],oi);var li;(t=>{function n(i,a,o){var l=i.validate(),u=l.settings;return u.abortHandler||a!=null&&a()===!1?!1:(u.abortHandler=Vi,u.submitHandler=function(){return o!=null&&o(),!1},i.trigger("submit"),!0)}t.asyncSubmit=n;function r(i,a,o){var l=i.validate(),u=l.settings;return u.abortHandler!=null||a!=null&&a()===!1||!l.form()?!1:(o!=null&&o(),!0)}t.submit=r;function e(i){var a=i.closest("form");return a.length===0?null:a.data("validator")}t.getValidator=e})(li||(li={}));var bo;(t=>{function n(i,a,o){if(!i.length)return i;if(o==null)throw new ye("rule is null!");return i.addClass("customValidate").bind("customValidate."+a,o),i}t.addValidationRule=n;function r(i,a){return i.unbind("customValidate."+a),i}t.removeValidationRule=r;function e(i,a){return i.element(a.element[0])}t.validateElement=e})(bo||(bo={}));var cr=class{constructor(r,e,t){this.parentType=r;this.widget=e;this.parentChange=t;this.bind(),this.widget.element.bind("remove."+e.uniqueName+"cwh",i=>{this.unbind(),this.widget=null,this.parentChange=null})}bind(){if(w(this._parentID))return null;var r=Ra(this.widget.element,this._parentID).tryGetWidget(this.parentType);return r!=null?(r.element.bind("change."+this.widget.uniqueName,()=>{this.parentChange(r)}),r):(re("Can't find cascaded parent element with ID: "+this._parentID+"!","",null),null)}unbind(){if(w(this._parentID))return null;var r=Ra(this.widget.element,this._parentID).tryGetWidget(this.parentType);return r!=null&&r.element.unbind("."+this.widget.uniqueName),r}get_parentID(){return this._parentID}set_parentID(r){this._parentID!==r&&(this.unbind(),this._parentID=r,this.bind())}};cr=g([m.registerClass("Serenity.CascadedWidgetLink")],cr);var Vn;(a=>{function n(o,l,u){var p,f;if(o){var d=t(o);if(d){var c=d[l];c!=null&&(u&&c===o.tabs("option","active")&&((p=o.tabs)==null||p.call(o,"option","active",0)),(f=o.tabs)==null||f.call(o,u?"disable":"enable",c))}}}a.setDisabled=n;function r(o,l,u){var p,f;if(o){var d=t(o);if(d){var c=d[l];c!=null&&(!u&&c===((p=o.tabs)==null?void 0:p.call(o,"option","active"))&&((f=o.tabs)==null||f.call(o,"option","active",0)),o.children("ul").children("li").eq(c).toggle(u))}}}a.toggle=r;function e(o){var c;var l=o.children("ul").children("li").eq((c=o.tabs)==null?void 0:c.call(o,"option","active")).children("a").attr("href").toString(),u="_Tab",d=l.lastIndexOf(u);return d>=0&&(l=l.substr(d+u.length)),l}a.activeTabKey=e;function t(o){var l=o.data("indexByKey");return l||(l={},o.children("ul").children("li").children("a").each(function(u,d){var c=d.getAttribute("href").toString(),p="_Tab",f=c.lastIndexOf(p);f>=0&&(c=c.substr(f+p.length)),l[c]=u}),o.data("indexByKey",l)),l}a.indexByKey=t;function i(o,l){var c,p;var u=t(o);if(u){var d=u[l];d!=null&&d!==((c=o.tabs)==null?void 0:c.call(o,"option","active"))&&((p=o.tabs)==null||p.call(o,"option","active",d))}}a.selectTab=i})(Vn||(Vn={}));var ut;(r=>{function n(e,t){if(t!=null){var i=U(e);if(i!==Object){var a=i.__propByName,o=i.__fieldByName;if(a==null){var l=nn(i,16),u=l.filter(function(E){return!!E.setter&&((E.attr||[]).filter(function(D){return Ae(D,or)}).length>0||(E.attr||[]).filter(function(D){return Ae(D,Bt)}).length>0)});a={};for(var d of u)a[lt.makeCamelCase(d.name)]=d;i.__propByName=a}if(o==null){var c=nn(i,4),p=c.filter(function(E){return(E.attr||[]).filter(function(D){return Ae(D,or)}).length>0||(E.attr||[]).filter(function(D){return Ae(D,Bt)}).length>0});o={};for(var f=0;f<p.length;f++){var b=p[f];o[lt.makeCamelCase(b.name)]=b}i.__fieldByName=o}var x=Object.keys(t);for(var v of x){var I=t[v],S=lt.makeCamelCase(v),T=a[S]||a[v];if(T!=null){var _=e[T.setter];_&&_.call(e,I)}else{var N=o[S]||o[v];N&&(e[N.name]=I)}}}}}r.set=n})(ut||(ut={}));var q;(c=>{function n(p){var v,I,S;var f=p.element.data("select2");if(f!=null){var b=p.element.select2("data");return b==null?"":(v=b.text)!=null?v:""}var x=e(p);return x==null?"":typeof x=="string"?x:x instanceof Boolean?x?(I=V("Controls.FilterPanel.OperatorNames.true"))!=null?I:"True":(S=V("Controls.FilterPanel.OperatorNames.true"))!=null?S:"False":x.toString()}c.getDisplayText=n;var r={name:"_"};function e(p){var f={};return t(p,r,f),f._}c.getValue=e;function t(p,f,b){var x=Ce(p,rt);if(x!=null){x.getEditValue(f,b);return}var v=Ce(p,oe);if(v!=null){b[f.name]=v.get_value();return}var I=Ce(p,Gt);if(I!=null){b[f.name]=I.get_value();return}var S=Ce(p,tt);if(S!=null){var T=S.get_value();b[f.name]=isNaN(T)?null:T;return}if(p.getEditValue!=null){p.getEditValue(f,b);return}if(p.element.is(":input")){b[f.name]=p.element.val();return}}c.saveValue=t;function i(p,f){var b={_:f};a(p,r,b)}c.setValue=i;function a(p,f,b){var x=Ce(p,it);if(x!=null){x.setEditValue(b,f);return}var v=Ce(p,oe);if(v!=null){var I=b[f.name];I!=null&&(I=I.toString()),v.set_value(Zt(I,String));return}var S=Ce(p,Gt);if(S!=null){var T=b[f.name];typeof T=="number"?S.set_value(T>0):S.set_value(!!T);return}var _=Ce(p,tt);if(_!=null){var N=b[f.name];N==null||Ae(N,String)&&mt(Zt(N,String))?_.set_value(null):Ae(N,String)?_.set_value(Zt(tr(Zt(N,String)),Number)):Ae(N,Boolean)?_.set_value(N?1:0):_.set_value(Zt(N,Number));return}if(p.setEditValue!=null){p.setEditValue(b,f);return}if(p.element.is(":input")){var E=b[f.name];E==null?p.element.val(""):p.element.val(E);return}}c.loadValue=a;function o(p,f){return p.each(function(b,x){var v=$(x),I=v.attr("type");return v.is("select")||I==="radio"||I==="checkbox"?f?v.addClass("readonly").attr("disabled","disabled"):v.removeClass("readonly").removeAttr("disabled"):f?v.addClass("readonly").attr("readonly","readonly"):v.removeClass("readonly").removeAttr("readonly"),!0}),p}c.setReadonly=o;function l(p,f){var b=Ce(p,pe);b!=null?b.set_readOnly(f):p.element.is(":input")&&o(p.element,f)}c.setReadOnly=l;function u(p,f){var b=Ce(p,qt);b!=null?b.set_required(f):p.element.is(":input")&&p.element.toggleClass("required",!!f);var x=p.element.closest(".field"),v=x.find("sup").get().length>0;f&&!v?$("<sup>*</sup>").attr("title",O("Controls.PropertyGrid.RequiredHint")).prependTo(x.find(".caption")[0]):!f&&v&&$(x.find("sup")[0]).remove()}c.setRequired=u;function d(p,f){if(!f){if(!p.hasClass("readonly-container"))return;p.removeClass("readonly-container").find(".editor.container-readonly").removeClass("container-readonly").each((b,x)=>{var v=$(x).tryGetWidget(P);v!=null?c.setReadOnly(v,!1):c.setReadonly($(x),!1)});return}p.addClass("readonly-container").find(".editor").not(".container-readonly").each((b,x)=>{var v=$(x).tryGetWidget(P);if(v!=null){if(v.get_readOnly){if(v.get_readOnly())return}else if($(x).is("[readonly]")||$(x).is("[disabled]")||$(x).is(".readonly")||$(x).is(".disabled"))return;$(x).addClass("container-readonly"),c.setReadOnly(v,!0)}else{if($(x).is("[readonly]")||$(x).is("[disabled]")||$(x).is(".readonly")||$(x).is(".disabled"))return;c.setReadonly($(x).addClass("container-readonly"),!0)}})}c.setContainerReadOnly=d})(q||(q={}));var ze=class extends P{constructor(e,t){var T;super(e,t);this.categoryLinkClick=e=>{e.preventDefault();var t=$("a[name="+e.target.getAttribute("href").toString().substr(1)+"]");t.closest(".category").hasClass("collapsed")&&t.closest(".category").children(".category-title").click();var i=function(){$.fn.fadeTo&&t.fadeTo(100,.5,function(){t.fadeTo(100,1,function(){})})},a=t.closest(".category");$.fn.scrollintoview?a.closest(":scrollable(both)").length===0?i():a.scrollintoview({duration:"fast",direction:"y",complete:i}):a&&a[0]&&a[0].scrollIntoView&&(a[0].scrollIntoView(),i())};this.idPrefix=this.options.idPrefix=(T=this.options.idPrefix)!=null?T:this.idPrefix,this.options.mode==null&&(this.options.mode=1),e.addClass("s-PropertyGrid"),this.editors=[];var i=this.options.items||[];this.items=[];var a=Nt(i,function(_){return!w(_.tab)});if(a){var o=i.filter(_=>w(_.tab));o.length>0&&(this.createItems(this.element,o),$("<div class='pad'></div>").appendTo(this.element));for(var l=i.filter(_=>!w(_.tab)),u=$("<ul class='nav nav-tabs property-tabs' role='tablist'></ul>").appendTo(this.element),d=$("<div class='tab-content property-panes'></div>").appendTo(this.element),c=0,p=0;p<l.length;){var f={$:Yr(l[p].tab)},b=[],x=p;do b.push(l[x]);while(++x<l.length&&Yr(l[x].tab)===f.$);p=x;var v=$(Ct()?'<li><a data-toggle="tab" role="tab"></a></li>':`<li class="nav-item"><a class="nav-link" data-${vt()?"bs-":""}toggle="tab" role="tab"></a></li>`).appendTo(u);c===0&&(Ct()?v.addClass("active"):v.children("a").addClass("active"));var I=this.uniqueName+"_Tab"+c;v.children("a").attr("href","#"+I).text(this.determineText(f.$,function(_){return _+"Tabs."+this.tab.$}.bind({tab:f})));var S=$("<div class='tab-pane fade' role='tabpanel'>").appendTo(d);c===0&&S.addClass(Ct()?"in active":"show active"),S.attr("id",I),this.createItems(S,b),c++}}else this.createItems(this.element,i);this.updateInterface()}destroy(){if(this.editors!=null){for(var e=0;e<this.editors.length;e++)this.editors[e].destroy();this.editors=null}this.element.find("a.category-link").unbind("click",this.categoryLinkClick).remove(),P.prototype.destroy.call(this)}createItems(e,t){var v,I;var i={},a=e,o=this.options.useCategories!==!1&&Nt(t,function(S){return!w(S.category)});if(o){var l=$("<div/>").addClass("category-links");i=this.createCategoryLinks(l,t),Object.keys(i).length>1?l.appendTo(e):l.find("a.category-link").unbind("click",this.categoryLinkClick).remove()}a=$("<div/>").addClass("categories").appendTo(e);var u;o?u=a:u=$("<div/>").addClass("category").appendTo(a);for(var d=null,c=0;c<t.length;c++){var p=t[c],f=p.category;if(f==null&&(f=(v=this.options.defaultCategory)!=null?v:""),o&&d!==f){var b=this.createCategoryDiv(a,i,f,p.collapsible!==!0?null:(I=p.collapsed)!=null?I:!1);d==null&&b.addClass("first-category"),d=f,u=b}var x=this.createField(u,p);this.items.push(p),this.editors.push(x)}}createCategoryDiv(e,t,i,a){var o=$("<div/>").addClass("category").appendTo(e),l=$("<div/>").addClass("category-title").append($("<a/>").addClass("category-anchor").text(this.determineText(i,function(d){return d+"Categories."+i})).attr("name",this.idPrefix+"Category"+t[i].toString())).appendTo(o);if(a!=null){o.addClass(a===!0?"collapsible collapsed":"collapsible");var u=$("<i/>").addClass(a===!0?"fa fa-plus":"fa fa-minus").appendTo(l);l.click(function(d){o.toggleClass("collapsed"),u.toggleClass("fa-plus").toggleClass("fa-minus")})}return o}determineText(e,t){if(e!=null&&!G(e,"`")){var i=V(e);if(i!=null)return i}if(e!=null&&G(e,"`")&&(e=e.substring(1)),!w(this.options.localTextPrefix)){var a=V(t(this.options.localTextPrefix));if(a!=null)return a}return e}createField(e,t){var S,T;var i=$("<div/>").addClass("field").addClass(t.name).data("PropertyItem",t).appendTo(e);if(w(t.cssClass)||i.addClass(t.cssClass),!w(t.formCssClass)&&(i.addClass(t.formCssClass),t.formCssClass.indexOf("line-break-")>=0)){var a=t.formCssClass.split(String.fromCharCode(32));a.indexOf("line-break-xs")>=0?$("<div class='line-break' style='width: 100%' />").insertBefore(i):a.indexOf("line-break-sm")>=0?$("<div class='line-break hidden-xs' style='width: 100%' />").insertBefore(i):a.indexOf("line-break-md")>=0?$("<div class='line-break hidden-sm' style='width: 100%' />").insertBefore(i):a.indexOf("line-break-lg")>=0&&$("<div class='line-break hidden-md' style='width: 100%' />").insertBefore(i)}var o=this.idPrefix+t.name,l=this.determineText(t.title,function(_){return _+t.name}),u=this.determineText(t.hint,function(_){return _+t.name+"_Hint"}),d=this.determineText(t.placeholder,function(_){return _+t.name+"_Placeholder"});u==null&&(u=l!=null?l:"");var c=$("<label/>").addClass("caption").attr("for",o).attr("title",u).text(l!=null?l:"").appendTo(i);w(t.labelWidth)||(t.labelWidth==="0"?c.hide():c.css("width",t.labelWidth)),t.required===!0&&$("<sup>*</sup>").attr("title",O("Controls.PropertyGrid.RequiredHint")).prependTo(c);var p=Mr.get((S=t.editorType)!=null?S:"String"),f=P.elementFor(p).addClass("editor").attr("id",o).appendTo(i);f.is(":input")&&f.attr("name",(T=t.name)!=null?T:""),w(d)||f.attr("placeholder",d);var b=t.editorParams,x=null,v=ce(p,Pr,!0);v!=null&&v.length>0&&(x=v[0].optionsType);var I;return x!=null?(b=Q(new x,t.editorParams),I=new p(f,b)):(b=Q(new Object,t.editorParams),I=new p(f,b)),I.initialize(),Xt(I)=="BooleanEditor"&&(t.editorParams==null||!t.editorParams.labelFor)&&c.removeAttr("for"),Xt(I)=="RadioButtonEditor"&&(t.editorParams==null||!t.editorParams.labelFor)&&c.removeAttr("for"),t.maxLength!=null&&ze.setMaxLength(I,t.maxLength),t.editorParams!=null&&ut.set(I,t.editorParams),$("<div/>").addClass("vx").appendTo(i),$("<div/>").addClass("clear").appendTo(i),I}getCategoryOrder(e){var p;var t=0,i={},a=Y(this.options.categoryOrder);if(a!=null){var o=a.split(";");for(var l of o){var u=Y(l);u!=null&&i[u]==null&&(i[u]=t++)}}for(var d of e){var c=d.category;c==null&&(c=(p=this.options.defaultCategory)!=null?p:""),i[c]==null&&(i[c]=t++)}return i}createCategoryLinks(e,t){var S;var i=0,a={},o={};for(var l of t){var u=l.name,d=l.category;d==null&&(d=(S=this.options.defaultCategory)!=null?S:""),o[u]=d,a[l.name]=i++}var c=this,p=this.getCategoryOrder(t);t.sort(function(T,_){var N=0,E=o[T.name],D=o[_.name];if(E!=D){var R=p[E],z=p[D];R!=null&&z!=null?N=R-z:R!=null?N=-1:z!=null&&(N=1)}return N===0&&(N=F.stringCompare(E,D)),N===0&&(N=a[T.name]<a[_.name]?-1:a[T.name]>a[_.name]?1:0),N});for(var f={},b=0;b<t.length;b++){var x=t[b],v={$:o[x.name]};if(f[v.$]==null){var I=Object.keys(f).length+1;f[v.$]=I,I>1&&$("<span/>").addClass("separator").text("|").prependTo(e),$("<a/>").addClass("category-link").text(this.determineText(v.$,function(T){return T+"Categories."+this.category.$}.bind({category:v}))).attr("tabindex","-1").attr("href","#"+this.idPrefix+"Category"+I.toString()).click(this.categoryLinkClick).prependTo(e)}}return $("<div/>").addClass("clear").appendTo(e),f}get_editors(){return this.editors}get_items(){return this.items}get_idPrefix(){return this.idPrefix}get_mode(){return this.options.mode}set_mode(e){this.options.mode!==e&&(this.options.mode=e,this.updateInterface())}static loadEditorValue(e,t,i){}static saveEditorValue(e,t,i){q.saveValue(e,t,i)}static setReadOnly(e,t){q.setReadOnly(e,t)}static setReadonly(e,t){return q.setReadonly(e,t)}static setRequired(e,t){q.setRequired(e,t)}static setMaxLength(e,t){e.element.is(":input")&&(t>0?e.element.attr("maxlength",t):e.element.removeAttr("maxlength"))}load(e){for(var t=0;t<this.editors.length;t++){var i=this.items[t],a=this.editors[t];this.get_mode()===1&&i.defaultValue!=null&&typeof e[i.name]=="undefined"&&(e[i.name]=i.defaultValue),q.loadValue(a,i,e)}}save(e){e==null&&(e=Object.create(null));for(var t=0;t<this.editors.length;t++){var i=this.items[t];if(i.oneWay!==!0&&this.canModifyItem(i)){var a=this.editors[t];q.saveValue(a,i,e)}}return e}get value(){return this.save()}set value(e){e==null&&(e=Object.create(null)),this.load(e)}canModifyItem(e){return this.get_mode()===Gi.insert?e.insertable===!1?!1:e.insertPermission==null?!0:ae.hasPermission(e.insertPermission):this.get_mode()===Gi.update?e.updatable===!1?!1:e.updatePermission==null?!0:ae.hasPermission(e.updatePermission):!0}updateInterface(){for(var e=0;e<this.editors.length;e++){var t=this.items[e],i=this.editors[e],a=t.readOnly===!0||!this.canModifyItem(t);if(q.setReadOnly(i,a),q.setRequired(i,!a&&!!t.required&&t.editorType!=="Boolean"),t.visible===!1||t.readPermission!=null||t.insertPermission!=null||t.updatePermission!=null||t.hideOnInsert===!0||t.hideOnUpdate===!0){var o=t.readPermission!=null&&!ae.hasPermission(t.readPermission)||t.visible===!1||this.get_mode()===Gi.insert&&t.hideOnInsert===!0||this.get_mode()===2&&t.hideOnUpdate===!0;i.getGridField().toggle(!o)}}}enumerateItems(e){for(var t=0;t<this.editors.length;t++){var i=this.items[t],a=this.editors[t];e(i,a)}}};ze=g([m.registerClass("Serenity.PropertyGrid")],ze);var Gi=(e=>(e[e.insert=1]="insert",e[e.update=2]="update",e))(Gi||{});var Qn=class extends oi{constructor(e,t){super(e,t);this.initPropertyGrid(),this.loadInitialEntity()}destroy(){this.propertyGrid&&(this.propertyGrid.destroy(),this.propertyGrid=null),this.validator&&(this.byId("Form").remove(),this.validator=null),super.destroy()}initPropertyGrid(){var e=this.byId("PropertyGrid");if(!(e.length<=0)){var t=this.getPropertyGridOptions();this.propertyGrid=new ze(e,t).init(null),this.element.closest(".ui-Panel").hasClass("s-Flexify")&&this.propertyGrid.element.children(".categories").flexHeightOnly(1)}}loadInitialEntity(){this.propertyGrid&&this.propertyGrid.load(new Object)}getFormKey(){var e=ce(U(this),wt,!0);if(e.length>=1)return e[0].value;var t=se(U(this)),i=t.indexOf(".");return i>=0&&(t=t.substring(i+1)),te(t,"Panel")?t=t.substr(0,t.length-6):te(t,"Panel")&&(t=t.substr(0,t.length-5)),t}getPropertyGridOptions(){return{idPrefix:this.idPrefix,items:this.getPropertyItems(),mode:1,useCategories:!1,localTextPrefix:"Forms."+this.getFormKey()+"."}}getPropertyItems(){var e=this.getFormKey();return Xa(e)}getSaveEntity(){var e=new Object;return this.propertyGrid&&this.propertyGrid.save(e),e}get_entity(){return this._entity}get_entityId(){return this._entityId}set_entity(e){this._entity=e!=null?e:new Object}set_entityId(e){this._entityId=e}validateBeforeSave(){return this.validator.form()}};Qn=g([m.registerClass("Serenity.PropertyPanel")],Qn);var _t;(o=>{function n(l,u,d,c){var p=u.widgetName;return l.element.bind("ondatachange."+p,function(f,b){c?window.setTimeout(function(){d(f,b)},0):d(f,b)}).bind("remove."+p,function(){l.element.unbind("ondatachange."+p)}),l}o.bindToDataChange=n;function r(l){return l.element.triggerHandler("ondatachange"),l}o.triggerDataChange=r;function e(l){return l.triggerHandler("ondatachange"),l}o.triggerDataChanged=e;function t(l,u,d){return n(l,u,function(c,p){u.element.triggerHandler("ondatachange")},d)}o.bubbleDataChange=t;function i(l,u){return l.element.one("dialogopen",function(d){l.element.dialog().dialog("option","position",a(u))}),l}o.cascade=i;function a(l){return{my:"left top",at:"left+20 top+20",of:l[0]}}o.cascadedDialogOffset=a})(_t||(_t={}));var Vr=class extends xe{constructor(e){super(e);this.useAsync()?this.initAsync():this.initSync()}internalInit(){this.initPropertyGrid(),this.loadInitialEntity()}initSync(){this.propertyItemsData=this.getPropertyItemsData(),this.internalInit(),this.afterInit()}initAsync(){return me(this,null,function*(){this.propertyItemsData=yield this.getPropertyItemsDataAsync(),this.internalInit(),this.afterInit()})}afterInit(){}useAsync(){return!1}destroy(){this.propertyGrid&&(this.propertyGrid.destroy(),this.propertyGrid=null),this.validator&&(this.byId("Form").remove(),this.validator=null),super.destroy()}getDialogOptions(){var e=super.getDialogOptions();return e.width=400,e}getDialogButtons(){return super.getDialogButtons(),[{text:O("Dialogs.OkButton"),cssClass:"btn btn-primary",click:()=>this.okClick()},{text:O("Dialogs.CancelButton"),click:()=>this.cancelClick()}]}okClick(){this.validateBeforeSave()&&this.okClickValidated()}okClickValidated(){this.dialogClose()}cancelClick(){this.dialogClose()}initPropertyGrid(){var e=this.byId("PropertyGrid");if(!(e.length<=0)){var t=this.getPropertyGridOptions();this.propertyGrid=new ze(e,t).init(null),this.element.closest(".ui-dialog").hasClass("s-Flexify")&&this.propertyGrid.element.children(".categories").flexHeightOnly(1)}}getFormKey(){var e=ce(U(this),wt,!0);if(e.length>=1)return e[0].value;var t=se(U(this)),i=t.indexOf(".");return i>=0&&(t=t.substring(i+1)),te(t,"Dialog")?t=t.substr(0,t.length-6):te(t,"Panel")&&(t=t.substr(0,t.length-5)),t}getPropertyGridOptions(){return{idPrefix:this.idPrefix,items:this.getPropertyItems(),mode:1,useCategories:!1,localTextPrefix:"Forms."+this.getFormKey()+"."}}getPropertyItems(){var e;return((e=this.propertyItemsData)==null?void 0:e.items)||[]}getPropertyItemsData(){var e=this.getFormKey();return this.getFormKey===Vr.prototype.getFormKey&&this.getPropertyItems!==Vr.prototype.getPropertyItems&&!he.canLoad("Form."+e)?{items:this.getPropertyItems(),additionalItems:[]}:w(e)?{items:[],additionalItems:[]}:Li(e)}getPropertyItemsDataAsync(){return me(this,null,function*(){var e=this.getFormKey();return w(e)?{items:[],additionalItems:[]}:yield Mi(e)})}getSaveEntity(){var e=new Object;return this.propertyGrid&&this.propertyGrid.save(e),e}loadInitialEntity(){this.propertyGrid&&this.propertyGrid.load(new Object)}get_entity(){return this.entity}set_entity(e){this.entity=e!=null?e:new Object}get_entityId(){return this.entityId}set_entityId(e){this.entityId=e}validateBeforeSave(){return this.validator.form()}updateTitle(){}getFallbackTemplate(){return`<div>
    <div class="s-Form">
        <form id="~_Form" action="">
            <div class="fieldset">
                <div id="~_PropertyGrid"></div>
                <div class="clear"></div>
            </div>
        </form> 
    </div>
</div>`}};Vr=g([m.registerClass("Serenity.PropertyDialog")],Vr);var dt=class extends P{constructor(r){super(r)}get value(){return this.element.val()}get_value(){return this.value}set value(r){this.element.val(r)}set_value(r){this.value=r}};dt=g([m.registerEditor("Serenity.StringEditor",[oe]),m.element('<input type="text"/>')],dt);var Gn=class extends dt{constructor(r){super(r),r.attr("type","password")}};Gn=g([m.registerEditor("Serenity.PasswordEditor")],Gn);var $n=class extends P{constructor(r,e){var t,i;super(r,e),this.options.cols!==0&&r.attr("cols",(t=this.options.cols)!=null?t:80),this.options.rows!==0&&r.attr("rows",(i=this.options.rows)!=null?i:6)}get value(){return this.element.val()}get_value(){return this.value}set value(r){this.element.val(r)}set_value(r){this.value=r}};$n=g([m.registerEditor("Serenity.TextAreaEditor",[oe]),m.element("<textarea />")],$n);var qn=class extends P{get value(){return this.element.is(":checked")}get_value(){return this.value}set value(r){this.element.prop("checked",!!r)}set_value(r){this.value=r}};qn=g([m.registerEditor("Serenity.BooleanEditor",[Gt]),m.element('<input type="checkbox"/>')],qn);var Et=class extends P{constructor(r,e){var i,a;super(r,e),r.addClass("decimalQ");var t=Q(Et.defaultAutoNumericOptions(),{vMin:(i=this.options.minValue)!=null?i:this.options.allowNegatives?this.options.maxValue!=null?"-"+this.options.maxValue:"-999999999999.99":"0.00",vMax:(a=this.options.maxValue)!=null?a:"999999999999.99"});this.options.decimals!=null&&(t.mDec=this.options.decimals),this.options.padDecimals!=null&&(t.aPad=this.options.padDecimals),$.fn.autoNumeric&&r.autoNumeric(t)}get_value(){if($.fn.autoNumeric){var r=this.element.autoNumeric("get");return r==null||r===""?null:parseFloat(r)}var r=this.element.val();return tr(r)}get value(){return this.get_value()}set_value(r){r==null||r===""?this.element.val(""):$.fn.autoNumeric?this.element.autoNumeric("set",r):this.element.val(It(r))}set value(r){this.set_value(r)}get_isValid(){return!isNaN(this.get_value())}static defaultAutoNumericOptions(){return{aDec:F.decimalSeparator,altDec:F.decimalSeparator==="."?",":".",aSep:F.decimalSeparator==="."?",":".",aPad:!0}}};Et=g([m.registerEditor("Serenity.DecimalEditor",[tt]),m.element('<input type="text"/>')],Et);var ui=class extends P{constructor(r,e){var i,a;super(r,e),r.addClass("integerQ");var t=Q(Et.defaultAutoNumericOptions(),{vMin:((i=this.options.minValue)!=null?i:this.options.allowNegatives)?this.options.maxValue!=null?"-"+this.options.maxValue:"-2147483647":"0",vMax:(a=this.options.maxValue)!=null?a:2147483647,aSep:null});$.fn.autoNumeric&&r.autoNumeric(t)}get_value(){if($.fn.autoNumeric){var r=this.element.autoNumeric("get");return mt(r)?null:parseInt(r,10)}else{var r=Y(this.element.val());return r==null?null:st(r)}}get value(){return this.get_value()}set_value(r){r==null||r===""?this.element.val(""):$.fn.autoNumeric?this.element.autoNumeric("set",r):this.element.val(It(r))}set value(r){this.set_value(r)}get_isValid(){return!isNaN(this.get_value())}};ui=g([m.registerEditor("Serenity.IntegerEditor",[tt]),m.element('<input type="text"/>')],ui);var To='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 17 17"><g></g><path d="M14 2v-1h-3v1h-5v-1h-3v1h-3v15h17v-15h-3zM12 2h1v2h-1v-2zM4 2h1v2h-1v-2zM16 16h-15v-8.921h15v8.921zM1 6.079v-3.079h2v2h3v-2h5v2h3v-2h2v3.079h-15z" fill="currentColor"></path></svg>',be=class extends P{constructor(e){var t,i;super(e);typeof flatpickr!="undefined"&&(be.useFlatpickr||!$.fn.datepicker)?flatpickr(e[0],be.flatPickrOptions(e)):(t=$.fn)!=null&&t.datepicker?e.datepicker({showOn:"button",beforeShow:(a,o)=>e.hasClass("readonly")?!1:(be.uiPickerZIndexWorkaround(this.element),!0),yearRange:(i=this.yearRange)!=null?i:"-100:+50"}):e.attr("type","date"),e.on("keyup."+this.uniqueName,a=>{a.which===32&&!this.get_readOnly()?this.get_valueAsDate()!=Ur()&&(this.set_valueAsDate(Ur()),this.element.trigger("change")):be.dateInputKeyup(a)}),e.on("change."+this.uniqueName,be.dateInputChange),rr(e,this.uniqueName,a=>{var o=this.get_value();return w(o)?null:!w(this.get_minValue())&&Lt.stringCompare(ie(o,"yyyy-MM-dd"),ie(this.get_minValue(),"yyyy-MM-dd"))<0?j(O("Validation.MinDate"),ie(this.get_minValue(),null)):!w(this.get_maxValue())&&Lt.stringCompare(ie(o,"yyyy-MM-dd"),ie(this.get_maxValue(),"yyyy-MM-dd"))>0?j(O("Validation.MaxDate"),ie(this.get_maxValue(),null)):null}),this.set_sqlMinMax(!0)}static flatPickrOptions(e){return{clickOpens:!0,allowInput:!0,dateFormat:F.dateOrder.split("").join(F.dateSeparator).replace("y","Y"),onChange:function(){e.triggerHandler("change")}}}get_value(){var t;var e=(t=this.element.val())==null?void 0:t.trim();return e!=null&&e.length?ie(e,"yyyy-MM-dd"):null}get value(){return this.get_value()}set_value(e){e==null?this.element.val(""):e.toLowerCase()==="today"||e.toLowerCase()==="now"?this.element.val(ie(Ur(),this.element.attr("type")==="date"?"yyyy-MM-dd":null)):this.element.val(ie(e,this.element.attr("type")==="date"?"yyyy-MM-dd":null))}set value(e){this.set_value(e)}get_valueAsDate(){return w(this.get_value())?null:qe(this.get_value())}get valueAsDate(){return this.get_valueAsDate()}set_valueAsDate(e){e==null&&this.set_value(null),this.set_value(ie(e,"yyyy-MM-dd"))}set valueAsDate(e){this.set_valueAsDate(e)}get_readOnly(){return this.element.hasClass("readonly")}set_readOnly(e){e!==this.get_readOnly()&&(e?(this.element.addClass("readonly").attr("readonly","readonly"),this.element.nextAll(".ui-datepicker-trigger").css("opacity","0.1")):(this.element.removeClass("readonly").removeAttr("readonly"),this.element.nextAll(".ui-datepicker-trigger").css("opacity","1")))}get_minValue(){return this.minValue}set_minValue(e){this.minValue=e}get_maxValue(){return this.maxValue}set_maxValue(e){this.maxValue=e}get_minDate(){return qe(this.get_minValue())}set_minDate(e){this.set_minValue(ie(e,"yyyy-MM-dd"))}get_maxDate(){return qe(this.get_maxValue())}set_maxDate(e){this.set_maxValue(ie(e,"yyyy-MM-dd"))}get_sqlMinMax(){return this.get_minValue()==="1753-01-01"&&this.get_maxValue()==="9999-12-31"}set_sqlMinMax(e){e?(this.set_minValue("1753-01-01"),this.set_maxValue("9999-12-31")):(this.set_minValue(null),this.set_maxValue(null))}static flatPickrTrigger(e){return $('<i class="ui-datepicker-trigger" href="javascript:;">'+To+"</i>").insertAfter(e).click(()=>{e.hasClass("readonly")||e[0]._flatpickr.open()})}static dateInputKeyup(e){var o;if(F.dateOrder!=="dmy")return;var t=$(e.target);if(!t.is(":input")||t.attr("type")=="date"||t.is("[readonly]")||t.is(":disabled"))return;var i=(o=t.val())!=null?o:"";if(i.length===0||t[0].selectionEnd!==i.length)return;if(i.indexOf(F.dateSeparator+F.dateSeparator)!==-1){t.val(Ie(i,F.dateSeparator+F.dateSeparator,F.dateSeparator));return}function a(l){return l>=48&&l<=57}if(e.which===47||e.which===111){if(i.length>=2&&i.charAt(i.length-1)===F.dateSeparator&&i.charAt(i.length-2)===F.dateSeparator){t.val(i.substr(0,i.length-1));return}if(i.charAt(i.length-1)!==F.dateSeparator)return;switch(i.length){case 2:if(a(i.charCodeAt(0))){i="0"+i;break}else return;case 4:if(a(i.charCodeAt(0))&&a(i.charCodeAt(2))&&i.charAt(1)==F.dateSeparator){i="0"+i.charAt(0)+F.dateSeparator+"0"+i.charAt(2)+F.dateSeparator;break}else return;case 5:if(a(i.charCodeAt(0))&&a(i.charCodeAt(2))&&a(i.charCodeAt(3))&&i.charAt(1)===F.dateSeparator){i="0"+i;break}else if(a(i.charCodeAt(0))&&a(i.charCodeAt(1))&&a(i.charCodeAt(3))&&i.charAt(2)===F.dateSeparator){i=i.charAt(0)+i.charAt(1)+F.dateSeparator+"0"+i.charAt(3)+F.dateSeparator;break}else break;default:return}t.val(i)}if(i.length<6&&(e.which>=48&&e.which<=57||e.which>=96&&e.which<=105)&&a(i.charCodeAt(i.length-1))){switch(i.length){case 1:{if(i.charCodeAt(0)<=51)return;i="0"+i;break}case 2:{if(!a(i.charCodeAt(0)))return;break}case 3:{if(!a(i.charCodeAt(0))||i.charAt(1)!==F.dateSeparator||i.charCodeAt(2)<=49)return;i="0"+i.charAt(0)+F.dateSeparator+"0"+i.charAt(2);break}case 4:if(i.charAt(1)==F.dateSeparator){if(!a(i.charCodeAt(0))||!a(i.charCodeAt(2)))return;i="0"+i;break}else if(i.charAt(2)==F.dateSeparator){if(!a(i.charCodeAt(0))||!a(i.charCodeAt(1))||i.charCodeAt(3)<=49)return;i=i.charAt(0)+i.charAt(1)+F.dateSeparator+"0"+i.charAt(3);break}else return;case 5:{if(i.charAt(2)!==F.dateSeparator||!a(i.charCodeAt(0))||!a(i.charCodeAt(1))||!a(i.charCodeAt(3)))return;break}default:return}t.val(i+F.dateSeparator)}}static uiPickerZIndexWorkaround(e){if(e!=null&&e.closest(".ui-dialog").length){var t=parseInt(e.closest(".ui-dialog").css("z-index"),10);t==null||isNaN(t)||setTimeout(()=>{var i=e.datepicker("widget");if(i!=null&&i.length){var a=parseInt(i.css("z-index"));!isNaN(a)&&a<=t&&i.css("z-index",t+1)}},0)}}};be.dateInputChange=function(e){var l,u;if(F.dateOrder==="dmy"){var t=$(e.target);if(!(!t.is(":input")||t.attr("type")=="date")){var i=(l=t.val())!=null?l:"",a={};if(i.length>=6&&/^[0-9]*$/g.test(i)&&t.val(i.substr(0,2)+F.dateSeparator+i.substr(2,2)+F.dateSeparator+i.substr(4)),i=(u=t.val())!=null?u:"",i.length>=5){var o=je(i);o&&!isNaN(o.valueOf())&&t.val(ie(o,null))}}}},g([m.option()],be.prototype,"yearRange",2),g([m.option()],be.prototype,"get_minValue",1),g([m.option()],be.prototype,"get_maxValue",1),g([m.option()],be.prototype,"get_maxDate",1),g([m.option()],be.prototype,"get_sqlMinMax",1),be=g([m.registerEditor("Serenity.DateEditor",[oe,pe]),m.element('<input type="text"/>')],be);function xo(){var t,i;if(!((i=(t=$.datepicker)==null?void 0:t.regional)!=null&&i.en))return!1;let n=F.dateOrder,r=F.dateSeparator,e=($("html").attr("lang")||"en").toLowerCase();return $.datepicker.regional[e]||(e=e.split("-")[0],$.datepicker.regional[e]||(e="en")),$.datepicker.setDefaults($.datepicker.regional.en),$.datepicker.setDefaults($.datepicker.regional[e]),$.datepicker.setDefaults({dateFormat:n=="mdy"?"mm"+r+"dd"+r+"yy":n=="ymd"?"yy"+r+"mm"+r+"dd":"dd"+r+"mm"+r+"yy",buttonImage:"data:image/svg+xml,"+encodeURIComponent(To),buttonImageOnly:!0,showOn:"both",showButtonPanel:!0,changeMonth:!0,changeYear:!0}),$.ui&&$.ui.version<="1.12.1"&&$.datepicker.setDefaults({buttonImage:null,buttonImageOnly:!1,buttonText:'<i class="fa fa-calendar"></i>'}),!0}typeof $!="undefined"&&$.fn&&!xo()&&$(xo);var Be=class extends P{constructor(e,t){var l,u,d,c,p;super(e,t);if(e.addClass("s-DateTimeEditor"),this.options.inputOnly)e.addClass("dateTimeQ");else if(typeof flatpickr!="undefined"&&(be.useFlatpickr||!$.fn.datepicker||this.options.seconds))e.addClass("dateTimeQ"),flatpickr(e[0],this.getFlatpickrOptions());else if((l=$.fn)!=null&&l.datepicker){e.addClass("dateQ"),e.datepicker({showOn:"button",beforeShow:function(){return e.hasClass("readonly")?!1:(be.uiPickerZIndexWorkaround(this.element),!0)},yearRange:(u=this.options.yearRange)!=null?u:"-100:+50"}),e.bind("change."+this.uniqueName,f=>{this.lastSetValue=null,be.dateInputChange(f)}),this.time=$("<select/>").addClass("editor s-DateTimeEditor time");var i=e.next(".ui-datepicker-trigger");i.length>0?this.time.insertAfter(i):(i=e.prev(".ui-datepicker-trigger"),i.length>0?this.time.insertBefore(i):this.time.insertAfter(e)),this.time.on("change",function(f){this.lastSetValue=null,e.triggerHandler("change")});var a=Be.getTimeOptions((d=this.options.startHour)!=null?d:0,0,(c=this.options.endHour)!=null?c:23,59,(p=this.options.intervalMinutes)!=null?p:5);for(var o of a)Cr(this.time,o,o);rr(e,this.uniqueName,f=>{var b=this.get_value();return w(b)?null:!w(this.get_minValue())&&Lt.stringCompare(b,this.get_minValue())<0?j(O("Validation.MinDate"),ie(this.get_minValue(),null)):!w(this.get_maxValue())&&Lt.stringCompare(b,this.get_maxValue())>0?j(O("Validation.MaxDate"),ie(this.get_maxValue(),null)):null})}else e.attr("type","datetime").addClass("dateTimeQ");e.bind("keyup."+this.uniqueName,f=>{if(!this.get_readOnly()&&this.time)if(f.which===32)this.get_valueAsDate()!==new Date&&(this.set_valueAsDate(new Date),this.element.trigger("change"));else{var b=this.element.val();be.dateInputKeyup(f),b!=this.element.val()&&(this.lastSetValue=null)}}),this.set_sqlMinMax(!0),this.options.inputOnly||$("<i class='inplace-button inplace-now'><b></b></div>").attr("title",this.getInplaceNowText()).insertAfter(this.time).click(f=>{this.element.hasClass("readonly")||(this.lastSetValue=null,this.set_valueAsDate(new Date),e.triggerHandler("change"))})}getFlatpickrOptions(){var e;return{clickOpens:!0,allowInput:!0,enableTime:!0,time_24hr:!0,enableSeconds:!!this.options.seconds,minuteIncrement:(e=this.options.intervalMinutes)!=null?e:5,dateFormat:F.dateOrder.split("").join(F.dateSeparator).replace("y","Y")+" H:i"+(this.options.seconds?":S":""),onChange:()=>{this.lastSetValue=null,this.element&&this.element.triggerHandler("change")}}}get_value(){var e=this.element.val().trim();if(e!=null&&e.length===0)return null;var t;if(this.time){var i=ie(e,"yyyy-MM-dd"),a=this.time.val();t=i+"T"+a+":00.000"}else t=ie(je(this.element.val()),"yyyy-MM-ddTHH:mm:ss.fff");return this.options.useUtc&&(t=Zs(qe(t))),this.lastSetValue!=null&&this.lastSetValueGet==t?this.lastSetValue:t}get value(){return this.get_value()}set_value(e){var i;if(w(e))this.element.val(""),this.time&&this.time.val("00:00");else if(e.toLowerCase()==="today")this.time?(this.element.val(ie(Ur(),null)),this.time.val("00:00")):this.element.val(this.getDisplayFormat());else{var t=e.toLowerCase()==="now"?new Date:qe(e);this.time?(t=Be.roundToMinutes(t,(i=this.options.intervalMinutes)!=null?i:5),this.element.val(ie(t,null)),this.time.val(ie(t,"HH:mm"))):this.element.val(ie(t,this.getDisplayFormat()))}this.lastSetValue=null,!w(e)&&e.toLowerCase()!="today"&&e.toLowerCase()!="now"&&(this.lastSetValueGet=this.get_value(),this.lastSetValue=e)}getInplaceNowText(){var e;return(e=V("Controls.DateTimeEditor.SetToNow"))!=null?e:"set to now"}getDisplayFormat(){return this.options.seconds?F.dateTimeFormat:F.dateTimeFormat.replace(":ss","")}set value(e){this.set_value(e)}get_valueAsDate(){return w(this.get_value())?null:qe(this.get_value())}get valueAsDate(){return this.get_valueAsDate()}set_valueAsDate(e){e==null&&this.set_value(null),this.set_value(ie(e,"yyyy-MM-ddTHH:mm"+(this.options.seconds?":ss":"")))}set valueAsDate(e){this.set_valueAsDate(e)}get_minValue(){return this.minValue}set_minValue(e){this.minValue=e}get_maxValue(){return this.maxValue}set_maxValue(e){this.maxValue=e}get_minDate(){return qe(this.get_minValue())}set_minDate(e){this.set_minValue(ie(e,"yyyy-MM-ddTHH:mm:ss"))}get_maxDate(){return qe(this.get_maxValue())}set_maxDate(e){this.set_maxValue(ie(e,"yyyy-MM-ddTHH:mm:ss"))}get_sqlMinMax(){return this.get_minValue()==="1753-01-01"&&this.get_maxValue()==="9999-12-31"}set_sqlMinMax(e){e?(this.set_minValue("1753-01-01"),this.set_maxValue("9999-12-31")):(this.set_minValue(null),this.set_maxValue(null))}get_readOnly(){return this.element.hasClass("readonly")}set_readOnly(e){e!==this.get_readOnly()&&(e?(this.element.addClass("readonly").attr("readonly","readonly"),this.element.nextAll(".ui-datepicker-trigger").css("opacity","0.1"),this.element.nextAll(".inplace-now").css("opacity","0.1")):(this.element.removeClass("readonly").removeAttr("readonly"),this.element.nextAll(".ui-datepicker-trigger").css("opacity","1"),this.element.nextAll(".inplace-now").css("opacity","1")),this.time&&q.setReadonly(this.time,e))}static roundToMinutes(e,t){e=new Date(e.getTime());var i=Xs(Ri(e.getMinutes()/t)*t);return e.setMinutes(i),e.setSeconds(0),e.setMilliseconds(0),e}};Be.getTimeOptions=function(e,t,i,a,o){var l=[];i>=23&&(i=23),a>=60&&(a=59);for(var u=e,d=t;!(u>i||u===i&&d>a);){var c=(u>=10?"":"0")+u+":"+(d>=10?"":"0")+d;l.push(c),d+=o,d>=60&&(d-=60,u++)}return l},g([m.option()],Be.prototype,"get_minValue",1),g([m.option()],Be.prototype,"get_maxValue",1),g([m.option()],Be.prototype,"get_maxDate",1),g([m.option()],Be.prototype,"get_sqlMinMax",1),Be=g([m.registerEditor("Serenity.DateTimeEditor",[oe,pe]),m.element('<input type="text"/>')],Be);var Hn=class extends P{constructor(e,t){super(e,t);e.addClass("editor s-TimeEditor hour"),this.options.noEmptyOption||Cr(e,"","--");for(var i=this.options.startHour||0;i<=(this.options.endHour||23);i++)Cr(e,i.toString(),i<10?"0"+i:i.toString());this.minutes=$("<select/>").addClass("editor s-TimeEditor minute").insertAfter(e),this.minutes.change(()=>this.element.trigger("change"));for(var a=0;a<=59;a+=this.options.intervalMinutes||5)Cr(this.minutes,a.toString(),a<10?"0"+a:a.toString())}get value(){var e=Ni(this.element.val()),t=Ni(this.minutes.val());return e==null||t==null?null:e*60+t}get_value(){return this.value}set value(e){e?(this.element.val(Math.floor(e/60).toString()),this.minutes.val(e%60)):this.options.noEmptyOption?(this.element.val(this.options.startHour),this.minutes.val("0")):(this.element.val(""),this.minutes.val("0"))}set_value(e){this.value=e}get_readOnly(){return this.element.hasClass("readonly")}set_readOnly(e){e!==this.get_readOnly()&&(e?this.element.addClass("readonly").attr("readonly","readonly"):this.element.removeClass("readonly").removeAttr("readonly"),q.setReadonly(this.minutes,e))}};Hn=g([m.registerEditor("Serenity.TimeEditor",[tt,pe]),m.element("<select />")],Hn);var di=class extends P{constructor(r,e){super(r,e),di.registerValidationMethods(),r.addClass("emailuser");var t=$("<span/>").text("@").addClass("emailat").insertAfter(r),i=$('<input type="text"/>').addClass("emaildomain").insertAfter(t);i.bind("blur."+this.uniqueName,function(){var a=i.closest("form").data("validator");a!=null&&a.element(r[0])}),w(this.options.domain)||i.val(this.options.domain),this.options.readOnlyDomain&&i.attr("readonly","readonly").addClass("disabled").attr("tabindex","-1"),r.bind("keypress."+this.uniqueName,a=>{a.which===64&&(a.preventDefault(),this.options.readOnlyDomain||(i.focus(),i.select()))}),i.bind("keypress."+this.uniqueName,function(a){a.which===64&&a.preventDefault()}),this.options.readOnlyDomain||r.change(a=>this.set_value(r.val()))}static registerValidationMethods(){var r;!$.validator||!$.validator.methods||$.validator.methods.emailuser!=null||$.validator.addMethod("emailuser",function(e,t){var i=$(t).nextAll(".emaildomain");return i.length>0&&i.attr("readonly")==null?this.optional(t)&&this.optional(i[0])?!0:$.validator.methods.email.call(this,e+"@"+i.val(),t):$.validator.methods.email.call(this,e+"@dummy.com",t)},(r=V("Validation.Email"))!=null?r:$.validator.messages.email)}get_value(){var r=this.element.nextAll(".emaildomain"),e=this.element.val(),t=r.val();return w(e)?this.options.readOnlyDomain||w(t)?"":"@"+t:e+"@"+t}get value(){return this.get_value()}set_value(r){var e=this.element.nextAll(".emaildomain");if(r=Y(r),r==null)this.options.readOnlyDomain||e.val(""),this.element.val("");else{var t=r.split("@");t.length>1?this.options.readOnlyDomain?w(this.options.domain)?this.element.val(t[0]):t[1]!==this.options.domain?this.element.val(r):this.element.val(t[0]):(e.val(t[1]),this.element.val(t[0])):this.element.val(t[0])}}set value(r){this.set_value(r)}get_readOnly(){var r=this.element.nextAll(".emaildomain");return!(this.element.attr("readonly")==null&&(!this.options.readOnlyDomain||r.attr("readonly")==null))}set_readOnly(r){var e=this.element.nextAll(".emaildomain");r?(this.element.attr("readonly","readonly").addClass("readonly"),this.options.readOnlyDomain||e.attr("readonly","readonly").addClass("readonly")):(this.element.removeAttr("readonly").removeClass("readonly"),this.options.readOnlyDomain||e.removeAttr("readonly").removeClass("readonly"))}};di=g([m.registerEditor("Serenity.EmailEditor",[oe,pe]),m.element('<input type="text"/>')],di);var Wn=class extends dt{constructor(r){super(r),r.attr("type","email").addClass("email")}};Wn=g([m.registerEditor("Serenity.EmailAddressEditor")],Wn);var Jn=class extends dt{constructor(r){super(r),r.addClass("url").attr("title","URL should be entered in format: 'http://www.site.com/page'."),r.on("blur."+this.uniqueName,e=>{var t=r.closest("form").data("validator");if(t!=null&&r.hasClass("error")){var i=Y(r.val());i&&(i="http://"+i,$.validator.methods.url.call(t,i,r[0])==!0&&(r.val(i),t.element(r)))}})}};Jn=g([m.registerEditor("Serenity.URLEditor",[oe])],Jn);var zn=class extends P{constructor(r,e){var v;if(super(r,e),!(w(this.options.enumKey)&&this.options.enumType==null&&w(this.options.lookupKey)))if(w(this.options.lookupKey)){var d=this.options.enumType||ur.get(this.options.enumKey),c=this.options.enumKey;if(c==null&&d!=null){var p=ce(d,Ye,!1);p.length>0&&(c=p[0].value)}var f=gt.getValues(d);for(var b of f){var x=gt.toString(d,b);this.addRadio(b.toString(),(v=V("Enums."+c+"."+x))!=null?v:x)}}else{var t=Or(this.options.lookupKey);for(var i of t.items){var a=i[t.textField],o=a==null?"":a.toString(),l=i[t.idField],u=l==null?"":l.toString();this.addRadio(u,o)}}}addRadio(r,e){var t=$("<label/>").text(e);$('<input type="radio"/>').attr("name",this.uniqueName).attr("id",this.uniqueName+"_"+r).attr("value",r).prependTo(t),t.appendTo(this.element)}get_value(){return this.element.find("input:checked").first().val()}get value(){return this.get_value()}set_value(r){if(r!==this.get_value()){var e=this.element.find("input"),t=e.filter(":checked");t.length>0&&(t[0].checked=!1),w(r)||(t=e.filter("[value="+r+"]"),t.length>0&&(t[0].checked=!0))}}set value(r){this.set_value(r)}get_readOnly(){return this.element.attr("disabled")!=null}set_readOnly(r){this.get_readOnly()!==r&&(r?this.element.attr("disabled","disabled").find("input").attr("disabled","disabled"):this.element.removeAttr("disabled").find("input").removeAttr("disabled"))}};zn=g([m.registerEditor("Serenity.RadioButtonEditor",[oe,pe]),m.element("<div/>")],zn);var bu=typeof Select2!="undefined"?Select2:void 0,ci=bu;var Re=class extends P{constructor(e,t){super(e,t);this._items=[],this._itemById={};var i=this.emptyItemText();i!=null&&e.attr("placeholder",i);var a=this.getSelect2Options();e.select2(a),e.attr("type","text"),e.on("change."+this.uniqueName,(o,l)=>{l!==!0&&e.closest("form").data("validator")&&e.valid()}),this.setCascadeFrom(this.options.cascadeFrom),this.useInplaceAdd()&&this.addInplaceCreate(O("Controls.SelectEditor.InplaceAdd"),null)}destroy(){var e,t,i,a;(t=(e=this.initSelectionPromise)==null?void 0:e.abort)==null||t.call(e),this.abortPendingQuery(),(a=(i=this.element)==null?void 0:i.select2)==null||a.call(i,"destroy"),super.destroy()}hasAsyncSource(){return!1}asyncSearch(e,t){return t({items:[],more:!1}),null}getTypeDelay(){var e;return(e=this.options.typeDelay)!=null?e:200}emptyItemText(){var e;return(e=this.element.attr("placeholder"))!=null?e:O("Controls.SelectEditor.EmptyItemText")}getPageSize(){var e;return(e=this.options.pageSize)!=null?e:100}getIdField(){return this.options.idField}itemId(e){var t=e[this.getIdField()];return t==null?"":t.toString()}getTextField(){var e;return(e=this.options.textField)!=null?e:this.getIdField()}itemText(e){var t=e[this.getTextField()];return t==null?"":t.toString()}itemDisabled(e){return!1}mapItem(e){return{id:this.itemId(e),text:this.itemText(e),disabled:this.itemDisabled(e),source:e}}mapItems(e){return e.map(this.mapItem.bind(this))}allowClear(){return this.options.allowClear!=null?!!this.options.allowClear:this.emptyItemText()!=null}isMultiple(){return!!this.options.multiple}abortPendingQuery(){var e,t;(t=(e=this.queryPromise)==null?void 0:e.abort)==null||t.call(e),this.queryPromise=null,this.typeTimeout&&(clearTimeout(this.typeTimeout),this.typeTimeout=null)}getSelect2Options(){var e=this.emptyItemText(),t={multiple:this.isMultiple(),placeHolder:w(e)?null:e,allowClear:this.allowClear(),createSearchChoicePosition:"bottom"};return this.hasAsyncSource()?(t.query=i=>{var u,d;var a=this.getPageSize(),o={searchTerm:Y(i.term),skip:(i.page-1)*a,take:a,checkMore:!0};this.abortPendingQuery();var l=$(this.element).data("select2");(d=(u=l==null?void 0:l.search)==null?void 0:u.removeClass)==null||d.call(u,"select2-active").parent().removeClass("select2-active"),this.typeTimeout=setTimeout(()=>{var c,p,f,b,x;this.abortPendingQuery(),(p=(c=l==null?void 0:l.search)==null?void 0:c.addClass)==null||p.call(c,"select2-active").parent().addClass("select2-active"),this.queryPromise=this.asyncSearch(o,v=>{var I,S;(S=(I=l==null?void 0:l.search)==null?void 0:I.removeClass)==null||S.call(I,"select2-active").parent().removeClass("select2-active"),this.queryPromise=null,i.callback({results:this.mapItems(v.items),more:v.more})}),(x=((f=this.queryPromise)==null?void 0:f.catch)||((b=this.queryPromise)==null?void 0:b.fail))==null||x.call(this.queryPromise,()=>{var v,I;this.queryPromise=null,(I=(v=l==null?void 0:l.search)==null?void 0:v.removeClass)==null||I.call(v,"select2-active").parent().removeClass("select2-active")})},i.term?this.getTypeDelay():0)},t.initSelection=(i,a)=>{var c,p,f;var o=i.val();if(o==null||o==""){a(null);return}var l=this.isMultiple(),u=l?o.split(","):[o],d={idList:u};(p=(c=this.initSelectionPromise)==null?void 0:c.abort)==null||p.call(c),this.initSelectionPromise=this.asyncSearch(d,b=>{if(this.initSelectionPromise=null,l){var x=(b.items||[]).map(S=>this.mapItem(S));this._itemById=this._itemById||{};for(var v of x)this._itemById[v.id]=v;if(this.isAutoComplete&&x.length!=u.length)for(var I of u)Nt(x,S=>S.id==I)||x.push({id:I,text:I});a(x)}else if(!b.items||!b.items.length)this.isAutoComplete?a({id:o,text:o}):a(null);else{var v=this.mapItem(b.items[0]);this._itemById=this._itemById||{},this._itemById[v.id]=v,a(v)}}),(f=this.initSelectionPromise.catch||this.initSelectionPromise.fail)==null||f.call(this.initSelectionPromise,()=>{this.initSelectionPromise=null})}):(t.data=this._items,t.query=i=>{var a=Re.filterByText(this._items,l=>l.text,i.term),o=this.getPageSize();i.callback({results:a.slice((i.page-1)*o,i.page*o),more:a.length>=i.page*o})},t.initSelection=(i,a)=>{var o=i.val(),l=this.isAutoComplete();if(this.isMultiple()){var u=[];for(var d of o.split(",")){var c=this._itemById[d];c==null&&l&&(c={id:d,text:d},this.addItem(c)),c!=null&&u.push(c)}a(u);return}var p=this._itemById[o];p==null&&l&&(p={id:o,text:o},this.addItem(p)),a(p)}),this.options.minimumResultsForSearch!=null&&(t.minimumResultsForSearch=this.options.minimumResultsForSearch),(this.isAutoComplete()||this.useInplaceAdd())&&(t.createSearchChoice=this.getCreateSearchChoice(null)),t}get_delimited(){return!!this.options.delimited}get items(){if(this.hasAsyncSource())throw new Error("Can't read items property of an async select editor!");return this._items||[]}set items(e){if(this.hasAsyncSource())throw new Error("Can't set items of an async select editor!");this._items=e||[],this._itemById={};for(var t of this._items)this._itemById[t.id]=t}get itemById(){if(this.hasAsyncSource())throw new Error("Can't read items property of an async select editor!");return this._itemById}set itemById(e){if(this.hasAsyncSource())throw new Error("Can't set itemById of an async select editor!");this._itemById=e||{}}clearItems(){if(this.hasAsyncSource())throw new Error("Can't clear items of an async select editor!");this._items.length=0,this._itemById={}}addItem(e){if(this.hasAsyncSource())throw new Error("Can't add item to an async select editor!");this._items.push(e),this._itemById[e.id]=e}addOption(e,t,i,a){this.addItem({id:e,text:t,source:i,disabled:a})}addInplaceCreate(e,t){var i=this;e=e!=null?e:O("Controls.SelectEditor.InplaceAdd"),t=t!=null?t:O("Controls.SelectEditor.InplaceEdit");var a=$("<a><b/></a>").addClass("inplace-button inplace-create").attr("title",e).insertAfter(this.element).click(function(o){i.inplaceCreateClick(o)});this.get_select2Container().add(this.element).addClass("has-inplace-button"),this.element.change(()=>{var o=this.isMultiple()||w(this.get_value());a.attr("title",o?e:t).toggleClass("edit",!o)}),this.element.change((o,l)=>{if(l!==!0)if(this.isMultiple()){var u=this.get_values();u.length>0&&u[u.length-1]==(-2147483648).toString()&&(this.set_values(u.slice(0,u.length-1)),this.inplaceCreateClick(o))}else this.get_value()==(-2147483648).toString()&&(this.set_value(null),this.inplaceCreateClick(o))}),this.isMultiple()&&this.get_select2Container().on("dblclick."+this.uniqueName,".select2-search-choice",o=>{var l=$(o.target);l.hasClass("select2-search-choice")||(l=l.closest(".select2-search-choice"));var u=l.index(),d=this.get_values();u<0||u>=this.get_values().length||(o.editItem=d[u],this.inplaceCreateClick(o))})}useInplaceAdd(){return!this.isAutoComplete()&&this.options.inplaceAdd&&(this.options.inplaceAddPermission==null||ae.hasPermission(this.options.inplaceAddPermission))}isAutoComplete(){return!!this.options.autoComplete}getCreateSearchChoice(e){return t=>{var a;if(this.lastCreateTerm=t,t=((a=ci.util.stripDiacritics(t))!=null?a:"").toLowerCase(),mt(t))return null;var i=!1;return Nt(this._items||[],o=>{var l=e?e(o.source):o.text;return ci.util.stripDiacritics(l!=null?l:"").toLowerCase()==t})?null:Nt(this._items||[],o=>{var l;return((l=ci.util.stripDiacritics(o.text))!=null?l:"").toLowerCase().indexOf(t)!==-1})?this.isAutoComplete()?{id:this.lastCreateTerm,text:this.lastCreateTerm}:{id:(-2147483648).toString(),text:O("Controls.SelectEditor.ClickToDefine")}:this.isAutoComplete()?{id:this.lastCreateTerm,text:this.lastCreateTerm}:{id:(-2147483648).toString(),text:O("Controls.SelectEditor.NoResultsClickToDefine")}}}setEditValue(e,t){var i=e[t.name];Array.isArray(i)?this.set_values(i):this.set_value(i==null?null:i.toString())}getEditValue(e,t){!this.isMultiple()||this.get_delimited()?t[e.name]=this.get_value():t[e.name]=this.get_values()}get_select2Container(){return this.element.prevAll(".select2-container")}get_items(){return this.items}get_itemByKey(){return this.itemById}static filterByText(e,t,i){if(i==null||i.length==0)return e;i=ci.util.stripDiacritics(i).toUpperCase();var a=[];function o(l){var u=t(l);return u==null||!u.length?!1:(u=ci.util.stripDiacritics(u).toUpperCase(),G(u,i)?!0:(u.indexOf(i)>=0&&a.push(l),!1))}return e.filter(o).concat(a)}get_value(){var e;if(this.element.data("select2")){if(e=this.element.select2("val"),e!=null&&Array.isArray(e))return e.join(",")}else e=this.element.val();return e}get value(){return this.get_value()}set_value(e){if(e!=this.get_value()){var t=e;!w(e)&&this.isMultiple()&&(t=e.split(String.fromCharCode(44)).map(function(a){return Y(a)}).filter(function(a){return a!=null}));var i=this.element;i.select2("val",t),i.data("select2-change-triggered",!0);try{i.triggerHandler("change",[!0])}finally{i.data("select2-change-triggered",!1)}this.updateInplaceReadOnly()}}set value(e){this.set_value(e)}get selectedItem(){let e=this.get_value();if(e&&this._itemById){let t=this._itemById[e];if(t)return t.source}return null}get selectedItems(){let e=this.values;var t=[];for(var i of e)if(i&&this._itemById){let a=this._itemById[i];a&&a.source?t.push(a.source):t.push(null)}return t}get_values(){var e=this.element.select2("val");if(e==null)return[];if(Array.isArray(e))return e;var t=e;return w(t)?[]:[t]}get values(){return this.get_values()}set_values(e){if(e==null||e.length===0){this.set_value(null);return}this.set_value(e.join(","))}set values(e){this.set_values(e)}get_text(){var e;return((e=this.element.select2("data"))!=null?e:{}).text}get text(){return this.get_text()}get_readOnly(){return!w(this.element.attr("readonly"))}get readOnly(){return this.get_readOnly()}updateInplaceReadOnly(){var e=this.get_readOnly()&&(this.isMultiple()||!this.value);this.element.nextAll(".inplace-create").attr("disabled",e?"disabled":"").css("opacity",e?"0.1":"").css("cursor",e?"default":"")}set_readOnly(e){e!==this.get_readOnly()&&(this.element.attr("readonly",e?"readonly":null),this.updateInplaceReadOnly())}set readOnly(e){this.set_readOnly(e)}getCascadeFromValue(e){return q.getValue(e)}setCascadeFrom(e){if(w(e)){this.cascadeLink!=null&&(this.cascadeLink.set_parentID(null),this.cascadeLink=null),this.options.cascadeFrom=null;return}this.cascadeLink=new cr(P,this,t=>{this.set_cascadeValue(this.getCascadeFromValue(t))}),this.cascadeLink.set_parentID(e),this.options.cascadeFrom=e}get_cascadeFrom(){return this.options.cascadeFrom}get cascadeFrom(){return this.get_cascadeFrom()}set_cascadeFrom(e){e!==this.options.cascadeFrom&&(this.setCascadeFrom(e),this.updateItems())}set cascadeFrom(e){this.set_cascadeFrom(e)}get_cascadeField(){var e;return(e=this.options.cascadeField)!=null?e:this.options.cascadeFrom}get cascadeField(){return this.get_cascadeField()}set_cascadeField(e){this.options.cascadeField=e}set cascadeField(e){this.set_cascadeField(e)}get_cascadeValue(){return this.options.cascadeValue}get cascadeValue(){return this.get_cascadeValue()}set_cascadeValue(e){this.options.cascadeValue!==e&&(this.options.cascadeValue=e,this.set_value(null),this.updateItems())}set cascadeValue(e){this.set_cascadeValue(e)}get_filterField(){return this.options.filterField}get filterField(){return this.get_filterField()}set_filterField(e){this.options.filterField=e}set filterField(e){this.set_filterField(e)}get_filterValue(){return this.options.filterValue}get filterValue(){return this.get_filterValue()}set_filterValue(e){this.options.filterValue!==e&&(this.options.filterValue=e,this.set_value(null),this.updateItems())}set filterValue(e){this.set_filterValue(e)}cascadeItems(e){var t=this.get_cascadeValue();if(t==null||t==="")return w(this.get_cascadeField())?e:[];var i=t.toString(),a=this.get_cascadeField();return e.filter(o=>{var u;var l=(u=o[a])!=null?u:lt.getPropertyValue(o,a);return l!=null&&l.toString()===i})}filterItems(e){var t=this.get_filterValue();if(t==null||t==="")return e;var i=t.toString(),a=this.get_filterField();return e.filter(o=>{var u;var l=(u=o[a])!=null?u:lt.getPropertyValue(o,a);return l!=null&&l.toString()===i})}updateItems(){}getDialogTypeKey(){return this.options.dialogType!=null?this.options.dialogType:null}createEditDialog(e){var t=this.getDialogTypeKey(),i=Lr.get(t);P.create({type:i,init:a=>e(a)})}initNewEntity(e){w(this.get_cascadeField())||(e[this.get_cascadeField()]=this.get_cascadeValue()),w(this.get_filterField())||(e[this.get_filterField()]=this.get_filterValue()),this.onInitNewEntity!=null&&this.onInitNewEntity(e)}setEditDialogReadOnly(e){e.element&&e.element.find(".tool-button.delete-button").addClass("disabled").unbind("click")}editDialogDataChange(){}setTermOnNewEntity(e,t){}inplaceCreateClick(e){this.get_readOnly()&&(this.isMultiple()&&!e.editItem||!this.value)||this.createEditDialog(t=>{this.get_readOnly()&&this.setEditDialogReadOnly(t),_t.bindToDataChange(t,this,(o,l)=>{if(this.editDialogDataChange(),this.updateItems(),this.lastCreateTerm=null,(l.type==="create"||l.type==="update")&&l.entityId!=null){var u=l.entityId.toString();if(this.isMultiple()){var d=this.get_values().slice();d.indexOf(u)<0&&d.push(u),this.set_values(null),this.set_values(d.slice())}else this.set_value(null),this.set_value(u)}else if(this.isMultiple()&&l.type==="delete"&&l.entityId!=null){var c=l.entityId.toString(),p=this.get_values().slice(),f=p.indexOf(c);f>=0&&p.splice(f,1),this.set_values(p.slice())}else this.isMultiple()||this.set_value(null)},!0);var i=e.editItem;if(i!=null)t.load(i,()=>{t.dialogOpen(this.openDialogAsPanel)},null);else if(this.isMultiple()||w(this.get_value())){var a={};this.setTermOnNewEntity(a,Yr(this.lastCreateTerm)),this.initNewEntity(a),t.load(a,()=>{t.dialogOpen(this.openDialogAsPanel)},null)}else t.load(this.get_value(),()=>{t.dialogOpen(this.openDialogAsPanel)},null)})}};Re=g([m.registerClass("Serenity.Select2Editor",[it,rt,oe,pe]),m.element('<input type="hidden"/>')],Re);var pr=class extends Re{constructor(r,e){super(r,e),this.updateItems()}getItems(){return this.options.items||[]}emptyItemText(){return w(this.options.emptyOptionText)?super.emptyItemText():this.options.emptyOptionText}updateItems(){var o;var r=this.getItems();if(this.clearItems(),r.length>0){var e=typeof r[0]=="string";for(var t of r){var i=e?t:t[0],a=e?t:(o=t[1])!=null?o:t[0];this.addOption(i,a,t,!1)}}}};pr=g([m.registerClass("Serenity.SelectEditor")],pr);var Un=class extends pr{constructor(r,e){super(r,e),this.updateItems()}getItems(){var l,u;var r=this.options;if(r.items!=null&&r.items.length>=1)return r.items;var e=[],t=new Date().getFullYear(),i=new Date().getFullYear();if(r.minYear=((l=r.minYear)!=null?l:"-10").toString(),G(r.minYear,"-")?t-=parseInt(r.minYear.substr(1),10):G(r.minYear,"+")?t+=parseInt(r.minYear.substr(1),10):t=parseInt(r.minYear,10),r.maxYear=((u=r.maxYear)!=null?u:"+10").toString(),G(r.maxYear,"-")?i-=parseInt(r.maxYear.substr(1),10):G(r.maxYear,"+")?i+=parseInt(r.maxYear.substr(1),10):i=parseInt(r.maxYear,10),r.descending)for(var a=i;a>=t;a--)e.push(a.toString());else for(var o=t;o<=i;o++)e.push(o.toString());return e}};Un=g([m.registerEditor("Serenity.DateYearEditor")],Un);var pi=class extends Re{constructor(r,e){super(r,e),this.updateItems()}updateItems(){var l;this.clearItems();var r=this.options.enumType||ur.get(this.options.enumKey),e=this.options.enumKey;if(e==null&&r!=null){var t=ce(r,Ye,!1);t.length>0&&(e=t[0].value)}var i=gt.getValues(r);for(var a of i){var o=gt.toString(r,a);this.addOption(parseInt(a,10).toString(),(l=V("Enums."+e+"."+o))!=null?l:o,null,!1)}}allowClear(){var r;return(r=this.options.allowClear)!=null?r:!0}};pi=g([m.registerEditor("Serenity.EnumEditor")],pi);var $i=class extends Re{constructor(e,t){super(e,t);if(!this.hasAsyncSource()){this.updateItems();var i=this;he.bindToChange("Lookup."+this.getLookupKey(),this.uniqueName,function(){i.hasAsyncSource()||i.updateItems()})}}hasAsyncSource(){return!!this.options.async}destroy(){this.hasAsyncSource()||he.unbindFromChange(this.uniqueName),super.destroy()}getLookupKey(){if(this.options.lookupKey!=null)return this.options.lookupKey;var e=se(U(this)),t=e.indexOf(".");return t>=0&&(e=e.substring(t+1)),te(e,"Editor")&&(e=e.substr(0,e.length-6)),e}getLookupAsync(){return Ua(this.getLookupKey())}getLookup(){return Or(this.getLookupKey())}getItems(e){return this.filterItems(this.cascadeItems(e.items))}getIdField(){return this.lookup!=null?this.lookup.idField:super.getIdField()}getItemText(e,t){if(t==null)return super.itemText(e);var i=t.textFormatter?t.textFormatter(e):e[t.textField];return i==null?"":i.toString()}mapItem(e){return{id:this.itemId(e),text:this.getItemText(e,this.lookup),disabled:this.getItemDisabled(e,this.lookup),source:e}}getItemDisabled(e,t){return super.itemDisabled(e)}updateItems(){if(!this.hasAsyncSource()){this.clearItems(),this.lookup=this.getLookup();var e=this.getItems(this.lookup);for(var t of e)this.addItem(this.mapItem(t))}}asyncSearch(e,t){return this.getLookupAsync().then(i=>{this.lookup=i;var a=this.getItems(this.lookup);e.idList!=null&&(a=a.filter(l=>e.idList.indexOf(this.itemId(l))>=0));function o(l){return this.getItemText(l,this.lookup)}a=Re.filterByText(a,o.bind(this),e.searchTerm),t({items:a.slice(e.skip,e.take),more:a.length>=e.take})})}getDialogTypeKey(){var e=super.getDialogTypeKey();return e||this.getLookupKey()}setCreateTermOnNewEntity(e,t){e[this.getLookup().textField]=t}editDialogDataChange(){ja(this.getLookupKey())}};$i=g([m.registerEditor("Serenity.LookupEditorBase")],$i);var fi=class extends $i{constructor(r,e){super(r,e)}};fi=g([m.registerEditor("Serenity.LookupEditor")],fi);var qi=class extends Re{constructor(r,e){super(r,e)}getDialogTypeKey(){var r=super.getDialogTypeKey();if(r)return r;var e=this.getService();return G(e,"~/Services/")&&(e=e.substr(11)),e.split("/").length==3&&(e=e.substr(0,e.lastIndexOf("/"))),e.replace("/",".")}getService(){return this.options.service}getServiceUrl(){var r=this.getService();if(r==null)throw new Error("ServiceLookupEditor requires 'service' option to be configured!");return!G(r,"~")&&!G(r,"/")&&r.indexOf("://")<0&&(r="~/Services/"+r),G(r,"~")&&(r=Ee(r)),r}getIncludeColumns(){var r=this.options.includeColumns||[],e=this.getIdField();e&&r.indexOf(e)<0&&r.push(e);var t=this.getTextField();return t&&r.indexOf(t)<0&&r.push(t),r}getSort(){return this.options.sort||(this.getTextField()?[this.getTextField()]:null)}getCascadeCriteria(){var r=this.get_cascadeValue();if(r==null||r==="")return w(this.get_cascadeField())?null:["0","=","1"];var e=this.get_cascadeField();return W(e).eq(r)}getFilterCriteria(){var r=this.get_filterValue();if(r==null||r==="")return null;var e=this.get_filterField();return[[e],"=",r]}getIdListCriteria(r){if(r==null)return null;if(r.length==0)return["0","=","1"];var e=this.getIdField();if(e==null)throw new Error("ServiceLookupEditor requires 'idField' option to be configured!");return W(e).in(r)}getCriteria(r){return W.and(W.and(this.getIdListCriteria(r.idList),this.options.criteria),W.and(this.getCascadeCriteria(),this.getFilterCriteria()))}getListRequest(r){var e={};return r.searchTerm&&(e.ContainsText=r.searchTerm),e.Sort=this.getSort(),e.ColumnSelection=this.options.columnSelection||1,e.IncludeColumns=this.getIncludeColumns(),e.ExcludeColumns=this.options.excludeColumns,e.ContainsField=this.options.containsField,e.EqualityFilter=this.options.equalityFilter,e.Criteria=this.getCriteria(r),e.Skip=r.skip||0,e.Take=r.take?r.checkMore?r.take+1:r.take:0,e.IncludeDeleted=this.options.includeDeleted,e.ExcludeTotalCount=!0,e}getServiceCallOptions(r,e){return{blockUI:!1,url:this.getServiceUrl(),request:this.getListRequest(r),onSuccess:t=>{var i=t.Entities||[];i&&r.take&&r.checkMore&&t.Entities.length>i.length&&(i=i.slice(0,r.take)),e({items:i.slice(0,r.take),more:r.checkMore&&r.take&&i.length>r.take})}}}hasAsyncSource(){return!0}asyncSearch(r,e){var t=this.getServiceCallOptions(r,e);return $e(t)}};qi=g([m.registerEditor("Serenity.ServiceLookupEditorBase")],qi);var hi=class extends qi{constructor(r,e){super(r,e)}};hi=g([m.registerEditor("Serenity.ServiceLookupEditor")],hi);var ct=class extends P{constructor(e,t){super(e,t);this._instanceReady=!1,ct.includeCKEditor();var i=e.attr("id");mt(i)&&(e.attr("id",this.uniqueName),i=this.uniqueName),this.options.cols!=null&&e.attr("cols",this.options.cols),this.options.rows!=null&&e.attr("rows",this.options.rows),this.addValidationRule(this.uniqueName,a=>{if(a.hasClass("required")){var o=Y(this.get_value());if(o==null)return O("Validation.Required")}return null}),kt.executeOnceWhenShown(this.element,()=>{var a=this.getConfig();window.CKEDITOR&&window.CKEDITOR.replace(i,a)})}instanceReady(e){this._instanceReady=!0,$(e.editor.container.$).addClass(this.element.attr("class")),this.element.addClass("select2-offscreen").css("display","block"),e.editor.setData(this.element.val()),e.editor.setReadOnly(this.get_readOnly())}getLanguage(){var i;if(!window.CKEDITOR)return"en";var e=window.CKEDITOR,t=(i=Y($("html").attr("lang")))!=null?i:"en";return e.lang.languages[t]||(t.indexOf(String.fromCharCode(45))>=0&&(t=t.split(String.fromCharCode(45))[0]),e.lang.languages[t])?t:"en"}getConfig(){return{customConfig:"",language:this.getLanguage(),bodyClass:"s-HtmlContentBody",on:{instanceReady:e=>this.instanceReady(e),change:e=>{e.editor.updateElement(),this.element.triggerHandler("change")}},toolbarGroups:[{name:"clipboard",groups:["clipboard","undo"]},{name:"editing",groups:["find","selection","spellchecker"]},{name:"insert",groups:["links","insert","blocks","bidi","list","indent"]},{name:"forms",groups:["forms","mode","document","doctools","others","about","tools"]},{name:"colors"},{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"align"},{name:"styles"}],removeButtons:"SpecialChar,Anchor,Subscript,Styles",format_tags:"p;h1;h2;h3;pre",removeDialogTabs:"image:advanced;link:advanced",removePlugins:"uploadimage,image2",contentsCss:Ee("~/Content/site/site.htmlcontent.css"),entities:!1,entities_latin:!1,entities_greek:!1,autoUpdateElement:!0,height:this.options.rows==null||this.options.rows===0?null:this.options.rows*20+"px"}}getEditorInstance(){var e=this.element.attr("id");return window.CKEDITOR.instances[e]}destroy(){var e=this.getEditorInstance();e&&e.destroy(!0),super.destroy()}get_value(){var e=this.getEditorInstance();return this._instanceReady&&e?e.getData():this.element.val()}get value(){return this.get_value()}set_value(e){var t=this.getEditorInstance();this.element.val(e),this._instanceReady&&t&&t.setData(e)}set value(e){this.set_value(e)}get_readOnly(){return!w(this.element.attr("disabled"))}set_readOnly(e){if(this.get_readOnly()!==e){e?this.element.attr("disabled","disabled"):this.element.removeAttr("disabled");var t=this.getEditorInstance();this._instanceReady&&t&&t.setReadOnly(e)}}static getCKEditorBasePath(){var e=ct.CKEditorBasePath;if(e==null)if(typeof CKEDITOR_BASEPATH!="undefined"&&CKEDITOR_BASEPATH)e=CKEDITOR_BASEPATH;else return"~/Serenity.Assets/Scripts/ckeditor/";return te(e,"/")?e:e+"/"}static includeCKEditor(){if(!window.CKEDITOR){var e=$("#CKEditorScript");e.length>0||$("<script/>").attr("type","text/javascript").attr("id","CKEditorScript").attr("src",Ee(ct.getCKEditorBasePath()+"ckeditor.js?v="+ct.CKEditorVer)).appendTo(window.document.head)}}};ct.CKEditorVer="4.7.1",ct=g([m.registerEditor("Serenity.HtmlContentEditor",[oe,pe]),m.element("<textarea/>")],ct);var jn=class extends ct{constructor(r,e){super(r,e)}getConfig(){var r=super.getConfig();return r.removeButtons+=",Cut,Copy,Paste,BulletedList,NumberedList,Indent,Outdent,SpecialChar,Subscript,Superscript,Styles,PasteText,PasteFromWord,Strike,Link,Unlink,CreatePlaceholder,Image,Table,HorizontalRule,Source,Maximize,Format,Font,FontSize,Anchor,Blockquote,CreatePlaceholder,BGColor,JustifyLeft,JustifyCenter,JustifyRight,JustifyBlock,Superscript,RemoveFormat",r.removePlugins="elementspath,uploadimage,image2",r}};jn=g([m.registerEditor("Serenity.HtmlNoteContentEditor")],jn);var Kn=class extends ct{constructor(r,e){super(r,e)}getConfig(){var r=super.getConfig();return r.removeButtons+=",Cut,Copy,Paste,BulletedList,NumberedList,Indent,Outdent,SpecialChar,Subscript,Superscript,Styles,PasteText,PasteFromWord,Strike,Link,Unlink,CreatePlaceholder,Image,Table,HorizontalRule,Source,Maximize,Format,Font,FontSize,Anchor,Blockquote,CreatePlaceholder,BGColor,JustifyLeft,JustifyCenter,JustifyRight,JustifyBlock,Superscript,RemoveFormat",r.removePlugins="elementspath,uploadimage,image2",r}};Kn=g([m.registerEditor("Serenity.HtmlReportContentEditor")],Kn);var Yn=class extends P{constructor(r,e){var t;super(r,e),r.mask(this.options.mask||"",{placeholder:(t=this.options.placeholder)!=null?t:"_"})}get value(){return this.element.triggerHandler("blur.mask"),this.element.val()}get_value(){return this.value}set value(r){this.element.val(r)}set_value(r){this.value=r}};Yn=g([m.registerEditor("Serenity.MaskedEditor",[oe]),m.element('<input type="text"/>')],Yn);var Xn=class extends P{constructor(r,e){var d;if(super(r,e),this.element.addClass("g-recaptcha").attr("data-sitekey",this.options.siteKey),window.grecaptcha==null&&$("script#RecaptchaInclude").length===0){var t="https://www.google.com/recaptcha/api.js",i=this.options.language;i==null&&(i=(d=$("html").attr("lang"))!=null?d:""),t+="?hl="+i,$("<script/>").attr("id","RecaptchaInclude").attr("src",t).appendTo(document.body)}var a=$("<input />").insertBefore(this.element).attr("id",this.uniqueName+"_validate").val("x"),o={};o.visibility="hidden",o.width="0px",o.height="0px",o.padding="0px";var l=a.css(o),u=this;rr(l,this.uniqueName,c=>w(this.get_value())?O("Validation.Required"):null)}get_value(){return this.element.find(".g-recaptcha-response").val()}set_value(r){}};Xn=g([m.registerEditor("Serenity.Recaptcha",[oe]),m.element("<div/>")],Xn);var Dt;(d=>{function n(c){c.container.addClass("fileinput-button");var p=c.uploadUrl||"~/File/TemporaryUpload";c.uploadIntent&&(p.indexOf("?")<0?p+="?":p+="&",p+="uploadIntent=",p+=encodeURIComponent(c.uploadIntent));var f=$("<input/>").attr("type","file").attr("name",c.inputName+"[]").attr("data-url",Ee(p)).appendTo(c.container);return c.allowMultiple&&f.attr("multiple","multiple"),f.fileupload({dataType:"json",dropZone:c.zone,pasteZone:c.zone,done:function(b,x){var v=x.result;if(v.Error){re(v.Error.Message);return}c.fileDone!=null&&c.fileDone(v,x.files[0].name,x)},fail:function(b,x){var T;var v=(T=x==null?void 0:x._response)==null?void 0:T.jqXHR;if(!v){re("An error occurred during file upload.");return}if((v.getResponseHeader("content-type")||"").toLowerCase().indexOf("application/json")>=0){var I=$.parseJSON(v.responseText);if(I&&I.Error&&I.Error.Message){re(I.Error.Message);return}}var S=v.responseText;if(S){ei({html:S});return}if(!v.status){v.statusText!="abort"&&re("An unknown connection error occurred! Check browser console for details.");return}if(v.status==500){re("HTTP 500: Connection refused! Check browser console for details.");return}re("HTTP "+v.status+" error! Check browser console for details.")},start:function(){ri(null),c.progress!=null&&c.progress.show()},stop:function(){Sr(),c.progress!=null&&c.progress.hide()},progress:function(b,x){if(c.progress!=null){var v=x.loaded/x.total*100;c.progress.children().css("width",v.toString()+"%")}}}),f}d.addUploadInput=n;function r(c,p){return!c.IsImage&&!p.allowNonImage?(_e(O("Controls.ImageUpload.NotAnImageFile")),!1):p.minSize>0&&c.Size<p.minSize?(_e(j(O("Controls.ImageUpload.UploadFileTooSmall"),t(p.minSize))),!1):p.maxSize>0&&c.Size>p.maxSize?(_e(j(O("Controls.ImageUpload.UploadFileTooBig"),t(p.maxSize))),!1):c.IsImage?p.minWidth>0&&c.Width<p.minWidth?(_e(j(O("Controls.ImageUpload.MinWidth"),p.minWidth)),!1):p.maxWidth>0&&c.Width>p.maxWidth?(_e(j(O("Controls.ImageUpload.MaxWidth"),p.maxWidth)),!1):p.minHeight>0&&c.Height<p.minHeight?(_e(j(O("Controls.ImageUpload.MinHeight"),p.minHeight)),!1):p.maxHeight>0&&c.Height>p.maxHeight?(_e(j(O("Controls.ImageUpload.MaxHeight"),p.maxHeight)),!1):!0:!0}d.checkImageConstraints=r;function e(c,p){return c+" ("+t(p)+")"}d.fileNameSizeDisplay=e;function t(c){var p=Ri(c*100/1024)*.01,f="KB";p>=1024&&(p=Ri(p*100/1024)*.01,f="MB");var b=p.toString().split(String.fromCharCode(46)),x;return b.length>1?x=b[0]+"."+b[1].substr(0,2):x=b[0],x+" "+f}d.fileSizeDisplay=t;function i(c){return w(c)?!1:(c=c.toLowerCase(),te(c,".jpg")||te(c,".jpeg")||te(c,".gif")||te(c,".png"))}d.hasImageExtension=i;function a(c){c=c!=null?c:"";var p=c.lastIndexOf(".");return p>=0&&(c=c.substr(0,p)),c+"_t.jpg"}d.thumbFileName=a;function o(c){return c=Ie(c!=null?c:"","\\","/"),Ee("~/upload/")+c}d.dbFileUrl=o;function l(c,p){c.colorbox({current:L(O("Controls.ImageUpload.ColorboxCurrent")),previous:L(O("Controls.ImageUpload.ColorboxPrior")),next:L(O("Controls.ImageUpload.ColorboxNext")),close:L(O("Controls.ImageUpload.ColorboxClose"))})}d.colorBox=l;function u(c,p,f,b){var D;p=p||[],c.html("");for(var x=0;x<p.length;x++){var v=p[x],I=$("<li/>").addClass("file-item").data("index",x),S=i(v.Filename);S?I.addClass("file-image"):I.addClass("file-binary");var T="#"+x,_=$("<a/>").addClass("thumb").appendTo(I),N=(D=v.OriginalName)!=null?D:"",E=v.Filename;b!=null&&E!=null&&!G(E,"temporary/")&&(E=b+E),_.attr("href",o(E)),_.attr("target","_blank"),w(N)||_.attr("title",N),S&&(_.css("backgroundImage","url('"+o(a(v.Filename))+"')"),l(_,new Object)),f&&$("<div/>").addClass("filename").text(N).attr("title",N).appendTo(I),I.appendTo(c)}}d.populateFileSymbols=u})(Dt||(Dt={}));var Hi=class extends P{constructor(e,t){super(e,t);(!t||t.allowNonImage==null)&&(this.options.allowNonImage=!0),e.addClass("s-FileUploadEditor"),w(this.options.originalNameProperty)&&e.addClass("hide-original-name"),this.toolbar=new He($("<div/>").appendTo(this.element),{buttons:this.getToolButtons()}),this.progress=$("<div><div></div></div>").addClass("upload-progress").prependTo(this.toolbar.element);var i=this.getUploadInputOptions();this.uploadInput=Dt.addUploadInput(i),this.fileSymbols=$("<ul/>").appendTo(this.element),this.element.attr("id")||this.element.attr("id",this.uniqueName),this.hiddenInput=$('<input type="text" class="s-offscreen" name="'+this.uniqueName+'_Validator" data-vx-highlight="'+this.element.attr("id")+'"/>').appendTo(this.element),this.updateInterface()}getUploadInputOptions(){return{container:this.toolbar.findButton("add-file-button"),zone:this.element,inputName:this.uniqueName,progress:this.progress,uploadIntent:this.options.uploadIntent,uploadUrl:this.options.uploadUrl,fileDone:(e,t,i)=>{if(Dt.checkImageConstraints(e,this.options)){var a={OriginalName:t,Filename:e.TemporaryFile};this.entity=a,this.populate(),this.updateInterface();var o=this.hiddenInput.closest("form").data("validator");o!=null&&o.element(this.hiddenInput)}}}}addFileButtonText(){return O("Controls.ImageUpload.AddFileButton")}getToolButtons(){return[{title:this.addFileButtonText(),action:"add-file",cssClass:"add-file-button",onClick:function(){}},{title:"",hint:O("Controls.ImageUpload.DeleteButtonHint"),action:"delete",cssClass:"delete-button",onClick:()=>{this.entity=null,this.populate(),this.updateInterface();var e=this.hiddenInput.closest("form").data("validator");e!=null&&e.element(this.hiddenInput)}}]}populate(){var e=this.options.displayFileName||!mt(this.options.originalNameProperty);this.entity==null?Dt.populateFileSymbols(this.fileSymbols,null,e,this.options.urlPrefix):Dt.populateFileSymbols(this.fileSymbols,[this.entity],e,this.options.urlPrefix),this.hiddenInput.val(Y((this.get_value()||{}).Filename))}updateInterface(){var e=this.toolbar.findButton("add-file-button"),t=this.toolbar.findButton("delete-button");e.toggleClass("disabled",this.get_readOnly()),t.toggleClass("disabled",this.get_readOnly()||this.entity==null)}get_readOnly(){return this.uploadInput.attr("disabled")!=null}set_readOnly(e){if(this.get_readOnly()!==e){if(e){this.uploadInput.attr("disabled","disabled");try{this.uploadInput.fileupload("disable")}catch(t){}}else{this.uploadInput.removeAttr("disabled");try{this.uploadInput.fileupload("enable")}catch(t){}}this.updateInterface()}}get_required(){return this.hiddenInput.hasClass("required")}set_required(e){this.hiddenInput.toggleClass("required",!!e)}get_value(){if(this.entity==null)return null;var e=Q({},this.entity);return e}get value(){return this.get_value()}set_value(e){var t=e;if(typeof t=="string"){var t=Y(t);if(e!=null){var i=t.indexOf("/");i<0&&(i=t.indexOf("\\")),e={Filename:e,OriginalName:t.substring(i+1)}}}else e!=null&&mt(e.Filename)&&(e=null);e!=null?e.Filename==null?this.entity=null:this.entity=Q({},e):this.entity=null,this.populate();var a=this.hiddenInput.closest("form").data("validator");a!=null&&a.element(this.hiddenInput),this.updateInterface()}set value(e){this.set_value(e)}getEditValue(e,t){t[e.name]=this.entity==null?null:Y(this.entity.Filename)}setEditValue(e,t){var l;var i={};if(i.Filename=e[t.name],w(this.options.originalNameProperty)){if(this.options.displayFileName){var a=(l=i.Filename)!=null?l:"",o=Ie(a,"\\","/").lastIndexOf("/");o>=0?i.OriginalName=a.substr(o+1):i.OriginalName=a}}else i.OriginalName=e[this.options.originalNameProperty];this.set_value(i)}};Hi=g([m.registerEditor("Serenity.FileUploadEditor",[pe,rt,it,qt]),m.element("<div/>")],Hi);var Zn=class extends Hi{constructor(r,e){super(r,e),e&&e.allowNonImage==null&&(this.options.allowNonImage=!1),r.addClass("s-ImageUploadEditor")}};Zn=g([m.registerEditor("Serenity.ImageUploadEditor")],Zn);var gi=class extends P{constructor(e,t){super(e,t);this.entities=[],e.addClass("s-MultipleFileUploadEditor");var i=this;this.toolbar=new He($("<div/>").appendTo(this.element),{buttons:this.getToolButtons()}),this.progress=$("<div><div></div></div>").addClass("upload-progress").prependTo(this.toolbar.element),this.uploadInput=Dt.addUploadInput(this.getUploadInputOptions()),this.fileSymbols=$("<ul/>").appendTo(this.element),this.element.attr("id")||this.element.attr("id",this.uniqueName),this.hiddenInput=$('<input type="text" class="s-offscreen" name="'+this.uniqueName+'_Validator" data-vx-highlight="'+this.element.attr("id")+'" multiple="multiple"></input>').appendTo(this.element),this.updateInterface()}getUploadInputOptions(){var e=this.toolbar.findButton("add-file-button");return{container:e,zone:this.element,inputName:this.uniqueName,progress:this.progress,uploadIntent:this.options.uploadIntent,uploadUrl:this.options.uploadUrl,allowMultiple:!0,fileDone:(t,i)=>{if(Dt.checkImageConstraints(t,this.options)){var a={OriginalName:i,Filename:t.TemporaryFile};this.entities.push(a),this.populate();var o=this.hiddenInput.closest("form").data("validator");o!=null&&o.element(this.hiddenInput),this.updateInterface()}}}}addFileButtonText(){return O("Controls.ImageUpload.AddFileButton")}getToolButtons(){return[{title:this.addFileButtonText(),action:"add-file",cssClass:"add-file-button",onClick:function(){}}]}populate(){Dt.populateFileSymbols(this.fileSymbols,this.entities,!0,this.options.urlPrefix),this.fileSymbols.children().each((e,t)=>{var i=e;$("<a class='delete'></a>").appendTo($(t).children(".filename")).click(a=>{a.preventDefault(),this.entities.splice(i,1),this.populate();var o=this.hiddenInput.closest("form").data("validator");o!=null&&o.element(this.hiddenInput)})}),this.hiddenInput.val(Y((this.get_value()[0]||{}).Filename))}updateInterface(){var e=this.toolbar.findButton("add-file-button");e.toggleClass("disabled",this.get_readOnly()),this.fileSymbols.find("a.delete").toggle(!this.get_readOnly())}get_readOnly(){return this.uploadInput.attr("disabled")!=null}set_readOnly(e){if(this.get_readOnly()!==e){if(e){this.uploadInput.attr("disabled","disabled");try{this.uploadInput.fileupload("disable")}catch(t){}}else{this.uploadInput.removeAttr("disabled");try{this.uploadInput.fileupload("enable")}catch(t){}}this.updateInterface()}}get_required(){return this.hiddenInput.hasClass("required")}set_required(e){this.hiddenInput&&this.hiddenInput.toggleClass("required",!!e)}get_value(){return this.entities.map(function(e){return Q({},e)})}get value(){return this.get_value()}set_value(e){this.entities=(e||[]).map(function(t){return Q({},t)}),this.populate(),this.updateInterface()}set value(e){this.set_value(e)}getEditValue(e,t){this.jsonEncodeValue?t[e.name]=JSON.stringify(this.get_value()):t[e.name]=this.get_value()}setEditValue(e,t){var o;var i=e[t.name];if(Ae(i,String)){var a=(o=Y(i))!=null?o:"[]";G(a,"[")&&te(a,"]")?this.set_value($.parseJSON(a)):this.set_value([{Filename:a,OriginalName:"UnknownFile"}])}else this.set_value(i)}};g([m.option()],gi.prototype,"jsonEncodeValue",2),gi=g([m.registerEditor("Serenity.MultipleFileUploadEditor",[pe,rt,it,qt]),m.element("<div/>")],gi);var ea=class extends gi{constructor(r,e){super(r,e),r.addClass("s-MultipleImageUploadEditor")}};ea=g([m.registerEditor("Serenity.MultipleImageUploadEditor")],ea);var We=class extends P{constructor(e,t){var l;super(e,t);e.addClass("quick-filters-bar").addClass("clear");for(var i=this.options.filters,a=0;a<i.length;a++){var o=i[a];this.add(o)}this.options.idPrefix=(l=this.options.idPrefix)!=null?l:this.uniqueName+"_"}addSeparator(){this.element.append($("<hr/>"))}add(e){var u;if(e==null)throw new Le("opt");e.separator&&this.addSeparator();var t=$("<div class='quick-filter-item'><span class='quick-filter-label'></span></div>").appendTo(this.element).data("qffield",e.field).children(),i=(u=V(e.title))!=null?u:e.title;i==null&&(i=this.options.getTitle?this.options.getTitle(e):null,i==null&&(i=e.field));var a=t.text(i).parent();e.displayText!=null&&a.data("qfdisplaytext",e.displayText),e.saveState!=null&&a.data("qfsavestate",e.saveState),e.loadState!=null&&a.data("qfloadstate",e.loadState),w(e.cssClass)||a.addClass(e.cssClass);var o=P.create({type:e.type,element:d=>{w(e.field)||d.attr("id",this.options.idPrefix+e.field),d.attr("placeholder"," "),d.appendTo(a),e.element!=null&&e.element(d)},options:e.options,init:e.init}),l=d=>{if(!a.hasClass("ignore")){d.EqualityFilter=d.EqualityFilter||{};var c=q.getValue(o),p=c!=null&&!w(c.toString());if(e.handler!=null){var f={field:e.field,request:d,equalityFilter:d.EqualityFilter,value:c,active:p,widget:o,handled:!0};e.handler(f),a.toggleClass("quick-filter-active",f.active),f.handled||(d.EqualityFilter[e.field]=c)}else d.EqualityFilter[e.field]=c,a.toggleClass("quick-filter-active",p)}};return o.changeSelect2(d=>{window.setTimeout(()=>this.onChange&&this.onChange(d),0)}),this.add_submitHandlers(l),o.element.bind("remove."+this.uniqueName,d=>{this.remove_submitHandlers(l)}),o}addDateRange(e,t){return this.add(We.dateRange(e,t))}static dateRange(e,t){var i=null;return{field:e,type:be,title:t,element:function(a){i=P.create({type:be,element:function(o){o.insertAfter(a)},options:null,init:null}),i.element.change(function(o){a.triggerHandler("change")}),$("<span/>").addClass("range-separator").text("-").insertAfter(a)},handler:function(a){var o=je(a.widget.value);o&&(isNaN(o.valueOf())?(Fi(O("Validation.DateInvalid"),"",null),a.widget.element.val(""),o=null):a.request.Criteria=W.and(a.request.Criteria,W(a.field).ge(a.widget.value)));var l=je(i.value);if(l)if(isNaN(l==null?void 0:l.valueOf()))Fi(O("Validation.DateInvalid"),"",null),i.element.val(""),l=null;else{var u=new Date(i.valueAsDate.valueOf());u.setDate(u.getDate()+1),a.request.Criteria=W.and(a.request.Criteria,W(a.field).lt(ie(u,"yyyy-MM-dd")))}a.active=!!(o||l)},displayText:function(a,o){var p;var l=q.getDisplayText(a),u=q.getDisplayText(i);if(w(l)&&w(u))return null;var d=o+" >= "+l,c=o+" <= "+u;return!w(l)&&!w(u)?d+" "+((p=V("Controls.FilterPanel.And"))!=null?p:"and")+" "+c:w(l)?c:d},saveState:function(a){return[q.getValue(a),q.getValue(i)]},loadState:function(a,o){(o==null||!Array.isArray(o)||o.length!==2)&&(o=[null,null]),q.setValue(a,o[0]),q.setValue(i,o[1])}}}addDateTimeRange(e,t){return this.add(We.dateTimeRange(e,t))}static dateTimeRange(e,t,i){var a=null;return{field:e,type:Be,title:t,element:function(o){a=P.create({type:Be,element:function(l){l.insertAfter(o)},options:i==null?null:{useUtc:i},init:null}),a.element.change(function(l){o.triggerHandler("change")}),$("<span/>").addClass("range-separator").text("-").insertAfter(o)},init:function(o){o.element.parent().find(".time").change(function(l){o.element.triggerHandler("change")})},handler:function(o){var l=je(o.widget.value);l&&(isNaN(l==null?void 0:l.valueOf())?(Fi(O("Validation.DateInvalid"),"",null),o.widget.element.val(""),l=null):o.request.Criteria=W.and(o.request.Criteria,W(o.field).ge(o.widget.value)));var u=je(a.value);u&&(isNaN(u==null?void 0:u.valueOf())?(Fi(O("Validation.DateInvalid"),"",null),a.element.val(""),u=null):o.request.Criteria=W.and(o.request.Criteria,W(o.field).le(a.value))),o.active=!!(l||u)},displayText:function(o,l){var f;var u=q.getDisplayText(o),d=q.getDisplayText(a);if(w(u)&&w(d))return null;var c=l+" >= "+u,p=l+" <= "+d;return!w(u)&&!w(d)?c+" "+((f=V("Controls.FilterPanel.And"))!=null?f:"and")+" "+p:w(u)?p:c},saveState:function(o){return[q.getValue(o),q.getValue(a)]},loadState:function(o,l){(l==null||!Array.isArray(l)||l.length!==2)&&(l=[null,null]),q.setValue(o,l[0]),q.setValue(a,l[1])},options:i==null?null:{useUtc:i}}}addBoolean(e,t,i,a){return this.add(We.boolean(e,t,i,a))}static boolean(e,t,i,a){var o={},l=[],u=i;u==null&&(u=O("Controls.FilterPanel.OperatorNames.true")),l.push(["1",u]);var d=a;return d==null&&(d=O("Controls.FilterPanel.OperatorNames.false")),l.push(["0",d]),o.items=l,{field:e,type:pr,title:t,options:o,handler:function(c){c.equalityFilter[c.field]=c.value==null||w(c.value.toString())?null:!!Ni(c.value)}}}destroy(){this.submitHandlers=null,super.destroy()}onSubmit(e){this.submitHandlers&&this.submitHandlers(e)}add_submitHandlers(e){this.submitHandlers=sn(this.submitHandlers,e)}remove_submitHandlers(e){this.submitHandlers=on(this.submitHandlers,e)}clear_submitHandlers(){}find(e,t){return $("#"+this.options.idPrefix+t).getWidget(e)}tryFind(e,t){var i=$("#"+this.options.idPrefix+t);return i.length?i.tryGetWidget(e):null}};We=g([m.registerClass("Serenity.QuickFilterBar"),m.element("<div/>")],We);var nt=class extends P{constructor(e,t){var d,c;super(e,t);e.attr("title",O("Controls.QuickSearch.Hint")).attr("placeholder",O("Controls.QuickSearch.Placeholder")),this.lastValue=Je((d=e.val())!=null?d:"");var i=this;if(this.element.bind("keyup."+this.uniqueName,function(){i.checkIfValueChanged()}),this.element.bind("change."+this.uniqueName,function(){i.checkIfValueChanged()}),$("<span><i></i></span>").addClass("quick-search-icon").insertBefore(e),tn(this.options.fields)&&this.options.fields.length>0){var a=$("<a/>").addClass("quick-search-field").attr("title",O("Controls.QuickSearch.FieldSelection")).insertBefore(e),o=$("<ul></ul>").css("width","120px");for(var l of this.options.fields){var u={$:l};$("<li><a/></li>").appendTo(o).children().attr("href","#").text((c=l.title)!=null?c:"").click(function(p){p.preventDefault(),this.$this.fieldChanged=i.field!==this.field.$,i.field=this.field.$,this.$this.updateInputPlaceHolder(),this.$this.checkIfValueChanged()}.bind({field:u,$this:this}))}new Br(a,{positionMy:"right top",positionAt:"right bottom",menu:o}),this.field=this.options.fields[0],this.updateInputPlaceHolder()}this.element.bind("execute-search."+this.uniqueName,p=>{var f;this.timer&&window.clearTimeout(this.timer),this.searchNow(Je((f=this.element.val())!=null?f:""))})}checkIfValueChanged(){var i;if(!this.element.hasClass("ignore-change")){var e=this.get_value();if(e==this.lastValue&&(!this.fieldChanged||w(e))){this.fieldChanged=!1;return}this.fieldChanged=!1,this.timer&&window.clearTimeout(this.timer);var t=this;this.timer=window.setTimeout(function(){t.searchNow(e)},(i=this.options.typeDelay)!=null?i:500),this.lastValue=e}}get_value(){var e;return Je((e=this.element.val())!=null?e:"")}get_field(){return this.field}set_field(e){this.field!==e&&(this.fieldChanged=!0,this.field=e,this.updateInputPlaceHolder(),this.checkIfValueChanged())}updateInputPlaceHolder(){var e=this.element.prevAll(".quick-search-field");this.field?e.text(this.field.title):e.text("")}restoreState(i,t){this.fieldChanged=!1,this.field=t;var i=Je(i!=null?i:"");this.element.val(i),this.lastValue=i,this.timer&&(window.clearTimeout(this.timer),this.timer=null),this.updateInputPlaceHolder()}searchNow(e){var i,a,o;this.element.parent().toggleClass((i=this.options.filteredParentClass)!=null?i:"s-QuickSearchFiltered",e.length>0),this.element.parent().addClass((a=this.options.loadingParentClass)!=null?a:"s-QuickSearchLoading").addClass((o=this.options.loadingParentClass)!=null?o:"s-QuickSearchLoading");var t=l=>{var d,c;if(this.element.removeClass((d=this.options.loadingParentClass)!=null?d:"s-QuickSearchLoading").parent().removeClass((c=this.options.loadingParentClass)!=null?c:"s-QuickSearchLoading"),!l){var u=this.element.closest(".s-QuickSearchBar").find(".quick-search-icon i")[0];u&&(u.classList.add("s-shake-effect"),setTimeout(()=>u.classList.remove("s-shake-effect"),2e3))}};this.options.onSearch!=null?this.options.onSearch(this.field!=null&&!w(this.field.name)?this.field.name:null,e,t):t(!0)}};nt=g([m.registerClass("Serenity.QuickSearchInput")],nt);var J;(v=>(v.isTrue="true",v.isFalse="false",v.contains="contains",v.startsWith="startswith",v.EQ="eq",v.NE="ne",v.GT="gt",v.GE="ge",v.LT="lt",v.LE="le",v.BW="bw",v.IN="in",v.isNull="isnull",v.isNotNull="isnotnull",v.toCriteriaOperator={eq:"=",ne:"!=",gt:">",ge:">=",lt:"<",le:"<="}))(J||(J={}));var pt=class{constructor(r){if(this.items=[],r==null)throw new Le("source");this.fields=r.slice(),this.get_fields().sort(function(t,i){var a=V(t.title);a==null&&(a=t.title,a==null&&(a=t.name));var o=V(i.title);return o==null&&(o=i.title,o==null&&(o=i.name)),F.stringCompare(a,o)}),this.fieldByName={};for(var e of r)this.get_fieldByName()[e.name]=e}static getCriteriaFor(r){if(r==null)return[""];for(var e=!1,t=[""],i=!1,a=[""],o=0;o<r.length;o++){var l=r[o];(l.leftParen||e&&l.rightParen)&&(W.isEmpty(t)||(e&&(t=W.paren(t)),i?a=W.or(a,t):a=W.and(a,t),t=[""]),e=!1),l.leftParen&&(i=l.isOr,e=!0),l.isOr?t=W.or(t,l.criteria):t=W.and(t,l.criteria)}return W.isEmpty(t)||(i?a=W.or(a,W.paren(t)):a=W.and(a,W.paren(t))),a}static getDisplayTextFor(r){if(r==null)return"";for(var e=!1,t="",i=0;i<r.length;i++){var a=r[i];e&&(a.rightParen||a.leftParen)&&(t+=")",e=!1),t.length>0&&(t+=" "+O("Controls.FilterPanel."+(a.isOr?"Or":"And"))+" "),a.leftParen&&(t+="(",e=!0),t+=a.displayText}return e&&(t+=")"),t}get_fields(){return this.fields}get_fieldByName(){return this.fieldByName}get_items(){return this.items}raiseChanged(){this.displayText=null,this.changed&&this.changed(this,{})}add_changed(r){this.changed=sn(this.changed,r)}remove_changed(r){this.changed=on(this.changed,r)}get_activeCriteria(){return pt.getCriteriaFor(this.items)}get_displayText(){return this.displayText==null&&(this.displayText=pt.getDisplayTextFor(this.items)),this.displayText}};pt=g([m.registerClass("Serenity.FilterStore")],pt);var fr=class{};fr=g([m.registerInterface("Serenity.IFiltering")],fr);var Gr=class{};Gr=g([m.registerInterface("Serenity.IQuickFiltering")],Gr);var $r=class{get_field(){return this.field}set_field(r){this.field=r}get_container(){return this.container}set_container(r){this.container=r}get_operator(){return this.operator}set_operator(r){this.operator=r}appendNullableOperators(r){return this.isNullable()&&(r.push({key:J.isNotNull}),r.push({key:J.isNull})),r}appendComparisonOperators(r){return r.push({key:J.EQ}),r.push({key:J.NE}),r.push({key:J.LT}),r.push({key:J.LE}),r.push({key:J.GT}),r.push({key:J.GE}),r}isNullable(){return this.get_field().required!==!0}createEditor(){switch(this.get_operator().key){case"true":case"false":case"isnull":case"isnotnull":return;case"contains":case"startswith":case"eq":case"ne":case"lt":case"le":case"gt":case"ge":{this.get_container().html('<input type="text"/>');return}}throw new ye(j("Filtering '{0}' has no editor for '{1}' operator",se(U(this)),this.get_operator().key))}operatorFormat(r){var e,t;return(t=(e=r.format)!=null?e:V("Controls.FilterPanel.OperatorFormats."+r.key))!=null?t:r.key}getTitle(r){var e,t;return(t=V(r.title))!=null?t:(e=r.title)!=null?e:r.name}displayText(r,e){return!e||e.length===0?j(this.operatorFormat(r),this.getTitle(this.field)):e.length===1?j(this.operatorFormat(r),this.getTitle(this.field),e[0]):j(this.operatorFormat(r),this.getTitle(this.field),e[0],e[1])}getCriteriaField(){return this.field.name}getCriteria(){var r={},e,t=W(this.getCriteriaField()),i=this.get_operator().key;switch(i){case"true":return r.displayText=this.displayText(this.get_operator(),[]),r.criteria=t.eq(!0),r;case"false":return r.displayText=this.displayText(this.get_operator(),[]),r.criteria=t.eq(!1),r;case"isnull":return r.displayText=this.displayText(this.get_operator(),[]),r.criteria=t.isNull(),r;case"isnotnull":return r.displayText=this.displayText(this.get_operator(),[]),r.criteria=t.isNotNull(),r;case"contains":return e=this.getEditorText(),r.displayText=this.displayText(this.get_operator(),[e]),r.criteria=t.contains(e),r;case"startswith":return e=this.getEditorText(),r.displayText=this.displayText(this.get_operator(),[e]),r.criteria=t.startsWith(e),r;case"eq":case"ne":case"lt":case"le":case"gt":case"ge":return e=this.getEditorText(),r.displayText=this.displayText(this.get_operator(),[e]),r.criteria=t[i](this.getEditorValue()),r}throw new ye(j("Filtering '{0}' has no handler for '{1}' operator",se(U(this)),this.get_operator().key))}loadState(r){var e=this.get_container().find(":input").first();e.val(r)}saveState(){switch(this.get_operator().key){case"contains":case"startswith":case"eq":case"ne":case"lt":case"le":case"gt":case"ge":{var r=this.get_container().find(":input").first();return r.val()}}return null}argumentNull(){return new Error(O("Controls.FilterPanel.ValueRequired"))}validateEditorValue(r){if(r.length===0)throw this.argumentNull();return r}getEditorValue(){var t;var r=this.get_container().find(":input").not(".select2-focusser").first();if(r.length!==1)throw new ye(j("Couldn't find input in filter container for {0}",(t=this.field.title)!=null?t:this.field.name));var e;return r.data("select2")!=null?e=r.select2("val"):e=r.val(),e=(e!=null?e:"").trim(),this.validateEditorValue(e)}getEditorText(){var t;var r=this.get_container().find(":input").not(".select2-focusser").not(".select2-input").first();if(r.length===0)return this.get_container().text().trim();var e;return r.data("select2")!=null?e=((t=r.select2("data"))!=null?t:{}).text:e=r.val(),e}initQuickFilter(r){r.field=this.getCriteriaField(),r.type=dt,r.title=this.getTitle(this.field),r.options=Ve(this.get_field().quickFilterParams)}};$r=g([m.registerClass("Serenity.BaseFiltering",[fr,Gr])],$r);function bt(n){return m.registerClass("Serenity."+n+"Filtering")}var ft=class extends $r{constructor(e){super();this.editorType=e}useEditor(){switch(this.get_operator().key){case"eq":case"ne":case"lt":case"le":case"gt":case"ge":return!0}return!1}createEditor(){if(this.useEditor()){this.editor=P.create({type:this.editorType,container:this.get_container(),options:this.getEditorOptions(),init:null});return}this.editor=null,super.createEditor()}useIdField(){return!1}getCriteriaField(){return this.useEditor()&&this.useIdField()&&!w(this.get_field().filteringIdField)?this.get_field().filteringIdField:super.getCriteriaField()}getEditorOptions(){var e=Ve(this.get_field().editorParams||{});return delete e.cascadeFrom,Q(e,this.get_field().filteringParams)}loadState(e){if(this.useEditor()){if(e==null)return;q.setValue(this.editor,e);return}super.loadState(e)}saveState(){return this.useEditor()?q.getValue(this.editor):super.saveState()}getEditorValue(){if(this.useEditor()){var e=q.getValue(this.editor);if(e==null||typeof e=="string"&&e.trim().length===0)throw this.argumentNull();return e}return super.getEditorValue()}initQuickFilter(e){super.initQuickFilter(e),e.type=this.editorType,e.options=Q(Q({},Ve(this.getEditorOptions())),Ve(this.get_field().quickFilterParams))}};ft=g([bt("BaseEditor")],ft);var mi=class extends ft{constructor(){super(be)}getOperators(){return this.appendNullableOperators(this.appendComparisonOperators([]))}};mi=g([bt("Date")],mi);var yi=class extends $r{getOperators(){return this.appendNullableOperators([{key:J.isTrue},{key:J.isFalse}])}};yi=g([bt("Boolean")],yi);var vi=class extends ft{constructor(){super(Be)}getOperators(){return this.appendNullableOperators(this.appendComparisonOperators([]))}getCriteria(){var r={};switch(this.get_operator().key){case"eq":case"ne":case"lt":case"le":case"gt":case"ge":{{var e=this.getEditorText();r.displayText=this.displayText(this.get_operator(),[e]);var t=qe(this.getEditorValue());t=new Date(t.getFullYear(),t.getMonth(),t.getDate());var i=new Date(t.getFullYear(),t.getMonth(),t.getDate()+1),a=W(this.getCriteriaField()),o=ie(t,"yyyy-MM-dd"),l=ie(i,"yyyy-MM-dd");switch(this.get_operator().key){case"eq":return r.criteria=W.and(a.ge(o),a.lt(l)),r;case"ne":return r.criteria=W.paren(W.or(a.lt(o),a.gt(l))),r;case"lt":return r.criteria=a.lt(o),r;case"le":r.criteria=a.lt(l);case"gt":return r.criteria=a.ge(l),r;case"ge":return r.criteria=a.ge(o),r}}break}}return super.getCriteria()}};vi=g([bt("DateTime")],vi);var ta=class extends ft{constructor(){super(Et)}getOperators(){return this.appendNullableOperators(this.appendComparisonOperators([]))}};ta=g([bt("Decimal")],ta);var Qr=class extends ft{constructor(){super(P)}getOperators(){var e=[];return e.push({key:J.EQ}),e.push({key:J.NE}),this.useRelative&&(e.push({key:J.LT}),e.push({key:J.LE}),e.push({key:J.GT}),e.push({key:J.GE})),this.useLike&&(e.push({key:J.contains}),e.push({key:J.startsWith})),this.appendNullableOperators(e),e}useEditor(){var e=this.get_operator().key;return e===J.EQ||e===J.NE||this.useRelative&&(e===J.LT||e===J.LE||e===J.GT||e===J.GE)}getEditorOptions(){var t;var e=super.getEditorOptions();return this.useEditor()&&this.editorType===((t=this.get_field().editorType)!=null?t:"String")&&(e=Q(e,this.get_field().editorParams)),e}createEditor(){if(this.useEditor()){var e=Mr.get(this.editorType);this.editor=P.create({type:e,element:t=>t.appendTo(this.get_container()),options:this.getEditorOptions()});return}super.createEditor()}useIdField(){return this.useEditor()}initQuickFilter(e){super.initQuickFilter(e),e.type=Mr.get(this.editorType)}};g([m.option()],Qr.prototype,"editorType",2),g([m.option()],Qr.prototype,"useRelative",2),g([m.option()],Qr.prototype,"useLike",2),Qr=g([bt("Editor")],Qr);var ra=class extends ft{constructor(){super(pi)}getOperators(){var r=[{key:J.EQ},{key:J.NE}];return this.appendNullableOperators(r)}};ra=g([bt("Enum")],ra);var ia=class extends ft{constructor(){super(ui)}getOperators(){return this.appendNullableOperators(this.appendComparisonOperators([]))}};ia=g([bt("Integer")],ia);var na=class extends ft{constructor(){super(fi)}getOperators(){var r=[{key:J.EQ},{key:J.NE},{key:J.contains},{key:J.startsWith}];return this.appendNullableOperators(r)}useEditor(){var r=this.get_operator().key;return r==J.EQ||r==J.NE}useIdField(){return this.useEditor()}getEditorText(){return this.useEditor()?this.editor.text:super.getEditorText()}};na=g([bt("Lookup")],na);var aa=class extends ft{constructor(){super(hi)}getOperators(){var r=[{key:J.EQ},{key:J.NE},{key:J.contains},{key:J.startsWith}];return this.appendNullableOperators(r)}useEditor(){var r=this.get_operator().key;return r==J.EQ||r==J.NE}useIdField(){return this.useEditor()}getEditorText(){return this.useEditor()?this.editor.text:super.getEditorText()}};aa=g([bt("ServiceLookup")],aa);var sa=class extends $r{getOperators(){var r=[{key:J.contains},{key:J.startsWith},{key:J.EQ},{key:J.NE}];return this.appendNullableOperators(r)}validateEditorValue(r){return r.length===0?r:super.validateEditorValue(r)}};sa=g([bt("String")],sa);var bi;(a=>{let n;function r(){if(n==null){n={};for(var o of an())if(Ue(fr,o)){var l=se(o).toLowerCase();n[l]=o;for(var u of Se.rootNamespaces)if(G(l,u.toLowerCase()+".")){var d=l.substr(u.length+1).toLowerCase();n[d]==null&&(n[d]=o)}}e()}}function e(){var o="filtering";for(var l of Object.keys(n))if(te(l,o)){var u=l.substr(0,l.length-o.length);w(u)||n[u]==null&&(n[u]=n[l])}}function t(){n=null}function i(o){if(w(o))throw new Le("key");r();var l=n[o.toLowerCase()];if(l==null)throw new ye(j("Can't find {0} filter handler type!",o));return l}a.get=i})(bi||(bi={}));var hr=class extends Pe{constructor(e,t){super(e,t);this.store=new pt([]),this.onFilterStoreChanged=()=>this.filterStoreChanged(),this.store.add_changed(this.onFilterStoreChanged)}destroy(){this.store&&(this.store.remove_changed(this.onFilterStoreChanged),this.onFilterStoreChanged=null,this.store=null),super.destroy()}filterStoreChanged(){}get_store(){return this.store}set_store(e){this.store!==e&&(this.store!=null&&this.store.remove_changed(this.onFilterStoreChanged),this.store=e||new pt([]),this.store.add_changed(this.onFilterStoreChanged),this.filterStoreChanged())}};hr=g([m.registerClass("Serenity.FilterWidgetBase")],hr);var gr=class extends Re{constructor(r,e){var i,a;super(r);for(var t of e)this.addOption(t.name,(a=(i=V(t.title))!=null?i:t.title)!=null?a:t.name,t)}emptyItemText(){return w(this.value)?O("Controls.FilterPanel.SelectField"):null}getSelect2Options(){var r=super.getSelect2Options();return r.allowClear=!1,r}};gr=g([m.registerClass("Serenity.FilterFieldSelect")],gr);var mr=class extends Re{constructor(r,e){var a,o;super(r);for(var t of e){var i=(o=t.title)!=null?o:(a=V("Controls.FilterPanel.OperatorNames."+t.key))!=null?a:t.key;this.addOption(t.key,i,t)}e.length&&e[0]&&(this.value=e[0].key)}emptyItemText(){return null}getSelect2Options(){var r=super.getSelect2Options();return r.allowClear=!1,r}};mr=g([m.registerClass("Serenity.FilterOperatorSelect")],mr);var xi=class extends hr{constructor(e){super(e);this.element.addClass("s-FilterPanel"),this.rowsDiv=this.byId("Rows"),this.initButtons(),this.updateButtons()}get_showInitialLine(){return this.showInitialLine}set_showInitialLine(e){this.showInitialLine!==e&&(this.showInitialLine=e,this.showInitialLine&&this.rowsDiv.children().length===0&&this.addEmptyRow(!1))}filterStoreChanged(){super.filterStoreChanged(),this.updateRowsFromStore()}updateRowsFromStore(){this.rowsDiv.empty();var e=this.get_store().get_items();for(var t of e){this.addEmptyRow(!1);var i=this.rowsDiv.children().last(),a=i.children("div.l");a.children(".leftparen").toggleClass("active",!!t.leftParen),a.children(".rightparen").toggleClass("active",!!t.rightParen),a.children(".andor").toggleClass("or",!!t.isOr).text(O(t.isOr?"Controls.FilterPanel.Or":"Controls.FilterPanel.And"));var o=i.children("div.f").find("input.field-select").getWidget(gr);o.value=t.field,this.rowFieldChange(i);var l=i.children("div.o").find("input.op-select").getWidget(mr);l.set_value(t.operator),this.rowOperatorChange(i);var u=this.getFilteringFor(i);u!=null&&(u.set_operator({key:t.operator}),u.loadState(t.state))}this.get_showInitialLine()&&this.rowsDiv.children().length===0&&this.addEmptyRow(!1),this.updateParens()}get_showSearchButton(){return this.showSearchButton}set_showSearchButton(e){this.showSearchButton!==e&&(this.showSearchButton=e,this.updateButtons())}get_updateStoreOnReset(){return this.updateStoreOnReset}set_updateStoreOnReset(e){this.updateStoreOnReset!==e&&(this.updateStoreOnReset=e)}getTemplate(){return"<div id='~_Rows' class='filter-lines'></div><div id='~_Buttons' class='buttons'><button id='~_AddButton' class='btn btn-primary add'></button><button id='~_SearchButton' class='btn btn-success search'></button><button id='~_ResetButton' class='btn btn-danger reset'></button></div><div style='clear: both'></div>"}initButtons(){this.byId("AddButton").text(O("Controls.FilterPanel.AddFilter")).click(e=>this.addButtonClick(e)),this.byId("SearchButton").text(O("Controls.FilterPanel.SearchButton")).click(e=>this.searchButtonClick(e)),this.byId("ResetButton").text(O("Controls.FilterPanel.ResetButton")).click(e=>this.resetButtonClick(e))}searchButtonClick(e){e.preventDefault(),this.search()}get_hasErrors(){return this.rowsDiv.children().children("div.v").children("span.error").length>0}search(){var f;this.rowsDiv.children().children("div.v").children("span.error").remove();for(var e=[],t=null,i=null,a=0;a<this.rowsDiv.children().length;a++){i=this.rowsDiv.children().eq(a);var o=this.getFilteringFor(i);if(o!=null){var l=this.getFieldFor(i),u=i.children("div.o").find("input.op-select").getWidget(mr).value;if(u==null||u.length===0){t=O("Controls.FilterPanel.InvalidOperator");break}var d={};d.field=l.name,d.operator=u,d.isOr=i.children("div.l").children("a.andor").hasClass("or"),d.leftParen=i.children("div.l").children("a.leftparen").hasClass("active"),d.rightParen=i.children("div.l").children("a.rightparen").hasClass("active"),o.set_operator({key:u});var c;try{c=o.getCriteria()}catch(b){t=(f=b.message)!=null?f:b.toString();break}d.criteria=c.criteria,d.state=o.saveState(),d.displayText=c.displayText,e.push(d)}}if(t!=null){$("<span/>").addClass("error").attr("title",t).appendTo(i.children("div.v")),i.children("div.v").find("input:first").focus();return}var p=this.get_store().get_items();p.length=0,p.push.apply(p,e),this.get_store().raiseChanged()}addButtonClick(e){this.addEmptyRow(!0),e.preventDefault()}resetButtonClick(e){e.preventDefault(),this.get_updateStoreOnReset()&&this.get_store().get_items().length>0&&(this.get_store().get_items().length=0,this.get_store().raiseChanged()),this.rowsDiv.empty(),this.updateButtons(),this.get_showInitialLine()&&this.addEmptyRow(!1)}findEmptyRow(){var e=null;return this.rowsDiv.children().each(function(t,i){var a=$(i).children("div.f").children("input.field-select").first();if(a.length===0)return!0;var o=a.val();return o==null||o.length===0?(e=$(i),!1):!0}),e}addEmptyRow(e){var t=this.findEmptyRow();if(t!=null)return t.find("input.field-select").select2("focus"),e&&t.find("input.field-select").select2("open"),t;var i=this.rowsDiv.children().last().children("a.andor").hasClass("or"),a=$("<div class='filter-line'><a class='delete'><span></span></a><div class='l'><a class='rightparen' href='#'>)</a><a class='andor' href='#'></a><a class='leftparen' href='#'>(</a></div><div class='f'><input type='hidden' class='field-select'></div><div class='o'></div><div class='v'></div><div style='clear: both'></div></div>").appendTo(this.rowsDiv),o=a.children("div.l").hide();o.children("a.leftparen, a.rightparen").click(d=>this.leftRightParenClick(d));var l=o.children("a.andor").attr("title",O("Controls.FilterPanel.ChangeAndOr"));i?l.addClass("or").text(O("Controls.FilterPanel.Or")):l.text(O("Controls.FilterPanel.And")),l.click(d=>this.andOrClick(d)),a.children("a.delete").attr("title",O("Controls.FilterPanel.RemoveField")).click(d=>this.deleteRowClick(d));var u=new gr(a.children("div.f").children("input"),this.get_store().get_fields()).changeSelect2(d=>this.onRowFieldChange(d));return this.updateParens(),this.updateButtons(),a.find("input.field-select").select2("focus"),e&&a.find("input.field-select").select2("open"),a}onRowFieldChange(e){var t=$(e.target).closest("div.filter-line");this.rowFieldChange(t);var i=t.children("div.o").find("input.op-select");i.select2("focus")}rowFieldChange(e){e.removeData("Filtering");var t=e.children("div.f").find("input.field-select").getWidget(gr),i=t.get_value(),a=i==null||i==="";this.removeFiltering(e),this.populateOperatorList(e),this.rowOperatorChange(e),this.updateParens(),this.updateButtons()}removeFiltering(e){e.data("Filtering",null),e.data("FilteringField",null)}populateOperatorList(e){e.children("div.o").html("");var t=this.getFilteringFor(e);if(t!=null){var i=e.children("div.o").html("<input/>").children().attr("type","hidden").addClass("op-select"),a=t.getOperators(),o=new mr(i,a);o.changeSelect2(l=>this.onRowOperatorChange(l))}}getFieldFor(e){if(e.length===0)return null;var t=e.children("div.f").find("input.field-select").getWidget(gr);return w(t.value)?null:this.get_store().get_fieldByName()[t.get_value()]}getFilteringFor(e){var l;var t=this.getFieldFor(e);if(t==null)return null;var i=Zt(e.data("Filtering"),fr);if(i!=null)return i;var a=bi.get((l=t.filteringType)!=null?l:"String"),o=e.children("div.v");return i=new a,ut.set(i,t.filteringParams),i.set_container(o),i.set_field(t),e.data("Filtering",i),i}onRowOperatorChange(e){var t=$(e.target).closest("div.filter-line");this.rowOperatorChange(t);var i=t.children("div.v").find(":input:visible").first();try{i.focus()}catch(a){}}rowOperatorChange(e){if(e.length!==0){var t=e.children("div.v");t.html("");var i=this.getFilteringFor(e);if(i!=null){var a=e.children("div.o").find("input.op-select").getWidget(mr);if(!w(a.get_value())){var o=i.getOperators().filter(function(u){return u.key===a.value}),l=o.length>0?o[0]:null;l!=null&&(i.set_operator(l),i.createEditor())}}}}deleteRowClick(e){e.preventDefault();var t=$(e.target).closest("div.filter-line");t.remove(),this.rowsDiv.children().length===0&&this.search(),this.updateParens(),this.updateButtons()}updateButtons(){this.byId("SearchButton").toggle(this.rowsDiv.children().length>=1&&this.showSearchButton),this.byId("ResetButton").toggle(this.rowsDiv.children().length>=1)}andOrClick(e){e.preventDefault();var t=$(e.target).toggleClass("or");t.text(O("Controls.FilterPanel."+(t.hasClass("or")?"Or":"And")))}leftRightParenClick(e){e.preventDefault(),$(e.target).toggleClass("active"),this.updateParens()}updateParens(){var e=this.rowsDiv.children();if(e.length!==0){e.removeClass("paren-start"),e.removeClass("paren-end"),e.children("div.l").css("display",e.length===1?"none":"block"),e.first().children("div.l").children("a.rightparen, a.andor").css("visibility","hidden");for(var t=1;t<e.length;t++){var i=e.eq(t);i.children("div.l").css("display","block").children("a.lefparen, a.andor").css("visibility","visible")}for(var a=!1,o=0;o<e.length;o++){var l=e.eq(o),u=l.children("div.l"),d=u.children("a.leftparen"),c=u.children("a.rightparen");c.hasClass("active")&&a&&(a=!1,o>0&&e.eq(o-1).addClass("paren-end")),d.hasClass("active")&&(a=!0,o>0&&l.addClass("paren-start"))}}}};xi=g([m.registerClass("Serenity.FilterPanel")],xi);var Ti=class extends xe{constructor(){super();this.filterPanel=new xi(this.byId("FilterPanel")),this.filterPanel.set_showInitialLine(!0),this.filterPanel.set_showSearchButton(!1),this.filterPanel.set_updateStoreOnReset(!1),this.dialogTitle=O("Controls.FilterPanel.DialogTitle")}get_filterPanel(){return this.filterPanel}getTemplate(){return'<div id="~_FilterPanel"/>'}getDialogButtons(){return[{text:O("Dialogs.OkButton"),click:()=>{if(this.filterPanel.search(),this.filterPanel.get_hasErrors()){re(O("Controls.FilterPanel.FixErrorsMessage"),"",null);return}this.dialogClose()}},{text:O("Dialogs.CancelButton"),click:()=>this.dialogClose()}]}};Ti=g([m.registerClass("Serenity.FilterDialog")],Ti);var Ci=class extends hr{constructor(r){super(r),this.element.find(".cap").text(O("Controls.FilterPanel.EffectiveFilter")),this.element.find(".edit").text(O("Controls.FilterPanel.EditFilter")),this.element.find(".reset").attr("title",O("Controls.FilterPanel.ResetFilterHint"));var e=t=>{t.preventDefault();var i=new Ti;i.get_filterPanel().set_store(this.get_store()),i.dialogOpen(null)};this.element.find(".edit").click(e),this.element.find(".txt").click(e),this.element.find(".reset").click(t=>{t.preventDefault(),this.get_store().get_items().length=0,this.get_store().raiseChanged()})}filterStoreChanged(){super.filterStoreChanged();var r=Y(this.get_store().get_displayText());this.element.find(".current").toggle(r!=null),this.element.find(".reset").toggle(r!=null),r==null&&(r=O("Controls.FilterPanel.EffectiveEmpty")),this.element.find(".txt").text("["+r+"]")}getTemplate(){return"<div><a class='reset'></a><a class='edit'></a><div class='current'><span class='cap'></span><a class='txt'></a></div></div>"}};Ci=g([m.registerClass("Serenity.FilterDisplayBar")],Ci);var Ii=class extends P{constructor(r,e){super(r,Q({showRowsPerPage:!0,rowsPerPageOptions:[20,100,500,2e3]},e)),e=this.options;var t=e.view;if(!t)throw"SlickPager requires view option to be set!";this.element.addClass("s-SlickPager slick-pg").html(`<div class="slick-pg-in">
    <div class="slick-pg-grp slick-pg-grp-firstprev">
        <div class="slick-pg-first slick-pg-btn"><span class="slick-pg-btn-span"></span></div>
        <div class="slick-pg-prev slick-pg-btn"><span class="slick-pg-btn-span"></span></div>
    </div>
    <div class="slick-pg-grp slick-pg-grp-control">
        <span class="slick-pg-control">
            <span class="slick-pg-pagetext">${L(O("Controls.Pager.Page"))}</span>
            <input id="${this.idPrefix}CurrentPage" class="slick-pg-current" type="text" size="4" value="1" />
            <span class="slick-pg-pagesep">/</span>
            <span class="slick-pg-total">1</span>
        </span>
    </div>
    <div class="slick-pg-grp slick-pg-grp-nextlast">
        <div class="slick-pg-next slick-pg-btn"><span class="slick-pg-btn-span"></span></div>
        <div class="slick-pg-last slick-pg-btn"><span class="slick-pg-btn-span"></span></div>
    </div>
    <div class="slick-pg-grp slick-pg-grp-reload">
        <div class="slick-pg-reload slick-pg-btn"><span class="slick-pg-btn-span"></span></div>
    </div>
    <div class="slick-pg-grp slick-pg-grp-stat">
        <span class="slick-pg-stat"></span>
    </div>
</div>`);var i=this;if($(".slick-pg-reload",this.element).click(function(){t.populate()}),$(".slick-pg-first",this.element).click(function(){i._changePage("first")}),$(".slick-pg-prev",this.element).click(function(){i._changePage("prev")}),$(".slick-pg-next",this.element).click(function(){i._changePage("next")}),$(".slick-pg-last",this.element).click(function(){i._changePage("last")}),$(".slick-pg-current",this.element).keydown(function(u){u.keyCode==13&&i._changePage("input")}),i.options.showRowsPerPage){for(var a="",o="",l=0;l<e.rowsPerPageOptions.length;l++)t.rowsPerPage==e.rowsPerPageOptions[l]?o='selected="selected"':o="",a+="<option value='"+e.rowsPerPageOptions[l]+"' "+o+" >"+e.rowsPerPageOptions[l]+"&nbsp;&nbsp;</option>";$(".slick-pg-in",this.element).prepend('<div class="slick-pg-grp"><select class="slick-pg-size" name="rp">'+a+"</select></div>"),$("select.slick-pg-size",this.element).change(function(){e.onRowsPerPageChange?e.onRowsPerPageChange(+this.value):(t.newp=1,t.setPagingOptions({page:1,rowsPerPage:+this.value}))})}t.onPagingInfoChanged.subscribe(function(){i._updatePager()})}_changePage(r){var e=this.options.view;if(!e||e.loading)return!0;var t=e.getPagingInfo(),i=!t.rowsPerPage||!t.totalCount?1:Math.ceil(t.totalCount/t.rowsPerPage),a;switch(r){case"first":a=1;break;case"prev":t.page>1&&(a=parseInt(t.page)-1);break;case"next":t.page<i&&(a=parseInt(t.page)+1);break;case"last":a=i;break;case"input":var o=parseInt($("input.slick-pg-current",this.element).val());isNaN(o)||o<1?o=1:o>i&&(o=i),$(".slick-pg-current",this.element).val(o),a=o;break}if(a==t.page)return!1;this.options.onChangePage?this.options.onChangePage(a):e.setPagingOptions({page:a})}_updatePager(){var r=this.options.view,e=r.getPagingInfo(),t=!e.rowsPerPage||!e.totalCount?1:Math.ceil(e.totalCount/e.rowsPerPage);$(".slick-pg-current",this.element).val(e.page),$(".slick-pg-total",this.element).html(t);var i=(e.page-1)*e.rowsPerPage+1,a=i+e.rowsPerPage-1;e.totalCount<a&&(a=e.totalCount);var o;e.loading?o=L(O("Controls.Pager.LoadingStatus")):e.error?o=e.error:e.totalCount>0?(o=L(O("Controls.Pager.PageStatus")),o=o.replace(/{from}/,i),o=o.replace(/{to}/,a),o=o.replace(/{total}/,e.totalCount)):o=L(O("Controls.Pager.NoRowStatus")),$(".slick-pg-stat",this.element).html(o),$(".slick-pg-size",this.element).val((e.rowsPerPage||0).toString())}};Ii=g([m.registerClass("Serenity.SlickPager")],Ii);var yr=class{};yr=g([m.registerInterface("Serenity.IInitializeColumn")],yr);var Si=class{format(r){var t,i;if(r.value==null)return"";var e;return r.value?(e=V(this.trueText),e==null&&(e=this.trueText,e==null&&(e=(t=V("Dialogs.YesButton"))!=null?t:"Yes"))):(e=V(this.falseText),e==null&&(e=this.falseText,e==null&&(e=(i=V("Dialogs.NoButton"))!=null?i:"No"))),L(e)}};g([m.option()],Si.prototype,"falseText",2),g([m.option()],Si.prototype,"trueText",2),Si=g([m.registerFormatter("Serenity.BooleanFormatter")],Si);var oa=class{format(r){return'<span class="check-box no-float readonly slick-edit-preclick '+(r.value?" checked":"")+'"></span>'}};oa=g([m.registerFormatter("Serenity.CheckboxFormatter")],oa);var xt=class{constructor(){this.displayFormat=F.dateFormat}static format(r,e){if(r==null)return"";var t;if(r instanceof Date)t=r;else if(typeof r=="string"){if(t=qe(r),t==null||isNaN(t.valueOf()))return L(r)}else return r.toString();return L(ie(t,e))}format(r){return xt.format(r.value,this.displayFormat)}};g([m.option()],xt.prototype,"displayFormat",2),xt=g([m.registerFormatter("Serenity.DateFormatter")],xt);var la=class extends xt{constructor(){super(),this.displayFormat=F.dateTimeFormat}};la=g([m.registerFormatter("Serenity.DateTimeFormatter")],la);var Ft=class{format(r){return Ft.format(ur.get(this.enumKey),r.value)}static format(r,e){if(e==null)return"";var t=gt.toString(r,e),i=ce(r,Ye,!1),a=i.length>0?i[0].value:se(r);return Ft.getText(a,t)}static getText(r,e){var t;return w(e)?"":L((t=V("Enums."+r+"."+e))!=null?t:e)}static getName(r,e){return e==null?"":gt.toString(r,e)}};g([m.option()],Ft.prototype,"enumKey",2),Ft=g([m.registerFormatter("Serenity.EnumFormatter")],Ft);var Wt=class{format(r){var l,u;var e=Ce(r.value,String);if(w(e))return"";var t=Wt.dbFileUrl(e),i=w(this.originalNameProperty)?null:Ce(r.item[this.originalNameProperty],String);i=i!=null?i:"";var a=j((l=this.displayFormat)!=null?l:"{0}",i,e,t),o=(u=this.iconClass)!=null?u:"fa fa-download";return o.startsWith("fa-")&&(o="fa "+o),"<a class='file-download-link' target='_blank' href='"+L(t)+"'><i class='"+o+"'></i> "+L(a)+"</a>"}static dbFileUrl(r){return r=Ie(r!=null?r:"","\\","/"),Ee("~/upload/")+r}initializeColumn(r){if(r.referencedFields=r.referencedFields||[],!w(this.originalNameProperty)){r.referencedFields.push(this.originalNameProperty);return}}};g([m.option()],Wt.prototype,"displayFormat",2),g([m.option()],Wt.prototype,"originalNameProperty",2),g([m.option()],Wt.prototype,"iconClass",2),Wt=g([m.registerFormatter("Serenity.FileDownloadFormatter",[et,yr])],Wt);var wi=class{format(r){return wi.format(r.value)}static format(r){var e=Math.floor(r/60),t=r-e*60,i,a;return r==null||isNaN(r)?"":(e<10?i="0"+e:i=e.toString(),t<10?a="0"+t:a=t.toString(),j("{0}:{1}",i,a))}};wi=g([m.registerFormatter("Serenity.MinuteFormatter")],wi);var Jt=class{format(r){return Jt.format(r.value,this.displayFormat)}static format(r,e){var i;if(e=e!=null?e:"0.##",r==null)return"";if(typeof r=="number")return isNaN(r)?"":L(It(r,e));var t=tr(r.toString());return t==null||isNaN(t)?(i=r==null?void 0:r.toString())!=null?i:"":L(It(t,e))}};g([m.option()],Jt.prototype,"displayFormat",2),Jt=g([m.registerFormatter("Serenity.NumberFormatter")],Jt);var Ht=class{format(r){var a,o,l,u;var e=w(this.urlProperty)?((o=r.value)!=null?o:"").toString():((a=r.item[this.urlProperty])!=null?a:"").toString();if(w(e))return"";w(this.urlFormat)||(e=j(this.urlFormat,e)),e!=null&&G(e,"~/")&&(e=Ee(e));var t=w(this.displayProperty)?((u=r.value)!=null?u:"").toString():((l=r.item[this.displayProperty])!=null?l:"").toString();w(this.displayFormat)||(t=j(this.displayFormat,t));var i="<a href='"+L(e)+"'";return w(this.target)||(i+=" target='"+this.target+"'"),i+=">"+L(t)+"</a>",i}initializeColumn(r){r.referencedFields=r.referencedFields||[],w(this.displayProperty)||r.referencedFields.push(this.displayProperty),w(this.urlProperty)||r.referencedFields.push(this.urlProperty)}};g([m.option()],Ht.prototype,"displayProperty",2),g([m.option()],Ht.prototype,"displayFormat",2),g([m.option()],Ht.prototype,"urlProperty",2),g([m.option()],Ht.prototype,"urlFormat",2),g([m.option()],Ht.prototype,"target",2),Ht=g([m.registerFormatter("Serenity.UrlFormatter",[et,yr])],Ht);var ua;(i=>{let n=lr(a=>Ue(et,a),null,"Formatter");function r(a){if(w(a))throw new Le("key");var o=n.tryGet(a);if(o)return o;var l=`"${L(a)}" formatter class not found! 
Make sure there is such a formatter type under the project root namespace,
and its namespace parts start with capital letters like MyProject.MyModule.MyFormatter.

If using ES modules, make sure the formatter type has a decorator like 
@Decorators.registerFormatter('MyProject.MyModule.MyFormatter') with the full name 
of your formatter type and "side-effect-import" this formatter class from the current 
"page.ts/grid.ts/dialog.ts file (import "./path/to/MyFormatter.ts").

After applying fixes, build and run "node ./tsbuild.js" (or "tsc" if using namespaces) 
from the project folder.`;throw re(l.replace(/\r?\n\r?\n/g,"<br/><br/>"),"",{escapeHtml:!1,timeOut:5e3}),new ye(l)}i.get=r;function e(){n.reset()}i.reset=e;function t(a){return n.tryGet(a)}i.tryGet=t})(ua||(ua={}));var da=class{constructor(r,e){this.include={},this.grid=r,this.idField=r.getView().idField,this.options=e||{},r.getGrid().onClick.subscribe((t,i)=>{if($(t.target).hasClass("select-item")){t.preventDefault();var a=r.getView().getItem(i.row),o=a[this.idField].toString();this.include[o]?delete this.include[o]:this.include[o]=!0;for(var l=0;l<r.getView().getLength();l++)r.getGrid().updateRow(l);this.updateSelectAll()}}),r.getGrid().onHeaderClick.subscribe((t,i)=>{if(!t.isDefaultPrevented()&&$(t.target).hasClass("select-all-items")){if(t.preventDefault(),Object.keys(this.include).length>0)jr(this.include);else{var a=r.getView().getItems();for(var o of a.filter(this.isSelectable.bind(this))){var l=o[this.idField];this.include[l]=!0}}this.updateSelectAll(),r.getView().setItems(r.getView().getItems(),!0),setTimeout(this.updateSelectAll.bind(this),0)}}),r.getView().onRowsChanged.subscribe(()=>this.updateSelectAll())}updateSelectAll(){var r=this.grid.getElement().find(".select-all-header .slick-column-name .select-all-items");if(r){var e=Object.keys(this.include);r.toggleClass("checked",e.length>0&&this.grid.getView().getItems().filter(this.isSelectable.bind(this)).length<=e.length)}}clear(){jr(this.include),this.updateSelectAll()}resetCheckedAndRefresh(){this.include={},this.updateSelectAll(),this.grid.getView().populate()}selectKeys(r){for(var e of r)this.include[e]=!0;this.updateSelectAll()}getSelectedKeys(){return Object.keys(this.include)}getSelectedAsInt32(){return Object.keys(this.include).map(function(r){return parseInt(r,10)})}getSelectedAsInt64(){return Object.keys(this.include).map(function(r){return parseInt(r,10)})}setSelectedKeys(r){this.clear();for(var e of r)this.include[e]=!0;this.updateSelectAll()}isSelectable(r){return r&&(this.options.selectable==null||this.options.selectable(r))}static createSelectColumn(r){return{name:'<span class="select-all-items check-box no-float "></span>',nameIsHtml:!0,toolTip:" ",field:"__select__",width:27,minWidth:27,headerCssClass:"select-all-header",sortable:!1,format:function(e){var t=e.item,i=r();if(!i||!i.isSelectable(t))return"";var a=i.include[e.item[i.idField]];return'<span class="select-item check-box no-float '+(a?" checked":"")+'"></span>'}}}};da=g([m.registerClass("Serenity.GridRowSelectionMixin")],da);var ca=class{constructor(r,e){this.include={},this.grid=r,this.idField=r.getView().idField,this.options=e||{},r.getGrid().onClick.subscribe((t,i)=>{if($(t.target).hasClass("rad-select-item")){t.preventDefault();var a=r.getView().getItem(i.row);if(!this.isSelectable(a))return;var o=a[this.idField].toString();this.include[o]==!0?jr(this.include):(jr(this.include),this.include[o]=!0);for(var l=0;l<r.getView().getLength();l++)r.getGrid().updateRow(l)}})}isSelectable(r){return r&&(this.options.selectable==null||this.options.selectable(r))}clear(){jr(this.include)}resetCheckedAndRefresh(){this.include={},this.grid.getView().populate()}getSelectedKey(){var r=Object.keys(this.include);return r!=null&&r.length>0?r[0]:null}getSelectedAsInt32(){var r=Object.keys(this.include).map(function(e){return parseInt(e,10)});return r!=null&&r.length>0?r[0]:null}getSelectedAsInt64(){var r=Object.keys(this.include).map(function(e){return parseInt(e,10)});return r!=null&&r.length>0?r[0]:null}setSelectedKey(r){this.clear(),this.include[r]=!0}static createSelectColumn(r){return{name:"",toolTip:" ",field:"__select__",width:27,minWidth:27,headerCssClass:"",sortable:!1,formatter:function(e,t,i,a,o){var l=r();if(!l||!l.isSelectable(o))return"";var u=l.include[o[l.idField]];return'<input type="radio" name="radio-selection-group" class="rad-select-item no-float" style="cursor: pointer;width: 13px; height:13px;" '+(u?" checked":"")+" /> "}}}};ca=g([m.registerClass("GridRadioSelectionMixin")],ca);var Wi;(e=>{function n(t,i){var a=t.element.children(".s-Toolbar");if(a.length!==0){var o=a.getWidget(He).findButton("select-all-button"),l=t.getView().getItems();o.toggleClass("checked",l.length>0&&!l.some(function(u){return!i(u)}))}}e.update=n;function r(t,i,a,o,l,u){var d;return l==null&&(l=(d=V("Controls.CheckTreeEditor.SelectAll"))!=null?d:"Select All"),{title:l,action:"select-all",cssClass:"select-all-button",onClick:function(){var c=t(),p=c.getView(),f=c.element.children(".s-Toolbar").getWidget(He).findButton("select-all-button"),b=!f.hasClass("checked");p.beginUpdate();try{for(var x of p.getItems())o(x,b),p.updateItem(i(x),x);u&&u()}finally{p.endUpdate()}f.toggleClass("checked",b)}}}e.define=r})(Wi||(Wi={}));var qr;(o=>{function n(l,u,d,c,p){var f=$('<div><a href="#"></a></div>').addClass("s-ToggleButton").addClass(u).prependTo(l);f.children("a").click(function(b){b.preventDefault(),f.toggleClass("pressed");var x=f.hasClass("pressed");d&&d(x)}).attr("title",c!=null?c:""),p&&f.addClass("pressed")}o.addToggleButton=n;function r(l,u,d,c){var p=!1,f=u.onSubmit;u.onSubmit=function(b){return b.params.IncludeDeleted=p,f!=null?f(b):!0},d==null&&(d=O("Controls.EntityGrid.IncludeDeletedToggle")),n(l,"s-IncludeDeletedToggle",function(b){p=b,u.seekToPage=1,u.populate()},d,c),l.bind("remove",function(){u.onSubmit=null,f=null})}o.addIncludeDeletedToggle=r;function e(l,u,d,c){var p=u.onSubmit,f;u.onSubmit=function(x){var S;if(f){var v=f.get_value();v&&v.length>0?x.params.ContainsText=v:delete x.params.ContainsText;var I=(S=f.get_field())==null?void 0:S.name;I!=null&&I.length>0?x.params.ContainsField=I:delete x.params.ContainsField}return p!=null?p(x):!0};var b=null;return f=t(l,(x,v,I)=>{c&&c(),u.seekToPage=1,b=I,u.populate()},d),u.onDataLoaded.subscribe(function(x,v){b!=null&&(b(u.getLength()>0),b=null)}),f}o.addQuickSearchInput=e;function t(l,u,d){var c=$('<div><input type="text"/></div>').addClass("s-QuickSearchBar").prependTo(l);return d!=null&&d.length>0&&c.addClass("has-quick-search-fields"),new nt(c.children(),{fields:d,onSearch:u})}o.addQuickSearchInputCustom=t;function i(l,u){var d=new Slick.RowMoveManager({cancelEditOnDrag:!0});d.onBeforeMoveRows.subscribe(function(c,p){for(var f=0;f<p.rows.length;f++)if(p.rows[f]===p.insertBefore||p.rows[f]===p.insertBefore-1)return c.stopPropagation(),!1;return!0}),d.onMoveRows.subscribe(function(c,p){u(p.rows,p.insertBefore);try{l.setSelectedRows([])}catch(f){}}),l.registerPlugin(d)}o.makeOrderable=i;function a(l,u,d,c,p){i(l.getGrid(),function(f,b){var T,_;if(f.length!==0){var x,v=b;v<0?x=1:b>=l.getGrid().getDataLength()?(x=(T=d(l.getGrid().getDataItem(l.getGrid().getDataLength()-1)))!=null?T:0,x===0?x=b+1:x=x+1):(x=(_=d(l.getGrid().getDataItem(b)))!=null?_:0,x===0&&(x=b+1));var I=0,S=null;S=function(){$e({service:c,request:p(u(l.getGrid().getDataItem(f[I])),x++),onSuccess:function(N){I++,I<f.length?S():l.getView().populate()}})},S()}})}o.makeOrderableWithUpdateRequest=a})(qr||(qr={}));var pa;(e=>{function n(t){var i=[];if(t==null)return i;for(var a=0;a<t.length;a++)i.push(e.toSlickColumn(t[a]));return i}e.toSlickColumns=n;function r(t){var d,c;var i={field:t.name,sourceItem:t,cssClass:t.cssClass,headerCssClass:t.headerCssClass,sortable:t.sortable!==!1,sortOrder:(d=t.sortOrder)!=null?d:0,width:t.width!=null?t.width:80,minWidth:(c=t.minWidth)!=null?c:30,maxWidth:t.maxWidth==null||t.maxWidth===0?null:t.maxWidth,resizable:t.resizable==null||!!t.resizable};i.visible=t.visible!==!1&&t.filterOnly!==!0&&(t.readPermission==null||ae.hasPermission(t.readPermission));var a=V(t.title);if(a==null&&(a=t.title),i.name=a,t.alignment!=null&&t.alignment.length>0&&(w(i.cssClass)?i.cssClass="align-"+t.alignment:i.cssClass+=" align-"+t.alignment),t.formatterType!=null&&t.formatterType.length>0){var o=ua.get(t.formatterType),l=new o;t.formatterParams!=null&&ut.set(l,t.formatterParams);var u=Ce(l,yr);u!=null&&u.initializeColumn(i),i.format=p=>l.format(p)}return i}e.toSlickColumn=r})(pa||(pa={}));var Pt;(c=>{function n(p,f){return Ft.getText(p,f)}c.getEnumText=n;function r(p,f,b){return function(x){var R,z;var v=b(x),I=p(),S=(R=x.item._indent)!=null?R:0,T='<span class="s-TreeIndent" style="width:'+15*S+'px"></span>',_=f(x.item),N=I.getIdxById(_),E=I.getItemByIdx(N+1);if(E!=null){var D=(z=E._indent)!=null?z:0;if(D>S)return x.item._collapsed?T+'<span class="s-TreeToggle s-TreeExpand"></span>'+v:T+'<span class="s-TreeToggle s-TreeCollapse"></span>'+v}return T+'<span class="s-TreeToggle"></span>'+v}}c.treeToggle=r;function e(p){return p==null&&(p=F.dateFormat),function(f){return L(xt.format(f.value,p))}}c.date=e;function t(p){return p==null&&(p=F.dateTimeFormat),function(f){return L(xt.format(f.value,p))}}c.dateTime=t;function i(){return function(p){return'<span class="check-box no-float '+(p.value?" checked":"")+'"></span>'}}c.checkBox=i;function a(p){return function(f){return Jt.format(f.value,p)}}c.number=a;function o(p){return p.data("item-type")}c.getItemType=o;function l(p){var f=p.data("item-id");return f==null?null:f.toString()}c.getItemId=l;function u(p,f,b,x,v){return"<a"+(f!=null?' href="#'+Ie(p,".","-")+"/"+f+'"':"")+' data-item-type="'+L(p)+'" data-item-id="'+L(f)+'" class="s-EditLink s-'+Ie(p,".","-")+"Link"+(w(x)?"":" "+x)+'">'+(v?L(b!=null?b:""):b!=null?b:"")+"</a>"}c.itemLinkText=u;function d(p,f,b,x,v){return function(I){var T,_;var S=(T=b==null?I.value:b(I))!=null?T:"";return(_=I.item)!=null&&_.__nonDataRow?v?L(S):S:u(p,I.item[f],b==null?I.value:b(I),x==null?"":x(I),v)}}c.itemLink=d})(Pt||(Pt={}));var fa;(r=>{function n(e,t){for(var i of e){i.sortable=i.sortable!=null?i.sortable:!0;var a=i.id;if(a==null&&(a=i.field),i.id=a,t!=null&&i.id!=null&&(i.name==null||G(i.name,"~"))){var o=i.name!=null?i.name.substr(1):i.id;i.name=O(t+o)}}return e}r.setDefaults=n})(fa||(fa={}));var at;(o=>{function n(l,u){for(var d=u(l),c=0;d!=null;){if(d._collapsed)return!1;if(d=u(d),c++>1e3)throw new Error("Possible infinite loop, check parents has no circular reference!")}return!0}o.filterCustom=n;function r(l,u,d){return n(l,function(c){var p=d(c);return p==null?null:u.getItemById(p)})}o.filterById=r;function e(l,u){if(l!=null)for(var d of l)d._collapsed=u}o.setCollapsed=e;function t(l,u){l._collapsed=u}o.setCollapsedFlag=t;function i(l,u,d,c){for(var p=0,f={},b=0;b<l.length;b++){var x=l[b];if(b>0){var v=d(x);v!=null&&v===u(l[b-1])?p+=1:v==null?p=0:v!==d(l[b-1])&&(f[v]!=null?p=f[v]+1:p=0)}f[u(x)]=p,x._indent=p,c!=null&&(x._collapsed=c)}}o.setIndents=i;function a(l,u,d,c,p){var f=$(l.target);if(f.hasClass("s-TreeToggle")&&(f.hasClass("s-TreeCollapse")||f.hasClass("s-TreeExpand"))){var b=c.getItem(u);if(b!=null&&(b._collapsed?b._collapsed=!1:b._collapsed=!0,c.updateItem(p(b),b)),l.shiftKey){c.beginUpdate();try{e(c.getItems(),!!b._collapsed),c.setItems(c.getItems(),!0)}finally{c.endUpdate()}}}}o.toggleClick=a})(at||(at={}));var Co=class{constructor(r){var t;this.__items=r;for(var e of r){let i=e.id;i&&!this[i]&&(this[i]=e)}for(var e of r){let a=(t=e.sourceItem)==null?void 0:t.name;a&&!this[a]&&(this[a]=e)}for(var e of r){let a=e.field;a&&!this[a]&&(this[a]=e)}}valueOf(){return this.__items}};import{AutoTooltips as xu,Grid as Tu}from"@serenity-is/sleekgrid";var De=class extends P{constructor(e,t){super(e,t);this.restoringSettings=0;var i=this;this.element.addClass("s-DataGrid").html("");var a=function(){i.layout(),i._layoutTimer!=null&&Mt.store(i._layoutTimer)};this.element.addClass("require-layout").on("layout."+this.uniqueName,a),this.useLayoutTimer()&&(this._layoutTimer=Mt.onSizeChange(()=>this.element&&this.element[0],ro(a,50))),this.setTitle(this.getInitialTitle());var o=this.getButtons();o!=null&&this.createToolbar(o),this.slickContainer=this.createSlickContainer(),this.view=this.createView(),this.useAsync()?this.initAsync():this.initSync()}internalInit(){var t;this.allColumns=(t=this.allColumns)!=null?t:this.getColumns(),this.slickGrid=this.createSlickGrid(),this.enableFiltering()&&this.createFilterBar(),this.usePager()&&this.createPager(),this.bindToSlickEvents(),this.bindToViewEvents(),this.toolbar&&this.createToolbarExtensions(),this.createQuickFilters(),this.updateDisabledState(),this.updateInterface(),this.initialSettings=this.getCurrentSettings(null);var e=this.restoreSettings(null,null);e!=null&&e.then?e.then(()=>window.setTimeout(()=>this.initialPopulate(),0)):window.setTimeout(()=>this.initialPopulate(),0)}initSync(){this.propertyItemsData=this.getPropertyItemsData(),this.internalInit(),this.afterInit()}initAsync(){return me(this,null,function*(){this.propertyItemsData=yield this.getPropertyItemsDataAsync(),this.internalInit(),this.afterInit()})}afterInit(){}useAsync(){return!1}useLayoutTimer(){return!0}attrs(e){return ce(U(this),e,!0)}layout(){if(!(!this.element||!this.element.is(":visible")||!this.slickContainer||!this.slickGrid)){var e=this.element.hasClass("responsive-height"),t=this.slickGrid!=null&&this.slickGrid.getOptions().autoHeight,i=e&&window.innerWidth<768;i?t||this.slickGrid.setOptions({autoHeight:!0}):t&&(this.slickContainer.css("height",""),this.slickContainer.children(".slick-viewport").css("height",""),this.slickGrid.setOptions({autoHeight:!1})),this.slickGrid.resizeCanvas()}}getInitialTitle(){return null}createToolbarExtensions(){}ensureQuickFilterBar(){return this.quickFiltersDiv==null&&this.createQuickFilters([]),this.quickFiltersBar}createQuickFilters(e){this.quickFiltersDiv==null&&(e!=null||(e=this.getQuickFilters())&&e!=null&&e.length)&&(this.quickFiltersDiv=$("<div/>").addClass("quick-filters-bar"),this.toolbar?($("<div/>").addClass("clear").appendTo(this.toolbar.element),this.quickFiltersDiv.appendTo(this.toolbar.element)):this.quickFiltersDiv.appendTo($("<div/>").addClass("s-Toolbar").insertBefore(this.slickContainer)),this.quickFiltersBar=new We(this.quickFiltersDiv,{filters:e,getTitle:t=>this.determineText(i=>i+t.field),idPrefix:this.uniqueName+"_QuickFilter_"}),this.quickFiltersBar.onChange=t=>this.quickFilterChange(t))}getQuickFilters(){return this.allColumns.filter(function(e){return e.sourceItem&&e.sourceItem.quickFilter===!0&&(e.sourceItem.readPermission==null||ae.hasPermission(e.sourceItem.readPermission))}).map(e=>De.propertyItemToQuickFilter(e.sourceItem)).filter(e=>e!=null)}static propertyItemToQuickFilter(e){var f,b;var t={},i=e.name,a=V(e.title);a==null&&(a=e.title,a==null&&(a=i));var o=bi.get((f=e.filteringType)!=null?f:"String");if(o===mi)t=We.dateRange(i,a);else if(o===vi)t=We.dateTimeRange(i,a,(b=e.editorParams)==null?void 0:b.useUtc);else if(o===yi){var l=e.quickFilterParams||{},u=e.filteringParams||{},d=l.trueText;d==null&&(d=u.trueText);var c=l.falseText;c==null&&(c=u.falseText),t=We.boolean(i,a,d,c)}else{var p=new o;if(p&&Ae(p,Gr))ut.set(p,e.filteringParams),p.set_field(e),p.set_operator({key:J.EQ}),p.initQuickFilter(t),t.options=Q(Ve(t.options),e.quickFilterParams);else return null}return e.quickFilterSeparator&&(t.separator=!0),t.cssClass=e.quickFilterCssClass,t}findQuickFilter(e,t){return this.quickFiltersBar!=null?this.quickFiltersBar.find(e,t):$("#"+this.uniqueName+"_QuickFilter_"+t).getWidget(e)}tryFindQuickFilter(e,t){if(this.quickFiltersBar!=null)return this.quickFiltersBar.tryFind(e,t);var i=$("#"+this.uniqueName+"_QuickFilter_"+t);return i.length?i.tryGetWidget(e):null}createIncludeDeletedButton(){(!w(this.getIsActiveProperty())||!w(this.getIsDeletedProperty()))&&qr.addIncludeDeletedToggle(this.toolbar.element,this.view,null,!1)}getQuickSearchFields(){return null}createQuickSearchInput(){var t;var e=qr.addQuickSearchInput(this.toolbar.element,this.view,this.getQuickSearchFields(),()=>this.persistSettings(null));(t=e==null?void 0:e.element)==null||t.attr("id",this.idPrefix+"QuickSearchInput")}destroy(){this._layoutTimer&&(this._layoutTimer=Mt.off(this._layoutTimer)),this.quickFiltersBar&&(this.quickFiltersBar.destroy(),this.quickFiltersBar=null),this.toolbar&&(this.toolbar.destroy(),this.toolbar=null),this.slickGrid&&(this.slickGrid.onClick.clear(),this.slickGrid.onSort.clear(),this.slickGrid.onColumnsResized.clear(),this.slickGrid.onColumnsReordered.clear(),this.slickGrid.destroy(),this.slickGrid=null),this.view&&(this.view.onDataChanged.clear(),this.view.onSubmit=null,this.view.setFilter(null),this.view=null),this.titleDiv=null,super.destroy()}getItemCssClass(e,t){var i=this.getIsActiveProperty(),a=this.getIsDeletedProperty();if(w(i)&&w(a))return null;if(i){var o=e[i];if(o==null)return null;if(typeof o=="number"){if(o<0)return"deleted";if(o===0)return"inactive"}else if(typeof o=="boolean"&&o===!1)return"deleted"}else return e[a]?"deleted":null;return null}getItemMetadata(e,t){var i=this.getItemCssClass(e,t);return w(i)?new Object:{cssClasses:i}}postProcessColumns(e){fa.setDefaults(e,this.getLocalTextDbPrefix());var t=this.getColumnWidthDelta(),i=this.getColumnWidthScale();if(i<0&&(i=1),t!==0||i!==1)for(var a of e)typeof a.width=="number"&&(a.width=Math.round(a.width*i+t)),typeof a.minWidth=="number"&&(a.minWidth=Math.round(a.minWidth*i+t)),typeof a.maxWidth=="number"&&(a.maxWidth=Math.round(a.maxWidth*i+t));return e}getColumnWidthDelta(){var e;return(e=De.defaultColumnWidthDelta)!=null?e:0}getColumnWidthScale(){var e;return(e=De.defaultColumnWidthScale)!=null?e:1}initialPopulate(){var e=this;this.populateWhenVisible()?(kt.executeEverytimeWhenShown(this.element,function(){e.refreshIfNeeded()},!1),this.element.is(":visible")&&this.view&&this.view.populate()):this.view&&this.view.populate()}canFilterColumn(e){return e.sourceItem!=null&&e.sourceItem.notFilterable!==!0&&(e.sourceItem.readPermission==null||ae.hasPermission(e.sourceItem.readPermission))}initializeFilterBar(){this.filterBar.set_store(new pt(this.allColumns.filter(e=>this.canFilterColumn(e)).map(e=>e.sourceItem))),this.filterBar.get_store().add_changed((e,t)=>{this.restoringSettings<=0&&(this.persistSettings(null),this.view&&(this.view.seekToPage=1),this.refresh())})}createSlickGrid(){var e=this.postProcessColumns(this.allColumns).filter(function(a){return a.visible!==!1}),t=this.getSlickOptions(),i=new Tu(this.slickContainer,this.view,e,t);return i.registerPlugin(new xu({enableForHeaderCells:!0})),this.slickGrid=i,this.setInitialSortOrder(),i}setInitialSortOrder(){var e=this.getDefaultSortBy();this.view&&(this.view.sortBy=Array.prototype.slice.call(e));var t=e.map(function(i){var a;return i&&te(i.toLowerCase()," desc")?{columnId:As(i.substr(0,i.length-5)),sortAsc:!1}:{columnId:i,sortAsc:!0}});this.slickGrid.setSortColumns(t)}itemAt(e){return this.slickGrid.getDataItem(e)}rowCount(){return this.slickGrid.getDataLength()}getItems(){return this.view.getItems()}setItems(e){this.view.setItems(e,!0)}bindToSlickEvents(){var e=this;this._slickGridOnSort=(t,i)=>{e.view.populateLock();try{var a=[],o;if(i.multiColumnSort)for(var l=0;l<i.sortCols.length;l++){var u=i.sortCols[l];o=u.sortCol,o==null&&(o={}),a.push(o.field+(u.sortAsc?"":" DESC"))}else{var o=i.sortCol;o==null&&(o={}),a.push(o.field+(i.sortAsc?"":" DESC"))}e.view.seekToPage=1,e.view.sortBy=a}finally{e.view.populateUnlock()}e.view.getLocalSort&&e.view.getLocalSort()?e.view.sort():e.view.populate(),this.persistSettings(null)},this.slickGrid.onSort.subscribe(this._slickGridOnSort),this._slickGridOnClick=(t,i)=>{e.onClick(t,i.row,i.cell)},this.slickGrid.onClick.subscribe(this._slickGridOnClick),this.slickGrid.onColumnsReordered.subscribe((t,i)=>this.persistSettings(null)),this.slickGrid.onColumnsResized.subscribe((t,i)=>this.persistSettings(null))}getAddButtonCaption(){var e;return(e=V("Controls.DataGrid.NewButton"))!=null?e:"New"}getButtons(){return[]}editItem(e){throw new Error("Not Implemented!")}editItemOfType(e,t){if(e===this.getItemType()){this.editItem(t);return}throw new Error("Not Implemented!")}onClick(e,t,i){if(!e.isDefaultPrevented()){var a=$(e.target);a.hasClass("s-EditLink")||(a=a.closest("a")),a.hasClass("s-EditLink")&&(e.preventDefault(),this.editItemOfType(Pt.getItemType(a),Pt.getItemId(a)))}}viewDataChanged(e,t){this.markupReady(),this.layout()}bindToViewEvents(){var e=this;this.view.onDataChanged.subscribe(function(t,i){return e.viewDataChanged(t,i)}),this.view.onSubmit=function(t){return e.onViewSubmit()},this.view.setFilter(function(t,i){return e.onViewFilter(t)}),this.view.onProcessData=function(t,i){return e.onViewProcessData(t)}}onViewProcessData(e){return e}onViewFilter(e){return!0}getIncludeColumns(e){var t=this.slickGrid.getColumns();for(var i of t)if(i.field&&(e[i.field]=!0),i.referencedFields)for(var a of i.referencedFields)e[a]=!0}setCriteriaParameter(){if(delete this.view.params.Criteria,this.filterBar){var e=this.filterBar.get_store().get_activeCriteria();W.isEmpty(e)||(this.view.params.Criteria=e)}}setEquality(e,t){Us(this.view.params,e,t)}setIncludeColumnsParameter(){var e={};this.getIncludeColumns(e);var t=[];for(var i of Object.keys(e))t.push(i);this.view.params.IncludeColumns=t}onViewSubmit(){return this._isDisabled||!this.getGridCanLoad()?!1:(this.setCriteriaParameter(),this.setIncludeColumnsParameter(),this.invokeSubmitHandlers(),!0)}markupReady(){}createSlickContainer(){return $('<div class="grid-container"></div>').appendTo(this.element)}createView(){var e=this.getViewOptions();return new xn(e)}getDefaultSortBy(){if(this.slickGrid){var e=this.slickGrid.getColumns().filter(function(o){return o.sortOrder&&o.sortOrder!==0});if(e.length>0){e.sort(function(o,l){return Math.abs(o.sortOrder)<Math.abs(l.sortOrder)?-1:Math.abs(o.sortOrder)>Math.abs(l.sortOrder)?1:0});for(var t=[],i=0;i<e.length;i++){var a=e[i];t.push(a.field+(a.sortOrder<0?" DESC":""))}return t}}return[]}usePager(){return!1}enableFiltering(){var e=this.attrs(Er);return e.length>0&&e[0].value}populateWhenVisible(){return!1}createFilterBar(){var e=$("<div/>").appendTo(this.element);this.filterBar=new Ci(e),this.initializeFilterBar()}getPagerOptions(){return{view:this.view,rowsPerPage:20,rowsPerPageOptions:[20,100,500,2500]}}createPager(){var e=$("<div></div>").appendTo(this.element);new Ii(e,this.getPagerOptions())}getViewOptions(){var e={};return e.idField=this.getIdProperty(),e.sortBy=this.getDefaultSortBy(),this.usePager()?this.element.hasClass("responsive-height")?e.rowsPerPage=$(window.window).width()<768?20:100:e.rowsPerPage=100:e.rowsPerPage=0,e.getItemMetadata=(t,i)=>this.getItemMetadata(t,i),e}createToolbar(e){var t=$('<div class="grid-toolbar"></div>').appendTo(this.element);this.toolbar=new He(t,{buttons:e,hotkeyContext:this.element[0]})}getTitle(){return this.titleDiv?this.titleDiv.children(".title-text").text():null}setTitle(e){e!==this.getTitle()&&(e==null?this.titleDiv&&(this.titleDiv.remove(),this.titleDiv=null):(this.titleDiv||(this.titleDiv=$('<div class="grid-title"><div class="title-text"></div></div>').prependTo(this.element)),this.titleDiv.children(".title-text").text(e)),this.layout())}getItemType(){return"Item"}itemLink(e,t,i,a,o=!0){return e==null&&(e=this.getItemType()),t==null&&(t=this.getIdProperty()),Pt.itemLink(e,t,i,a,o)}getColumnsKey(){var e=this.attrs(ai);return e&&e.length>0?e[0].value:null}getPropertyItems(){var e;return((e=this.propertyItemsData)==null?void 0:e.items)||[]}getPropertyItemsData(){var e=this.getColumnsKey();return this.getColumnsKey===De.prototype.getColumnsKey&&this.getPropertyItems!==De.prototype.getPropertyItems&&!he.canLoad("Columns."+e)?{items:this.getPropertyItems(),additionalItems:[]}:w(e)?{items:[],additionalItems:[]}:Ka(e)}getPropertyItemsDataAsync(){return me(this,null,function*(){var e=this.getColumnsKey();return w(e)?{items:[],additionalItems:[]}:yield Ya(e)})}getColumns(){return this.propertyItemsToSlickColumns(this.getPropertyItems())}propertyItemsToSlickColumns(e){for(var t=pa.toSlickColumns(e),i=0;i<e.length;i++){var a=e[i],o=t[i];if(a.editLink===!0){var l={$:o.format},u={$:a.editLinkCssClass!=null?a.editLinkCssClass:null};o.format=this.itemLink(a.editLinkItemType!=null?a.editLinkItemType:null,a.editLinkIdField!=null?a.editLinkIdField:null,function(d){return this.oldFormat.$!=null?this.oldFormat.$(d):L(d.value)}.bind({oldFormat:l}),function(d){var c;return(c=this.css.$)!=null?c:""}.bind({css:u}),!1),w(a.editLinkIdField)||(o.referencedFields=o.referencedFields||[],o.referencedFields.push(a.editLinkIdField))}}return t}getSlickOptions(){var e={};return e.multiSelect=!1,e.multiColumnSort=!0,e.enableCellNavigation=!1,De.defaultHeaderHeight&&(e.headerRowHeight=De.defaultHeaderHeight),De.defaultRowHeight&&(e.rowHeight=De.defaultRowHeight),e}populateLock(){this.view.populateLock()}populateUnlock(){this.view.populateUnlock()}getGridCanLoad(){return!0}refresh(){if(!this.populateWhenVisible()){this.internalRefresh();return}if(this.slickContainer.is(":visible")){this.slickContainer.data("needsRefresh",!1),this.internalRefresh();return}this.slickContainer.data("needsRefresh",!0)}refreshIfNeeded(){this.slickContainer.data("needsRefresh")&&(this.slickContainer.data("needsRefresh",!1),this.internalRefresh())}internalRefresh(){this.view.populate()}setIsDisabled(e){this._isDisabled!==e&&(this._isDisabled=e,this._isDisabled&&this.view.setItems([],!0),this.updateDisabledState())}get readOnly(){return this.get_readOnly()}set readOnly(e){this.set_readOnly(e)}get_readOnly(){return!!this._readonly}set_readOnly(e){!!this._readonly!=!!e&&(this._readonly=!!e,this.updateInterface())}updateInterface(){this.toolbar&&this.toolbar.updateInterface()}getRowDefinition(){return null}getLocalTextDbPrefix(){var e;return this._localTextDbPrefix!=null?this._localTextDbPrefix:(this._localTextDbPrefix=(e=this.getLocalTextPrefix())!=null?e:"",this._localTextDbPrefix.length>0&&!te(this._localTextDbPrefix,".")&&(this._localTextDbPrefix="Db."+this._localTextDbPrefix+"."),this._localTextDbPrefix)}getLocalTextPrefix(){var e=this.getRowDefinition();if(e)return e.localTextPrefix;var t=this.attrs(sr);if(t.length>=1)return t[0].value}getIdProperty(){var i,a;if(this._idProperty!=null)return this._idProperty;var e=this.getRowDefinition();if(e)return this._idProperty=(i=e.idProperty)!=null?i:"";var t=this.attrs(nr);return t.length===1?this._idProperty=(a=t[0].value)!=null?a:"":this._idProperty="ID"}getIsDeletedProperty(){var e;return(e=this.getRowDefinition())==null?void 0:e.isDeletedProperty}getIsActiveProperty(){var i,a;if(this._isActiveProperty!=null)return this._isActiveProperty;var e=this.getRowDefinition();if(e)return this._isActiveProperty=(i=e.isActiveProperty)!=null?i:"";var t=this.attrs(ar);return t.length===1?this._isActiveProperty=(a=t[0].value)!=null?a:"":this._isActiveProperty=""}updateDisabledState(){this.slickContainer.toggleClass("ui-state-disabled",!!this._isDisabled)}resizeCanvas(){var e;(e=this.slickGrid)==null||e.resizeCanvas()}subDialogDataChange(){this.refresh()}addFilterSeparator(){this.ensureQuickFilterBar().addSeparator()}determineText(e){var t=this.getLocalTextDbPrefix();if(!w(t)){var i=V(e(t));if(i!=null)return i}return null}addQuickFilter(e){return this.ensureQuickFilterBar().add(e)}addDateRangeFilter(e,t){return this.ensureQuickFilterBar().addDateRange(e,t)}dateRangeQuickFilter(e,t){return We.dateRange(e,t)}addDateTimeRangeFilter(e,t){return this.ensureQuickFilterBar().addDateTimeRange(e,t)}dateTimeRangeQuickFilter(e,t){return We.dateTimeRange(e,t)}addBooleanFilter(e,t,i,a){return this.ensureQuickFilterBar().addBoolean(e,t,i,a)}booleanQuickFilter(e,t,i,a){return We.boolean(e,t,i,a)}invokeSubmitHandlers(){this.quickFiltersBar!=null&&this.quickFiltersBar.onSubmit(this.view.params)}quickFilterChange(e){this.persistSettings(null),this.view&&(this.view.seekToPage=1),this.refresh()}getPersistanceStorage(){return De.defaultPersistanceStorage}getPersistanceKey(){var e="GridSettings:",t=window.location.pathname;return w(t)||(e+=t.substr(1).split(String.fromCharCode(47)).slice(0,2).join("/")+":"),e+=se(U(this)),e}gridPersistanceFlags(){return{}}canShowColumn(e){if(e==null)return!1;var t=e.sourceItem;return t==null?!0:t.filterOnly===!0?!1:t.readPermission==null?!0:ae.hasPermission(t.readPermission)}getPersistedSettings(){var e=this.getPersistanceStorage();if(e==null)return null;function t(a){return a=Y(a),a!=null&&G(a,"{")&&te(a,"}")?JSON.parse(a):null}var i=e.getItem(this.getPersistanceKey());return i!=null&&i.then?i.then(a=>t(a)):t(i)}restoreSettings(e,t){if(e!=null)return this.restoreSettingsFrom(e,t);var i=this.getPersistedSettings();if(i!=null&&i.then)return i.then(a=>this.restoreSettingsFrom(a));this.restoreSettingsFrom(i)}restoreSettingsFrom(e,t){if(!(!this.slickGrid||!e)){var i=this.slickGrid.getColumns(),a=null,o=function(le){a={};for(var K=0;K<le.length;K++){var Oe=le[K];a[Oe.id]=Oe}};this.view.beginUpdate(),this.restoringSettings++;try{if(t=t||this.gridPersistanceFlags(),e.columns!=null){if(t.columnVisibility!==!1){var l={};o(this.allColumns);for(var u=[],d=0;d<e.columns.length;d++){var c=e.columns[d];if(c.id!=null&&c.visible===!0){var p=a[c.id];this.canShowColumn(p)&&(p.visible=!0,u.push(p),delete a[c.id])}}for(var f=0;f<this.allColumns.length;f++){var b=this.allColumns[f];a[b.id]!=null&&(b.visible=!1,u.push(b))}this.allColumns=u,i=this.allColumns.filter(function(le){return le.visible===!0})}if(t.columnWidths!==!1){o(i);for(var x=0;x<e.columns.length;x++){var v=e.columns[x];if(v.id!=null&&v.width!=null&&v.width!==0){var I=a[v.id];I!=null&&(I.width=v.width)}}}if(t.sortColumns!==!1){o(i);var S=[],T=e.columns.filter(function(le){var K;return le.id!=null&&((K=le.sort)!=null?K:0)!==0});T.sort(function(le,K){return Math.abs(le.sort)-Math.abs(K.sort)});for(var _=0;_<T.length;_++){var N=T[_],E=a[N.id];E!=null&&S.push({columnId:N.id,sortAsc:N.sort>0})}this.view.sortBy=S.map(function(le){return le.columnId+(le.sortAsc===!1?" DESC":"")}),this.slickGrid.setSortColumns(S)}this.slickGrid.setColumns(i),this.slickGrid.invalidate()}if(e.filterItems!=null&&t.filterItems!==!1&&this.filterBar!=null&&this.filterBar.get_store()!=null){var D=this.filterBar.get_store().get_items();D.length=0,D.push.apply(D,e.filterItems),this.filterBar.get_store().raiseChanged()}if(e.includeDeleted!=null&&t.includeDeleted!==!1){var R=this.element.find(".s-IncludeDeletedToggle");!!e.includeDeleted!==R.hasClass("pressed")&&R.children("a").click()}if(e.quickFilters!=null&&t.quickFilters!==!1&&this.quickFiltersDiv!=null&&this.quickFiltersDiv.length>0&&this.quickFiltersDiv.find(".quick-filter-item").each((le,K)=>{var Oe=$(K).data("qffield");if(!w(Oe)){var fe=$("#"+this.uniqueName+"_QuickFilter_"+Oe).tryGetWidget(P);if(fe!=null){var ue=e.quickFilters[Oe],ge=$(K).data("qfloadstate");ge!=null?ge(fe,ue):q.setValue(fe,ue)}}}),t.quickSearch===!0&&(e.quickSearchField!==void 0||e.quickSearchText!==void 0)){var z=this.toolbar.element.find(".s-QuickSearchInput").first();if(z.length>0){var Te=z.tryGetWidget(nt);Te&&Te.restoreState(e.quickSearchText,e.quickSearchField)}}}finally{this.restoringSettings--,this.view.endUpdate()}}}persistSettings(e){var t=this.getPersistanceStorage();if(t){var i=this.getCurrentSettings(e);return t.setItem(this.getPersistanceKey(),JSON.stringify(i))}}getCurrentSettings(e){e=e||this.gridPersistanceFlags();var t={};if(e.columnVisibility!==!1||e.columnWidths!==!1||e.sortColumns!==!1){t.columns=[];var i=this.slickGrid.getSortColumns(),a=this.slickGrid.getColumns();for(var o of a){var l={id:o.id};if(e.columnVisibility!==!1&&(l.visible=!0),e.columnWidths!==!1&&(l.width=o.width),e.sortColumns!==!1){var u=Os(i,p=>p.columnId==o.id);l.sort=u>=0?i[u].sortAsc!==!1?u+1:-u-1:0}t.columns.push(l)}}if(e.includeDeleted!==!1&&(t.includeDeleted=this.element.find(".s-IncludeDeletedToggle").hasClass("pressed")),e.filterItems!==!1&&this.filterBar!=null&&this.filterBar.get_store()!=null&&(t.filterItems=this.filterBar.get_store().get_items().slice()),e.quickSearch===!0){var d=this.toolbar.element.find(".s-QuickSearchInput").first();if(d.length>0){var c=d.tryGetWidget(nt);c!=null&&(t.quickSearchField=c.get_field(),t.quickSearchText=c.element.val())}}return e.quickFilters!==!1&&this.quickFiltersDiv!=null&&this.quickFiltersDiv.length>0&&(t.quickFilters={},this.quickFiltersDiv.find(".quick-filter-item").each((p,f)=>{var N;var b=$(f).data("qffield");if(!w(b)){var x=$("#"+this.uniqueName+"_QuickFilter_"+b).tryGetWidget(P);if(x!=null){var v=$(f).data("qfsavestate"),I=v!=null?v(x):q.getValue(x);if(t.quickFilters[b]=I,e.quickFilterText===!0&&$(f).hasClass("quick-filter-active")){var S=$(f).data("qfdisplaytext"),T=$(f).find(".quick-filter-label").text(),_;S!=null?_=S(x,T):_=T+" = "+q.getDisplayText(x),w(_)||(w(t.quickFilterText)?t.quickFilterText=_:(t.quickFilterText+=" "+((N=V("Controls.FilterPanel.And"))!=null?N:"and")+" ",t.quickFilterText+=_))}}}})),t}getElement(){return this.element}getGrid(){return this.slickGrid}getView(){return this.view}getFilterStore(){return this.filterBar==null?null:this.filterBar.get_store()}};De=g([m.registerClass("Serenity.DataGrid",[pe]),m.element("<div/>")],De);var vr=class extends xe{constructor(){super();new nt(this.byId("Search"),{onSearch:(e,t,i)=>{t=Y(t),t!=null&&(t=Select2.util.stripDiacritics(t.toLowerCase())),this.element.find("li").each((a,o)=>{$(o).toggle(!t||Select2.util.stripDiacritics($(o).text().toLowerCase()).indexOf(t)>=0)}),i&&i(!0)}}),this.ulVisible=this.byId("VisibleCols"),this.ulHidden=this.byId("HiddenCols"),this.dialogTitle=O("Controls.ColumnPickerDialog.Title")}static createToolButton(e){function t(){var i=new vr;if(i.allColumns=e.allColumns,e.initialSettings){var a=e.initialSettings;a.columns&&a.columns.length&&(i.defaultColumns=a.columns.map(o=>o.id))}i.visibleColumns=e.getGrid().getColumns().map(o=>o.id),i.done=()=>{e.allColumns=i.allColumns;var o=i.allColumns.filter(l=>l.visible===!0);e.getGrid().setColumns(o),Promise.resolve(e.persistSettings()).then(()=>e.getView().populate())},Ke&&Ke.dialog&&Ke.dialog(e.element,i.element,()=>"columns"),i.dialogOpen()}return e.element.on("handleroute."+e.uniqueName,(i,a)=>{a&&!a.handled&&a.route=="columns"&&t()}),{hint:O("Controls.ColumnPickerDialog.Title"),action:"column-picker",cssClass:"column-picker-button",icon:"fa-th-list text-blue",onClick:t}}getDialogButtons(){return[{text:O("Controls.ColumnPickerDialog.RestoreDefaults"),click:()=>{let e={};this.ulVisible.children().add(this.ulHidden.children()).each((i,a)=>{let o=$(a);e[o.data("key")]=o});let t=null;for(let i of this.defaultColumns){let a=e[i];if(!a)continue;t==null?a.prependTo(this.ulVisible):a.insertAfter(t),t=a;let o=a.data("key");delete e[o]}for(let i in e)e[i].appendTo(this.ulHidden);this.updateListStates()}},{text:O("Dialogs.OkButton"),click:()=>{let e=[];for(var t of this.allColumns)t.visible=!1;this.visibleColumns=this.ulVisible.children().toArray().map(i=>{let a=$(i).data("key");var o=this.colById[a];return o.visible=!0,e.push(o),a});for(var t of this.allColumns)t.visible||e.push(t);this.allColumns=e,this.done&&this.done(),this.dialogClose()}},{text:O("Dialogs.CancelButton"),click:()=>{this.dialogClose()}}]}getDialogOptions(){var e=super.getDialogOptions();return e.width=600,e}getTitle(e){return e.id=="__select__"?"[x]":e.name||e.toolTip||e.id}allowHide(e){return e.sourceItem==null||e.sourceItem.allowHide==null||e.sourceItem.allowHide}createLI(e){var t=this.allowHide(e);return $(`
<li data-key="${e.id}" class="${t?"":"cant-hide"}">
<span class="drag-handle">\u2630</span>
${L(this.getTitle(e))}
${t?`<i class="js-hide fa fa-eye-slash" title="${L(O("Controls.ColumnPickerDialog.HideHint"))}"></i>`:""}
<i class="js-show fa fa-eye" title="${L(O("Controls.ColumnPickerDialog.ShowHint"))}"></i>
</li>`)}updateListStates(){this.ulVisible.children().removeClass("bg-info").addClass("bg-success"),this.ulHidden.children().removeClass("bg-success").addClass("bg-info")}setupColumns(){this.allColumns=this.allColumns||[],this.visibleColumns=this.visibleColumns||[];let e={};for(let o of this.visibleColumns)e[o]=!0;this.colById={};for(let o of this.allColumns)this.colById[o.id]=o;this.defaultColumns==null&&(this.defaultColumns=this.visibleColumns.slice(0));let t=[];for(let o of this.allColumns)!e[o.id]&&(!o.sourceItem||o.sourceItem.filterOnly!==!0&&(o.sourceItem.readPermission==null||ae.hasPermission(o.sourceItem.readPermission)))&&t.push(o);let i=t.sort((o,l)=>F.stringCompare(this.getTitle(o),this.getTitle(l)));for(let o of this.visibleColumns){var a=this.colById[o];a&&this.createLI(a).appendTo(this.ulVisible)}for(let o of i)this.createLI(o).appendTo(this.ulHidden);this.updateListStates(),typeof Sortable!="undefined"&&Sortable.create&&(Sortable.create(this.ulVisible[0],{group:this.uniqueName+"_group",filter:".js-hide",onFilter:o=>{$(o.item).appendTo(this.ulHidden),this.updateListStates()},onMove:o=>!($(o.dragged).hasClass("cant-hide")&&o.from==this.ulVisible[0]&&o.to!==o.from),onEnd:o=>this.updateListStates()}),Sortable.create(this.ulHidden[0],{group:this.uniqueName+"_group",sort:!1,filter:".js-show",onFilter:o=>{$(o.item).appendTo(this.ulVisible),this.updateListStates()},onEnd:()=>this.updateListStates()}))}onDialogOpen(){super.onDialogOpen(),this.element.find("input").removeAttr("disabled"),this.element.closest(".ui-dialog").children(".ui-dialog-buttonpane").find("button").eq(0).addClass("restore-defaults").next().focus(),this.setupColumns(),no(this.element)}getTemplate(){return`
<div class="search"><input id="~_Search" type="text" disabled /></div>
<div class="columns-container">
<div class="column-list visible-list bg-success">
<h5><i class="fa fa-eye"></i> ${L(O("Controls.ColumnPickerDialog.VisibleColumns"))}</h5>
<ul id="~_VisibleCols"></ul>
</div>
<div class="column-list hidden-list bg-info">
<h5><i class="fa fa-eye-slash"></i> ${L(O("Controls.ColumnPickerDialog.HiddenColumns"))}</h5>
<ul id="~_HiddenCols"></ul>
</div>
</div>`}};vr=g([m.registerClass("Serenity.ColumnPickerDialog"),m.resizable(),m.responsive()],vr);var ha=class{constructor(r){this.options=r;var e=this.dataGrid=r.grid,t=e.getIdProperty(),i=this.getId=u=>u[t];e.element.find(".grid-container").on("click",u=>{if($(u.target).hasClass("s-TreeToggle")){var d=e.slickGrid.getCellFromEvent(u);d.cell>=0&&d.row>=0&&at.toggleClick(u,d.row,d.row,e.view,i)}});var a=e.onViewFilter;e.onViewFilter=function(u){return a.apply(this,[u])?at.filterById(u,e.view,r.getParentId):!1};var o=e.onViewProcessData;if(e.onViewProcessData=function(u){return u=o.apply(this,[u]),u.Entities=ha.applyTreeOrdering(u.Entities,i,r.getParentId),at.setIndents(u.Entities,i,r.getParentId,r.initialCollapse&&r.initialCollapse()||!1),u},r.toggleField){var l=ks(e.allColumns||e.slickGrid.getColumns()||[],u=>u.field==r.toggleField);l&&(l.format=Pt.treeToggle(()=>e.view,i,l.format||(u=>L(u.value))))}}toggleAll(){at.setCollapsed(this.dataGrid.view.getItems(),!this.dataGrid.view.getItems().every(r=>r._collapsed==!0)),this.dataGrid.view.setItems(this.dataGrid.view.getItems(),!0)}collapseAll(){at.setCollapsed(this.dataGrid.view.getItems(),!0),this.dataGrid.view.setItems(this.dataGrid.view.getItems(),!0)}expandAll(){at.setCollapsed(this.dataGrid.view.getItems(),!1),this.dataGrid.view.setItems(this.dataGrid.view.getItems(),!0)}static applyTreeOrdering(r,e,t){var i=[],a=Sa(r,e),o=Sa(r,t),l={};function u(p){if(!l[p]){l[p]=!0;for(var f of o[p]||[])i.push(f),u(e(f))}}for(var d of r){var c=t(d);(c==null||!(a[c]||[]).length)&&(i.push(d),u(e(d)))}return i}};var Ji=class extends De{constructor(e,t){super(e,t);e.addClass("s-CheckTreeEditor"),this.updateItems()}getIdProperty(){return"id"}getTreeItems(){return[]}updateItems(){for(var e=this.getTreeItems(),t={},i=0;i<e.length;i++){var a=e[i];if(a.children=[],w(a.id)||(t[a.id]=a),!w(a.parentId)){var o=t[a.parentId];o!=null&&o.children.push(a)}}this.view.addData({Entities:e,Skip:0,Take:0,TotalCount:e.length}),this.updateSelectAll(),this.updateFlags()}getEditValue(e,t){this.getDelimited()?t[e.name]=this.get_value().join(","):t[e.name]=this.get_value()}setEditValue(e,t){var i=e[t.name];this.set_value(i)}getButtons(){var e=this.getSelectAllText();if(w(e))return null;var t=this,i=[];return i.push(Wi.define(function(){return t},function(a){return a.id},function(a){return a.isSelected},(a,o)=>{a.isSelected!==o&&(a.isSelected=o,this.itemSelectedChanged(a))},null,()=>{this.updateFlags()})),i}itemSelectedChanged(e){}getSelectAllText(){var e;return(e=V("Controls.CheckTreeEditor.SelectAll"))!=null?e:"Select All"}isThreeStateHierarchy(){return!1}createSlickGrid(){this.element.addClass("slick-no-cell-border").addClass("slick-no-odd-even");var e=super.createSlickGrid();return this.element.addClass("slick-hide-header"),e.resizeCanvas(),e}onViewFilter(e){if(!super.onViewFilter(e))return!1;var t=this.view.getItems(),i=this;return at.filterCustom(e,function(a){if(a.parentId==null)return null;if(i.byId==null){i.byId={};for(var o=0;o<t.length;o++){var l=t[o];l.id!=null&&(i.byId[l.id]=l)}}return i.byId[a.parentId]})}getInitialCollapse(){return!1}onViewProcessData(e){return e=super.onViewProcessData(e),this.byId=null,at.setIndents(e.Entities,function(t){return t.id},function(t){return t.parentId},this.getInitialCollapse()),e}onClick(e,t,i){if(super.onClick(e,t,i),e.isDefaultPrevented()||at.toggleClick(e,t,i,this.view,function(d){return d.id}),!e.isDefaultPrevented()){var a=$(e.target);if(a.hasClass("check-box")){if(e.preventDefault(),this._readOnly)return;var o=a.hasClass("checked")||a.hasClass("partial"),l=this.itemAt(t),u=l.isSelected!==!o;this.view.beginUpdate();try{l.isSelected!==!o&&(l.isSelected=!o,this.view.updateItem(l.id,l),this.itemSelectedChanged(l)),u=this.setAllSubTreeSelected(l,l.isSelected)||u,this.updateSelectAll(),this.updateFlags()}finally{this.view.endUpdate()}u&&this.element.triggerHandler("change")}}}updateSelectAll(){Wi.update(this,function(e){return e.isSelected})}updateFlags(){var e=this.view,t=e.getItems(),i=this.isThreeStateHierarchy();if(i){e.beginUpdate();try{for(var a=0;a<t.length;a++){var o=t[a];if(o.children==null||o.children.length===0){var l=this.getDescendantsSelected(o);l!==o.isAllDescendantsSelected&&(o.isAllDescendantsSelected=l,e.updateItem(o.id,o));continue}var u=this.allDescendantsSelected(o),d=u||this.anyDescendantsSelected(o);if(u!==o.isAllDescendantsSelected||d!==o.isSelected){var c=o.isSelected!==d;o.isAllDescendantsSelected=u,o.isSelected=d,e.updateItem(o.id,o),c&&this.itemSelectedChanged(o)}}}finally{e.endUpdate()}}}getDescendantsSelected(e){return!0}setAllSubTreeSelected(e,t){for(var i=!1,a=0;a<e.children.length;a++){var o=e.children[a];o.isSelected!==t&&(i=!0,o.isSelected=t,this.view.updateItem(o.id,o),this.itemSelectedChanged(o)),o.children.length>0&&(i=this.setAllSubTreeSelected(o,t)||i)}return i}allItemsSelected(){for(var e=0;e<this.rowCount();e++){var t=this.itemAt(e);if(!t.isSelected)return!1}return this.rowCount()>0}allDescendantsSelected(e){if(e.children.length>0)for(var t=0;t<e.children.length;t++){var i=e.children[t];if(!i.isSelected||!this.allDescendantsSelected(i))return!1}return!0}getDelimited(){return!!this.options.delimited}anyDescendantsSelected(e){if(e.children.length>0)for(var t=0;t<e.children.length;t++){var i=e.children[t];if(i.isSelected||this.anyDescendantsSelected(i))return!0}return!1}getColumns(){var e=this,t=[];return t.push({field:"text",name:"Kay\u0131t",width:80,format:Pt.treeToggle(function(){return e.view},function(i){return i.id},i=>{var a="check-box",o=i.item;if(o.hideCheckBox)return this.getItemText(i);var l=this.isThreeStateHierarchy();return o.isSelected&&(l&&!o.isAllDescendantsSelected?a+=" partial":a+=" checked"),this._readOnly&&(a+=" readonly"),'<span class="'+a+'"></span>'+this.getItemText(i)})}),t}getItemText(e){return L(e.value)}getSlickOptions(){var e=super.getSlickOptions();return e.forceFitColumns=!0,e}sortItems(){if(this.moveSelectedUp()){for(var e={},t=this.view.getItems(),i=0,a=0;a<t.length;a++){var o=t[a];e[o.id]=i++}t.sort(function(l,u){if(l.isSelected&&!u.isSelected)return-1;if(u.isSelected&&!l.isSelected)return 1;var d=F.stringCompare(l.text,u.text);return d!==0?d:e[l.id]<e[u.id]?-1:e[l.id]>e[u.id]?1:0}),this.view.setItems(t,!0)}}moveSelectedUp(){return!1}get_readOnly(){return this._readOnly}set_readOnly(e){!!this._readOnly!=!!e&&(this._readOnly=!!e,this.view.refresh())}get_value(){for(var e=[],t=this.view.getItems(),i=0;i<t.length;i++)t[i].isSelected&&e.push(t[i].id);return e}get value(){return this.get_value()}set_value(e){var t={};if(e!=null){typeof e=="string"&&(e=e.split(",").map(d=>Y(d)).filter(d=>d!=null));for(var i=0;i<e.length;i++)t[e[i]]=!0}this.view.beginUpdate();try{for(var a=this.view.getItems(),o=0;o<a.length;o++){var l=a[o],u=t[l.id];u!==l.isSelected&&(l.isSelected=u,this.view.updateItem(l.id,l))}this.updateSelectAll(),this.updateFlags(),this.sortItems()}finally{this.view.endUpdate()}}set value(e){this.set_value(e)}};Ji=g([m.registerEditor("Serenity.CheckTreeEditor",[rt,it,pe]),m.element("<div/>")],Ji);var ga=class extends Ji{constructor(e,t){super(e,t);this.enableUpdateItems=!0,this.setCascadeFrom(this.options.cascadeFrom),this.updateItems(),he.bindToChange("Lookup."+this.getLookupKey(),this.uniqueName,()=>this.updateItems())}updateItems(){this.enableUpdateItems&&super.updateItems()}getLookupKey(){return this.options.lookupKey}getButtons(){var e;return(e=super.getButtons())!=null?e:this.options.hideSearch?null:[]}createToolbarExtensions(){super.createToolbarExtensions(),qr.addQuickSearchInputCustom(this.toolbar.element,(e,t)=>{this.searchText=Select2.util.stripDiacritics(t||"").toUpperCase(),this.view.setItems(this.view.getItems(),!0)})}getSelectAllText(){return this.options.showSelectAll?super.getSelectAllText():null}cascadeItems(e){var t=this.get_cascadeValue();if(t==null||t==="")return w(this.get_cascadeField())?e:[];var i=t.toString(),a=this.get_cascadeField();return e.filter(o=>{var u;var l=(u=o[a])!=null?u:lt.getPropertyValue(o,a);return l!=null&&l.toString()===i})}filterItems(e){var t=this.get_filterValue();if(t==null||t==="")return e;var i=t.toString(),a=this.get_filterField();return e.filter(o=>{var u;var l=(u=o[a])!=null?u:lt.getPropertyValue(o,a);return l!=null&&l.toString()===i})}getLookupItems(e){return this.filterItems(this.cascadeItems(e.items))}getTreeItems(){var e=Or(this.options.lookupKey),t=this.getLookupItems(e);return t.map(i=>{var a,o;return{id:((a=i[e.idField])!=null?a:"").toString(),text:((o=i[e.textField])!=null?o:"").toString(),source:i}})}onViewFilter(e){return super.onViewFilter(e)&&(w(this.searchText)||Select2.util.stripDiacritics(e.text||"").toUpperCase().indexOf(this.searchText)>=0)}moveSelectedUp(){return this.options.checkedOnTop}get_cascadeFrom(){return this.options.cascadeFrom}get cascadeFrom(){return this.get_cascadeFrom()}getCascadeFromValue(e){return q.getValue(e)}setCascadeFrom(e){if(w(e)){this.cascadeLink!=null&&(this.cascadeLink.set_parentID(null),this.cascadeLink=null),this.options.cascadeFrom=null;return}this.cascadeLink=new cr(P,this,t=>{this.set_cascadeValue(this.getCascadeFromValue(t))}),this.cascadeLink.set_parentID(e),this.options.cascadeFrom=e}set_cascadeFrom(e){e!==this.options.cascadeFrom&&(this.setCascadeFrom(e),this.updateItems())}set cascadeFrom(e){this.set_cascadeFrom(e)}get_cascadeField(){var e;return(e=this.options.cascadeField)!=null?e:this.options.cascadeFrom}get cascadeField(){return this.get_cascadeField()}set_cascadeField(e){this.options.cascadeField=e}set cascadeField(e){this.set_cascadeField(e)}get_cascadeValue(){return this.options.cascadeValue}get cascadeValue(){return this.get_cascadeValue()}set_cascadeValue(e){this.options.cascadeValue!==e&&(this.options.cascadeValue=e,this.value=[],this.updateItems())}set cascadeValue(e){this.set_cascadeValue(e)}get_filterField(){return this.options.filterField}get filterField(){return this.get_filterField()}set_filterField(e){this.options.filterField=e}set filterField(e){this.set_filterField(e)}get_filterValue(){return this.options.filterValue}get filterValue(){return this.get_filterValue()}set_filterValue(e){this.options.filterValue!==e&&(this.options.filterValue=e,this.value=null,this.updateItems())}set filterValue(e){this.set_filterValue(e)}};ga=g([m.registerEditor("Serenity.CheckLookupEditor")],ga);var ma=class extends De{constructor(e,t){super(e,t);this.element.addClass("route-handler").on("handleroute."+this.uniqueName,(i,a)=>this.handleRoute(a))}handleRoute(e){var a,o;if(!e.handled){if(e.route==="new"){e.handled=!0,this.addButtonClick();return}var t=(a=k)==null?void 0:a.active,i=e.route.split("/");if(i.length===2&&i[0]==="edit")e.handled=!0,this.editItem(decodeURIComponent(i[1]));else if(i.length===2&&i[1]==="new")e.handled=!0,this.editItemOfType(i[0],null);else if(i.length===3&&i[1]==="edit")e.handled=!0,this.editItemOfType(i[0],decodeURIComponent(i[2]));else return;((o=k)==null?void 0:o.active)>t&&e.handled&&e.index>=0&&e.index<e.parts.length-1&&k(document).one("ajaxStop",()=>{setTimeout(()=>Ke.resolve("#"+e.parts.join("/+/")),1)})}}usePager(){return!0}createToolbarExtensions(){this.createIncludeDeletedButton(),this.createQuickSearchInput()}getInitialTitle(){return this.getDisplayName()}getLocalTextPrefix(){var e=super.getLocalTextPrefix();return e!=null||this.getRowDefinition()?e:this.getEntityType()}getEntityType(){if(this._entityType!=null)return this._entityType;var e=this.attrs(ir);if(e.length===1)return this._entityType=e[0].value;var t=se(U(this)),i=t.indexOf(".");return i>=0&&(t=t.substring(i+1)),te(t,"Grid")?t=t.substr(0,t.length-4):te(t,"SubGrid")&&(t=t.substr(0,t.length-7)),this._entityType=t,this._entityType}getDisplayName(){if(this._displayName!=null)return this._displayName;var e=this.attrs(Bt);return e.length>=1?(this._displayName=e[0].displayName,this._displayName=yt.getDefault(this._displayName,this._displayName)):(this._displayName=V(this.getLocalTextDbPrefix()+"EntityPlural"),this._displayName==null&&(this._displayName=this.getEntityType())),this._displayName}getItemName(){if(this._itemName!=null)return this._itemName;var e=this.attrs(Vt);return e.length>=1?(this._itemName=e[0].value,this._itemName=yt.getDefault(this._itemName,this._itemName)):(this._itemName=V(this.getLocalTextDbPrefix()+"EntitySingular"),this._itemName==null&&(this._itemName=this.getEntityType())),this._itemName}getAddButtonCaption(){return j(O("Controls.EntityGrid.NewButton"),this.getItemName())}getButtons(){var e=[];return e.push({title:this.getAddButtonCaption(),action:"add",cssClass:"add-button",icon:"fa-plus-circle text-green",hotkey:"alt+n",onClick:()=>{this.addButtonClick()},disabled:()=>!this.hasInsertPermission()||this.readOnly}),e.push(this.newRefreshButton(!0)),e.push(vr.createToolButton(this)),e}newRefreshButton(e){return{title:e?null:O("Controls.EntityGrid.RefreshButton"),hint:e?O("Controls.EntityGrid.RefreshButton"):null,icon:"fa-refresh text-blue",action:"refresh",cssClass:"refresh-button",onClick:()=>{this.refresh()}}}addButtonClick(){this.editItem(new Object)}editItem(e){this.createEntityDialog(this.getItemType(),t=>{var i=Ce(t,$t);if(i!=null){i.load(e,()=>{i.dialogOpen(this.openDialogsAsPanel)});return}throw new Error(j("{0} doesn't implement IEditDialog!",se(U(t))))})}editItemOfType(e,t){if(e===this.getItemType()){this.editItem(t);return}this.createEntityDialog(e,i=>{var a=Ce(i,$t);if(a!=null){a.load(t,()=>a.dialogOpen(this.openDialogsAsPanel));return}throw new Error(j("{0} doesn't implement IEditDialog!",se(U(i))))})}getService(){if(this._service!=null)return this._service;var e=this.attrs(Qt);return e.length>=1?this._service=e[0].value:this._service=Ie(this.getEntityType(),".","/"),this._service}getViewOptions(){var e=super.getViewOptions();return e.url=Ee("~/Services/"+this.getService()+"/List"),e}getItemType(){return this.getEntityType()}routeDialog(e,t){Ke&&Ke.dialog&&Ke.dialog(this.element,t.element,()=>{var i="";return e!==this.getItemType()&&(i=e+"/"),t!=null&&t.entityId!=null?i+="edit/"+t.entityId.toString():i+="new",i})}getInsertPermission(){var e;return(e=this.getRowDefinition())==null?void 0:e.insertPermission}hasInsertPermission(){var e=this.getInsertPermission();return e==null||ae.hasPermission(this.getInsertPermission())}transferDialogReadOnly(e){this.readOnly&&q.setReadOnly(e,!0)}initDialog(e){_t.bindToDataChange(e,this,(t,i)=>{this.subDialogDataChange()},!0),this.transferDialogReadOnly(e),this.routeDialog(this.getItemType(),e)}initEntityDialog(e,t){if(e===this.getItemType()){this.initDialog(t);return}_t.bindToDataChange(t,this,(i,a)=>{this.subDialogDataChange()},!0),this.transferDialogReadOnly(t),this.routeDialog(e,t)}createEntityDialog(e,t){var i=this.getDialogTypeFor(e),a=P.create({type:i,options:this.getDialogOptionsFor(e),init:o=>{this.initEntityDialog(e,o),t&&t(o)}});return a}getDialogOptions(){return{}}getDialogOptionsFor(e){return e===this.getItemType()?this.getDialogOptions():{}}getDialogTypeFor(e){return e===this.getItemType()?this.getDialogType():Lr.get(e)}getDialogType(){if(this._dialogType!=null)return this._dialogType;var e=this.attrs(kr);return e.length>=1?this._dialogType=e[0].value:this._dialogType=Lr.get(this.getEntityType()),this._dialogType}};ma=g([m.registerClass("Serenity.EntityGrid")],ma);var zt=class extends xe{constructor(e){super(e);this.useAsync()?this.initAsync():this.initSync()}internalInit(){this.initPropertyGrid(),this.initLocalizationGrid()}initSync(){this.propertyItemsData=this.getPropertyItemsData(),this.internalInit(),this.afterInit()}initAsync(){return me(this,null,function*(){this.propertyItemsData=yield this.getPropertyItemsDataAsync(),this.internalInit(),this.afterInit()})}afterInit(){}useAsync(){return!1}destroy(){this.propertyGrid&&(this.propertyGrid.destroy(),this.propertyGrid=null),this.localizationGrid&&(this.localizationGrid.destroy(),this.localizationGrid=null),this.undeleteButton=null,this.applyChangesButton=null,this.deleteButton=null,this.saveAndCloseButton=null,this.editButton=null,this.cloneButton=null,this.toolbar=null,super.destroy()}get_entity(){return this.entity}set_entity(e){this.entity=e||new Object}get_entityId(){return this.entityId}set_entityId(e){this.entityId=e}getEntityNameFieldValue(){var e;return((e=this.get_entity()[this.getNameProperty()])!=null?e:"").toString()}getEntityTitle(){var i;if(this.isEditMode()){var e=this.isViewMode()||this.readOnly||!this.hasSavePermission()?O("Controls.EntityDialog.ViewRecordTitle"):O("Controls.EntityDialog.EditRecordTitle"),t=(i=this.getEntityNameFieldValue())!=null?i:"";return j(e,this.getEntitySingular(),w(t)?"":" ("+t+")")}else return j(O("Controls.EntityDialog.NewRecordTitle"),this.getEntitySingular())}updateTitle(){this.dialogTitle=this.getEntityTitle()}isCloneMode(){return!1}isEditMode(){return this.get_entityId()!=null&&!this.isCloneMode()}isDeleted(){if(this.get_entityId()==null)return!1;var e=this.getIsDeletedProperty();if(e)return!!this.get_entity()[e];var t=this.get_entity()[this.getIsActiveProperty()];return t==null?!1:t<0}isNew(){return this.get_entityId()==null}isNewOrDeleted(){return this.isNew()||this.isDeleted()}getDeleteOptions(e){return{}}deleteHandler(e,t){$e(e)}doDelete(e){var t=this,i={EntityId:this.get_entityId()},a={service:this.getService()+"/Delete",request:i,onSuccess:u=>{t.onDeleteSuccess(u),e!=null&&e(u),t.element.triggerHandler("ondatachange",[{entityId:i.EntityId,entity:this.entity,type:"delete"}])}},o=this.getDeleteOptions(e),l=Q(a,o);this.deleteHandler(l,e)}onDeleteSuccess(e){}attrs(e){return ce(U(this),e,!0)}getRowDefinition(){return null}getEntityType(){if(this._entityType!=null)return this._entityType;var e=this.attrs(ir);if(e.length===1)return this._entityType=e[0].value;var t=se(U(this)),i=t.indexOf(".");return i>=0&&(t=t.substring(i+1)),te(t,"Dialog")||te(t,"Control")?t=t.substr(0,t.length-6):te(t,"Panel")&&(t=t.substr(0,t.length-5)),this._entityType=t}getFormKey(){if(this._formKey!=null)return this._formKey;var e=this.attrs(wt);return e.length>=1?this._formKey=e[0].value:this._formKey=this.getEntityType()}getLocalTextDbPrefix(){var e;return this._localTextDbPrefix!=null?this._localTextDbPrefix:(this._localTextDbPrefix=(e=this.getLocalTextPrefix())!=null?e:"",this._localTextDbPrefix.length>0&&!te(this._localTextDbPrefix,".")&&(this._localTextDbPrefix="Db."+this._localTextDbPrefix+"."),this._localTextDbPrefix)}getLocalTextPrefix(){var e=this.getRowDefinition();if(e)return e.localTextPrefix;var t=this.attrs(sr);return t.length>=1?t[0].value:this.getEntityType()}getEntitySingular(){if(this._entitySingular!=null)return this._entitySingular;var e=this.attrs(Vt);if(e.length>=1)this._entitySingular=e[0].value,this._entitySingular=yt.getDefault(this._entitySingular,this._entitySingular);else{var t=V(this.getLocalTextDbPrefix()+"EntitySingular");t==null&&(t=this.getEntityType()),this._entitySingular=t}return this._entitySingular}getNameProperty(){var i,a;if(this._nameProperty!=null)return this._nameProperty;var e=this.getRowDefinition();if(e)return this._nameProperty=(i=e.nameProperty)!=null?i:"";var t=this.attrs(si);return t.length>=1?this._nameProperty=(a=t[0].value)!=null?a:"":this._nameProperty="Name"}getIdProperty(){var i,a;if(this._idProperty!=null)return this._idProperty;var e=this.getRowDefinition();if(e)return this._idProperty=(i=e.idProperty)!=null?i:"";var t=this.attrs(nr);return t.length===1?this._idProperty=(a=t[0].value)!=null?a:"":this._idProperty="ID"}getIsActiveProperty(){var i,a;if(this._isActiveProperty!=null)return this._isActiveProperty;var e=this.getRowDefinition();if(e)return this._isActiveProperty=(i=e.isActiveProperty)!=null?i:"";var t=this.attrs(ar);return t.length===1?this._isActiveProperty=(a=t[0].value)!=null?a:"":this._isActiveProperty=""}getIsDeletedProperty(){var e;return(e=this.getRowDefinition())==null?void 0:e.isDeletedProperty}getService(){if(this._service!=null)return this._service;var e=this.attrs(Qt);return e.length>=1?this._service=e[0].value:this._service=Ie(this.getEntityType(),".","/"),this._service}load(e,t,i){var a=()=>{if(e==null){this.loadResponse({}),t&&t();return}var l=typeof e;if(l==="string"||l==="number"){var u=e;this.loadById(u,function(c){t&&window.setTimeout(t,0)},null);return}var d=e||new Object;this.loadResponse({Entity:d}),t&&t()};if(i==null){a();return}try{a()}catch(l){var o=ye.wrap(l);i(o)}}loadNewAndOpenDialog(e){this.loadResponse({}),this.dialogOpen(e)}loadEntityAndOpenDialog(e,t){this.loadResponse({Entity:e}),this.dialogOpen(t)}loadResponse(e){e=e||{},this.onLoadingData(e);var t=e.Entity||new Object;this.beforeLoadEntity(t),this.loadEntity(t),this.set_entity(t),this.afterLoadEntity()}loadEntity(e){var t=this.getIdProperty();t!=null&&this.set_entityId(e[t]),this.set_entity(e),this.propertyGrid!=null&&(this.propertyGrid.set_mode(this.isEditMode()?2:1),this.propertyGrid.load(e))}beforeLoadEntity(e){this.localizationPendingValue=null,this.localizationLastValue=null}afterLoadEntity(){this.updateInterface(),this.updateTitle()}loadByIdAndOpenDialog(e,t){this.loadById(e,i=>window.setTimeout(()=>this.dialogOpen(t),0),()=>{this.element.is(":visible")||this.element.remove()})}onLoadingData(e){}getLoadByIdOptions(e,t){return{}}getLoadByIdRequest(e){var t={};return t.EntityId=e,t}reloadById(){this.loadById(this.get_entityId())}loadById(e,t,i){var a={service:this.getService()+"/Retrieve",blockUI:!0,request:this.getLoadByIdRequest(e),onSuccess:u=>{this.loadResponse(u),t&&t(u)},onCleanup:()=>{this.validator!=null&&Vi(this.validator)}},o=this.getLoadByIdOptions(e,t),l=Q(a,o);this.loadByIdHandler(l,t,i)}loadByIdHandler(e,t,i){var a=$e(e);i&&a.fail(i)}initLocalizationGrid(){var e=this.byId("PropertyGrid");if(!(e.length<=0)){var t=this.getPropertyGridOptions();this.initLocalizationGridCommon(t)}}initLocalizationGridCommon(e){var t=this.byId("PropertyGrid");if(Nt(e.items,c=>c.localizable===!0)){var i=$("<div/>").attr("id",this.idPrefix+"LocalizationGrid").hide().insertAfter(t);e.idPrefix=this.idPrefix+"Localization_";var a=[];for(var o of e.items){var l=null;if(o.localizable===!0){var u=Q({},o);u.oneWay=!0,u.readOnly=!0,u.required=!1,u.defaultValue=null,a.push(u),l==null&&(l=this.getLangs());for(var d of l)u=Q({},o),u.name=d[0]+"$"+u.name,u.title=d[1],u.cssClass=[u.cssClass,"translation"].join(" "),u.insertable=!0,u.updatable=!0,u.oneWay=!1,u.required=!1,u.localizable=!1,u.defaultValue=null,a.push(u)}}e.items=a,this.localizationGrid=new ze(i,e).init(null),i.addClass("s-LocalizationGrid")}}isLocalizationMode(){return this.localizationButton!=null&&this.localizationButton.hasClass("pressed")}isLocalizationModeAndChanged(){if(!this.isLocalizationMode())return!1;var e=this.getLocalizationGridValue();return JSON.stringify(this.localizationLastValue)!=JSON.stringify(e)}localizationButtonClick(){if(!(this.isLocalizationMode()&&!this.validateForm())){if(this.isLocalizationModeAndChanged()){var e=this.getLocalizationGridValue();this.localizationLastValue=e,this.localizationPendingValue=e}this.localizationButton.toggleClass("pressed"),this.updateInterface(),this.isLocalizationMode()&&this.loadLocalization()}}getLanguages(){return zt.defaultLanguageList!=null?zt.defaultLanguageList()||[]:[]}getLangs(){var e=this.getLanguages(),t=Ce(e,Array);return(t==null||t.length===0||t[0]==null||!Array.isArray(t[0]))&&(t=Array.prototype.slice.call(e.map(function(i){return[i.item1,i.item2]}))),t}loadLocalization(){if(this.localizationLastValue==null&&this.isNew()){this.localizationGrid.load({}),this.setLocalizationGridCurrentValues(),this.localizationLastValue=this.getLocalizationGridValue();return}if(this.localizationLastValue!=null){this.localizationGrid.load(this.localizationLastValue),this.setLocalizationGridCurrentValues();return}var e={service:this.getService()+"/Retrieve",blockUI:!0,request:{EntityId:this.get_entityId(),ColumnSelection:"keyOnly",IncludeColumns:["Localizations"]},onSuccess:t=>{var i=Q(new Object,this.get_entity());if(t.Localizations)for(var a of Object.keys(t.Localizations)){var o=t.Localizations[a];for(var l of Object.keys(o))i[a+"$"+l]=o[l]}this.localizationGrid.load(i),this.setLocalizationGridCurrentValues(),this.localizationPendingValue=null,this.localizationLastValue=this.getLocalizationGridValue()}};$e(e)}setLocalizationGridCurrentValues(){var e={};this.localizationGrid.enumerateItems((t,i)=>{t.name.indexOf("$")<0&&i.element.is(":input")&&(e[t.name]=this.byId(t.name).val(),i.element.val(e[t.name]))}),this.localizationGrid.enumerateItems((t,i)=>{var a=t.name.indexOf("$");if(a>=0&&i.element.is(":input")){var o=e[t.name.substr(a+1)];o!=null&&o.length>0&&i.element.attr("title",o).attr("placeholder",o)}})}getLocalizationGridValue(){var e={};this.localizationGrid.save(e);for(var t of Object.keys(e))t.indexOf("$")<0&&delete e[t];return e}getPendingLocalizations(){if(this.localizationPendingValue==null)return null;var e={},t=this.getIdProperty(),i=this.getLangs();for(var a of i){var o=a[0],l={};t!=null&&(l[t]=this.get_entityId());var u=o+"$";for(var d of Object.keys(this.localizationPendingValue))G(d,u)&&(l[d.substr(u.length)]=this.localizationPendingValue[d]);e[o]=l}return e}initPropertyGrid(){var e=this.byId("PropertyGrid");if(!(e.length<=0)){var t=this.getPropertyGridOptions();this.propertyGrid=new ze(e,t).init(null),this.element.closest(".ui-dialog").hasClass("s-Flexify")&&this.propertyGrid.element.children(".categories").flexHeightOnly(1)}}getPropertyItems(){var e;return((e=this.propertyItemsData)==null?void 0:e.items)||[]}getPropertyItemsData(){var e=this.getFormKey();return this.getFormKey===zt.prototype.getFormKey&&this.getPropertyItems!==zt.prototype.getPropertyItems&&!he.canLoad("Form."+e)?{items:this.getPropertyItems(),additionalItems:[]}:w(e)?{items:[],additionalItems:[]}:Li(e)}getPropertyItemsDataAsync(){return me(this,null,function*(){var e=this.getFormKey();return w(e)?{items:[],additionalItems:[]}:yield Mi(e)})}getPropertyGridOptions(){return{idPrefix:this.idPrefix,items:this.getPropertyItems(),mode:1,localTextPrefix:"Forms."+this.getFormKey()+".",useCategories:!0}}validateBeforeSave(){return!0}getSaveOptions(e){var t={};return t.service=this.getService()+"/"+(this.isEditMode()?"Update":"Create"),t.onSuccess=i=>{this.onSaveSuccess(i),e&&e(i);var a=this.isEditMode()?"update":"create",o=t.request==null?null:t.request.Entity,l=this.isEditMode()?this.get_entityId():i==null?null:i.EntityId,u={type:a,entity:o,entityId:l};this.element.triggerHandler("ondatachange",[u])},t.onCleanup=()=>{this.validator&&Vi(this.validator)},t.request=this.getSaveRequest(),t}getSaveEntity(){var e=new Object;if(this.propertyGrid!=null&&this.propertyGrid.save(e),this.isEditMode()){var t=this.getIdProperty();t!=null&&e[t]==null&&(e[t]=this.get_entityId())}return e}getSaveRequest(){var e=this.getSaveEntity(),t={};if(t.Entity=e,this.isEditMode()){var i=this.getIdProperty();i!=null&&(t.EntityId=this.get_entityId())}return this.localizationPendingValue!=null&&(t.Localizations=this.getPendingLocalizations()),t}onSaveSuccess(e){}save_submitHandler(e){var t=this.getSaveOptions(e);this.saveHandler(t,e)}save(e){return li.submit(this.byId("Form"),()=>this.validateBeforeSave(),()=>this.save_submitHandler(e))}saveHandler(e,t){$e(e)}initToolbar(){super.initToolbar(),this.toolbar&&(this.saveAndCloseButton=this.toolbar.findButton("save-and-close-button"),this.applyChangesButton=this.toolbar.findButton("apply-changes-button"),this.deleteButton=this.toolbar.findButton("delete-button"),this.undeleteButton=this.toolbar.findButton("undo-delete-button"),this.editButton=this.toolbar.findButton("edit-button"),this.cloneButton=this.toolbar.findButton("clone-button"),this.localizationButton=this.toolbar.findButton("localization-button"))}showSaveSuccessMessage(e){Vs(O("Controls.EntityDialog.SaveSuccessMessage"),"",null)}getToolbarButtons(){var e=[];return e.push({title:O("Controls.EntityDialog.SaveButton"),action:"save-and-close",cssClass:"save-and-close-button",icon:"fa-check-circle text-purple",hotkey:"alt+s",onClick:()=>{this.save(t=>{this.dialogClose()})},visible:()=>!this.isDeleted()&&!this.isViewMode(),disabled:()=>!this.hasSavePermission()||this.readOnly}),e.push({title:"",hint:O("Controls.EntityDialog.ApplyChangesButton"),action:"apply-changes",cssClass:"apply-changes-button",icon:"fa-clipboard-check text-purple",hotkey:"alt+a",onClick:()=>{this.save(t=>{if(this.isEditMode()){var i=t.EntityId;i==null&&(i=this.get_entityId()),this.loadById(i)}else this.loadById(t.EntityId);this.showSaveSuccessMessage(t)})},visible:()=>!this.isDeleted()&&!this.isViewMode(),disabled:()=>!this.hasSavePermission()||this.readOnly}),e.push({title:O("Controls.EntityDialog.DeleteButton"),cssClass:"delete-button",icon:"fa-trash-o text-red",hotkey:"alt+x",onClick:()=>{Zr(O("Controls.EntityDialog.DeleteConfirmation"),()=>{this.doDelete(()=>this.dialogClose())})},visible:()=>this.isEditMode()&&!this.isDeleted()&&!this.isViewMode(),disabled:()=>!this.hasDeletePermission()||this.readOnly}),e.push({title:O("Controls.EntityDialog.UndeleteButton"),action:"undo-delete",cssClass:"undo-delete-button",onClick:()=>{this.isDeleted()&&Zr(O("Controls.EntityDialog.UndeleteConfirmation"),()=>{this.undelete(()=>this.loadById(this.get_entityId()))})},visible:()=>this.isEditMode()&&this.isDeleted()&&!this.isViewMode(),disabled:()=>!this.hasDeletePermission()||this.readOnly}),this.useViewMode()&&e.push({title:O("Controls.EntityDialog.EditButton"),action:"delete",cssClass:"edit-button",icon:"fa-edit",onClick:()=>{this.isEditMode()&&(this.editClicked=!0,this.updateInterface(),this.updateTitle())},visible:()=>this.isViewMode(),disabled:()=>!this.hasSavePermission()||this.readOnly}),e.push({title:O("Controls.EntityDialog.LocalizationButton"),action:"localization",cssClass:"localization-button",onClick:()=>this.localizationButtonClick()}),e.push({title:O("Controls.EntityDialog.CloneButton"),action:"clone",cssClass:"clone-button",icon:"fa-clone",onClick:()=>{if(this.isEditMode()){var t=this.getCloningEntity();P.create({type:U(this),init:i=>_t.bubbleDataChange(_t.cascade(i,this.element),this,!0).loadEntityAndOpenDialog(t,null)})}},visible:()=>!1,disabled:()=>!this.hasInsertPermission()||this.readOnly}),e}getCloningEntity(){var e=new Object;e=Q(e,this.get_entity());var t=this.getIdProperty();w(t)||delete e[t];var i=this.getIsActiveProperty();w(i)||delete e[i];var a=this.getIsDeletedProperty();return w(a)||delete e[a],e}updateInterface(){q.setContainerReadOnly(this.byId("Form"),!1);var e=this.isLocalizationMode(),t=this.hasSavePermission(),i=this.isViewMode(),a=this.readOnly;if(this.toolbar.updateInterface(),this.tabs!=null&&Vn.setDisabled(this.tabs,"Log",this.isNewOrDeleted()),this.propertyGrid!=null&&this.propertyGrid.element.toggle(!e),this.localizationGrid!=null&&this.localizationGrid.element.toggle(e),this.localizationButton!=null&&(this.localizationButton.toggle(this.localizationGrid!=null),this.localizationButton.find(".button-inner").text(this.isLocalizationMode()?O("Controls.EntityDialog.LocalizationBack"):O("Controls.EntityDialog.LocalizationButton"))),e){this.toolbar!=null&&this.toolbar.findButton("tool-button").not(".localization-hidden").addClass(".localization-hidden").hide(),this.localizationButton&&this.localizationButton.show();return}this.toolbar.findButton("localization-hidden").removeClass("localization-hidden").show(),(!t||i||a)&&q.setContainerReadOnly(this.byId("Form"),!0)}getUndeleteOptions(e){return{}}undeleteHandler(e,t){$e(e)}undelete(e){var t={};t.service=this.getService()+"/Undelete";var i={};i.EntityId=this.get_entityId(),t.request=i,t.onSuccess=l=>{e&&e(l),this.element.triggerHandler("ondatachange",[{entityId:this.get_entityId(),entity:this.entity,type:"undelete"}])};var a=this.getUndeleteOptions(e),o=Q(t,a);this.undeleteHandler(o,e)}get readOnly(){return this.get_readOnly()}set readOnly(e){this.set_readOnly(e)}get_readOnly(){return!!this._readonly}set_readOnly(e){!!this._readonly!=!!e&&(this._readonly=!!e,this.updateInterface(),this.updateTitle())}getInsertPermission(){var e;return(e=this.getRowDefinition())==null?void 0:e.insertPermission}getUpdatePermission(){var e;return(e=this.getRowDefinition())==null?void 0:e.updatePermission}getDeletePermission(){var e;return(e=this.getRowDefinition())==null?void 0:e.deletePermission}hasDeletePermission(){var e=this.getDeletePermission();return e==null||ae.hasPermission(e)}hasInsertPermission(){var e=this.getInsertPermission();return e==null||ae.hasPermission(e)}hasUpdatePermission(){var e=this.getUpdatePermission();return e==null||ae.hasPermission(e)}hasSavePermission(){return this.isNew()?this.hasInsertPermission():this.hasUpdatePermission()}isViewMode(){return this.useViewMode()&&this.isEditMode()&&!this.editClicked}useViewMode(){return!1}getFallbackTemplate(){return`<div class="s-DialogContent">
    <div id="~_Toolbar" class="s-DialogToolbar">
    </div>
    <div class="s-Form">
        <form id="~_Form" action="">
            <div class="fieldset">
                <div id="~_PropertyGrid"></div>
                <div class="clear"></div>
            </div>
        </form> 
    </div>
</div>`}};zt=g([m.registerClass("Serenity.EntityDialog",[$t,pe])],zt);function Cu(n){var r=P.create({type:this,element:e=>{var t=e[0];n.id!=null&&(t.id=n.id),n.name!=null&&t.setAttribute("name",n.name),n.placeholder!=null&&t.setAttribute("placeholder",n.placeholder),n.className!=null?t.className=n.className:n.class!=null&&(t.className=n.class),n.oneWay&&(t.dataset.oneWay="1"),n.maxLength!=null?t.setAttribute("maxLength",n.maxLength||0):n.maxlength!=null&&t.setAttribute("maxLength",n.maxlength||0)}});return n.required!=null&&q.setRequired(r,n.required),n.readOnly!==null?q.setReadOnly(r,n.readOnly):n.readonly!==null&&q.setReadOnly(r,n.readonly),n.setOptions!=n.setOptions&&ut.set(r,n.setOptions),n.value!==void 0?q.setValue(r,n.value):n.initialValue!=null&&q.setValue(r,n.initialValue),n.onChange!=null?r.element.on("change",n.onChange):n.onchange!=null&&r.element.on("change",n.onchange),n.onChangeSelect2!=null&&r.changeSelect2(n.onChangeSelect2),n.ref&&n.ref(r),r.element[0]}function wC(n){return Cu.bind(n)}var Io;(e=>{let n=class extends xe{constructor(a){super(a);a.reportKey&&this.loadReport(a.reportKey)}createPropertyGrid(){this.propertyGrid&&(this.byId("PropertyGrid").html("").attr("class",""),this.propertyGrid=null),this.propertyGrid=new ze(this.byId("PropertyGrid"),{idPrefix:this.idPrefix,useCategories:!0,items:this.propertyItems}).init(null)}loadReport(a){$e({service:"Report/Retrieve",request:{ReportKey:a},onSuccess:o=>{var u;this.reportKey=(u=o.ReportKey)!=null?u:a,this.propertyItems=o.Properties||[],this.dialogTitle=o.Title,this.createPropertyGrid();var l=o.InitialSettings;l==null&&(l=new Object),this.propertyGrid.load(l),this.toolbar.findButton("print-preview-button").toggle(!o.IsDataOnlyReport),this.toolbar.findButton("export-pdf-button").toggle(!o.IsDataOnlyReport),this.toolbar.findButton("export-docx-button").toggle(!o.IsDataOnlyReport),this.dialogOpen(null)}})}executeReport(a,o){if(this.validateForm()){var l=new Object;this.propertyGrid.save(l),js({service:"Report/Execute",request:{ReportKey:this.reportKey,DesignId:"Default",ExportType:o,Parameters:l},target:a})}}getToolbarButtons(){var a=[];return a.push({title:"\xD6nizleme",cssClass:"print-preview-button",onClick:()=>{this.executeReport("_blank",null)}}),a.push({title:"PDF",cssClass:"export-pdf-button",onClick:()=>{this.executeReport("","Pdf")}}),a.push({title:"Excel",cssClass:"export-xlsx-button",onClick:()=>{this.executeReport("","Xlsx")}}),a.push({title:"Word",cssClass:"export-docx-button",onClick:()=>{this.executeReport("","Docx")}}),a}};n=g([m.registerClass("Serenity.Reporting.ReportDialog")],n),e.ReportDialog=n;let r=class extends P{constructor(i){super(i),$(".report-link").click(o=>this.reportLinkClick(o)),$("div.line").click(o=>this.categoryClick(o));var a=this;new nt($("#QuickSearchInput"),{onSearch:function(o,l,u){a.updateMatchFlags(l),u(!0)}})}updateMatchFlags(i){var a=$("#ReportList").find("li").removeClass("non-match");if(i=Y(i),i==null){a.children("ul").hide(),a.show().removeClass("expanded");return}for(var o=i.replace(","," ").split(" "),l=0;l<o.length;l++)o[l]=Y(Select2.util.stripDiacritics(o[l]).toUpperCase());var u=a.filter(".report-item");u.each(function(f,b){var T;for(var x=$(b),v=Select2.util.stripDiacritics(((T=x.text())!=null?T:"").toUpperCase()),I=0;I<o.length;I++){var S=o[I];if(S!=null&&v.indexOf(S)===-1){x.addClass("non-match");break}}});var d=u.not(".non-match"),c=d.parents("li").add(d),p=a.not(c);p.hide().addClass("non-match"),c.show(),c.length<=100&&(a.children("ul").show(),a.addClass("expanded"))}categoryClick(i){var a=$(i.target).closest("li");a.hasClass("expanded")?(a.find("ul").hide("fast"),a.removeClass("expanded"),a.find("li").removeClass("expanded")):(a.addClass("expanded"),a.children("ul").show("fast"),a.children("ul").children("li").length===1&&!a.children("ul").children("li").hasClass("expanded")&&a.children("ul").children("li").children(".line").click())}reportLinkClick(i){i.preventDefault();var a=new n({reportKey:$(i.target).data("key")})}};r=g([m.registerClass("Serenity.Reporting.ReportPage")],r),e.ReportPage=r})(Io||(Io={}));var ya=class{};ya=g([m.registerClass("Serenity.ScriptContext")],ya);var va=class{};va=g([m.registerInterface("Serenity.IAsyncInit")],va);var ba;(o=>{function n(l,u){return l.getWidget(u)}o.getWidget=n,o.getWidgetName=P.getWidgetName;function e(l){return typeof l.originalEvent!="undefined"}o.hasOriginalEvent=e;function t(l,u){l.change(u)}o.change=t;function i(l,u){l.changeSelect2(u)}o.changeSelect2=i;function a(l){return l.getGridField()}o.getGridField=a})(ba||(ba={}));var xa=class extends P{constructor(e,t){var d,c,p,f,b,x,v;super(e,t);var i=(p=new google.m)!=null?p:s.LatLng((d=this.options.latitude)!=null?d:0,(c=this.options.longitude)!=null?c:0),a=new Object;if(a.center=i,a.mapTypeId=(f=this.options.mapTypeId)!=null?f:"roadmap",a.zoom=(b=this.options.zoom)!=null?b:15,a.zoomControl=!0,this.map=new google.maps.Map(e[0],a),this.options.markerTitle!=null){var o=new Object,l=this.options.markerLatitude;l==null&&(l=(x=this.options.latitude)!=null?x:0);var u=this.options.markerLongitude;u==null&&(u=(v=this.options.longitude)!=null?v:0),o.position=new google.maps.LatLng(l,u),o.map=this.map,o.title=this.options.markerTitle,o.animation=2,new google.maps.Marker(o)}kt.executeOnceWhenShown(e,()=>{google.maps.event.trigger(this.map,"resize",[]),this.map.setCenter(i)})}get_map(){return this.map}};xa=g([m.registerEditor("Serenity.GoogleMap",[]),m.element("<div/>")],xa);var Ta=class extends P{constructor(e,t){super(e,t);this.pageSize=50;var i=this.emptyItemText();i!=null&&e.attr("placeholder",i),e.select2(this.getSelect2Options()),e.attr("type","text"),e.on("change."+this.uniqueName,(a,o)=>{(ba.hasOriginalEvent(a)||!o)&&li.getValidator(e)!=null&&e.valid()})}emptyItemText(){var e=this.element.attr("placeholder");return e==null&&(e=O("Controls.SelectEditor.EmptyItemText")),e}getService(){throw new Error("Not implemented!")}query(e,t){var i={blockUI:!1,service:this.getService()+"/List",request:e,onSuccess:function(a){t(a)}};this.executeQuery(i)}executeQuery(e){$e(e)}queryByKey(e,t){var i={blockUI:!1,service:this.getService()+"/Retrieve",request:{EntityId:e},onSuccess:function(a){t(a.Entity)}};this.executeQueryByKey(i)}executeQueryByKey(e){$e(e)}getItemKey(e){return null}getItemText(e){return null}getTypeDelay(){return 200}getSelect2Options(){var e=this.emptyItemText(),t=0;return{minimumResultsForSearch:10,placeHolder:w(e)?null:e,allowClear:tn(e),query:i=>{var a={ContainsText:Y(i.term),Skip:(i.page-1)*this.pageSize,Take:this.pageSize+1};t!==0&&window.clearTimeout(t);var o=$(this.element).data("select2");o&&o.search&&o.search.removeClass("select2-active").parent().removeClass("select2-active"),t=window.setTimeout(()=>{o&&o.search.addClass("select2-active").parent().addClass("select2-active"),this.query(a,l=>{i.callback({results:l.Entities.slice(0,this.pageSize).map(u=>({id:this.getItemKey(u),text:this.getItemText(u),source:u})),more:l.Entities.length>=this.pageSize})})},this.getTypeDelay())},initSelection:(i,a)=>{var o=i.val();if(w(o)){a(null);return}this.queryByKey(o,l=>{a(l==null?null:{id:this.getItemKey(l),text:this.getItemText(l),source:l})})}}}addInplaceCreate(e){var t=this;$("<a><b/></a>").addClass("inplace-button inplace-create").attr("title",e).insertAfter(this.element).click(function(i){t.inplaceCreateClick(i)}),this.get_select2Container().add(this.element).addClass("has-inplace-button")}inplaceCreateClick(e){}get_select2Container(){return this.element.prevAll(".select2-container")}get_value(){return Ce(this.element.select2("val"),String)}get value(){return this.get_value()}set_value(e){if(e!==this.get_value()){var t=this.element;t.select2("val",e),t.data("select2-change-triggered",!0);try{t.triggerHandler("change",[!0])}finally{t.data("select2-change-triggered",!1)}}}set value(e){this.set_value(e)}};Ta=g([m.registerEditor("Serenity.Select2AjaxEditor",[oe]),m.element('<input type="hidden" />')],Ta);export{bn as AggregateFormatting,go as Aggregators,Le as ArgumentNullException,ae as Authorization,ft as BaseEditorFiltering,$r as BaseFiltering,qn as BooleanEditor,yi as BooleanFiltering,Si as BooleanFormatter,mo as CaptureOperationType,cr as CascadedWidgetLink,Tn as CategoryAttribute,ga as CheckLookupEditor,Ji as CheckTreeEditor,oa as CheckboxFormatter,vr as ColumnPickerDialog,oo as ColumnSelection,Co as ColumnsBase,ai as ColumnsKeyAttribute,Se as Config,W as Criteria,vn as CriteriaBuilder,ho as CriteriaOperator,Cn as CssClassAttribute,F as Culture,De as DataGrid,be as DateEditor,mi as DateFiltering,xt as DateFormatter,Be as DateTimeEditor,vi as DateTimeFiltering,la as DateTimeFormatter,Un as DateYearEditor,Et as DecimalEditor,ta as DecimalFiltering,m as Decorators,In as DefaultValueAttribute,dr as DialogExtensions,kr as DialogTypeAttribute,Lr as DialogTypeRegistry,Bt as DisplayNameAttribute,Yt as EditorAttribute,Qr as EditorFiltering,Sn as EditorOptionAttribute,wn as EditorTypeAttribute,Ln as EditorTypeAttributeBase,Mr as EditorTypeRegistry,q as EditorUtils,_r as ElementAttribute,Wn as EmailAddressEditor,di as EmailEditor,zt as EntityDialog,ma as EntityGrid,ir as EntityTypeAttribute,gt as Enum,pi as EnumEditor,ra as EnumFiltering,Ft as EnumFormatter,Ye as EnumKeyAttribute,ur as EnumTypeRegistry,cn as ErrorHandling,ye as Exception,Wt as FileDownloadFormatter,Hi as FileUploadEditor,Ti as FilterDialog,Ci as FilterDisplayBar,J as FilterOperators,xi as FilterPanel,pt as FilterStore,hr as FilterWidgetBase,Er as FilterableAttribute,bi as FilteringTypeRegistry,Bn as Flexify,Dr as FlexifyAttribute,wt as FormKeyAttribute,ua as FormatterTypeRegistry,On as GeneratedCodeAttribute,xa as GoogleMap,ca as GridRadioSelectionMixin,da as GridRowSelectionMixin,Wi as GridSelectAllButtonHelper,qr as GridUtils,kn as HiddenAttribute,_n as HintAttribute,ct as HtmlContentEditor,jn as HtmlNoteContentEditor,Kn as HtmlReportContentEditor,va as IAsyncInit,Gt as IBooleanValue,Ot as IDialog,tt as IDoubleValue,$t as IEditDialog,fr as IFiltering,rt as IGetEditValue,yr as IInitializeColumn,Gr as IQuickFiltering,pe as IReadOnly,it as ISetEditValue,et as ISlickFormatter,oe as IStringValue,qt as IValidateRequired,nr as IdPropertyAttribute,Zn as ImageUploadEditor,En as InsertableAttribute,ui as IntegerEditor,ia as IntegerFiltering,wa as InvalidCastException,Lt as Invariant,ar as IsActivePropertyAttribute,Vt as ItemNameAttribute,yt as LT,Mt as LayoutTimer,kt as LazyLoadHelper,sr as LocalTextPrefixAttribute,ao as Lookup,fi as LookupEditor,$i as LookupEditorBase,na as LookupFiltering,Yn as MaskedEditor,Dn as MaxLengthAttribute,Fr as MaximizableAttribute,_a as MemberType,wi as MinuteFormatter,gi as MultipleFileUploadEditor,ea as MultipleImageUploadEditor,si as NamePropertyAttribute,Jt as NumberFormatter,Fn as OneWayAttribute,or as OptionAttribute,Pr as OptionsTypeAttribute,Rr as PanelAttribute,Gn as PasswordEditor,Pn as PlaceholderAttribute,Br as PopupMenuButton,Mn as PopupToolButton,vo as PrefixedContext,Vr as PropertyDialog,ze as PropertyGrid,Gi as PropertyGridMode,pa as PropertyItemSlickConverter,Qn as PropertyPanel,We as QuickFilterBar,nt as QuickSearchInput,zn as RadioButtonEditor,Rn as ReadOnlyAttribute,Xn as Recaptcha,ut as ReflectionOptionsSetter,lt as ReflectionUtils,xn as RemoteView,Io as Reporting,Nn as RequiredAttribute,Nr as ResizableAttribute,Ar as ResponsiveAttribute,ru as RetrieveColumnSelection,Ke as Router,ya as ScriptContext,he as ScriptData,Ta as Select2AjaxEditor,Re as Select2Editor,pr as SelectEditor,Qt as ServiceAttribute,hi as ServiceLookupEditor,qi as ServiceLookupEditorBase,aa as ServiceLookupFiltering,Pt as SlickFormatting,fa as SlickHelper,Ii as SlickPager,at as SlickTreeHelper,dt as StringEditor,sa as StringFiltering,_t as SubDialogHelper,so as SummaryType,Vn as TabsExtensions,xe as TemplatedDialog,oi as TemplatedPanel,Pe as TemplatedWidget,$n as TextAreaEditor,Hn as TimeEditor,Na as Toastr,He as Toolbar,ha as TreeGridMixin,Jn as URLEditor,An as UpdatableAttribute,Dt as UploadHelper,Ht as UrlFormatter,bo as VX,li as ValidationHelper,ba as WX,P as Widget,Qe as addAttribute,Ku as addEmptyOption,Cr as addOption,Ds as addTypeMember,rr as addValidationRule,bd as alert,_e as alertDialog,Nt as any,Yu as attrEncode,is as baseValidateOptions,ri as blockUI,Sr as blockUndo,Qa as bsModalMarkup,ii as canLoadScriptData,Zt as cast,no as centerDialog,jr as clearKeys,Xu as clearOptions,dn as closePanel,Fu as coalesce,Ql as compareStringFactory,xd as confirm,Zr as confirmDialog,Su as count,To as datePickerIconSvg,qu as dbText,Wu as dbTryText,ro as debounce,Ve as deepClone,Nl as defaultNotifyOptions,sn as delegateCombine,on as delegateRemove,Ga as dialogButtonToBS,$a as dialogButtonToUI,te as endsWith,hn as executeEverytimeWhenVisible,io as executeOnceWhenVisible,Q as extend,Nu as fieldsProxy,Ra as findElementWithRelativeId,wu as first,j as format,ie as formatDate,Wd as formatDayHourAndMin,Zs as formatISODateTimeUTC,It as formatNumber,ce as getAttributes,rn as getBaseType,Kl as getColumns,Yl as getColumnsAsync,Ka as getColumnsData,Ya as getColumnsDataAsync,Wa as getCookie,Xa as getForm,Xl as getFormAsync,Li as getFormData,Mi as getFormDataAsync,_s as getGlobalThis,ni as getHighlightTarget,U as getInstanceType,Or as getLookup,Ua as getLookupAsync,nn as getMembers,Oa as getNested,Ja as getRemoteData,za as getRemoteDataAsync,er as getStateStore,Za as getTemplate,Zl as getTemplateAsync,ka as getType,se as getTypeFullName,br as getTypeNameProp,Xt as getTypeShortName,an as getTypes,Ou as groupBy,L as htmlEncode,ei as iframeDialog,Os as indexOf,Td as information,Ml as informationDialog,Pu as initFormType,vc as initFullHeightGridPage,Fa as initializeTypes,ku as insert,_u as isArray,Ue as isAssignableFrom,Ct as isBS3,vt as isBS5Plus,w as isEmptyOrNull,Ps as isEnum,Ae as isInstanceOfType,Bi as isMobileView,mt as isTrimmedEmpty,tn as isValue,wC as jsxDomWidget,Au as keyOf,ts as layoutFillHeight,tu as layoutFillHeightValue,iu as loadValidationErrorMessages,O as localText,Hd as localeFormat,Bs as newBodyDiv,re as notifyError,ld as notifyInfo,Vs as notifySuccess,Fi as notifyWarning,Js as openPanel,Zu as outerHtml,Ge as padLeft,lu as parseCriteria,je as parseDate,eo as parseDayHourAndMin,tr as parseDecimal,pn as parseHourAndMin,qe as parseISODateTime,st as parseInteger,Md as parseQueryString,Aa as positionToastContainer,js as postToService,Bd as postToUrl,Hu as prefixedText,Ru as prop,Ls as proxyTexts,mu as reactPatch,xr as registerClass,Da as registerEditor,Kr as registerEnum,ln as registerInterface,ja as reloadLookup,jl as reloadLookupAsync,Lc as removeValidationRule,Ie as replaceAll,Ee as resolveUrl,Ri as round,Ce as safeCast,$e as serviceCall,Ld as serviceRequest,Us as setEquality,Es as setTypeNameProp,Eu as single,Jl as splitDateString,G as startsWith,Cd as success,Bl as successDialog,$u as text,Sa as toGrouping,Ni as toId,Mu as toSingleLine,Ur as today,Tt as toggleClass,bc as triggerLayoutOnShow,Je as trim,As as trimEnd,Bu as trimStart,Yr as trimToEmpty,Y as trimToNull,Xs as trunc,ks as tryFirst,V as tryGetText,qd as turkishLocaleCompare,Gd as turkishLocaleToLower,$d as turkishLocaleToUpper,yu as useIdPrefix,Ac as validateForm,mn as validateOptions,Vi as validatorAbortHandler,Id as warning,Vl as warningDialog,Pa as zeroPad};
//# sourceMappingURL=index.js.map
